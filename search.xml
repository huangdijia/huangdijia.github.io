<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>å¤š PHP å¼€å‘ç¯å¢ƒ</title>
      <link href="/multi-php/"/>
      <url>/multi-php/</url>
      
        <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡é€‚ç”¨äº M1 æˆ–æ›´æ–°ç‰ˆæœ¬ macOS ç³»ç»Ÿï¼ŒLinux å¯å‚è€ƒæ€è·¯ã€‚</p></blockquote><h2 id="ä¸€ã€å®‰è£…-homebrew"><a href="#ä¸€ã€å®‰è£…-homebrew" class="headerlink" title="ä¸€ã€å®‰è£… homebrew"></a>ä¸€ã€å®‰è£… <code>homebrew</code></h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"</span><br></pre></td></tr></table></figure><h2 id="äºŒã€å®‰è£…-PHPs"><a href="#äºŒã€å®‰è£…-PHPs" class="headerlink" title="äºŒã€å®‰è£… PHPs"></a>äºŒã€å®‰è£… PHPs</h2><ul><li>æ·»åŠ ä»“åº“æº</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew tap shivammathur/php</span><br></pre></td></tr></table></figure><ul><li>å®‰è£…æŒ‡å®šç‰ˆæœ¬ PHPï¼Œä»¥ <code>7.4</code> ä¸ºä¾‹</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install shivammathur/php/php@7.4</span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="ä¸‰ã€å¿«é€Ÿåˆ‡æ¢ç¥å™¨"><a href="#ä¸‰ã€å¿«é€Ÿåˆ‡æ¢ç¥å™¨" class="headerlink" title="ä¸‰ã€å¿«é€Ÿåˆ‡æ¢ç¥å™¨"></a>ä¸‰ã€å¿«é€Ÿåˆ‡æ¢ç¥å™¨</h2><ul><li>è„šæœ¬ä½ç½® <code>~/scripts/brew-php-switcher.sh</code>ï¼Œ<code>~/scripts</code>å¯æŒ‰ä¸ªäººå–œå¥½è°ƒæ•´</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/sh</span></span><br><span class="line"></span><br><span class="line">if [ -z "$1" ]; then</span><br><span class="line">    echo "Usage: brew-php-switcher &lt;version&gt;"</span><br><span class="line">    return 1</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">version=$1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ£€æµ‹å‚æ•°æ˜¯å¦åŒ¹é… \d\.\d æ ¼å¼</span></span><br><span class="line">if [[ $&#123;version&#125; =~ ^[0-9]\.[0-9]$ ]]; then</span><br><span class="line">    echo "";</span><br><span class="line">else</span><br><span class="line">    echo "å‚æ•°&lt;version&gt;å¿…é¡»ç¬¦åˆ \d\.\d æ ¼å¼"</span><br><span class="line">    return 1</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">formula="php@$version"</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ£€æµ‹å‚æ•°æ˜¯å¦åœ¨ç»™å®šçš„å€¼åˆ—è¡¨ä¸­</span></span><br><span class="line">case $&#123;version&#125; in</span><br><span class="line">    7.4|8.0|8.1|8.2|8.4)</span><br><span class="line">        ;;</span><br><span class="line">    8.3) # é»˜è®¤ç‰ˆæœ¬</span><br><span class="line">        formula="php"</span><br><span class="line">        ;;</span><br><span class="line">    *)</span><br><span class="line">        echo "å‚æ•°&lt;version&gt;ä¸åœ¨ç»™å®šçš„å€¼åˆ—è¡¨ï¼ˆ7.4|8.0|8.1|8.2|8.3|8.4ï¼‰ä¸­"</span><br><span class="line">        return 1</span><br><span class="line">        ;;</span><br><span class="line">esac</span><br><span class="line"></span><br><span class="line">brew list --formula|grep -E "php(\d&#123;2&#125;|@\d\.\d)?$"|xargs brew unlink;</span><br><span class="line">brew link --overwrite --force $&#123;formula&#125; &amp;&amp; php -v</span><br></pre></td></tr></table></figure><ul><li><code>~/.bashrc</code> æˆ– <code>~/.zshrc</code> æ·»åŠ ä»¥ä¸‹è„šæœ¬</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alias brew-php-switcher="sh ~/scripts/brew-php-switcher.sh"</span><br></pre></td></tr></table></figure><ul><li>å¿«é€Ÿåˆ‡æ¢</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew-php-switcher 7.4</span><br></pre></td></tr></table></figure><h2 id="å››ã€è‡ªåŠ¨åˆ‡æ¢-PHP-ç‰ˆæœ¬"><a href="#å››ã€è‡ªåŠ¨åˆ‡æ¢-PHP-ç‰ˆæœ¬" class="headerlink" title="å››ã€è‡ªåŠ¨åˆ‡æ¢ PHP ç‰ˆæœ¬"></a>å››ã€è‡ªåŠ¨åˆ‡æ¢ PHP ç‰ˆæœ¬</h2><ul><li>åŒæ ·åœ¨ <code>~/.bashrc</code> æˆ– <code>~/.zshrc</code> æ·»åŠ ä»¥ä¸‹è„šæœ¬</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> auto dectect</span></span><br><span class="line">PROJECT_BASHRC=$(pwd)/.bashrc</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">echo</span> <span class="variable">$PROJECT_BASHRC</span></span></span><br><span class="line">if [ -f $PROJECT_BASHRC ]; then</span><br><span class="line">    source $PROJECT_BASHRC</span><br><span class="line">fi</span><br></pre></td></tr></table></figure><ul><li>.bashrcèŒƒæœ¬ï¼Œä»¥ PHP <code>7.4</code> é¡¹ç›®ä¸ºä¾‹</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">export PATH="/opt/homebrew/opt/php@7.4/bin:$PATH"</span><br><span class="line">export PATH="/opt/homebrew/opt/php@7.4/sbin:$PATH"</span><br><span class="line"></span><br><span class="line">alias artisan="php artisan"</span><br><span class="line">alias tinker="artisan tinker"</span><br></pre></td></tr></table></figure><blockquote><p>é‡å¯ IDE å³å¯ï¼Œè®°å¾—åœ¨é¡¹ç›®ä¸­å¿½ç•¥ <code>.bashrc</code> æ–‡ä»¶</p></blockquote><h2 id="äº”ã€Swoole-å®‰è£…ç¥å™¨"><a href="#äº”ã€Swoole-å®‰è£…ç¥å™¨" class="headerlink" title="äº”ã€Swoole å®‰è£…ç¥å™¨"></a>äº”ã€Swoole å®‰è£…ç¥å™¨</h2><ul><li>è„šæœ¬ä½ç½® <code>~/scripts/swoole.sh</code></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/sh</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> è·å–åŒ…å</span></span><br><span class="line">function _get_package() &#123;</span><br><span class="line">    local package="swoole"</span><br><span class="line"></span><br><span class="line">    if [ "$1" != "" ]; then</span><br><span class="line">        package="swoole-$1"</span><br><span class="line">    fi</span><br><span class="line"></span><br><span class="line">    echo $package</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¿®å¤ pcre2 è·¯å¾„é—®é¢˜</span></span><br><span class="line">function _fix_pcre() &#123;</span><br><span class="line">    local php_home=$(php -i | grep -Eo "\-\-prefix=([^']*)" | awk -F '=' '&#123;print $2&#125;')</span><br><span class="line">    local pcre_home=$(brew --prefix pcre2)</span><br><span class="line"></span><br><span class="line">    local source="$&#123;pcre_home&#125;/include/pcre2.h"</span><br><span class="line">    local target="$&#123;php_home&#125;/include/php/ext/pcre/pcre2.h"</span><br><span class="line"></span><br><span class="line">    if [ ! -f $target ]; then</span><br><span class="line">        ln -s $source $target</span><br><span class="line">    fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å®‰è£…</span></span><br><span class="line">function swoole_install() &#123;</span><br><span class="line"></span><br><span class="line">    _fix_pcre</span><br><span class="line"></span><br><span class="line">    local package=`_get_package $1`</span><br><span class="line"></span><br><span class="line">    case $1 in </span><br><span class="line">        4.8.11)</span><br><span class="line">            pecl install --configureoptions 'enable-sockets="no" enable-openssl="yes --with-openssl-dir=/opt/homebrew/opt/openssl@1.1" enable-http2="yes" enable-mysqlnd="yes" enable-swoole-json="no" enable-swoole-curl="yes" enable-cares="no"' $&#123;package&#125;</span><br><span class="line">            ;;</span><br><span class="line">        4.8.*)</span><br><span class="line">            pecl install --configureoptions 'enable-sockets="no" enable-openssl="yes --with-openssl-dir=/opt/homebrew/opt/openssl@1.1" enable-http2="yes" enable-mysqlnd="yes" enable-swoole-json="no" enable-swoole-curl="yes"' $&#123;package&#125;</span><br><span class="line">            ;;</span><br><span class="line">        5.0.0)</span><br><span class="line">            pecl install --configureoptions 'enable-sockets="no" enable-openssl="yes --with-openssl-dir=/opt/homebrew/opt/openssl@1.1" enable-http2="yes" enable-mysqlnd="yes" enable-swoole-json="no" enable-swoole-curl="yes" enable-cares="no"' $&#123;package&#125;</span><br><span class="line">            ;;</span><br><span class="line">        5.0.*)</span><br><span class="line">            pecl install --configureoptions 'enable-sockets="no" enable-openssl="yes --with-openssl-dir=/opt/homebrew/opt/openssl@1.1" enable-http2="yes" enable-mysqlnd="yes" enable-swoole-json="no" enable-swoole-curl="yes" enable-cares="no" enable-brotli="no"' $&#123;package&#125;</span><br><span class="line">            ;;</span><br><span class="line">        5.1.*)</span><br><span class="line">            pecl install --configureoptions 'enable-sockets="no" enable-openssl="yes --with-openssl-dir=/opt/homebrew/opt/openssl@1.1" enable-http2="yes" enable-mysqlnd="yes" enable-swoole-json="no" enable-swoole-curl="yes" enable-cares="no" enable-brotli="no" enable-swoole-pgsql="no" with-swoole-odbc="no" with-swoole-oracle="no" enable-swoole-sqlite="no"' $&#123;package&#125;</span><br><span class="line">            ;;</span><br><span class="line">        6.0.* | "")</span><br><span class="line">            pecl install --configureoptions 'enable-sockets="no" enable-openssl="yes --with-openssl-dir=/opt/homebrew/opt/openssl@1.1" enable-http2="yes" enable-mysqlnd="yes" enable-swoole-json="no" enable-swoole-curl="yes" enable-cares="no" enable-brotli="no" enable-swoole-pgsql="no" with-swoole-odbc="no" with-swoole-oracle="no" enable-swoole-sqlite="no" enable-swoole-thread="no" enable-iouring="no"' $&#123;package&#125;</span><br><span class="line">            ;;</span><br><span class="line">        *)</span><br><span class="line">            echo "Unsupported version: $1"</span><br><span class="line">            exit 1</span><br><span class="line">            ;;</span><br><span class="line">    esac</span><br><span class="line"></span><br><span class="line">    swoole_info</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ›´æ–°</span></span><br><span class="line">function swoole_upgrade() &#123;</span><br><span class="line">    swoole_uninstall</span><br><span class="line">    swoole_install $1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> é‡æ–°å®‰è£…</span></span><br><span class="line">function swoole_reinstall() &#123;</span><br><span class="line">    swoole_uninstall</span><br><span class="line">    swoole_install $1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¸è½½</span></span><br><span class="line">function swoole_uninstall() &#123;</span><br><span class="line">    local php_ini=$(php -i | grep "/php.ini" | awk -F ' =&gt; ' '&#123;print $2&#125;')</span><br><span class="line"></span><br><span class="line">    pecl uninstall swoole</span><br><span class="line">    sed -i '' '/^extension="swoole.so"/d' $php_ini</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æœ€æ–°ç‰ˆæœ¬</span></span><br><span class="line">function swoole_latest() &#123;</span><br><span class="line">    local version=`curl -s https://pecl.php.net/package/swoole |grep -E "swoole-.*.tgz" |head -1 |grep -Eo '\d+\.\d+\.\d+' | head -1`</span><br><span class="line">    echo $version</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¿¡æ¯</span></span><br><span class="line">function swoole_info() &#123;</span><br><span class="line">    php --ri swoole</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ç‰ˆæœ¬</span></span><br><span class="line">function swoole_version() &#123;</span><br><span class="line">    php -r "echo swoole_version();" </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å®‰è£…åˆ«å</span></span><br><span class="line">function swoole_i() &#123;</span><br><span class="line">    swoole_install $1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ›´æ–°åˆ«å</span></span><br><span class="line">function swoole_u() &#123;</span><br><span class="line">    swoole_upgrade $1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¸®åŠ©</span></span><br><span class="line">function swoole_help() &#123;</span><br><span class="line">    cat &lt;&lt; END</span><br><span class="line">Usage:</span><br><span class="line">    $0 [help|i|install|reinstall|uninstall|u|upgrade|version|latest] [version]</span><br><span class="line"></span><br><span class="line">Examples</span><br><span class="line">    $0 install</span><br><span class="line">    $0 install 5.1.3</span><br><span class="line">    $0 upgrade</span><br><span class="line">    $0 upgrade 5.1.3</span><br><span class="line">END</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å…¥å£</span></span><br><span class="line">function swoole_() &#123;</span><br><span class="line">    swoole_help</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ‰§è¡Œ</span></span><br><span class="line"><span class="meta">swoole_$</span><span class="bash">1 <span class="variable">$2</span></span></span><br></pre></td></tr></table></figure><ul><li><code>~/.bashrc</code> æˆ– <code>~/.zshrc</code> æ·»åŠ ä»¥ä¸‹è„šæœ¬</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alias swoole-tool="sh ~/scripts/swoole.sh"</span><br></pre></td></tr></table></figure><ul><li>å¿«é€Ÿå®‰è£… <code>Swoole</code></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">swoole-tool install 6.0.0</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> php </tag>
            
            <tag> homebrew </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Sponsors</title>
      <link href="/sponsors/"/>
      <url>/sponsors/</url>
      
        <content type="html"><![CDATA[<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>Iâ€™m Huangdijia, a software engineer with a passion for open source. Active in the Hyperf ecosystem.</p><p>Member of <a href="https://github.com/hyperf" target="_blank" rel="noopener">@Hyperf</a>, <a href="https://github.com/friendsofhyperf" target="_blank" rel="noopener">@FriendsOfHyperf</a></p><ul><li><a href="https://github.com/friendsofhyperf/sentry" target="_blank" rel="noopener">hyperf-sentry</a> - The sentry SDK for Hyperf</li><li><a href="https://github.com/friendsofhyperf/trigger" target="_blank" rel="noopener">hyperf-trigger</a> - The MySQL Trigger for Hyperf</li><li><a href="https://github.com/huangdijia/laravel-horizon-restart" target="_blank" rel="noopener">laravel-horizon-restart</a> - A Plugin for laravel-horzion</li><li><a href="https://github.com/huangdijia/laravel-trigger" target="_blank" rel="noopener">laravel-trigger</a> - MySQL event subscriber base on MySQLReplication</li><li><a href="https://github.com/friendsofhyperf/pest-plugin-hyperf" target="_blank" rel="noopener">pest-plugin-hyperf</a> - The Pest plugin for Hyperf</li></ul><p>Your sponsorship means a lot to me. It will help me sustain my projects actively and make more of my ideas come true. Much appreciated! ğŸ’– ğŸ™</p><h2 id="Sponsors"><a href="#Sponsors" class="headerlink" title="Sponsors"></a>Sponsors</h2><p><img src="https://hdj.me/images/wechat-pay-min.jpg" alt="WeChatPay"><br><img src="https://hdj.me/images/alipay-min.jpg" alt="Alipay"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>å¦‚ä½•è¿ç§» homebrew è‡³ M1 Mac</title>
      <link href="/How-to-migrate-to-native-Homebrew-on-an-M1-Mac/"/>
      <url>/How-to-migrate-to-native-Homebrew-on-an-M1-Mac/</url>
      
        <content type="html"><![CDATA[<h2 id="æ—§-Mac-å¤‡ä»½"><a href="#æ—§-Mac-å¤‡ä»½" class="headerlink" title="æ—§ Mac å¤‡ä»½"></a>æ—§ Mac å¤‡ä»½</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/<span class="built_in">local</span>/bin/brew bundle dump</span><br></pre></td></tr></table></figure><p>å¾—åˆ° <code>Brewfile</code> æ–‡ä»¶ã€‚</p><a id="more"></a><h2 id="M1-Mac-å®‰è£…-brew"><a href="#M1-Mac-å®‰è£…-brew" class="headerlink" title="M1 Mac å®‰è£… brew"></a>M1 Mac å®‰è£… brew</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/bin/bash -c <span class="string">"<span class="variable">$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install.sh)</span>"</span></span><br></pre></td></tr></table></figure><p>å®‰è£…è¿‡ç¨‹ä¸­å¯èƒ½ä¼šé‡åˆ°æƒé™é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨ sudo å‘½ä»¤æˆæƒ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chown -R $(whoami) /opt/homebrew</span><br></pre></td></tr></table></figure><h2 id="é…ç½®ç¯å¢ƒå˜é‡"><a href="#é…ç½®ç¯å¢ƒå˜é‡" class="headerlink" title="é…ç½®ç¯å¢ƒå˜é‡"></a>é…ç½®ç¯å¢ƒå˜é‡</h2><p>ç¼–è¾‘ <code>~/.zshrc</code> æ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># arm brew environment</span></span><br><span class="line"><span class="built_in">eval</span> <span class="string">"<span class="variable">$(/opt/homebrew/bin/brew shellenv)</span>"</span></span><br></pre></td></tr></table></figure><h2 id="å¯¼å…¥-Brewfile"><a href="#å¯¼å…¥-Brewfile" class="headerlink" title="å¯¼å…¥ Brewfile"></a>å¯¼å…¥ Brewfile</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/opt/homebrew/bin/brew bundle --file path/to/Brewfile</span><br></pre></td></tr></table></figure><blockquote><p>æœ‰äº›è½¯ä»¶ä¸èƒ½å®Œæˆå®‰è£…ï¼Œåé¢æ‰‹åŠ¨å®‰è£…å°±å¥½äº†ã€‚</p></blockquote><h2 id="å¸è½½æ—§ç‰ˆæœ¬"><a href="#å¸è½½æ—§ç‰ˆæœ¬" class="headerlink" title="å¸è½½æ—§ç‰ˆæœ¬"></a>å¸è½½æ—§ç‰ˆæœ¬</h2><p>å¦‚æœæ—§ç‰ˆè·Ÿè° Mac ä¹Ÿè¿ç§»è‡³äº† M1 Macï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¸è½½</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">arch -x86_64 <span class="variable">$SHELL</span></span><br><span class="line">/bin/bash -c <span class="string">"<span class="variable">$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/uninstall.sh)</span>"</span></span><br></pre></td></tr></table></figure><p>å¯èƒ½è¿˜ä¼šæœ‰ä¸€äº›æ®‹ç•™ç›®å½•ï¼Œåªè¦æ‰‹åŠ¨ <code>rm -rf</code> åˆ é™¤å³å¯</p><blockquote><p>/usr/local/.com.apple.installer.keep<br>/usr/local/Frameworks/<br>/usr/local/Homebrew/<br>/usr/local/bin/<br>/usr/local/etc/<br>/usr/local/iODBC.odbcmanager/<br>/usr/local/include/<br>/usr/local/lib/<br>/usr/local/opt/<br>/usr/local/packager/<br>/usr/local/remotedesktop/<br>/usr/local/sbin/<br>/usr/local/share/<br>/usr/local/var/<br>/usr/local/zlib/</p></blockquote>]]></content>
      
      
      
        <tags>
            
            <tag> macos </tag>
            
            <tag> brew </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å°† Apple Watch èº«ä»½éªŒè¯æ·»åŠ åˆ° sudo</title>
      <link href="/add-apple-watch-authentication-to-sudo/"/>
      <url>/add-apple-watch-authentication-to-sudo/</url>
      
        <content type="html"><![CDATA[<p>æˆ‘æœ€è¿‘çœ‹åˆ°ä¸€ç¯‡å…³äºå¦‚ä½•ä½¿ <code>sudo</code> ä¸ <code>Touch ID</code> ä¸€èµ·å·¥ä½œçš„æ–‡ç« ï¼Œè¿™å¾ˆå¥½ï¼Œä½†æˆ‘çš„ iMac Pro æ²¡æœ‰ <code>Touch ID</code>ã€‚æˆ‘ç»§ç»­æœç´¢å¹¶æ‰¾åˆ°äº†<code>pam-watchid</code>ï¼</p><p>è¿™æ˜¯ä¸€ä¸ªç”¨äºä½¿ç”¨ <code>Watch</code> çš„ <code>PAMæ¨¡å—</code> â€”â€”æ­£æ˜¯æˆ‘æƒ³è¦çš„ã€‚</p><a id="more"></a><p>å®ƒæ˜¯å¼€æºçš„ï¼Œå› æ­¤æ‚¨å¯ä»¥æŒ‰ç…§è‡ªè¿°æ–‡ä»¶è‡ªè¡Œç¼–è¯‘ï¼Œå› æ­¤è¯·ç¡®ä¿æ‚¨å·²å®‰è£…<code>Xcode</code>æˆ–<code>Xcode å‘½ä»¤è¡Œå·¥å…·</code>ï¼š</p><p>ä¸‹è½½<a href="https://github.com/biscuitehh/pam-watchid/archive/main.zip" target="_blank" rel="noopener">æœ€æ–°çš„ ZIP æ–‡ä»¶</a></p><p>è§£å‹ç¼©ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¼šåˆ›å»ºä¸€ä¸ªåä¸º<code>pam-watchid-main</code>çš„æ–‡ä»¶å¤¹</p><ul><li>æ‰“å¼€ç»ˆç«¯å¹¶å®‰è£…å®ƒï¼š</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> ~/Downloads/pam-watchid-main</span><br><span class="line">$ sudo å®‰è£…</span><br></pre></td></tr></table></figure><ul><li>ä¸ºsudoæ³¨å†Œæ–°çš„ PAM æ¨¡å—ï¼š</li></ul><p>ç¼–è¾‘ <code>/etc/pam.d/sudo</code>ï¼Œ åœ¨ç¬¬ 1 è¡Œï¼ˆè¿™æ˜¯æ³¨é‡Šï¼‰ä¸‹æ·»åŠ ä¸€ä¸ªæ–°è¡Œï¼Œå…¶ä¸­åŒ…å«ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">auth       sufficient     pam_watchid.so</span><br></pre></td></tr></table></figure><p>ï¼ˆä¿ç•™æ­¤æ–‡ä»¶ä¸­çš„æ‰€æœ‰å…¶ä»–è¡Œã€‚ï¼‰<br>å°±æ˜¯è¿™æ ·ã€‚ç°åœ¨ï¼Œæ— è®ºä½•æ—¶ä½¿ç”¨sudoï¼Œæ‚¨éƒ½å¯ä»¥é€‰æ‹©ä½¿ç”¨ Watch è¿›è¡Œèº«ä»½éªŒè¯ã€‚</p><p><img src="https://akrabat.com/wp-content/uploads/2020/11/Screenshot-2020-11-22-at-14.17.47-3.png" alt="å°† Apple Watch èº«ä»½éªŒè¯æ·»åŠ åˆ° sudo"></p>]]></content>
      
      
      <categories>
          
          <category> MacOS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MacOS </tag>
            
            <tag> Apple Watch </tag>
            
            <tag> Apple </tag>
            
            <tag> èº«ä»½éªŒè¯ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Laravel Eloquent è®¿é—®å™¨çš„ä¸€ä¸ªå‘</title>
      <link href="/pit-of-laravel-eloquent-accessor/"/>
      <url>/pit-of-laravel-eloquent-accessor/</url>
      
        <content type="html"><![CDATA[<h2 id="æ•°æ®"><a href="#æ•°æ®" class="headerlink" title="æ•°æ®"></a>æ•°æ®</h2><table><thead><tr><th>ID</th><th>first_name</th><th>last_name</th></tr></thead><tbody><tr><td>1</td><td>Jackie</td><td>Chan</td></tr><tr><td>2</td><td>Bruce</td><td>Lee</td></tr></tbody></table><a id="more"></a><h2 id="æ¨¡å‹"><a href="#æ¨¡å‹" class="headerlink" title="æ¨¡å‹"></a>æ¨¡å‹</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Star</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getFullNameAttribute</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;first_name . <span class="string">' '</span> . <span class="keyword">$this</span>-&gt;last_name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ­£å¸¸ä½¿ç”¨"><a href="#æ­£å¸¸ä½¿ç”¨" class="headerlink" title="æ­£å¸¸ä½¿ç”¨"></a>æ­£å¸¸ä½¿ç”¨</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Start::first()-&gt;full_name; <span class="comment">// "Jackie Chan"</span></span><br></pre></td></tr></table></figure><h2 id="å‘"><a href="#å‘" class="headerlink" title="å‘"></a>å‘</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Star::select(DB::raw(<span class="string">"concat(first_name, ' ', last_name) as full_name"</span>))-&gt;first()-&gt;full_name; <span class="comment">// ""</span></span><br></pre></td></tr></table></figure><p>ä½†æ˜¯</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dump(Star::select(DB::raw(<span class="string">"concat(first_name, ' ', last_name) as full_name"</span>))-&gt;first());</span><br></pre></td></tr></table></figure><p>ç»“æœèƒ½çœ‹åˆ° <code>full_name</code> æœ‰å€¼</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line">  <span class="comment">#attributes: array:1 [</span></span><br><span class="line">    <span class="string">"full_name"</span> =&gt; <span class="string">"Jackie Chan"</span></span><br><span class="line">  ]</span><br><span class="line">  <span class="comment">#original: array:1 [</span></span><br><span class="line">    <span class="string">"full_name"</span> =&gt; <span class="string">"Jackie Chan"</span></span><br><span class="line">  ]</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure><h2 id="åŸå› "><a href="#åŸå› " class="headerlink" title="åŸå› "></a>åŸå› </h2><blockquote><ol><li>Eloquent è®¿é—®å™¨ä¼˜å…ˆçº§é«˜äºå±æ€§</li><li>è¯¥ä¾‹å­ä¸­è®¿é—®å™¨ä¾èµ–çš„å±æ€§å› ä¸ºæœªæŒ‡å®š <code>select</code> ä¸ºç©º</li></ol></blockquote><h2 id="å¦‚ä½•å¡«å‘"><a href="#å¦‚ä½•å¡«å‘" class="headerlink" title="å¦‚ä½•å¡«å‘"></a>å¦‚ä½•å¡«å‘</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Star</span> <span class="keyword">extends</span> <span class="title">Model</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getFullNameAttribute</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// ä¼˜å…ˆ full_name å±æ€§</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;attributes[<span class="string">'full_name'</span>] ?? (<span class="keyword">$this</span>-&gt;attributes[<span class="string">'first_name'</span>] . <span class="string">' '</span> . <span class="keyword">$this</span>-&gt;attributes[<span class="string">'last_name'</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Laravel </tag>
            
            <tag> Eloquent </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Laravel artisan å‘½ä»¤è‡ªåŠ¨è¡¥å…¨</title>
      <link href="/auto-complete-for-laravel-artisan/"/>
      <url>/auto-complete-for-laravel-artisan/</url>
      
        <content type="html"><![CDATA[<h2 id="å®‰è£…-bash-completion-2"><a href="#å®‰è£…-bash-completion-2" class="headerlink" title="å®‰è£… bash-completion@2"></a>å®‰è£… <code>bash-completion@2</code></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install bash-completion@2</span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="é…ç½®-zshrc-æˆ–-bash-profile"><a href="#é…ç½®-zshrc-æˆ–-bash-profile" class="headerlink" title="é…ç½® ~/.zshrc æˆ– ~/.bash_profile"></a>é…ç½® <code>~/.zshrc</code> æˆ– <code>~/.bash_profile</code></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># bash-completion@2</span></span><br><span class="line"><span class="built_in">autoload</span> bashcompinit</span><br><span class="line">bashcompinit</span><br><span class="line"></span><br><span class="line"><span class="comment"># auto-complete for php artisan</span></span><br><span class="line">ARTISAN_COMMANDS=`php artisan --raw --no-ansi list | sed <span class="string">"s/[[:space:]].*//g"</span>`</span><br><span class="line">_artisan()</span><br><span class="line">&#123;</span><br><span class="line">    COMP_WORDBREAKS=<span class="variable">$&#123;COMP_WORDBREAKS//:&#125;</span></span><br><span class="line">    COMPREPLY=(`compgen -W <span class="string">"<span class="variable">$ARTISAN_COMMANDS</span>"</span> -- <span class="string">"<span class="variable">$&#123;COMP_WORDS[COMP_CWORD]&#125;</span>"</span>`)</span><br><span class="line">    <span class="built_in">return</span> 0</span><br><span class="line">&#125;</span><br><span class="line">complete -F _artisan artisan</span><br><span class="line"><span class="built_in">alias</span> artisan=<span class="string">'php artisan'</span></span><br></pre></td></tr></table></figure><p>å¦‚æœåœ¨ Windows çš„ Git-Bash ä¸Šå‡ºç°ç±»ä¼¼äº <code>stdout is not a tty</code> çš„é”™è¯¯ï¼Œåªéœ€è¦æŠŠ <code>ARTISAN_COMMANDS=</code> è¿™ä¸€è¡Œæ”¹æˆ:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ARTISAN_COMMANDS=`php.exe artisan --raw --no-ansi list | sed <span class="string">"s/[[:space:]].*//g"</span>`</span><br></pre></td></tr></table></figure><h2 id="æ•ˆæœé¢„è§ˆ"><a href="#æ•ˆæœé¢„è§ˆ" class="headerlink" title="æ•ˆæœé¢„è§ˆ"></a>æ•ˆæœé¢„è§ˆ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; php artisan make:[TAB][TAB]</span><br><span class="line">make:channel       make:factory       make:model         make:rule</span><br><span class="line">make:<span class="built_in">command</span>       make:import        make:notification  make:seeder</span><br><span class="line">make:controller    make:job           make:observer      make:service</span><br><span class="line">make:event         make:listener      make:policy        make:<span class="built_in">test</span></span><br><span class="line">make:exception     make:mail          make:provider      make:transformer</span><br><span class="line">make:<span class="built_in">export</span>        make:middleware    make:request</span><br><span class="line">make:<span class="built_in">export</span>-model  make:migration     make:resource</span><br></pre></td></tr></table></figure><h2 id="ä¸¾ä¸€åä¸‰"><a href="#ä¸¾ä¸€åä¸‰" class="headerlink" title="ä¸¾ä¸€åä¸‰"></a>ä¸¾ä¸€åä¸‰</h2><p>è®© <code>composer</code> ä¹Ÿæ˜¯æ”¯æŒç›¸åŒçš„æ•ˆæœ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># auto-complete for composer</span></span><br><span class="line">COMPOSER_COMMANDS=`composer --raw --no-ansi list | sed <span class="string">"s/[[:space:]].*//g"</span>`</span><br><span class="line">_composer()</span><br><span class="line">&#123;</span><br><span class="line">    COMP_WORDBREAKS=<span class="variable">$&#123;COMP_WORDBREAKS//:&#125;</span></span><br><span class="line">    COMPREPLY=(`compgen -W <span class="string">"<span class="variable">$COMPOSER_COMMANDS</span>"</span> -- <span class="string">"<span class="variable">$&#123;COMP_WORDS[COMP_CWORD]&#125;</span>"</span>`)</span><br><span class="line">    <span class="built_in">return</span> 0</span><br><span class="line">&#125;</span><br><span class="line">complete -F _composer composer</span><br></pre></td></tr></table></figure><h3 id="çœ‹çœ‹æ•ˆæœ"><a href="#çœ‹çœ‹æ•ˆæœ" class="headerlink" title="çœ‹çœ‹æ•ˆæœ"></a>çœ‹çœ‹æ•ˆæœ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ composer [TAB][TAB]</span><br><span class="line">about                clear-cache          create-project       dumpautoload         home                 install              prohibits            search               status               upgrade</span><br><span class="line">archive              clearcache           depends              <span class="built_in">exec</span>                 i                    licenses             remove               self-update          suggests             validate</span><br><span class="line">browse               <span class="built_in">command</span>              diagnose             global               info                 list                 require              selfupdate           u                    why</span><br><span class="line">check-platform-reqs  config               dump-autoload        <span class="built_in">help</span>                 init                 outdated             run-script           show                 update               why-not</span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> laravel </tag>
            
            <tag> artisan </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é€šè¿‡ JavaScript ç›‘å¬æš—é»‘æ¨¡å¼å˜åŒ–</title>
      <link href="/listening-darkmode-by-javascript/"/>
      <url>/listening-darkmode-by-javascript/</url>
      
        <content type="html"><![CDATA[<p>è‹¹æœç³»ç»Ÿï¼ˆmacOSã€iOSï¼‰éƒ½å·²ç»å…¨é¢æ”¯æŒæš—é»‘æ¨¡å¼ï¼ˆä¹Ÿå«æ·±è‰²æ¨¡å¼ï¼‰äº†ï¼Œåœ¨è¿™é‡Œä¸åšè¿‡å¤šçš„ä»‹ç»äº†ã€‚åœ¨ä¼—å¤šçš„æŠ€æœ¯æ–‡ç« é‡Œéƒ½æœ‰ä»‹ç»å¦‚ä½•ä½¿ç”¨ï¼Œæœ€å¸¸è§çš„æ˜¯é€šè¿‡ CSS ä¸­çš„ prefers-color-scheme: dark æ¥æ£€æµ‹ç”¨æˆ·æ˜¯å¦å¼€å¯äº† Dark Modeï¼Œåœ¨ CSSé‡Œå®šä¹‰ä¸åŒçš„æ ·å¼ã€‚</p><a id="more"></a><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* æ“ä½œç³»ç»ŸåŠæµè§ˆå™¨æœªæ”¯æŒæˆ–ç”¨æˆ·æœªå¼€å¯ Dark Mode */</span></span><br><span class="line"><span class="selector-tag">body</span> &#123;</span><br><span class="line">    <span class="attribute">background-color</span>: white;</span><br><span class="line">    <span class="attribute">color</span>: black;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@media</span> (<span class="attribute">prefers-color-scheme:</span> dark) &#123;</span><br><span class="line">    <span class="comment">/* æ“ä½œç³»ç»ŸåŠæµè§ˆå™¨æ”¯æŒä¸”ç”¨æˆ·å¼€å¯äº† Dark Mode */</span></span><br><span class="line">    <span class="selector-tag">body</span> &#123;</span><br><span class="line">        <span class="attribute">background-color</span>: black;</span><br><span class="line">        <span class="attribute">color</span>: white;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»ä»¥ä¸Šä»£ç çœ‹ï¼Œæœ‰ç‚¹ç±»ä¼¼ if-elseï¼Œå…¼å®¹æ€§å’Œå¯è¯»æ€§éƒ½ä¸æ˜¯å¾ˆå¥½ã€‚</p><p>æš—é»‘æ¨¡å¼åˆšæ¨å‡ºçš„æ—¶å€™ï¼Œæˆ‘é¦–å…ˆæƒ³åˆ°çš„æ˜¯è·Ÿåšå®¢çš„ä¸»é¢˜åŠŸèƒ½å¾ˆåƒï¼Œç»†å“ä¹‹åå‘ç°åŒºåˆ«åœ¨äºä¸»é¢˜åšæ³•æ›´å¤šçš„æ˜¯æ˜¯æ›´æ¢ CSS æ–‡ä»¶ï¼Œäºæ˜¯æˆ‘æƒ³æ˜¯ä¸æ˜¯å¯ä»¥é€šè¿‡ JavaScript æ£€æµ‹ï¼ˆç›‘å¬ï¼‰ç”¨æˆ·æ˜¯å¦å¯ç”¨æš—é»‘æ¨¡å¼ï¼Œä»è€ŒåŠ è½½ä¸åŒçš„æ ·å¼ï¼Œå®ç°å®æ—¶æ›´æ¢ä¸»é¢˜åŠŸèƒ½ã€‚</p><p>æ¥ä¸‹æ¥æœ€å…³é”®çš„é—®é¢˜å°±æ˜¯æ€ä¹ˆå®ç°è¿™ä¸ªâ€œç›‘å¬â€åŠŸèƒ½ï¼Œåœ¨è°·æ­Œä¸Šç™¾åº¦äº†ä¸€ä¸‹ï¼Œæ‰¾åˆ°äº†ä¸€ä¸ªå…³é”®è¯ matchMediaã€‚</p><p>ç”¨è¿‡ matchMedia æ–¹æ³•å¯ä»¥ç›´æ¥åˆ¤æ–­æµè§ˆå™¨å½“å‰æ˜¯å¦å€¾å‘äºä½¿ç”¨æ·±è‰²æ¨¡å¼ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> prefersDarkMode = <span class="built_in">window</span>.matchMedia(<span class="string">'(prefers-color-scheme: dark)'</span>).matches;</span><br><span class="line"><span class="keyword">if</span> (prefersDarkMode) &#123;</span><br><span class="line">    <span class="comment">// æäº‹æƒ…</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡ç›‘å¬ matchMedia çš„ change äº‹ä»¶ï¼Œå¯ä»¥åœ¨ç”¨æˆ·åˆ‡æ¢æ·±è‰² / æµ…è‰²æ¨¡å¼çš„æ—¶å€™ï¼Œå°†æµè§ˆå™¨ä¸­å·²æ‰“å¼€çš„é¡µé¢è‡ªåŠ¨åˆ‡æ¢ä¸ºç³»ç»Ÿå¯¹åº”çš„æ¨¡å¼ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> media = <span class="built_in">window</span>.matchMedia(<span class="string">'(prefers-color-scheme: dark)'</span>);</span><br><span class="line"><span class="keyword">let</span> callback = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> prefersDarkMode = e.matches;</span><br><span class="line">    <span class="keyword">if</span> (prefersDarkMode) &#123;</span><br><span class="line">        <span class="comment">// æäº‹æƒ…</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">typeof</span> media.addEventListener === <span class="string">'function'</span>) &#123;</span><br><span class="line">    media.addEventListener(<span class="string">'change'</span>, callback);</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> media.addListener === <span class="string">'function'</span>) &#123;</span><br><span class="line">    media.addListener(callback);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
            <tag> dark-mode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æœŸå¾…å·²ä¹…çš„ PHP preload</title>
      <link href="/php74-preload/"/>
      <url>/php74-preload/</url>
      
        <content type="html"><![CDATA[<p>æœŸå¾…å·²ä¹…çš„ <a href="https://www.php.net/archive/2019.php#2019-11-28-1" target="_blank" rel="noopener">PHP7.4</a> ç»ˆäºå‘å¸ƒäº†ï¼Œä¸ªäººæœ€æœŸå¾…çš„åŠŸèƒ½è¿˜æ˜¯ <a href="https://www.php.net/manual/zh/opcache.configuration.php#ini.opcache.preload" target="_blank" rel="noopener">Opcache Preloading</a>ã€‚</p><ul><li>ä¸ºäº†é¢„åŠ è½½æ–‡ä»¶ï¼Œæ‚¨éœ€è¦ç¼–å†™è‡ªå®šä¹‰PHPè„šæœ¬</li><li>æ­¤è„šæœ¬åœ¨æœåŠ¡å™¨å¯åŠ¨æ—¶æ‰§è¡Œä¸€æ¬¡</li><li>æ‰€æœ‰é¢„åŠ è½½çš„æ–‡ä»¶éƒ½å¯åœ¨å†…å­˜ä¸­ç”¨äºæ‰€æœ‰è¯·æ±‚</li><li>åœ¨é‡æ–°å¯åŠ¨æœåŠ¡å™¨ä¹‹å‰ï¼Œå¯¹æºæ–‡ä»¶æ‰€åšçš„æ›´æ”¹ä¸ä¼šäº§ç”Ÿä»»ä½•å½±å“</li></ul><a id="more"></a><h2 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h2><p>åŒ…å« 2 é…ç½®å‚æ•°ï¼š</p><ul><li>opcache.preload string</li></ul><blockquote><p>æŒ‡å®šè¦åœ¨æœåŠ¡å™¨å¯åŠ¨æ—¶æœŸè¿›è¡Œç¼–è¯‘å’Œç¼“å­˜çš„ PHP è„šæœ¬æ–‡ä»¶ï¼Œ è¿™äº›æ–‡ä»¶ä¹Ÿå¯èƒ½é€šè¿‡ include æˆ–è€… opcache_compile_file() å‡½æ•° æ¥é¢„åŠ è½½å…¶ä»–æ–‡ä»¶ã€‚ æ‰€æœ‰è¿™äº›æ–‡ä»¶ä¸­åŒ…å«çš„å®ä½“ï¼ŒåŒ…æ‹¬å‡½æ•°ã€ç±»ç­‰ï¼Œåœ¨æœåŠ¡å™¨å¯åŠ¨çš„æ—¶å€™å°±è¢«åŠ è½½å’Œç¼“å­˜ï¼Œ å¯¹äºç”¨æˆ·ä»£ç æ¥è®²æ˜¯â€œå¼€ç®±å¯ç”¨â€çš„ã€‚</p></blockquote><ul><li>opcache.preload_user string</li></ul><blockquote><p>è€ƒè™‘åˆ°å®‰å…¨å› ç´ ï¼Œç¦æ­¢ä»¥ root ç”¨æˆ·é¢„åŠ è½½ä»£ç ã€‚è¯¥æŒ‡ä»¤æ–¹ä¾¿ä»¥å…¶ä»–ç”¨æˆ·é¢„åŠ è½½ã€‚</p></blockquote><h3 id="php-ini-é…ç½®"><a href="#php-ini-é…ç½®" class="headerlink" title="php.ini é…ç½®"></a><code>php.ini</code> é…ç½®</h3><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">opcache.preload</span>=/path/to/project/preload.php</span><br></pre></td></tr></table></figure><h3 id="åŠæ—¶å®ç°"><a href="#åŠæ—¶å®ç°" class="headerlink" title="åŠæ—¶å®ç°"></a>åŠæ—¶å®ç°</h3><p>é’ˆå¯¹ composerï¼Œå¯ä»¥ç›´æ¥ç”Ÿæˆ <code>vendor/preload.php</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">$files = <span class="keyword">require</span> <span class="keyword">__DIR__</span> . <span class="string">'/composer/autoload_classmap.php'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (array_unique($files) <span class="keyword">as</span> $file) &#123;</span><br><span class="line">    opcache_compile_file($file);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç¬¬ä¸‰æ–¹åŒ…"><a href="#ç¬¬ä¸‰æ–¹åŒ…" class="headerlink" title="ç¬¬ä¸‰æ–¹åŒ…"></a>ç¬¬ä¸‰æ–¹åŒ…</h2><p>Github ä¸Šä¹Ÿæœ‰å¤§ç¥æ”¾å‡º composer æ‰©å±•åŒ… <a href="https://github.com/Ayesh/Composer-Preload" target="_blank" rel="noopener">Composer-Preload</a>ï¼Œå¯é€šè¿‡ç®€å•é…ç½®å®ç°ã€‚</p><h3 id="å½“å‰é¡¹ç›®å®‰è£…"><a href="#å½“å‰é¡¹ç›®å®‰è£…" class="headerlink" title="å½“å‰é¡¹ç›®å®‰è£…"></a>å½“å‰é¡¹ç›®å®‰è£…</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer require ayesh/composer-preload</span><br></pre></td></tr></table></figure><h3 id="å…¨å±€å®‰è£…"><a href="#å…¨å±€å®‰è£…" class="headerlink" title="å…¨å±€å®‰è£…"></a>å…¨å±€å®‰è£…</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer g require ayesh/composer-preload</span><br></pre></td></tr></table></figure><h3 id="composer-json-é…ç½®"><a href="#composer-json-é…ç½®" class="headerlink" title="composer.json é…ç½®"></a><code>composer.json</code> é…ç½®</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"extra"</span>: &#123;</span><br><span class="line">        <span class="attr">"preload"</span>: &#123;</span><br><span class="line">            <span class="attr">"paths"</span>: [</span><br><span class="line">                <span class="string">"web"</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">"exclude"</span>: [</span><br><span class="line">                <span class="string">"web/core/tests"</span>,</span><br><span class="line">                <span class="string">"web/core/lib/Drupal/Component/Assertion"</span>,</span><br><span class="line">                <span class="string">"web/core/modules/simpletest"</span>,</span><br><span class="line">                <span class="string">"web/core/modules/editor/src/Tests"</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">"extensions"</span>: [<span class="string">"php"</span>, <span class="string">"module"</span>, <span class="string">"inc"</span>, <span class="string">"install"</span>],</span><br><span class="line">            <span class="attr">"exclude-regex"</span>: <span class="string">"/[A-Za-z0-9_]test\\.php$/i"</span>,</span><br><span class="line">            <span class="attr">"no-status-check"</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">"files"</span>: [</span><br><span class="line">                <span class="string">"somefile.php"</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="vendor-preload-php-ç”Ÿæˆ"><a href="#vendor-preload-php-ç”Ÿæˆ" class="headerlink" title="vendor/preload.php ç”Ÿæˆ"></a><code>vendor/preload.php</code> ç”Ÿæˆ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer preload</span><br></pre></td></tr></table></figure><h2 id="å®˜æ–¹æ”¯æŒ"><a href="#å®˜æ–¹æ”¯æŒ" class="headerlink" title="å®˜æ–¹æ”¯æŒ"></a>å®˜æ–¹æ”¯æŒ</h2><p>ç›®å‰ composer å®˜æ–¹è¿˜æ²¡æ”¯æŒï¼Œå·²ç»æœ‰äººå‘ composer æäº¤äº†<a href="https://github.com/composer/composer/issues/7777" target="_blank" rel="noopener">Issue</a>ï¼Œæ®è¯´ 2.0 é‡Œç¨‹ç¢‘ç‰ˆæœ¬ä¼šå¢åŠ æ”¯æŒï¼Œå€¼å¾—æœŸå¾…ã€‚</p><h2 id="æ€§èƒ½æå‡"><a href="#æ€§èƒ½æå‡" class="headerlink" title="æ€§èƒ½æå‡"></a>æ€§èƒ½æå‡</h2><p>å®˜æ–¹ä»¥ zend framework æµ‹è¯• <code>30~50 %</code> çš„æ€§èƒ½æå‡ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> php </tag>
            
            <tag> preload </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¦‚ä½•å–æ¶ˆ failed_jobs</title>
      <link href="/how-to-disable-write-laravel-failed-table/"/>
      <url>/how-to-disable-write-laravel-failed-table/</url>
      
        <content type="html"><![CDATA[<h2 id="çƒ¦æ¼ä»ä½•è€Œæ¥"><a href="#çƒ¦æ¼ä»ä½•è€Œæ¥" class="headerlink" title="çƒ¦æ¼ä»ä½•è€Œæ¥"></a>çƒ¦æ¼ä»ä½•è€Œæ¥</h2><p>ç”¨ Laravel çš„å°ä¼™ä¼´åº”è¯¥éƒ½ä¼šç”¨åˆ° Queueï¼Œ ä»<a href="https://laravel.com/docs/6.x/queues#dealing-with-failed-jobs" target="_blank" rel="noopener">æ‰‹å†Œ</a> Job å¤±è´¥åä¼šå°†é˜Ÿåˆ—ä¿¡æ¯è®°å½•åˆ° <code>failed_jobs</code> è¡¨ï¼Œå¯ä»¥é€šè¿‡</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">php artisan queue:failed-table</span><br><span class="line">php artisan migrate</span><br></pre></td></tr></table></figure><p>ä½œç”¨ä¸»è¦æ˜¯ä¸ºäº†æ–¹ä¾¿åˆ†æå¤±è´¥åŸå› å’Œ Job é‡è¯•ï¼ˆæœ¬èº«æ”¯æŒ retryï¼‰ï¼Œè¿™éƒ½å¾ˆå¥½ç†è§£ã€‚å½“ <code>failed_jobs</code> æ²¡æœ‰è¢«åˆ›å»ºçš„æ—¶å€™ï¼Œä¼šæŠ¥è¿™æ ·ä¸€ä¸ªå¼‚å¸¸ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SQLSTATE[<span class="number">42</span>S02]: Base table <span class="keyword">or</span> view not found: <span class="number">1146</span> Table <span class="string">'a8591.failed_jobs'</span> doesn<span class="string">'t exist</span></span><br></pre></td></tr></table></figure><p>å¹¶ä¸”è®°å½•åˆ° log æ–‡ä»¶ï¼Œå¦‚æœä½ çš„é¡¹ç›®ä¸­æœ‰å¼‚å¸¸é€šçŸ¥ï¼Œé‚£æ˜¯ç›¸å½“å›°æ‰°ã€‚</p><p>ä½†æ˜¯æœ‰ä¸€ä¸ªåœºæ™¯ï¼Œä¹Ÿè®¸æˆ‘å¹¶ä¸å…³å¿ƒä»»åŠ¡æ‰§è¡Œæ˜¯å¦æˆåŠŸï¼Œæˆ–è€…è¯´å› ä¸ºæŸç§ç‰¹å®šä¸å¯æ§å› ç´ å…è®¸ä»»åŠ¡å­˜åœ¨æ‰§è¡Œå¤±è´¥çš„æƒ…å†µï¼Œè€Œæˆ‘åˆä¸å¸Œæœ›è¢«è¿™ç±»å¼‚å¸¸æ‰“æ‰°è¦æ€ä¹ˆåŠå‘¢ï¼Ÿ</p><a id="more"></a><h2 id="æ–¹æ³•ä¸€ï¼šé‡å†™-Job-ç±»-fail-æ–¹æ³•"><a href="#æ–¹æ³•ä¸€ï¼šé‡å†™-Job-ç±»-fail-æ–¹æ³•" class="headerlink" title="æ–¹æ³•ä¸€ï¼šé‡å†™ Job ç±» fail æ–¹æ³•"></a>æ–¹æ³•ä¸€ï¼šé‡å†™ Job ç±» fail æ–¹æ³•</h2><p>åªè¦ IDE å¼ºå¤§äº›ï¼Œè·³è·³è·³ï¼Œè·³è½¬ä¸€ä¸‹ä»£ç ï¼Œå¾ˆå®¹æ˜“æ‰¾åˆ° <code>vendor/illuminate/queue/Jobs/Job.php</code> å¤„ç† Job å¤±è´¥çš„é€»è¾‘ä½ç½®ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">fail</span><span class="params">($e = null)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;markAsFailed();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;isDeleted()) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// If the job has failed, we will delete it, call the "failed" method and then call</span></span><br><span class="line">        <span class="comment">// an event indicating the job has failed so it can be logged if needed. This is</span></span><br><span class="line">        <span class="comment">// to allow every developer to better keep monitor of their failed queue jobs.</span></span><br><span class="line">        <span class="keyword">$this</span>-&gt;delete();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">$this</span>-&gt;failed($e);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123; <span class="comment">// æ²¡é”™ï¼Œå°±æ˜¯è¿™é‡Œå¤„ç†å¤±è´¥ä»»åŠ¡</span></span><br><span class="line">        <span class="keyword">$this</span>-&gt;resolve(Dispatcher::class)-&gt;dispatch(<span class="keyword">new</span> JobFailed(</span><br><span class="line">            <span class="keyword">$this</span>-&gt;connectionName, <span class="keyword">$this</span>, $e ?: <span class="keyword">new</span> ManuallyFailedException</span><br><span class="line">        ));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure><p>æœ€ç²—æš´çš„æ–¹æ³•å°±æ˜¯åœ¨å…·ä½“çš„ XXXJob é‡Œé‡å†™è¿™ä¸ªæ–¹æ³•ã€‚</p><p>è¿™ä¸ªæ–¹æ³•æœ‰ä¸€ä¸ªå¥½å¤„ï¼šå¯ä»¥é’ˆå¯¹æŸä¸ª Jobï¼Œè€Œä¸æ˜¯ä¸€åˆ€åˆ‡ã€‚</p><h2 id="æ–¹æ³•äºŒï¼šä¿®æ”¹-queue-é…ç½®"><a href="#æ–¹æ³•äºŒï¼šä¿®æ”¹-queue-é…ç½®" class="headerlink" title="æ–¹æ³•äºŒï¼šä¿®æ”¹ queue é…ç½®"></a>æ–¹æ³•äºŒï¼šä¿®æ”¹ queue é…ç½®</h2><p>åæ¥æˆ‘å†æƒ³ï¼Œè¦ä¹ˆæ¯ä¸ª Job éƒ½è¦é‡å†™ä¸€éï¼Œè¦ä¹ˆå†é¡¹ç›®ä¸­å®šä¹‰ä¸€ä¸ª Job çˆ¶ç±»ï¼Œç„¶åå†çˆ¶ç±»ä¸­é‡å†™ï¼Œæ–¹æ³•å¯è¡Œï¼Œä½†æ˜¯æ„Ÿè§‰ä¸å¤ªä¼˜é›…ï¼Œæ¯”è¾ƒ Laravel æ˜¯ä¸€ä¸ªè¿™ä¹ˆä¼˜é›…çš„æ¡†æ¶ï¼Œæ€ä¹ˆå¯ä»¥å°±è¿™ä¹ˆç²—æš´å¤„ç†å‘¢ã€‚</p><p>äºæ˜¯åœ¨ <code>æ–¹æ³•ä¸€</code> çš„åŸºç¡€ä¸Šå†æ·±å…¥ç ”ç©¶ï¼Œæƒ³è¦çœ‹çœ‹æœ‰æ²¡æœ‰<code>å¼€å…³</code>ï¼Œä½†æ˜¯ä» queue çš„é…ç½®æ–‡ä»¶å’Œæ‰‹å†Œä¸­å¹¶æ²¡æœ‰æ˜ç¡®çš„æåˆ°è¿™ä¸ª<code>å¼€å…³</code>ï¼Œåªèƒ½ç»§ç»­<code>è·³è·³è·³</code>ï¼Œç»§ç»­æ·±å…¥çš„äº†è§£ Job çš„æ‰§è¡ŒåŸç†ã€‚</p><p>åŠŸå¤«ä¸è´Ÿæœ‰å¿ƒäººï¼Œç»ˆäºè®©æˆ‘æ‰¾åˆ°äº† <code>vendor/illuminate/queue/QueueServiceProvider.php</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">registerFailedJobServices</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">$this</span>-&gt;app-&gt;singleton(<span class="string">'queue.failer'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">        $config = <span class="keyword">$this</span>-&gt;app[<span class="string">'config'</span>][<span class="string">'queue.failed'</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>($config[<span class="string">'driver'</span>]) &amp;&amp; $config[<span class="string">'driver'</span>] === <span class="string">'dynamodb'</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;dynamoFailedJobProvider($config);</span><br><span class="line">        &#125; <span class="keyword">elseif</span> (<span class="keyword">isset</span>($config[<span class="string">'table'</span>])) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;databaseFailedJobProvider($config);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> NullFailedJobProvider;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é—®é¢˜å˜å¾—æ¸…æ™°æ˜æœ—äº†ï¼Œä¸éš¾çœ‹å‡ºï¼š</p><ul><li>å½“ <code>queue.failed.driver</code> ä¸º <code>dynamodb</code> çš„æ—¶å€™ä½¿ç”¨ <code>dynamoFailedJobProvider</code> å¤„ç†</li><li>å½“å­˜åœ¨ <code>queue.failed.table</code> çš„æ—¶å€™ï¼Œä½¿ç”¨ <code>databaseFailedJobProvider</code> å¤„ç†</li><li>å¦åˆ™ä½¿ç”¨ <code>NullFailedJobProvider</code> å¤„ç†ï¼Œä¹Ÿå°±æ˜¯å•¥éƒ½ä¸å¹²çš„æ„æ€</li></ul><p>æœ€ç»ˆå‘ç°åŸæ¥<code>å¼€å…³</code>æ˜¯å­˜åœ¨çš„ï¼Œåªæ˜¯å®˜æ–¹æ²¡æœ‰æ˜ç¡®è¯´æ˜ã€‚</p><p>æ‰¾åˆ° <code>config/queue.php</code>, do it!</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">|--------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">| Failed Queue Jobs</span></span><br><span class="line"><span class="comment">|--------------------------------------------------------------------------</span></span><br><span class="line"><span class="comment">|</span></span><br><span class="line"><span class="comment">| These options configure the behavior of failed queue job logging so you</span></span><br><span class="line"><span class="comment">| can control which database and table are used to store the jobs that</span></span><br><span class="line"><span class="comment">| have failed. You may change them to any database / table you wish.</span></span><br><span class="line"><span class="comment">|</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="string">'failed'</span> =&gt; [</span><br><span class="line">    <span class="comment">// 'database' =&gt; env('DB_CONNECTION', 'mysql'),</span></span><br><span class="line">    <span class="comment">// 'table' =&gt; env('QUEUE_FAILED_TABLE', 'failed_jobs'),</span></span><br><span class="line">],</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Laravel </tag>
            
            <tag> queue </tag>
            
            <tag> faild_jobs </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¦‚ä½•æ­£ç¡®çš„åœ¨ Lumen ä¸­å¯ç”¨ Notification</title>
      <link href="/how-to-make-notifications-in-Lumen/"/>
      <url>/how-to-make-notifications-in-Lumen/</url>
      
        <content type="html"><![CDATA[<h2 id="å®‰è£…-illuminate-notifications"><a href="#å®‰è£…-illuminate-notifications" class="headerlink" title="å®‰è£… illuminate/notifications"></a>å®‰è£… <code>illuminate/notifications</code></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer require illuminate/notifications</span><br></pre></td></tr></table></figure><h2 id="bootstrap-app-php-æ³¨å†ŒæœåŠ¡"><a href="#bootstrap-app-php-æ³¨å†ŒæœåŠ¡" class="headerlink" title="bootstrap/app.php æ³¨å†ŒæœåŠ¡"></a><code>bootstrap/app.php</code> æ³¨å†ŒæœåŠ¡</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$app-&gt;register(Illuminate\Notifications\NotificationServiceProvider::class);</span><br></pre></td></tr></table></figure><blockquote><p>âš ï¸ å¿…é¡»åœ¨ AppServiceProvider æ³¨å†Œä¹‹å‰ï¼Œä¸ç„¶è‡ªå®šä¹‰ <code>Channel</code> ä¼šæ— æ³•æ‰¾åˆ°ï¼Œæå‡ <code>InvalidArgumentException with message &#39;Driver [xxxx] not supported.&#39;</code></p></blockquote><h2 id="åœ¨-AppServiceProvider-php-æ³¨å†Œ-Channel"><a href="#åœ¨-AppServiceProvider-php-æ³¨å†Œ-Channel" class="headerlink" title="åœ¨ AppServiceProvider.php æ³¨å†Œ Channel"></a>åœ¨ <code>AppServiceProvider.php</code> æ³¨å†Œ <code>Channel</code></h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">$this</span>-&gt;app-&gt;make(Illuminate\Notifications\ChannelManager::class)-&gt;extend(<span class="string">'your-channel'</span>, <span class="function"><span class="keyword">function</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;app-&gt;make(App\Channels\YourChannel::class);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> lumen </tag>
            
            <tag> notification </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PHP çš„ __call å’Œ __callStatic</title>
      <link href="/call-and-callstatic-in-php/"/>
      <url>/call-and-callstatic-in-php/</url>
      
        <content type="html"><![CDATA[<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span><span class="params">($name, $arguments)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">__callStatic</span><span class="params">($name, $arguments)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">bar</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Foo::abc();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">(<span class="keyword">new</span> Foo)-&gt;bar();</span><br></pre></td></tr></table></figure><p>ç»“æœæ˜¯ <code>1</code> è¿˜æ˜¯ <code>2</code>ï¼Ÿç­”æ¡ˆæ˜¯ <code>1</code></p><p>æ¥ä¸‹æ¥è§£é‡Šä¸€ä¸‹ï¼š</p><ol><li><code>__call</code> æ–¹æ³•å…³æ³¨æ–¹æ³•èƒ½å¦è¢«è®¿é—®åˆ°ï¼Œè€Œä¸ä»…ä»…æ˜¯å…³æ³¨æ˜¯å¦å­˜åœ¨</li><li><code>__callStatic</code> æ–¹æ³•å…³æ³¨çš„æ˜¯æ–¹æ³•èƒ½å¦è¢«é™æ€çš„è®¿é—®åˆ°ï¼Œè€Œä¸æ˜¯å…³æ³¨æ–¹æ³•æ˜¯å¦å­˜åœ¨ï¼Œæ˜¯å¦æ˜¯é™æ€æ–¹æ³•ã€‚</li><li>å…·ä½“æ‰§è¡Œ <code>__call</code>ï¼Œ<code>__callStatic</code> ï¼Œæ˜¯æ ¹æ®è°ƒç”¨çš„ä¸Šä¸‹æ–‡ã€‚å¦‚</li></ol>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PHP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸º PHP7.x å®‰è£… memcache æ‰©å±•</title>
      <link href="/install-memcache-for-php7-x/"/>
      <url>/install-memcache-for-php7-x/</url>
      
        <content type="html"><![CDATA[<p><a href="https://github.com/websupport-sk/pecl-memcache" target="_blank" rel="noopener">PHP Extension - Memcache module with support of newer PHP 7.0-7.3</a></p><p>Install</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># clone source</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/websupport-sk/pecl-memcache.git</span><br><span class="line"></span><br><span class="line"><span class="comment"># configure &amp; install</span></span><br><span class="line"><span class="built_in">cd</span> pecl-memcache;</span><br><span class="line">phpize</span><br><span class="line">./configure</span><br><span class="line">make -j$(nproc)</span><br><span class="line">make install</span><br><span class="line"></span><br><span class="line"><span class="comment"># create php ini</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"extension=memcache.so"</span> &gt;&gt; /usr/<span class="built_in">local</span>/php/etc/conf.d/memcache.ini</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PHP </tag>
            
            <tag> Memcache </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¦‚ä½•æ­£ç¡®çš„è®¡ç®—æ¯ N åˆ†é’Ÿè®°å½•æ•°</title>
      <link href="/count-for-every-n-minutes-in-mysql/"/>
      <url>/count-for-every-n-minutes-in-mysql/</url>
      
        <content type="html"><![CDATA[<h2 id="è¡¨ç»“æ„"><a href="#è¡¨ç»“æ„" class="headerlink" title="è¡¨ç»“æ„"></a>è¡¨ç»“æ„</h2><table><thead><tr><th>å­—æ®µ</th><th>æ•°æ®ç±»å‹</th></tr></thead><tbody><tr><td>id</td><td>int(11)</td></tr><tr><td>created_at</td><td>datetime</td></tr></tbody></table><h2 id="æœŸæœ›ç»“æœ"><a href="#æœŸæœ›ç»“æœ" class="headerlink" title="æœŸæœ›ç»“æœ"></a>æœŸæœ›ç»“æœ</h2><table><thead><tr><th>æ—¶é—´æ®µ</th><th>æ•°é‡</th></tr></thead><tbody><tr><td>2019-09-29 12:00:00 ~ 2019-09-29 12:05:00</td><td>100</td></tr><tr><td>2019-09-29 12:05:00 ~ 2019-09-29 12:10:00</td><td>120</td></tr><tr><td>2019-09-29 12:10:00 ~ 2019-09-29 12:15:00</td><td>131</td></tr><tr><td>2019-09-29 12:15:00 ~ 2019-09-29 12:20:00</td><td>189</td></tr><tr><td>2019-09-29 12:20:00 ~ 2019-09-29 12:25:00</td><td>134</td></tr><tr><td>2019-09-29 12:25:00 ~ 2019-09-29 12:30:00</td><td>155</td></tr><tr><td>2019-09-29 12:30:00 ~ 2019-09-29 12:35:00</td><td>198</td></tr><tr><td>2019-09-29 12:35:00 ~ 2019-09-29 12:40:00</td><td>133</td></tr></tbody></table><h2 id="SQLè¯­å¥"><a href="#SQLè¯­å¥" class="headerlink" title="SQLè¯­å¥"></a>SQLè¯­å¥</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-- 300 ä¸º 5 åˆ†é’Ÿ</span><br><span class="line">select</span><br><span class="line">  concat(from_unixtime(unix_timestamp(created_at) - unix_timestamp(created_at) % 300), &apos; ~ &apos;, from_unixtime(unix_timestamp(created_at) - unix_timestamp(created_at) % 300 + 300)) as per,</span><br><span class="line">  count(1)</span><br><span class="line">from table</span><br><span class="line">group by per;</span><br></pre></td></tr></table></figure><p>å¦‚æœ created_at ç±»å‹ä¸º intï¼Œè¿˜å¯ä»¥å‡å°‘ä¸€æ¬¡è½¬æ¢</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-- 300 ä¸º 5 åˆ†é’Ÿ</span><br><span class="line">select</span><br><span class="line">  concat(from_unixtime(created_at - created_at % 300), &apos; ~ &apos;, from_unixtime(created_at - created_at % 300 + 300)) as per,</span><br><span class="line">  count(1)</span><br><span class="line">from table</span><br><span class="line">group by per;</span><br></pre></td></tr></table></figure><h2 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h2><blockquote><p>æ—¶é—´åˆ†ç‰‡ <em>MySQLæ²¡æœ‰ç›¸å…³çš„æ—¶é—´åˆ†ç‰‡å‡½æ•°ï¼Œè¿˜å¥½å¯ä»¥ç”¨å–æ¨¡ï¼ˆ%ï¼‰å®ç°</em></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¦‚ä½•æ­£ç¡®çš„ä½¿ç”¨ GitHub Actions å®ç° Hexo åšå®¢çš„ CICD</title>
      <link href="/github-actions-hexo-cicd/"/>
      <url>/github-actions-hexo-cicd/</url>
      
        <content type="html"><![CDATA[<blockquote><p>CI/CD (continuous integration and continuous deployment)</p></blockquote><p>æœ€è¿‘åŒäº‹åˆ†äº«äº† GitHub Actions ï¼Œå‘ç°é™¤äº†æˆ‘ä»¬å¸¸å¬åˆ°çš„è‡ªåŠ¨éƒ¨ç½²ï¼ˆé¡¹ç›®ä¸Šçº¿ï¼‰å¤–è¿˜å¯ä»¥åšå¾ˆå¤šäº‹æƒ…ï¼Œæ¯”å¦‚è¯´å°±å¯ä»¥è‡ªåŠ¨ç”Ÿæˆ Hexo åšå®¢ï¼Œæˆ‘æ“¦ï¼è¿™ä¸å°±æ˜¯æˆ‘æƒ³è¦çš„å—ï¼Ÿä»¥åå°±ä¸ç”¨æ¯æ¬¡å†™å®Œæ–‡ç« ä¹‹åå†æ‰§è¡Œ <code>hexo clean &amp;&amp; hexo g -d</code> äº†ã€‚</p><p>å›æ¥å„ç§ç™¾åº¦ï¼Œæœ‰å‡ ç¯‡é’ˆå¯¹ HEXO çš„æ–‡ç« ï¼Œç…§ç€å¼€å§‹å†™è„šæœ¬ï¼Œå‘ç°æ€ä¹ˆéƒ½ä¸èƒ½æˆåŠŸï¼Œå„ç§é”™è¯¯ã€‚æŠ˜è…¾äº† 3 ä¸ªå°æ—¶ï¼Œç»ˆäºé¡ºåˆ©é€šè¿‡äº†ã€‚</p><a id="more"></a><h2 id="é¡¹ç›®èƒŒæ™¯"><a href="#é¡¹ç›®èƒŒæ™¯" class="headerlink" title="é¡¹ç›®èƒŒæ™¯"></a>é¡¹ç›®èƒŒæ™¯</h2><p>æˆ‘å…ˆä»‹ç»ä¸€ä¸‹æˆ‘çš„é¡¹ç›®èƒŒæ™¯ï¼š</p><table><thead><tr><th>é¡¹ç›®</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td><code>https://github.com/huangdijia/blog</code></td><td>ç”¨äºå­˜æ”¾ hexo ç”Ÿæˆçš„é¡¹ç›®ï¼Œå¯ä»¥ç†è§£æˆæºç </td></tr><tr><td><code>https://github.com/huangdijia/huangdijia.github.io</code></td><td>å­˜æ”¾ hexo ç¼–è¯‘åçš„é™æ€æ–‡ä»¶ï¼Œä¹Ÿæ˜¯æˆ‘çš„åšå®¢é¡µé¢</td></tr></tbody></table><blockquote><p>ä»¥ä¸‹è¯´æ˜éƒ½æ˜¯ä»¥æˆ‘çš„ä¸¤ä¸ªé¡¹ç›®ä¸ºä¾‹å­</p></blockquote><h2 id="å¯†é’¥ç”Ÿæˆ"><a href="#å¯†é’¥ç”Ÿæˆ" class="headerlink" title="å¯†é’¥ç”Ÿæˆ"></a>å¯†é’¥ç”Ÿæˆ</h2><p>å› ä¸º hexo ç¼–è¯‘åéœ€è¦ push åˆ° huangdijia.github.io ä¸Šï¼Œéœ€è¦ GitHub çš„è´¦å·å¯†ç ï¼ˆå°è¯•è¿‡ä¸è¡Œï¼‰æˆ–è€…å¯†é’¥ï¼Œæˆ‘ä»¬éœ€è¦ç”¨ <code>ssh-keygen</code> å‘½ä»¤ç”Ÿæˆä¸€ç»„ç§é’¥ï¼ˆæ²¡æœ‰åç¼€åï¼‰å’Œå…¬é’¥ï¼ˆ.pubç»“å°¾ï¼‰</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -f github-deploy-key <span class="comment"># ä¸‰æ¬¡å›è½¦å³åˆ»</span></span><br></pre></td></tr></table></figure><p>ä¼šç”Ÿæˆ <code>github-deploy-key</code> å’Œ <code>github-deploy-key.pub</code> ä¸¤ä¸ªæ–‡ä»¶ã€‚</p><h2 id="é…ç½®-GitHub-ä»“åº“"><a href="#é…ç½®-GitHub-ä»“åº“" class="headerlink" title="é…ç½® GitHub ä»“åº“"></a>é…ç½® GitHub ä»“åº“</h2><h3 id="é…ç½®-blog-ä»“åº“"><a href="#é…ç½®-blog-ä»“åº“" class="headerlink" title="é…ç½® blog ä»“åº“"></a>é…ç½® blog ä»“åº“</h3><p>æ‰“å¼€ <code>https://github.com/huangdijia/blog/settings/secrets</code> ç‚¹å‡» <code>Add new secrets</code>ï¼Œåˆ†åˆ«åœ¨</p><ul><li><code>Name</code> è¾“å…¥ <code>HEXO_DEPLOY_PRI</code></li><li><code>Value</code> è¾“å…¥å‰é¢ç”Ÿæˆçš„ç§æœ‰ KEY <code>github-deploy-key</code> çš„å†…å®¹</li></ul><h3 id="é…ç½®-huangdijia-github-io-ä»“åº“"><a href="#é…ç½®-huangdijia-github-io-ä»“åº“" class="headerlink" title="é…ç½® huangdijia.github.io ä»“åº“"></a>é…ç½® huangdijia.github.io ä»“åº“</h3><p>æ‰“å¼€ <code>https://github.com/huangdijia/huangdijia.github.io/settings/keys</code>ï¼Œç‚¹å‡» <code>Add deploy key</code>ï¼Œåˆ†åˆ«åœ¨</p><ul><li><code>Title</code> è¾“å…¥ <code>HEXO_DEPLOY_PUB</code></li><li><code>Key</code> è¾“å…¥å‰é¢ç”Ÿæˆçš„ç§æœ‰ KEY <code>github-deploy-key.pub</code> çš„å†…å®¹</li></ul><h2 id="ç¼–å†™-Action-è„šæœ¬"><a href="#ç¼–å†™-Action-è„šæœ¬" class="headerlink" title="ç¼–å†™ Action è„šæœ¬"></a>ç¼–å†™ Action è„šæœ¬</h2><p>ä½¿ç”¨å‰å…ˆè¦<a href="https://github.com/features/actions" target="_blank" rel="noopener">ç”³è¯·</a>ï¼Œç„¶åç‚¹å‡» <code>Actions</code> -&gt; <code>Set up this workflow</code> æˆ–ç›´æ¥æ‰“å¼€ <code>https://github.com/huangdijia/huangdijia.github.io/actions/new</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">HEXO</span> <span class="string">CI</span></span><br><span class="line"></span><br><span class="line"><span class="attr">on:</span> <span class="string">[push]</span></span><br><span class="line"></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">build:</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">    <span class="attr">strategy:</span></span><br><span class="line">      <span class="attr">matrix:</span></span><br><span class="line">        <span class="attr">node-version:</span> <span class="string">[10.x]</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">uses:</span> <span class="string">actions/checkout@v1</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Use</span> <span class="string">Node.js</span> <span class="string">$&#123;&#123;</span> <span class="string">matrix.node-version</span> <span class="string">&#125;&#125;</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/setup-node@v1</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">node-version:</span> <span class="string">$&#123;&#123;</span> <span class="string">matrix.node-version</span> <span class="string">&#125;&#125;</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Configuration</span> <span class="string">environment</span></span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">          <span class="attr">HEXO_DEPLOY_PRI:</span> <span class="string">$&#123;&#123;secrets.HEXO_DEPLOY_PRI&#125;&#125;</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line">          <span class="string">mkdir</span> <span class="string">-p</span> <span class="string">~/.ssh/</span></span><br><span class="line">          <span class="string">echo</span> <span class="string">"$HEXO_DEPLOY_PRI"</span> <span class="string">&gt;</span> <span class="string">~/.ssh/id_rsa</span></span><br><span class="line">          <span class="string">chmod</span> <span class="number">600</span> <span class="string">~/.ssh/id_rsa</span></span><br><span class="line">          <span class="string">ssh-keyscan</span> <span class="string">github.com</span> <span class="string">&gt;&gt;</span> <span class="string">~/.ssh/known_hosts</span></span><br><span class="line">          <span class="string">git</span> <span class="string">config</span> <span class="string">--global</span> <span class="string">user.name</span> <span class="string">"yourname"</span></span><br><span class="line">          <span class="string">git</span> <span class="string">config</span> <span class="string">--global</span> <span class="string">user.email</span> <span class="string">"your@email.com"</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Install</span> <span class="string">dependencies</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line">          <span class="string">npm</span> <span class="string">i</span> <span class="string">-g</span> <span class="string">hexo-cli</span></span><br><span class="line">          <span class="string">npm</span> <span class="string">i</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Deploy</span> <span class="string">hexo</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line">          <span class="string">hexo</span> <span class="string">g</span> <span class="string">-d</span></span><br></pre></td></tr></table></figure><h2 id="ä¿®æ”¹-config-yml-repo"><a href="#ä¿®æ”¹-config-yml-repo" class="headerlink" title="ä¿®æ”¹ _config.yml repo"></a>ä¿®æ”¹ _config.yml repo</h2><p>å¦‚æœåŸæ¥æ˜¯ http çš„ï¼Œè¦æ”¹ä¸º ssh æ ¼å¼</p><p>å¦‚ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="comment"># repo: https://github.com/huangdijia/huangdijia.github.io</span></span><br><span class="line">  <span class="attr">repo:</span> <span class="string">git@github.com:huangdijia/huangdijia.github.io.git</span></span><br></pre></td></tr></table></figure><h2 id="äº«å—æˆæœ"><a href="#äº«å—æˆæœ" class="headerlink" title="äº«å—æˆæœ"></a>äº«å—æˆæœ</h2><p>åœ¨ <code>blog</code> é¡¹ç›®ä»»æ„ pushï¼Œåœ¨ <code>https://github.com/huangdijia/blog/actions</code> éƒ½æœ‰å“åº”çš„æ‰§è¡Œè®°å½•</p><h2 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h2><blockquote><p>åˆ‡è®°ä¸è¦æŠŠè´¦å·å¯†ç å†™åœ¨è„šæœ¬ä¸Š!!!</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Github </tag>
            
            <tag> actions </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åšå®¢è¿ç§»å…¬å‘Š</title>
      <link href="/blog-migrate/"/>
      <url>/blog-migrate/</url>
      
        <content type="html"><![CDATA[<p>å¾ˆä¸å¹¸ï¼Œå› ä¸ºVPSå¿˜è®°ç»­è´¹ï¼Œåšå®¢çš„èµ„æ–™æ²¡æœ‰å¤‡ä»½ï¼Œå¯¼è‡´åšå®¢èµ„æ–™ä¸¢å¤±ã€‚<br>ç»è¿‡æ·±æ€ç†Ÿè™‘ï¼Œè§‰å¾—å°†åšå®¢è¿ç§»è‡³GitHubï¼Œä¸¢å¤±çš„æ–‡ç« å’Œèµ„æ–™æˆ‘å°½é‡æ‰¾å›ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> å…¶ä»– </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>crontab å‡ ä¸ªç‰¹æ®Šå­—ç¬¦çš„å«ä¹‰</title>
      <link href="/the-meaning-of-several-special-characters-for-crontab/"/>
      <url>/the-meaning-of-several-special-characters-for-crontab/</url>
      
        <content type="html"><![CDATA[<h2 id="å«ä¹‰"><a href="#å«ä¹‰" class="headerlink" title="å«ä¹‰"></a>å«ä¹‰</h2><table><thead><tr><th>å­—ç¬¦</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td><code>*</code>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</td><td>å…¨éƒ¨ã€‚æ„æ€æ˜¯åœ¨è¯¥æ—¶é—´çš„ä»»æ„ç‚¹éƒ½åº”å½“æ‰§è¡Œ</td></tr><tr><td><code>?</code></td><td>ä¸æŒ‡å®šï¼Œä»»æ„ã€‚ä»…ç”¨äº æ—¥(æœˆ)å’Œæ—¥(å‘¨)ã€‚<code>0 0 5 * ?</code> ä»£è¡¨æ¯ä¸ªæœˆçš„ç¬¬5å¤©é›¶ç‚¹ï¼Œä¸è®ºæ˜ŸæœŸå‡ ã€‚</td></tr><tr><td><code>0</code></td><td><code>0 ? * 1</code> ä»£è¡¨æ¯å‘¨ä¸€ï¼Œä¸è®ºæ˜¯å½“æœˆçš„å“ªå¤©ã€‚</td></tr><tr><td><code>,</code></td><td>å¤šä¸ªå€¼çš„åˆ†éš”ç¬¦ï¼Œä¾‹å¦‚<code>1,5,10</code> - ä»£è¡¨è¿ç»­å€¼ï¼Œä¾‹å¦‚<code>1-20</code></td></tr><tr><td><code>/</code></td><td>æ­¥é•¿ã€‚ä¾‹å¦‚ <code>5/15</code>ï¼Œä»£è¡¨ä»5å¼€å§‹ï¼Œä»¥15ä¸ºæ­¥é•¿ã€‚å› æ­¤ï¼Œå½“<code>5/15</code>ä½äºåˆ†é’Ÿçš„ä½ç½®æ—¶ï¼Œè¡¨ç¤ºå°æ—¶å†…çš„ç¬¬5ã€20ã€35å’Œ50åˆ†é’Ÿ</td></tr><tr><td><code>L</code></td><td>æœ€åä¸€å¤©ã€‚å¯ä»¥æ˜¯æ¯æœˆæœ€åä¸€å¤©æˆ–è€…æ¯å‘¨æœ€åä¸€å¤©ã€‚å¦‚æœç”¨åœ¨ å¤©(å‘¨)å­—æ®µï¼Œå¹¶ä¸”å‰é¢åŠ æ•°å­—ï¼Œåˆ™è¡¨ç¤ºæœ€åä¸€ä¸ªå‘¨Nã€‚ä¾‹å¦‚<code>5L</code>ï¼Œè¡¨ç¤ºæœ€åä¸€ä¸ªå‘¨äº”ï¼ˆ5è¡¨ç¤ºå‘¨äº”ï¼ŒLè¡¨ç¤ºæœ€åï¼‰ã€‚</td></tr><tr><td><code>W</code></td><td>å·¥ä½œæ—¥ï¼ŒæŒ‡å‘¨ä¸€åˆ°å‘¨äº”çš„ä»»æ„ä¸€å¤©</td></tr><tr><td><code>#</code></td><td>è¡¨ç¤ºç¬¬å‡ ä¸ªçš„æ„æ€ï¼Œä¾‹å¦‚ <code>6#3</code>ï¼Œè¡¨ç¤ºå½“æœˆç¬¬3ä¸ªæ˜ŸæœŸå…­ï¼ˆ6è¡¨ç¤ºå‘¨å…­ï¼Œ3è¡¨ç¤ºç¬¬3ä¸ªï¼‰</td></tr></tbody></table><h2 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">* 0 9 5L æœ€åä¸€ä¸ªå‘¨äº”æ—©ä¸Š9ç‚¹</span><br><span class="line">* 0 9 6<span class="comment">#3 å½“æœˆç¬¬3ä¸ªæ˜ŸæœŸå…­</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> macos </tag>
            
            <tag> linux </tag>
            
            <tag> crontab </tag>
            
            <tag> centos </tag>
            
            <tag> ubuntu </tag>
            
            <tag> debian </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å°æ¹¾èº«ä»½è¯å­—å·äº§ç”Ÿå™¨</title>
      <link href="/taiwan-roc-id-generator/"/>
      <url>/taiwan-roc-id-generator/</url>
      
        <content type="html"><![CDATA[<p>å‚è€ƒ <a href="https://people.debian.org/~paulliu/ROCid.html" target="_blank" rel="noopener">èº«ä»½è­‰å­—è™Ÿç”¢ç”Ÿå™¨</a> å†™äº†ä¸€ä»½PHPç‰ˆæœ¬</p><a id="more"></a><h2 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * å°ç£èº«ä»½è­‰å­—è™Ÿç”Ÿæˆ &amp; é©—è­‰</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@example</span> $id = (new TaiwanRocId)-&gt;generate();</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@example</span> $ok = (new TaiwanRocId)-&gt;validate($id);</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TaiwanRocId</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">const</span> MALE   = <span class="number">1</span>; <span class="comment">// ç”·</span></span><br><span class="line">    <span class="keyword">const</span> FEMALE = <span class="number">2</span>; <span class="comment">// å¥³</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> $cityMaps = [</span><br><span class="line">        <span class="string">'A'</span> =&gt; <span class="number">10</span>, <span class="comment">// å°åŒ—å¸‚</span></span><br><span class="line">        <span class="string">'B'</span> =&gt; <span class="number">11</span>, <span class="comment">// å°ä¸­å¸‚</span></span><br><span class="line">        <span class="string">'C'</span> =&gt; <span class="number">12</span>, <span class="comment">// åŸºéš†å¸‚</span></span><br><span class="line">        <span class="string">'D'</span> =&gt; <span class="number">13</span>, <span class="comment">// å°å—å¸‚</span></span><br><span class="line">        <span class="string">'E'</span> =&gt; <span class="number">14</span>, <span class="comment">// é«˜é›„å¸‚</span></span><br><span class="line">        <span class="string">'F'</span> =&gt; <span class="number">15</span>, <span class="comment">// å°åŒ—ç¸£</span></span><br><span class="line">        <span class="string">'G'</span> =&gt; <span class="number">16</span>, <span class="comment">// å®œè˜­ç¸£</span></span><br><span class="line">        <span class="string">'H'</span> =&gt; <span class="number">17</span>, <span class="comment">// æ¡ƒåœ’ç¸£</span></span><br><span class="line">        <span class="string">'J'</span> =&gt; <span class="number">18</span>, <span class="comment">// æ–°ç«¹ç¸£</span></span><br><span class="line">        <span class="string">'K'</span> =&gt; <span class="number">19</span>, <span class="comment">// è‹—æ —ç¸£</span></span><br><span class="line">        <span class="string">'L'</span> =&gt; <span class="number">20</span>, <span class="comment">// å°ä¸­ç¸£</span></span><br><span class="line">        <span class="string">'M'</span> =&gt; <span class="number">21</span>, <span class="comment">// å—æŠ•ç¸£</span></span><br><span class="line">        <span class="string">'N'</span> =&gt; <span class="number">22</span>, <span class="comment">// å½°åŒ–ç¸£</span></span><br><span class="line">        <span class="string">'P'</span> =&gt; <span class="number">23</span>, <span class="comment">// é›²æ—ç¸£</span></span><br><span class="line">        <span class="string">'Q'</span> =&gt; <span class="number">24</span>, <span class="comment">// å˜‰ç¾©ç¸£</span></span><br><span class="line">        <span class="string">'R'</span> =&gt; <span class="number">25</span>, <span class="comment">// å°å—ç¸£</span></span><br><span class="line">        <span class="string">'S'</span> =&gt; <span class="number">26</span>, <span class="comment">// é«˜é›„ç¸£</span></span><br><span class="line">        <span class="string">'T'</span> =&gt; <span class="number">27</span>, <span class="comment">// å±æ±ç¸£</span></span><br><span class="line">        <span class="string">'U'</span> =&gt; <span class="number">28</span>, <span class="comment">// èŠ±è“®ç¸£</span></span><br><span class="line">        <span class="string">'V'</span> =&gt; <span class="number">29</span>, <span class="comment">// å°æ±ç¸£</span></span><br><span class="line">        <span class="string">'X'</span> =&gt; <span class="number">30</span>, <span class="comment">// æ¾æ¹–ç¸£</span></span><br><span class="line">        <span class="string">'Y'</span> =&gt; <span class="number">31</span>, <span class="comment">// é™½æ˜å±±</span></span><br><span class="line">        <span class="string">'W'</span> =&gt; <span class="number">32</span>, <span class="comment">// é‡‘é–€ç¸£</span></span><br><span class="line">        <span class="string">'Z'</span> =&gt; <span class="number">33</span>, <span class="comment">// é€£æ±Ÿç¸£</span></span><br><span class="line">        <span class="string">'O'</span> =&gt; <span class="number">35</span>, <span class="comment">// æ–°ç«¹å¸‚</span></span><br><span class="line">        <span class="string">'I'</span> =&gt; <span class="number">34</span>, <span class="comment">// å˜‰ç¾©å¸‚</span></span><br><span class="line">    ];</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ç”Ÿæˆèº«ä»½è­‰å­—è™Ÿ</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string $city åŸå¸‚</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> integer $sex æ€§åˆ¥</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string $mid æµæ°´è™Ÿ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">generate</span><span class="params">(string $city = null, int $sex = null, string $mid = null)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $cities = array_keys(<span class="keyword">$this</span>-&gt;cityMaps);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (is_null($city)) &#123;</span><br><span class="line">            $index    = array_rand($cities);</span><br><span class="line">            $city     = $cities[$index];</span><br><span class="line">            $cityCode = <span class="keyword">$this</span>-&gt;cityMaps[$city];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            $city     = strtoupper($city);</span><br><span class="line">            $cityCode = <span class="keyword">$this</span>-&gt;cityMaps[$city] ?? <span class="string">''</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (is_null($sex)) &#123;</span><br><span class="line">            $sex = rand(<span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (is_null($mid)) &#123;</span><br><span class="line">            $mid = <span class="keyword">$this</span>-&gt;midRand();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// é©—è­‰åŸå¸‚</span></span><br><span class="line">        <span class="keyword">if</span> (!in_array($city, $cities)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> \<span class="keyword">Exception</span>(<span class="string">"Invalid city"</span>, <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// é©—è­‰æ€§åˆ¥</span></span><br><span class="line">        <span class="keyword">if</span> (!in_array($sex, [<span class="keyword">self</span>::MALE, <span class="keyword">self</span>::FEMALE])) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> \<span class="keyword">Exception</span>(<span class="string">"Invalid sex"</span>, <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $verifyCode = <span class="keyword">$this</span>-&gt;calAll($cityCode, $sex, $mid);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> sprintf(<span class="string">'%s%s%s%s'</span>, $city, $sex, $mid, $verifyCode);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * é©—è­‰èº«ä»½è­‰å­—è™Ÿ</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string $id èº«ä»½è­‰å­—è™Ÿ</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> bool</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">validate</span><span class="params">(string $id = <span class="string">''</span>)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        [$city, $sex, $mid, $verifyCode] = [</span><br><span class="line">            substr($id, <span class="number">0</span>, <span class="number">1</span>),</span><br><span class="line">            substr($id, <span class="number">1</span>, <span class="number">1</span>),</span><br><span class="line">            substr($id, <span class="number">2</span>, <span class="number">-1</span>),</span><br><span class="line">            substr($id, <span class="number">-1</span>, <span class="number">1</span>),</span><br><span class="line">        ];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> $verifyCode == <span class="keyword">$this</span>-&gt;calAll(<span class="keyword">$this</span>-&gt;cityMaps[$city], $sex, $mid);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * éš¨æ©Ÿæµæ°´è™Ÿ</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> string</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">midRand</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> str_pad(rand(<span class="number">0</span>, <span class="number">9999999</span>), <span class="number">7</span>, <span class="string">'0'</span>, STR_PAD_LEFT);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¨ˆç®—é©—è­‰ç¢¼</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> int $city</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> int $sex</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string|int $mid</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> int</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">calAll</span><span class="params">($city, $sex, $mid)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $ret = <span class="number">0</span>;</span><br><span class="line">        $ret = <span class="keyword">$this</span>-&gt;calCity($city) + <span class="keyword">$this</span>-&gt;calSex($sex) + <span class="keyword">$this</span>-&gt;calMid($mid);</span><br><span class="line">        $ret = $ret % <span class="number">10</span>;</span><br><span class="line">        $ret = <span class="number">10</span> - $ret;</span><br><span class="line">        $ret = $ret % <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> $ret;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¨ˆç®—åŸå¸‚é©—è­‰ç¢¼</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> int $city</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> int</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">calCity</span><span class="params">(int $city)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> substr($city, <span class="number">0</span>, <span class="number">1</span>) + substr($city, <span class="number">1</span>, <span class="number">1</span>) * <span class="number">9</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¨ˆç®—æ€§åˆ¥é©—è­‰ç¢¼</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> integer $sex</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> int</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">calSex</span><span class="params">(int $sex)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> $sex * <span class="number">8</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è¨ˆç®—æµæ°´é©—è­‰ç¢¼</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> string|int $mid</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> int</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">calMid</span><span class="params">($mid)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $ret = <span class="number">0</span>;</span><br><span class="line">        $len = strlen($mid);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> ($i = <span class="number">0</span>; $i &lt; $len; $i++) &#123;</span><br><span class="line">            $ret = $ret + (<span class="number">7</span> - $i) * substr($mid, $i, <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> $ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h2><h3 id="ç”Ÿæˆèº«ä»½è¯å­—å·"><a href="#ç”Ÿæˆèº«ä»½è¯å­—å·" class="headerlink" title="ç”Ÿæˆèº«ä»½è¯å­—å·"></a>ç”Ÿæˆèº«ä»½è¯å­—å·</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$Roc = <span class="keyword">new</span> TaiwanRocId;</span><br><span class="line"></span><br><span class="line"><span class="comment">// éšæœºç”Ÿæˆ</span></span><br><span class="line">$id = $Roc-&gt;generate();</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŒ‡å®šåŸå¸‚ã€æ€§åˆ«</span></span><br><span class="line">$id = $Roc-&gt;generate(<span class="string">'A'</span>, <span class="number">1</span>);</span><br></pre></td></tr></table></figure><h3 id="éªŒè¯åˆæ³•æ€§"><a href="#éªŒè¯åˆæ³•æ€§" class="headerlink" title="éªŒè¯åˆæ³•æ€§"></a>éªŒè¯åˆæ³•æ€§</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ok = (<span class="keyword">new</span> TaiwanRocId)-&gt;validate(<span class="string">"A197651254"</span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> php </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MacOS ä¸Šå®‰è£…å¤šç‰ˆæœ¬ PHP</title>
      <link href="/install-multi-php-version-on-macos/"/>
      <url>/install-multi-php-version-on-macos/</url>
      
        <content type="html"><![CDATA[<h2 id="å®‰è£…-brew-æº"><a href="#å®‰è£…-brew-æº" class="headerlink" title="å®‰è£… brew æº"></a>å®‰è£… brew æº</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">brew tap shivammathur/php</span><br><span class="line">brew search php |grep -E <span class="string">"php@\d\.\d$"</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ç»“æœï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">shivammathur/php/php@5.6</span><br><span class="line">shivammathur/php/php@7.0</span><br><span class="line">shivammathur/php/php@7.1</span><br><span class="line">shivammathur/php/php@7.2</span><br><span class="line">shivammathur/php/php@7.3</span><br><span class="line">shivammathur/php/php@7.4</span><br><span class="line">shivammathur/php/php@8.1</span><br><span class="line">shivammathur/php/php@8.2</span><br></pre></td></tr></table></figure><a id="more"></a><h2 id="å®‰è£…å¤šç‰ˆæœ¬"><a href="#å®‰è£…å¤šç‰ˆæœ¬" class="headerlink" title="å®‰è£…å¤šç‰ˆæœ¬"></a>å®‰è£…å¤šç‰ˆæœ¬</h2><p>è·Ÿè¿›éœ€è¦å®‰è£…</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">brew install shivammathur/php/php@5.6</span><br><span class="line">brew install shivammathur/php/php@7.0</span><br><span class="line">brew install shivammathur/php/php@7.1</span><br><span class="line">brew install shivammathur/php/php@7.2</span><br><span class="line">brew install shivammathur/php/php@7.3</span><br><span class="line">brew install shivammathur/php/php@7.4</span><br><span class="line">brew install shivammathur/php/php@8.1</span><br><span class="line">brew install shivammathur/php/php@8.2</span><br></pre></td></tr></table></figure><h2 id="å‘½ä»¤åˆ«å"><a href="#å‘½ä»¤åˆ«å" class="headerlink" title="å‘½ä»¤åˆ«å"></a>å‘½ä»¤åˆ«å</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.zshrc</span><br></pre></td></tr></table></figure><p>æˆ–</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim ~/.bash_profile</span><br></pre></td></tr></table></figure><p>åŠ å…¥ä»¥ä¸‹å†…å®¹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è§£é™¤æ‰€æœ‰å…³è”</span></span><br><span class="line"><span class="built_in">alias</span> unlink-php=<span class="string">'brew list|grep -E "php(\d&#123;2&#125;|@\d\.\d)$"|xargs brew unlink; brew unlink php'</span></span><br><span class="line"><span class="comment"># å‘½ä»¤åˆ«å</span></span><br><span class="line"><span class="built_in">alias</span> php53=<span class="string">'/usr/local/opt/php@5.3/bin/php'</span></span><br><span class="line"><span class="built_in">alias</span> php54=<span class="string">'/usr/local/opt/php@5.4/bin/php'</span></span><br><span class="line"><span class="built_in">alias</span> php55=<span class="string">'/usr/local/opt/php@5.5/bin/php'</span></span><br><span class="line"><span class="built_in">alias</span> php56=<span class="string">'/usr/local/opt/php@5.6/bin/php'</span></span><br><span class="line"><span class="built_in">alias</span> php70=<span class="string">'/usr/local/opt/php@7.0/bin/php'</span></span><br><span class="line"><span class="built_in">alias</span> php71=<span class="string">'/usr/local/opt/php@7.1/bin/php'</span></span><br><span class="line"><span class="built_in">alias</span> php72=<span class="string">'/usr/local/opt/php@7.2/bin/php'</span></span><br><span class="line"><span class="built_in">alias</span> php73=<span class="string">'/usr/local/opt/php@7.3/bin/php'</span></span><br><span class="line"><span class="built_in">alias</span> php74=<span class="string">'/usr/local/opt/php@7.4/bin/php'</span></span><br><span class="line"><span class="built_in">alias</span> php80=<span class="string">'/usr/local/opt/php/bin/php'</span></span><br><span class="line"><span class="comment"># pecl alias</span></span><br><span class="line"><span class="built_in">alias</span> pecl53=<span class="string">'/usr/local/php5/bin/pecl'</span></span><br><span class="line"><span class="built_in">alias</span> pecl71=<span class="string">'/usr/local/opt/php@7.1/bin/pecl'</span></span><br><span class="line"><span class="built_in">alias</span> pecl72=<span class="string">'/usr/local/opt/php@7.2/bin/pecl'</span></span><br><span class="line"><span class="built_in">alias</span> pecl73=<span class="string">'/usr/local/opt/php@7.3/bin/pecl'</span></span><br><span class="line"><span class="built_in">alias</span> pecl74=<span class="string">'/usr/local/opt/php@7.4/bin/pecl'</span></span><br><span class="line"><span class="built_in">alias</span> pecl80=<span class="string">'/usr/local/opt/php/bin/pecl'</span></span><br><span class="line"><span class="comment"># composer alias</span></span><br><span class="line"><span class="built_in">alias</span> composer53=<span class="string">'php53 /usr/local/bin/composer'</span></span><br><span class="line"><span class="built_in">alias</span> composer70=<span class="string">'php70 /usr/local/bin/composer'</span></span><br><span class="line"><span class="built_in">alias</span> composer71=<span class="string">'php71 /usr/local/bin/composer'</span></span><br><span class="line"><span class="built_in">alias</span> composer72=<span class="string">'php72 /usr/local/bin/composer'</span></span><br><span class="line"><span class="built_in">alias</span> composer73=<span class="string">'php73 /usr/local/bin/composer'</span></span><br><span class="line"><span class="built_in">alias</span> composer74=<span class="string">'php74 /usr/local/bin/composer'</span></span><br><span class="line"><span class="built_in">alias</span> composer80=<span class="string">'php80 /usr/local/bin/composer'</span></span><br><span class="line"><span class="comment"># åˆ‡æ¢ç‰ˆæœ¬</span></span><br><span class="line"><span class="built_in">alias</span> use-php53=<span class="string">'unlink-php; brew link --overwrite --force php@5.3 &amp;&amp; php -v'</span></span><br><span class="line"><span class="built_in">alias</span> use-php54=<span class="string">'unlink-php; brew link --overwrite --force php@5.4 &amp;&amp; php -v'</span></span><br><span class="line"><span class="built_in">alias</span> use-php55=<span class="string">'unlink-php; brew link --overwrite --force php@5.5 &amp;&amp; php -v'</span></span><br><span class="line"><span class="built_in">alias</span> use-php56=<span class="string">'unlink-php; brew link --overwrite --force php@5.6 &amp;&amp; php -v'</span></span><br><span class="line"><span class="built_in">alias</span> use-php70=<span class="string">'unlink-php; brew link --overwrite --force php@7.0 &amp;&amp; php -v'</span></span><br><span class="line"><span class="built_in">alias</span> use-php71=<span class="string">'unlink-php; brew link --overwrite --force php@7.1 &amp;&amp; php -v'</span></span><br><span class="line"><span class="built_in">alias</span> use-php72=<span class="string">'unlink-php; brew link --overwrite --force php@7.2 &amp;&amp; php -v'</span></span><br><span class="line"><span class="built_in">alias</span> use-php73=<span class="string">'unlink-php; brew link --overwrite --force php@7.3 &amp;&amp; php -v'</span></span><br><span class="line"><span class="built_in">alias</span> use-php74=<span class="string">'unlink-php; brew link --overwrite --force php@7.4 &amp;&amp; php -v'</span></span><br><span class="line"><span class="built_in">alias</span> use-php80=<span class="string">'unlink-php; brew link --overwrite --force php &amp;&amp; php -v'</span></span><br></pre></td></tr></table></figure><p>åé¢å¯ä»¥é€šè¿‡ <code>use-php[version]</code> éšæ„åˆ‡æ¢ç‰ˆæœ¬ï¼Œæˆ–è€…ç›´æ¥ç”¨ <code>php[version]</code> æ‰§è¡Œã€‚</p>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> macos </tag>
            
            <tag> brew </tag>
            
            <tag> php </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2019å¦‚ä½•æ›´æ–°packagist github-hook</title>
      <link href="/update-packagist-github-hook-2019/"/>
      <url>/update-packagist-github-hook-2019/</url>
      
        <content type="html"><![CDATA[<p>å»å¹´ï¼ˆ2018ï¼‰Packagist å°±æœ‰æé†’ï¼š</p><blockquote><p>This package is using the legacy GitHub service and will stop being auto-updated in early 2019. Please set up the new GitHub Hook for Packagist so that it keeps working in the future.</p></blockquote><p>å¤§æ¦‚æ„æ€æ˜¯æ—§çš„ GitHub WebHook è¢«æ”¾å¼ƒäº†ï¼Œè¯·å¤§å®¶æ›´æ–°æœ€æ–°ç‰ˆï¼Œç›®å‰ç½‘ä¸Šæ²¡æœ‰æ¯”è¾ƒè¯¦ç»†çš„è¯´æ˜ï¼Œè‡ªå·±æ‘¸ç´¢äº†ä¸€ä¸‹ï¼š</p><ol><li>æ‰“å¼€ <a href="https://packagist.org/profile/edit" target="_blank" rel="noopener">https://packagist.org/profile/edit</a> ï¼Œçœ‹æ˜¯å¦ç»‘å®šäº† GitHub Account ï¼Œå¦‚æœæ²¡æœ‰ç›´æ¥ç»‘å®šã€‚å¦‚æœç»‘å®šè¿‡ï¼Œè§£é™¤é‡æ–°ç»‘å®šï¼ˆå› ä¸ºè¦é‡æ–°æˆæƒï¼‰ã€‚</li><li>æ‰“å¼€ <a href="https://github.com/your-github-account/your-project/settings/hooks" target="_blank" rel="noopener">https://github.com/your-github-account/your-project/settings/hooks</a> ï¼Œåˆ é™¤æ—§çš„ WebHookï¼ˆDonâ€™t ask whyï¼Œjust do itï¼‰ã€‚</li><li>å›åˆ° <a href="https://packagist.org/profile/" target="_blank" rel="noopener">https://packagist.org/profile/</a> ï¼Œç‚¹å‡» <code>retry hook sync</code> é‡æ–°åŒæ­¥ WebHookã€‚</li><li>å†æ¬¡æŸ¥çœ‹ GitHub WebHook çš„æ—¶å€™å‘ç°å·²ç»è‡ªåŠ¨é…ç½®å¥½äº†ï¼Œpackagist å¯¹åº”çš„é¡¹ç›®é¡µé¢ä¹Ÿæ²¡æœ‰ <code>WebHook</code> ç›¸å…³æç¤ºäº†ã€‚</li></ol><blockquote><p>å‘å¸ƒæ–°çš„ package ä¹Ÿåªéœ€è¦ç‚¹å‡» <code>retry hook sync</code> å°±å¯ä»¥è‡ªåŠ¨ç»‘å®šäº†ï¼Œä¸éœ€è¦æ‰‹åŠ¨æ·»åŠ ã€‚</p></blockquote>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>10ä¸ªå¸¸è§çš„Redisé¢è¯•&quot;åˆéš¾&quot;é—®é¢˜</title>
      <link href="/ten-questions-of-redis/"/>
      <url>/ten-questions-of-redis/</url>
      
        <content type="html"><![CDATA[<blockquote><p>å¯¼è¯»ï¼šåœ¨ç¨‹åºå‘˜é¢è¯•è¿‡ç¨‹ä¸­Redisç›¸å…³çš„çŸ¥è¯†æ˜¯å¸¸è¢«é—®åˆ°çš„è¯é¢˜ã€‚ä½œä¸ºä¸€ååœ¨äº’è”ç½‘æŠ€æœ¯è¡Œä¸šæ‰“å‡»è¿‡æˆç™¾ä¸Šåƒåçš„èµ„æ·±æŠ€æœ¯é¢è¯•å®˜ï¼Œæœ¬æ–‡ä½œè€…æ€»ç»“äº†é¢è¯•è¿‡ç¨‹ä¸­ç»å¸¸é—®åˆ°çš„é—®é¢˜ã€‚ååˆ†å€¼å¾—ä¸€è¯»ã€‚</p></blockquote><blockquote><p>ä½œè€…ç®€ä»‹ï¼šé’±æ–‡å“ï¼ˆè€é’±ï¼‰ï¼Œäº’è”ç½‘åˆ†å¸ƒå¼é«˜å¹¶å‘æŠ€æœ¯åå¹´è€å…µï¼Œç›®å‰ä»»æŒé˜…ç§‘æŠ€èµ„æ·±åç«¯å·¥ç¨‹å¸ˆã€‚ç†Ÿç»ƒä½¿ç”¨ Javaã€Pythonã€Golang ç­‰å¤šç§è®¡ç®—æœºè¯­è¨€ï¼Œå¼€å‘è¿‡æ¸¸æˆï¼Œåˆ¶ä½œè¿‡ç½‘ç«™ï¼Œå†™è¿‡æ¶ˆæ¯æ¨é€ç³»ç»Ÿå’ŒMySQL ä¸­é—´ä»¶ï¼Œå®ç°è¿‡å¼€æºçš„ ORM æ¡†æ¶ã€Web æ¡†æ¶ã€RPC æ¡†æ¶ç­‰</p></blockquote><p><code>Redis</code>åœ¨äº’è”ç½‘æŠ€æœ¯å­˜å‚¨æ–¹é¢ä½¿ç”¨å¦‚æ­¤å¹¿æ³›ï¼Œå‡ ä¹æ‰€æœ‰çš„åç«¯æŠ€æœ¯é¢è¯•å®˜éƒ½è¦åœ¨<code>Redis</code>çš„ä½¿ç”¨å’ŒåŸç†æ–¹é¢å¯¹å°ä¼™ä¼´ä»¬è¿›è¡Œå„ç§åˆéš¾ã€‚ä½œä¸ºä¸€ååœ¨äº’è”ç½‘æŠ€æœ¯è¡Œä¸šæ‰“å‡»è¿‡æˆç™¾ä¸Šåƒåã€è¯·å…è®¸æˆ‘å¤¸å¼ ä¸€ä¸‹ã€‘çš„èµ„æ·±æŠ€æœ¯é¢è¯•å®˜ï¼Œçœ‹è¿‡äº†æ— æ•°è½å¯çš„èº«å½±å¤±æœ›çš„ç¦»å¼€ï¼Œç•¥æ„Ÿæ„§ç–šï¼Œæ•…çŒ®ä¸Šæ­¤æ–‡ï¼Œå¸Œæœ›å„ä½è¯»è€…ä»¥åé¢è¯•åŠ¿å¦‚ç ´ç«¹ï¼Œæ°¸æ— å¤±è´¥ï¼</p><a id="more"></a><h1 id="Redisæœ‰å“ªäº›æ•°æ®ç»“æ„ï¼Ÿ"><a href="#Redisæœ‰å“ªäº›æ•°æ®ç»“æ„ï¼Ÿ" class="headerlink" title="Redisæœ‰å“ªäº›æ•°æ®ç»“æ„ï¼Ÿ"></a>Redisæœ‰å“ªäº›æ•°æ®ç»“æ„ï¼Ÿ</h1><p><code>å­—ç¬¦ä¸²String</code>ã€<code>å­—å…¸Hash</code>ã€<code>åˆ—è¡¨List</code>ã€<code>é›†åˆSet</code>ã€<code>æœ‰åºé›†åˆSortedSet</code>ã€‚</p><p>å¦‚æœä½ æ˜¯Redisä¸­é«˜çº§ç”¨æˆ·ï¼Œè¿˜éœ€è¦åŠ ä¸Šä¸‹é¢å‡ ç§æ•°æ®ç»“æ„<code>HyperLogLog</code>ã€<code>Geo</code>ã€<code>Pub/Sub</code>ã€‚</p><p>å¦‚æœä½ è¯´è¿˜ç©è¿‡<code>Redis Module</code>ï¼Œåƒ<code>BloomFilter</code>ï¼Œ<code>RedisSearch</code>ï¼Œ<code>Redis-ML</code>ï¼Œé¢è¯•å®˜å¾—çœ¼ç›å°±å¼€å§‹å‘äº®äº†ã€‚</p><h1 id="ä½¿ç”¨è¿‡Redisåˆ†å¸ƒå¼é”ä¹ˆï¼Œå®ƒæ˜¯ä»€ä¹ˆå›äº‹ï¼Ÿ"><a href="#ä½¿ç”¨è¿‡Redisåˆ†å¸ƒå¼é”ä¹ˆï¼Œå®ƒæ˜¯ä»€ä¹ˆå›äº‹ï¼Ÿ" class="headerlink" title="ä½¿ç”¨è¿‡Redisåˆ†å¸ƒå¼é”ä¹ˆï¼Œå®ƒæ˜¯ä»€ä¹ˆå›äº‹ï¼Ÿ"></a>ä½¿ç”¨è¿‡Redisåˆ†å¸ƒå¼é”ä¹ˆï¼Œå®ƒæ˜¯ä»€ä¹ˆå›äº‹ï¼Ÿ</h1><p>å…ˆæ‹¿<code>setnx</code>æ¥äº‰æŠ¢é”ï¼ŒæŠ¢åˆ°ä¹‹åï¼Œå†ç”¨<code>expire</code>ç»™é”åŠ ä¸€ä¸ªè¿‡æœŸæ—¶é—´é˜²æ­¢é”å¿˜è®°äº†é‡Šæ”¾ã€‚</p><p>è¿™æ—¶å€™å¯¹æ–¹ä¼šå‘Šè¯‰ä½ è¯´ä½ å›ç­”å¾—ä¸é”™ï¼Œç„¶åæ¥ç€é—®å¦‚æœåœ¨<code>setnx</code>ä¹‹åæ‰§è¡Œ<code>expire</code>ä¹‹å‰è¿›ç¨‹æ„å¤–crashæˆ–è€…è¦é‡å¯ç»´æŠ¤äº†ï¼Œé‚£ä¼šæ€ä¹ˆæ ·ï¼Ÿ</p><p>è¿™æ—¶å€™ä½ è¦ç»™äºˆæƒŠè®¶çš„åé¦ˆï¼šå”‰ï¼Œæ˜¯å–”ï¼Œè¿™ä¸ªé”å°±æ°¸è¿œå¾—ä¸åˆ°é‡Šæ”¾äº†ã€‚ç´§æ¥ç€ä½ éœ€è¦æŠ“ä¸€æŠ“è‡ªå·±å¾—è„‘è¢‹ï¼Œæ•…ä½œæ€è€ƒç‰‡åˆ»ï¼Œå¥½åƒæ¥ä¸‹æ¥çš„ç»“æœæ˜¯ä½ ä¸»åŠ¨æ€è€ƒå‡ºæ¥çš„ï¼Œç„¶åå›ç­”ï¼šæˆ‘è®°å¾—<code>set</code>æŒ‡ä»¤æœ‰éå¸¸å¤æ‚çš„å‚æ•°ï¼Œè¿™ä¸ªåº”è¯¥æ˜¯å¯ä»¥åŒæ—¶æŠŠ<code>setnx</code>å’Œ<code>expire</code>åˆæˆä¸€æ¡æŒ‡ä»¤æ¥ç”¨çš„ï¼å¯¹æ–¹è¿™æ—¶ä¼šæ˜¾éœ²ç¬‘å®¹ï¼Œå¿ƒé‡Œå¼€å§‹é»˜å¿µï¼šæ‘ï¼Œè¿™å°å­è¿˜ä¸é”™ã€‚</p><h1 id="å‡å¦‚Redisé‡Œé¢æœ‰1äº¿ä¸ªkeyï¼Œå…¶ä¸­æœ‰10wä¸ªkeyæ˜¯ä»¥æŸä¸ªå›ºå®šçš„å·²çŸ¥çš„å‰ç¼€å¼€å¤´çš„ï¼Œå¦‚æœå°†å®ƒä»¬å…¨éƒ¨æ‰¾å‡ºæ¥ï¼Ÿ"><a href="#å‡å¦‚Redisé‡Œé¢æœ‰1äº¿ä¸ªkeyï¼Œå…¶ä¸­æœ‰10wä¸ªkeyæ˜¯ä»¥æŸä¸ªå›ºå®šçš„å·²çŸ¥çš„å‰ç¼€å¼€å¤´çš„ï¼Œå¦‚æœå°†å®ƒä»¬å…¨éƒ¨æ‰¾å‡ºæ¥ï¼Ÿ" class="headerlink" title="å‡å¦‚Redisé‡Œé¢æœ‰1äº¿ä¸ªkeyï¼Œå…¶ä¸­æœ‰10wä¸ªkeyæ˜¯ä»¥æŸä¸ªå›ºå®šçš„å·²çŸ¥çš„å‰ç¼€å¼€å¤´çš„ï¼Œå¦‚æœå°†å®ƒä»¬å…¨éƒ¨æ‰¾å‡ºæ¥ï¼Ÿ"></a>å‡å¦‚Redisé‡Œé¢æœ‰1äº¿ä¸ªkeyï¼Œå…¶ä¸­æœ‰10wä¸ªkeyæ˜¯ä»¥æŸä¸ªå›ºå®šçš„å·²çŸ¥çš„å‰ç¼€å¼€å¤´çš„ï¼Œå¦‚æœå°†å®ƒä»¬å…¨éƒ¨æ‰¾å‡ºæ¥ï¼Ÿ</h1><p>ä½¿ç”¨keysæŒ‡ä»¤å¯ä»¥æ‰«å‡ºæŒ‡å®šæ¨¡å¼çš„keyåˆ—è¡¨ã€‚</p><p>å¯¹æ–¹æ¥ç€è¿½é—®ï¼šå¦‚æœè¿™ä¸ª<code>redis</code>æ­£åœ¨ç»™çº¿ä¸Šçš„ä¸šåŠ¡æä¾›æœåŠ¡ï¼Œé‚£ä½¿ç”¨keysæŒ‡ä»¤ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ</p><p>è¿™ä¸ªæ—¶å€™ä½ è¦å›ç­”<code>redis</code>å…³é”®çš„ä¸€ä¸ªç‰¹æ€§ï¼š<code>redis</code>çš„å•çº¿ç¨‹çš„ã€‚keysæŒ‡ä»¤ä¼šå¯¼è‡´çº¿ç¨‹é˜»å¡ä¸€æ®µæ—¶é—´ï¼Œçº¿ä¸ŠæœåŠ¡ä¼šåœé¡¿ï¼Œç›´åˆ°æŒ‡ä»¤æ‰§è¡Œå®Œæ¯•ï¼ŒæœåŠ¡æ‰èƒ½æ¢å¤ã€‚è¿™ä¸ªæ—¶å€™å¯ä»¥ä½¿ç”¨<code>scan</code>æŒ‡ä»¤ï¼Œ<code>scan</code>æŒ‡ä»¤å¯ä»¥æ— é˜»å¡çš„æå–å‡ºæŒ‡å®šæ¨¡å¼çš„keyåˆ—è¡¨ï¼Œä½†æ˜¯ä¼šæœ‰ä¸€å®šçš„é‡å¤æ¦‚ç‡ï¼Œåœ¨å®¢æˆ·ç«¯åšä¸€æ¬¡å»é‡å°±å¯ä»¥äº†ï¼Œä½†æ˜¯æ•´ä½“æ‰€èŠ±è´¹çš„æ—¶é—´ä¼šæ¯”ç›´æ¥ç”¨<code>keys</code>æŒ‡ä»¤é•¿ã€‚</p><h1 id="ä½¿ç”¨è¿‡Redisåšå¼‚æ­¥é˜Ÿåˆ—ä¹ˆï¼Œä½ æ˜¯æ€ä¹ˆç”¨çš„ï¼Ÿ"><a href="#ä½¿ç”¨è¿‡Redisåšå¼‚æ­¥é˜Ÿåˆ—ä¹ˆï¼Œä½ æ˜¯æ€ä¹ˆç”¨çš„ï¼Ÿ" class="headerlink" title="ä½¿ç”¨è¿‡Redisåšå¼‚æ­¥é˜Ÿåˆ—ä¹ˆï¼Œä½ æ˜¯æ€ä¹ˆç”¨çš„ï¼Ÿ"></a>ä½¿ç”¨è¿‡Redisåšå¼‚æ­¥é˜Ÿåˆ—ä¹ˆï¼Œä½ æ˜¯æ€ä¹ˆç”¨çš„ï¼Ÿ</h1><p>ä¸€èˆ¬ä½¿ç”¨<code>list</code>ç»“æ„ä½œä¸ºé˜Ÿåˆ—ï¼Œ<code>rpush</code>ç”Ÿäº§æ¶ˆæ¯ï¼Œ<code>lpop</code>æ¶ˆè´¹æ¶ˆæ¯ã€‚å½“<code>lpop</code>æ²¡æœ‰æ¶ˆæ¯çš„æ—¶å€™ï¼Œè¦é€‚å½“<code>sleep</code>ä¸€ä¼šå†é‡è¯•ã€‚</p><p>å¦‚æœå¯¹æ–¹è¿½é—®å¯ä¸å¯ä»¥ä¸ç”¨<code>sleep</code>å‘¢ï¼Ÿ<code>list</code>è¿˜æœ‰ä¸ªæŒ‡ä»¤å«<code>blpop</code>ï¼Œåœ¨æ²¡æœ‰æ¶ˆæ¯çš„æ—¶å€™ï¼Œå®ƒä¼šé˜»å¡ä½ç›´åˆ°æ¶ˆæ¯åˆ°æ¥ã€‚</p><p>å¦‚æœå¯¹æ–¹è¿½é—®èƒ½ä¸èƒ½ç”Ÿäº§ä¸€æ¬¡æ¶ˆè´¹å¤šæ¬¡å‘¢ï¼Ÿä½¿ç”¨<code>pub</code>/<code>sub</code>ä¸»é¢˜è®¢é˜…è€…æ¨¡å¼ï¼Œå¯ä»¥å®ç°<code>1:N</code>çš„æ¶ˆæ¯é˜Ÿåˆ—ã€‚</p><p>å¦‚æœå¯¹æ–¹è¿½é—®<code>pub</code>/<code>sub</code>æœ‰ä»€ä¹ˆç¼ºç‚¹ï¼Ÿåœ¨æ¶ˆè´¹è€…ä¸‹çº¿çš„æƒ…å†µä¸‹ï¼Œç”Ÿäº§çš„æ¶ˆæ¯ä¼šä¸¢å¤±ï¼Œå¾—ä½¿ç”¨ä¸“ä¸šçš„æ¶ˆæ¯é˜Ÿåˆ—å¦‚<code>rabbitmq</code>ç­‰ã€‚</p><p>å¦‚æœå¯¹æ–¹è¿½é—®<code>redis</code>å¦‚ä½•å®ç°å»¶æ—¶é˜Ÿåˆ—ï¼Ÿæˆ‘ä¼°è®¡ç°åœ¨ä½ å¾ˆæƒ³æŠŠé¢è¯•å®˜ä¸€æ£’æ‰“æ­»å¦‚æœä½ æ‰‹ä¸Šæœ‰ä¸€æ ¹æ£’çƒæ£çš„è¯ï¼Œæ€ä¹ˆé—®çš„è¿™ä¹ˆè¯¦ç»†ã€‚ä½†æ˜¯ä½ å¾ˆå…‹åˆ¶ï¼Œç„¶åç¥æ€è‡ªè‹¥çš„å›ç­”é“ï¼šä½¿ç”¨<code>sortedset</code>ï¼Œæ‹¿æ—¶é—´æˆ³ä½œä¸º<code>score</code>ï¼Œæ¶ˆæ¯å†…å®¹ä½œä¸º<code>key</code>è°ƒç”¨<code>zadd</code>æ¥ç”Ÿäº§æ¶ˆæ¯ï¼Œæ¶ˆè´¹è€…ç”¨<code>zrangebyscore</code>æŒ‡ä»¤è·å–Nç§’ä¹‹å‰çš„æ•°æ®è½®è¯¢è¿›è¡Œå¤„ç†ã€‚</p><p>åˆ°è¿™é‡Œï¼Œé¢è¯•å®˜æš—åœ°é‡Œå·²ç»å¯¹ä½ ç«–èµ·äº†å¤§æ‹‡æŒ‡ã€‚ä½†æ˜¯ä»–ä¸çŸ¥é“çš„æ˜¯æ­¤åˆ»ä½ å´ç«–èµ·äº†ä¸­æŒ‡ï¼Œåœ¨æ¤…å­èƒŒåã€‚</p><h1 id="å¦‚æœæœ‰å¤§é‡çš„keyéœ€è¦è®¾ç½®åŒä¸€æ—¶é—´è¿‡æœŸï¼Œä¸€èˆ¬éœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ"><a href="#å¦‚æœæœ‰å¤§é‡çš„keyéœ€è¦è®¾ç½®åŒä¸€æ—¶é—´è¿‡æœŸï¼Œä¸€èˆ¬éœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ" class="headerlink" title="å¦‚æœæœ‰å¤§é‡çš„keyéœ€è¦è®¾ç½®åŒä¸€æ—¶é—´è¿‡æœŸï¼Œä¸€èˆ¬éœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ"></a>å¦‚æœæœ‰å¤§é‡çš„keyéœ€è¦è®¾ç½®åŒä¸€æ—¶é—´è¿‡æœŸï¼Œä¸€èˆ¬éœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ</h1><p>å¦‚æœå¤§é‡çš„<code>key</code>è¿‡æœŸæ—¶é—´è®¾ç½®çš„è¿‡äºé›†ä¸­ï¼Œåˆ°è¿‡æœŸçš„é‚£ä¸ªæ—¶é—´ç‚¹ï¼Œrediså¯èƒ½ä¼šå‡ºç°çŸ­æš‚çš„å¡é¡¿ç°è±¡ã€‚ä¸€èˆ¬éœ€è¦åœ¨æ—¶é—´ä¸ŠåŠ ä¸€ä¸ªéšæœºå€¼ï¼Œä½¿å¾—è¿‡æœŸæ—¶é—´åˆ†æ•£ä¸€äº›ã€‚</p><h1 id="Rediså¦‚ä½•åšæŒä¹…åŒ–çš„ï¼Ÿ"><a href="#Rediså¦‚ä½•åšæŒä¹…åŒ–çš„ï¼Ÿ" class="headerlink" title="Rediså¦‚ä½•åšæŒä¹…åŒ–çš„ï¼Ÿ"></a>Rediså¦‚ä½•åšæŒä¹…åŒ–çš„ï¼Ÿ</h1><p><code>bgsave</code>åšé•œåƒå…¨é‡æŒä¹…åŒ–ï¼Œ<code>aof</code>åšå¢é‡æŒä¹…åŒ–ã€‚å› ä¸º<code>bgsave</code>ä¼šè€—è´¹è¾ƒé•¿æ—¶é—´ï¼Œä¸å¤Ÿå®æ—¶ï¼Œåœ¨åœæœºçš„æ—¶å€™ä¼šå¯¼è‡´å¤§é‡ä¸¢å¤±æ•°æ®ï¼Œæ‰€ä»¥éœ€è¦<code>aof</code>æ¥é…åˆä½¿ç”¨ã€‚åœ¨<code>redis</code>å®ä¾‹é‡å¯æ—¶ï¼Œä¼˜å…ˆä½¿ç”¨<code>aof</code>æ¥æ¢å¤å†…å­˜çš„çŠ¶æ€ï¼Œå¦‚æœæ²¡æœ‰<code>aof</code>æ—¥å¿—ï¼Œå°±ä¼šä½¿ç”¨<code>rdb</code>æ–‡ä»¶æ¥æ¢å¤ã€‚</p><p>å¦‚æœå†é—®<code>aof</code>æ–‡ä»¶è¿‡å¤§æ¢å¤æ—¶é—´è¿‡é•¿æ€ä¹ˆåŠï¼Ÿä½ å‘Šè¯‰é¢è¯•å®˜ï¼Œ<code>Redis</code>ä¼šå®šæœŸåš<code>aof</code>é‡å†™ï¼Œå‹ç¼©<code>aof</code>æ–‡ä»¶æ—¥å¿—å¤§å°ã€‚å¦‚æœé¢è¯•å®˜ä¸å¤Ÿæ»¡æ„ï¼Œå†æ‹¿å‡ºæ€æ‰‹é”ç­”æ¡ˆï¼Œ<code>Redis4.0</code>ä¹‹åæœ‰äº†æ··åˆæŒä¹…åŒ–çš„åŠŸèƒ½ï¼Œå°†<code>bgsave</code>çš„å…¨é‡å’Œ<code>aof</code>çš„å¢é‡åšäº†èåˆå¤„ç†ï¼Œè¿™æ ·æ—¢ä¿è¯äº†æ¢å¤çš„æ•ˆç‡åˆå…¼é¡¾äº†æ•°æ®çš„å®‰å…¨æ€§ã€‚è¿™ä¸ªåŠŸèƒ½ç”šè‡³å¾ˆå¤šé¢è¯•å®˜éƒ½ä¸çŸ¥é“ï¼Œä»–ä»¬è‚¯å®šä¼šå¯¹ä½ åˆ®ç›®ç›¸çœ‹ã€‚</p><p>å¦‚æœå¯¹æ–¹è¿½é—®é‚£å¦‚æœçªç„¶æœºå™¨æ‰ç”µä¼šæ€æ ·ï¼Ÿå–å†³äº<code>aof</code>æ—¥å¿—<code>sync</code>å±æ€§çš„é…ç½®ï¼Œå¦‚æœä¸è¦æ±‚æ€§èƒ½ï¼Œåœ¨æ¯æ¡å†™æŒ‡ä»¤æ—¶éƒ½<code>sync</code>ä¸€ä¸‹ç£ç›˜ï¼Œå°±ä¸ä¼šä¸¢å¤±æ•°æ®ã€‚ä½†æ˜¯åœ¨é«˜æ€§èƒ½çš„è¦æ±‚ä¸‹æ¯æ¬¡éƒ½<code>sync</code>æ˜¯ä¸ç°å®çš„ï¼Œä¸€èˆ¬éƒ½ä½¿ç”¨å®šæ—¶<code>sync</code>ï¼Œæ¯”å¦‚<code>1s1æ¬¡</code>ï¼Œè¿™ä¸ªæ—¶å€™æœ€å¤šå°±ä¼šä¸¢å¤±1sçš„æ•°æ®ã€‚</p><h1 id="Pipelineæœ‰ä»€ä¹ˆå¥½å¤„ï¼Œä¸ºä»€ä¹ˆè¦ç”¨pipelineï¼Ÿ"><a href="#Pipelineæœ‰ä»€ä¹ˆå¥½å¤„ï¼Œä¸ºä»€ä¹ˆè¦ç”¨pipelineï¼Ÿ" class="headerlink" title="Pipelineæœ‰ä»€ä¹ˆå¥½å¤„ï¼Œä¸ºä»€ä¹ˆè¦ç”¨pipelineï¼Ÿ"></a>Pipelineæœ‰ä»€ä¹ˆå¥½å¤„ï¼Œä¸ºä»€ä¹ˆè¦ç”¨pipelineï¼Ÿ</h1><p>å¯ä»¥å°†å¤šæ¬¡IOå¾€è¿”çš„æ—¶é—´ç¼©å‡ä¸ºä¸€æ¬¡ï¼Œå‰ææ˜¯<code>pipeline</code>æ‰§è¡Œçš„æŒ‡ä»¤ä¹‹é—´æ²¡æœ‰å› æœç›¸å…³æ€§ã€‚ä½¿ç”¨<code>redis-benchmark</code>è¿›è¡Œå‹æµ‹çš„æ—¶å€™å¯ä»¥å‘ç°å½±å“<code>redis</code>çš„<code>QPS</code>å³°å€¼çš„ä¸€ä¸ªé‡è¦å› ç´ æ˜¯<code>pipeline</code>æ‰¹æ¬¡æŒ‡ä»¤çš„æ•°ç›®ã€‚</p><h1 id="Redisçš„åŒæ­¥æœºåˆ¶äº†è§£ä¹ˆï¼Ÿ"><a href="#Redisçš„åŒæ­¥æœºåˆ¶äº†è§£ä¹ˆï¼Ÿ" class="headerlink" title="Redisçš„åŒæ­¥æœºåˆ¶äº†è§£ä¹ˆï¼Ÿ"></a>Redisçš„åŒæ­¥æœºåˆ¶äº†è§£ä¹ˆï¼Ÿ</h1><p><code>Redis</code>å¯ä»¥ä½¿ç”¨ä¸»ä»åŒæ­¥ï¼Œä»ä»åŒæ­¥ã€‚ç¬¬ä¸€æ¬¡åŒæ­¥æ—¶ï¼Œä¸»èŠ‚ç‚¹åšä¸€æ¬¡<code>bgsave</code>ï¼Œå¹¶åŒæ—¶å°†åç»­ä¿®æ”¹æ“ä½œè®°å½•åˆ°å†…å­˜<code>buffer</code>ï¼Œå¾…å®Œæˆåå°†<code>rdb</code>æ–‡ä»¶å…¨é‡åŒæ­¥åˆ°å¤åˆ¶èŠ‚ç‚¹ï¼Œå¤åˆ¶èŠ‚ç‚¹æ¥å—å®Œæˆåå°†<code>rdb</code>é•œåƒåŠ è½½åˆ°å†…å­˜ã€‚åŠ è½½å®Œæˆåï¼Œå†é€šçŸ¥ä¸»èŠ‚ç‚¹å°†æœŸé—´ä¿®æ”¹çš„æ“ä½œè®°å½•åŒæ­¥åˆ°å¤åˆ¶èŠ‚ç‚¹è¿›è¡Œé‡æ”¾å°±å®Œæˆäº†åŒæ­¥è¿‡ç¨‹ã€‚</p><h1 id="æ˜¯å¦ä½¿ç”¨è¿‡Redisé›†ç¾¤ï¼Œé›†ç¾¤çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#æ˜¯å¦ä½¿ç”¨è¿‡Redisé›†ç¾¤ï¼Œé›†ç¾¤çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="æ˜¯å¦ä½¿ç”¨è¿‡Redisé›†ç¾¤ï¼Œé›†ç¾¤çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ"></a>æ˜¯å¦ä½¿ç”¨è¿‡Redisé›†ç¾¤ï¼Œé›†ç¾¤çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</h1><p><code>Redis Sentinal</code>ç€çœ¼äºé«˜å¯ç”¨ï¼Œåœ¨<code>master</code>å®•æœºæ—¶ä¼šè‡ªåŠ¨å°†<code>slave</code>æå‡ä¸º<code>master</code>ï¼Œç»§ç»­æä¾›æœåŠ¡ã€‚</p><p><code>Redis Cluster</code>ç€çœ¼äºæ‰©å±•æ€§ï¼Œåœ¨å•ä¸ª<code>redis</code>å†…å­˜ä¸è¶³æ—¶ï¼Œä½¿ç”¨<code>Cluster</code>è¿›è¡Œåˆ†ç‰‡å­˜å‚¨ã€‚</p><p>åŸæ–‡ï¼š<a href="https://mp.weixin.qq.com/s/Z4a8wbWvPDGFTkKJH0X9VQ" target="_blank" rel="noopener">10ä¸ªå¸¸è§çš„Redisé¢è¯•â€åˆéš¾â€é—®é¢˜</a></p>]]></content>
      
      
      <categories>
          
          <category> å…¶ä»– </category>
          
      </categories>
      
      
        <tags>
            
            <tag> redis </tag>
            
            <tag> é¢è¯• </tag>
            
            <tag> é—®é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Swooleå®ç°å³æ—¶èŠå¤©æœåŠ¡</title>
      <link href="/im-server-by-swoole/"/>
      <url>/im-server-by-swoole/</url>
      
        <content type="html"><![CDATA[<h2 id="éœ€æ±‚èƒŒæ™¯"><a href="#éœ€æ±‚èƒŒæ™¯" class="headerlink" title="éœ€æ±‚èƒŒæ™¯"></a>éœ€æ±‚èƒŒæ™¯</h2><p>å°±æŠ€æœ¯é¢è€Œè¨€ï¼Œå³æ—¶é€šè®¯å¯¹å¾ˆå¤šäººæˆ–å…¬å¸æ¥è¯´å·²ç»æ²¡æœ‰ä»€ä¹ˆé—¨æ§›ï¼ŒæŠ€æœ¯æ–¹æ¡ˆæœ‰å¦‚é›¨åæ˜¥ç¬‹ï¼Œä¹Ÿå„æœ‰åƒç§‹ï¼Œä¹Ÿæœ‰ä¸å°‘ä¸“ä¸šæä¾›ç¬¬ä¸‰æ–¹æœåŠ¡çš„å…¬å¸ï¼Œå¦‚<code>äº‘ä¿¡</code>ã€<code>èäº‘</code>ç­‰ç­‰ï¼Œå‡ ä¸ªå¤§å‚ï¼ˆ<code>é˜¿é‡Œäº‘</code>ã€<code>è…¾è®¯äº‘</code>ï¼‰ä¹Ÿæœ‰æä¾›äº‘æœåŠ¡ã€‚</p><a id="more"></a><p>è¿™é‡Œè¦è®²ä¸€ä¸‹çš„æ˜¯ç¬¬ä¸‰æ–¹åŠŸèƒ½éå¸¸å¼ºå¤§ï¼Œä¹Ÿå…¼å®¹å„ä¸ªå¹³å°ï¼Œä½†æ˜¯çµæ´»æ€§ä¸å¤Ÿä¸ªæ€§éœ€æ±‚æ— æ³•å®šåˆ¶ã€‚</p><p>åˆšæåˆ°æŠ€æœ¯ä¸Šå·²ç»æ²¡æœ‰é—¨æ§›ï¼Œå¼€æºçš„é¡¹ç›®ä¹Ÿæœ‰ä¸å°‘ï¼ŒåŸºæœ¬éƒ½æ˜¯åŸºäº<code>é•¿è¿æ¥+è½®è¯¢</code>æˆ–<code>websocket</code>ï¼Œé•¿è¿æ¥çš„ä»£è¡¨æœ‰<code>iComet</code>ï¼Œè€Œ<code>websocket</code>çš„ä»£è¡¨æœ‰<code>Swoole</code>ã€‚</p><p>èŠ±äº†åŠå¤©å†™äº†ä¸ªdemoï¼Œå…ˆçœ‹çœ‹éœ€æ±‚ï¼š</p><blockquote><ul><li>æ”¯æŒç‚¹å¯¹ç‚¹èŠå¤©</li><li>åŒä¸€è´¦å·æ”¯æŒå¤šç«¯ï¼Œèƒ½åŒæ—¶å—åˆ°ä¿¡æ¯</li></ul></blockquote><p>TODO</p><blockquote><ul><li>æ”¯æŒæ¶ˆæ¯å¹¿æ’­</li><li>æ”¯æŒç¦»çº¿æ¶ˆæ¯</li></ul></blockquote><h2 id="æœåŠ¡ç«¯"><a href="#æœåŠ¡ç«¯" class="headerlink" title="æœåŠ¡ç«¯"></a>æœåŠ¡ç«¯</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FdMapping</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $redis;</span><br><span class="line">    <span class="keyword">const</span> MAP_UID_FD_PREFIX = <span class="string">'chat_map_uid_fd:'</span>;</span><br><span class="line">    <span class="keyword">const</span> MAP_FD_UID_PREFIX = <span class="string">'chat_map_fd_uid:'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($redis_host = <span class="string">'127.0.0.1'</span>, $redis_port = <span class="number">6379</span>)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;redis = <span class="keyword">new</span> Redis();</span><br><span class="line">        <span class="keyword">$this</span>-&gt;redis-&gt;connect($redis_host, $redis_port);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// uidä¸fdå¯¹åº”ï¼Œæ”¯æŒå¤šç«¯/å¤šé¡µé¢</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">uidBindFd</span><span class="params">($uid, $fd)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;redis-&gt;sadd(</span><br><span class="line">            <span class="keyword">self</span>::MAP_UID_FD_PREFIX . $uid,</span><br><span class="line">            $fd</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// fdä¸uidå¯¹åº”</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">fdBindUid</span><span class="params">($fd, $uid)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;redis-&gt;setex(</span><br><span class="line">            <span class="keyword">self</span>::MAP_FD_UID_PREFIX . $fd,</span><br><span class="line">            <span class="number">24</span> * <span class="number">3600</span>,</span><br><span class="line">            $uid</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–fdå¯¹åº”çš„uid</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getUidByFd</span><span class="params">($fd)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;redis-&gt;get(<span class="keyword">self</span>::MAP_FD_UID_PREFIX . $fd);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–uidå…¨éƒ¨fdï¼Œç¡®ä¿å¤šç«¯éƒ½èƒ½æ”¶åˆ°ä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getFdsByUid</span><span class="params">($uid)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;redis-&gt;sMembers(<span class="keyword">self</span>::MAP_UID_FD_PREFIX . $uid);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ é™¤uidçš„æŸä¸ªfd</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">delFd</span><span class="params">($fd, $uid = null)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (is_null($uid)) &#123;</span><br><span class="line">            $uid = <span class="keyword">$this</span>-&gt;getUidByFd($fd);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!$uid) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;redis-&gt;srem(<span class="keyword">self</span>::MAP_UID_FD_PREFIX . $uid, $fd);</span><br><span class="line">        <span class="keyword">$this</span>-&gt;redis-&gt;del(<span class="keyword">self</span>::MAP_FD_UID_PREFIX . $fd);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$FdMapping = <span class="keyword">new</span> FdMapping(<span class="string">'127.0.0.1'</span>);</span><br><span class="line">$server    = <span class="keyword">new</span> swoole_websocket_server(<span class="string">"127.0.0.1"</span>, <span class="number">9502</span>);</span><br><span class="line"></span><br><span class="line">$server-&gt;on(<span class="string">'open'</span>, <span class="function"><span class="keyword">function</span><span class="params">($server, $req)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"æ–°è¿æ¥: #&#123;$req-&gt;fd&#125;\n"</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">$server-&gt;on(<span class="string">'message'</span>, <span class="function"><span class="keyword">function</span><span class="params">($server, $frame)</span> <span class="title">use</span> <span class="params">($FdMapping)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"æ¥æ”¶åˆ°: "</span> . json_encode($frame-&gt;data) . <span class="string">"\n"</span>;</span><br><span class="line">    <span class="comment">// è§£æjsonä¸ºarray</span></span><br><span class="line">    $data = json_decode($frame-&gt;data, <span class="keyword">true</span>);</span><br><span class="line">    <span class="comment">// å¤„ç†ä¸åŒçš„æ¶ˆæ¯ç±»å‹</span></span><br><span class="line">    <span class="keyword">switch</span> ($data[<span class="string">'type'</span>]) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'sign'</span>:</span><br><span class="line">            <span class="comment">// è®¾ç½®uidä¸fdå¯¹åº”å…³ç³»</span></span><br><span class="line">            $FdMapping-&gt;uidBindFd($data[<span class="string">'uid'</span>], $frame-&gt;fd);</span><br><span class="line">            $FdMapping-&gt;fdBindUid($frame-&gt;fd, $data[<span class="string">'uid'</span>]);</span><br><span class="line">            <span class="comment">// æ¸…ç†è¿‡æœŸ/å·²æ–­å¼€çš„è¿æ¥</span></span><br><span class="line">            $fds = $FdMapping-&gt;getFdsByUid($data[<span class="string">'uid'</span>]);</span><br><span class="line">            <span class="keyword">foreach</span> ((<span class="keyword">array</span>)$fds <span class="keyword">as</span> $fd) &#123;</span><br><span class="line">                !$server-&gt;exist($fd) &amp;&amp; $FdMapping-&gt;delFd($fd, $data[<span class="string">'uid'</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// è¿”å›æ³¨å†ŒæˆåŠŸä¿¡æ¯ï¼ŒtokenæœªéªŒè¯</span></span><br><span class="line">            $server-&gt;push(</span><br><span class="line">                $frame-&gt;fd,</span><br><span class="line">                json_encode([</span><br><span class="line">                    <span class="string">'status'</span> =&gt; <span class="number">1</span>,</span><br><span class="line">                    <span class="string">'msg'</span>    =&gt; <span class="string">'æ³¨å†ŒæˆåŠŸ'</span>,</span><br><span class="line">                    <span class="string">'token'</span>  =&gt; md5(time()), <span class="comment">// å¯ç”¨äºè¿æ¥åˆæ³•æ€§éªŒè¯</span></span><br><span class="line">                ])</span><br><span class="line">            );</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">'msg'</span>:</span><br><span class="line">            $data[<span class="string">'from'</span>] = $FdMapping-&gt;getUidByFd($frame-&gt;fd);</span><br><span class="line">            <span class="comment">// éªŒè¯æ˜¯å¦å·²ç»æ³¨å†Œ</span></span><br><span class="line">            <span class="keyword">if</span> (!$data[<span class="string">'from'</span>]) &#123;</span><br><span class="line">                $server-&gt;push(</span><br><span class="line">                    $frame-&gt;fd,</span><br><span class="line">                    json_encode([</span><br><span class="line">                        <span class="string">'status'</span> =&gt; <span class="number">0</span>,</span><br><span class="line">                        <span class="string">'msg'</span>    =&gt; <span class="string">'å‘é€å¤±è´¥ï¼Œæœªç™»å…¥'</span>,</span><br><span class="line">                    ])</span><br><span class="line">                );</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// å°†æ¶ˆæ¯æ¨é€åˆ°uidå„ç«¯</span></span><br><span class="line">            $fds = $FdMapping-&gt;getFdsByUid($data[<span class="string">'to'</span>]);</span><br><span class="line">            <span class="keyword">foreach</span> ((<span class="keyword">array</span>) $fds <span class="keyword">as</span> $fd) &#123;</span><br><span class="line">                $server-&gt;exist($fd) &amp;&amp; $server-&gt;push(</span><br><span class="line">                    $fd,</span><br><span class="line">                    json_encode([</span><br><span class="line">                        <span class="string">'body'</span> =&gt; $data[<span class="string">'body'</span>],</span><br><span class="line">                        <span class="string">'from'</span> =&gt; $data[<span class="string">'from'</span>],</span><br><span class="line">                    ])</span><br><span class="line">                );</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">"#&#123;$fd&#125; æ¨é€æˆåŠŸ\n"</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// å‘ŠçŸ¥æ¨é€æˆåŠŸ</span></span><br><span class="line">            $server-&gt;push($frame-&gt;fd, json_encode([<span class="string">'status'</span> =&gt; <span class="number">1</span>, <span class="string">'msg'</span> =&gt; <span class="string">'sended'</span>]));</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="comment">// éæ³•è¯·æ±‚</span></span><br><span class="line">            $server-&gt;push(</span><br><span class="line">                $frame-&gt;fd,</span><br><span class="line">                json_encode([</span><br><span class="line">                    <span class="string">'status'</span>     =&gt; <span class="number">0</span>,</span><br><span class="line">                    <span class="string">'msg'</span>        =&gt; <span class="string">'éæ³•è¯·æ±‚'</span>,</span><br><span class="line">                    <span class="string">'disconnect'</span> =&gt; <span class="number">1</span>, <span class="comment">// å‘ŠçŸ¥ç»ˆç«¯è¯·æ–­å¼€</span></span><br><span class="line">                ])</span><br><span class="line">            );</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">$server-&gt;on(<span class="string">'close'</span>, <span class="function"><span class="keyword">function</span><span class="params">($server, $fd)</span> <span class="title">use</span> <span class="params">($FdMapping)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"è¿æ¥æ–­å¼€: #&#123;$fd&#125;\n"</span>;</span><br><span class="line">    $FdMapping-&gt;delFd($fd);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">$server-&gt;start();</span><br></pre></td></tr></table></figure><h2 id="å®¢æˆ·ç«¯"><a href="#å®¢æˆ·ç«¯" class="headerlink" title="å®¢æˆ·ç«¯"></a>å®¢æˆ·ç«¯</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ws = <span class="keyword">new</span> WebSocket(<span class="string">"ws://127.0.0.1:9502"</span>);</span><br><span class="line"></span><br><span class="line">ws.onopen = <span class="function"><span class="keyword">function</span> (<span class="params">evt</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"Connection open ..."</span>);</span><br><span class="line">    ws.send(<span class="string">'&#123;"type":"sign", "uid":"1001"&#125;'</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">ws.onmessage = <span class="function"><span class="keyword">function</span> (<span class="params">evt</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"Received Message: "</span> + evt.data);</span><br><span class="line">    <span class="comment">// ws.close();</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">ws.onclose = <span class="function"><span class="keyword">function</span> (<span class="params">evt</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"Connection closed."</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> swoole </tag>
            
            <tag> chat </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¬¬ä¸‰æ–¹åº”ç”¨å…±äº«Laravelé¡¹ç›®Session</title>
      <link href="/share-laravel-session-on-third-party-application/"/>
      <url>/share-laravel-session-on-third-party-application/</url>
      
        <content type="html"><![CDATA[<p>Laravel æ¡†æ¶è¶Šæ¥è¶Šè¢«PHPå¼€å‘è€…é’çï¼Œè¢«åº”ç”¨å¾—è¶Šæ¥è¶Šå¹¿æ³›ï¼Œå¤§å®¶éƒ½æ¨ä¸å¾—å…¨éƒ¨ç”¨å®ƒæ¥é‡æ„é¡¹ç›®ï¼Œbossä»¬å½“ç„¶ä¸ä¼šåŒæ„ï¼Œä½†æ˜¯æˆ‘ä»¬ä½œä¸ºå·¥ç¨‹å¸ˆä¹Ÿæ˜¯ä¸ä¼šæ”¾å¼ƒçš„ï¼Œé‚£è¦æ€ä¹ˆåŠå‘¢ï¼Ÿ</p><p>æ²¡é”™ï¼ŒæŒ‰æ¨¡å—æ‹†åˆ†é‡æ„ï¼Œæ¯”å¦‚<code>æ³¨å†Œ</code>ã€<code>ç™»å…¥</code>ç­‰å°æ¨¡å—å…ˆé‡æ„ã€‚</p><a id="more"></a><p><img src="http://www.315che.net/uploads/allimg/170329/225TQ495-0.jpg" alt="æ’¸èµ·è¢–å­åŠ æ²¹å¹²"></p><p>ä¸€é¼“ä½œæ°”ï¼Œå†™å®Œäº†å‘ç°<code>Session</code>ä¸å…¼å®¹ï¼Œå»Googleç™¾åº¦äº†ä¸€ä¸‹ï¼Œä¹Ÿæ²¡æ‰¾åˆ°ä»€ä¹ˆå¥½æ–¹æ¡ˆï¼Œæ²¡åŠæ³•è‡ªå·±åˆ†æä¸€ä¸‹ã€‚</p><h2 id="å…ˆçœ‹ä¸€ä¸‹Laravelå†™çš„Sessionæ˜¯ä»€ä¹ˆ"><a href="#å…ˆçœ‹ä¸€ä¸‹Laravelå†™çš„Sessionæ˜¯ä»€ä¹ˆ" class="headerlink" title="å…ˆçœ‹ä¸€ä¸‹Laravelå†™çš„Sessionæ˜¯ä»€ä¹ˆ"></a>å…ˆçœ‹ä¸€ä¸‹Laravelå†™çš„Sessionæ˜¯ä»€ä¹ˆ</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s:<span class="number">207</span>:<span class="string">"a:4:&#123;s:3:"</span>abc<span class="string">";i:1531800464;s:6:"</span>_token<span class="string">";s:40:"</span>SPhvkWipry9tCxLrU431ueWE8iHBaMkOMU0acQV6<span class="string">";s:9:"</span>_previous<span class="string">";a:1:&#123;s:3:"</span>url<span class="string">";s:26:"</span>http:<span class="comment">//yourdomain.com/";&#125;s:6:"_flash";a:2:&#123;s:3:"old";a:0:&#123;&#125;s:3:"new";a:0:&#123;&#125;&#125;&#125;";</span></span><br></pre></td></tr></table></figure><p>æ˜¯ä¸æ˜¯å¾ˆçœ¼ç†Ÿï¼Ÿæ²¡é”™ï¼Œæ˜¯PHPçš„åºåˆ—åŒ–ï¼Œè¦æ³¨æ„çš„æ˜¯2æ¬¡åºåˆ—åŒ–ã€‚æˆ‘ä»¬æ¥éªŒè¯ä¸€ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">$sessData = <span class="string">&lt;&lt;&lt;DATA</span></span><br><span class="line"><span class="string">s:207:"a:4:&#123;s:3:"abc";i:1531800464;s:6:"_token";s:40:"SPhvkWipry9tCxLrU431ueWE8iHBaMkOMU0acQV6";s:9:"_previous";a:1:&#123;s:3:"url";s:26:"http://yourdomain.com/";&#125;s:6:"_flash";a:2:&#123;s:3:"old";a:0:&#123;&#125;s:3:"new";a:0:&#123;&#125;&#125;&#125;";</span></span><br><span class="line"><span class="string">DATA;</span></span><br><span class="line"></span><br><span class="line">$sessData = unserialize(unserialize($sessData));</span><br><span class="line">var_dump($sessData);</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">array (</span></span><br><span class="line"><span class="comment">  'abc' =&gt; 1531800527,</span></span><br><span class="line"><span class="comment">  '_token' =&gt; 'SPhvkWipry9tCxLrU431ueWE8iHBaMkOMU0acQV6',</span></span><br><span class="line"><span class="comment">  '_previous' =&gt;</span></span><br><span class="line"><span class="comment">  array (</span></span><br><span class="line"><span class="comment">    'url' =&gt; 'http://yourdomain.com/',</span></span><br><span class="line"><span class="comment">  ),</span></span><br><span class="line"><span class="comment">  '_flash' =&gt;</span></span><br><span class="line"><span class="comment">  array (</span></span><br><span class="line"><span class="comment">    'old' =&gt;</span></span><br><span class="line"><span class="comment">    array (</span></span><br><span class="line"><span class="comment">    ),</span></span><br><span class="line"><span class="comment">    'new' =&gt;</span></span><br><span class="line"><span class="comment">    array (</span></span><br><span class="line"><span class="comment">    ),</span></span><br><span class="line"><span class="comment">  ),</span></span><br><span class="line"><span class="comment">)</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure><h2 id="è®¾ç½®Laravel-Sessioné…ç½®ï¼Œä¸ºå…±äº«å‡†å¤‡"><a href="#è®¾ç½®Laravel-Sessioné…ç½®ï¼Œä¸ºå…±äº«å‡†å¤‡" class="headerlink" title="è®¾ç½®Laravel Sessioné…ç½®ï¼Œä¸ºå…±äº«å‡†å¤‡"></a>è®¾ç½®Laravel Sessioné…ç½®ï¼Œä¸ºå…±äº«å‡†å¤‡</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// config/session.php</span></span><br><span class="line"><span class="string">'encrypt'</span> =&gt; <span class="keyword">false</span>,</span><br><span class="line"><span class="string">'cookie'</span>  =&gt; <span class="string">'PHPSESSID'</span>,</span><br><span class="line"><span class="string">'domain'</span>  =&gt; <span class="string">'yourdomain.com'</span>,</span><br></pre></td></tr></table></figure><h2 id="æ˜æ–‡-Cookie"><a href="#æ˜æ–‡-Cookie" class="headerlink" title="æ˜æ–‡ Cookie"></a>æ˜æ–‡ Cookie</h2><p>å¾ˆå¤šæ—¶å€™ <code>Cookie</code> æ˜¯éœ€è¦è¢«å‰ç«¯ç«¥é‹ä½¿ç”¨çš„ï¼Œä½†æ˜¯é»˜è®¤æƒ…å†µä¸‹ <code>Laravel</code> åœ¨å“åº”å¤´ä¸­æ·»åŠ çš„ <code>Cookie</code> ä¿¡æ¯æ˜¯åŠ å¯†è¿‡çš„ï¼Œç±»ä¼¼ <code>eyJpdiI6IjRwOFMyTkl2aGs2TGt4OUcxYXRNXC9BPT0iLCJ2YWx1ZSI6IkpHN0Fqb0ZSaDFxVHE0OHdFRXdXMHc9PSIsIm1hYyI6Ijc2MTljZDVmZDI1Mjg5MTk3NTBlZGM0MzUxMjUyZjQ5MzcxOGE1MWU4Y2ViZTBlYTY5YWRjZjNkZjUwNzNkMDEifQ%3D%3D</code>ï¼Œè¿™ç§æ—¶å€™å°±å¾—å°†é‚£äº›éœ€è¦ æ˜æ–‡ ä¼ è¾“çš„ <code>Cookie</code> åŠ å…¥åˆ° ç™½åå• ä¸­å»ï¼š</p><p>åœ¨ <code>/app/Http/Middleware/EncryptCookies.php</code> ä¸­çš„ <code>$except</code> æ•°ç»„ä¸­å°†å…¶åŠ å…¥</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> $except = [</span><br><span class="line">    <span class="string">'PHPSESSID'</span>,</span><br><span class="line">];</span><br></pre></td></tr></table></figure><h2 id="ç¬¬ä¸‰æ–¹åº”ç”¨å…¼å®¹-Laravel"><a href="#ç¬¬ä¸‰æ–¹åº”ç”¨å…¼å®¹-Laravel" class="headerlink" title="ç¬¬ä¸‰æ–¹åº”ç”¨å…¼å®¹ Laravel"></a>ç¬¬ä¸‰æ–¹åº”ç”¨å…¼å®¹ Laravel</h2><p>æ€è·¯å¦‚ä¸‹ï¼š</p><p>è¯»å–</p><blockquote><p>Rediså–å‡ºï¼ˆLaravelåºåˆ—åŒ–æ•°æ®ï¼Œå­—ç¬¦ä¸²ï¼‰-&gt;<code>unserialize</code> * 2ï¼ˆå¾—åˆ°æ•°ç»„ï¼‰-&gt;<code>SessionSerializer::encode()</code>ï¼ˆå¾—åˆ°åºåˆ—åŒ–æ•°æ®ï¼Œå­—ç¬¦ä¸²ï¼‰-&gt;äº¤ç»™PHPå†…æ ¸å¤„ç†</p></blockquote><p>å†™å…¥</p><blockquote><p>PHPç³»åˆ—åŒ–æ•°æ®-&gt;<code>SessionSerializer::decode()</code>ï¼ˆå¾—åˆ°æ•°ç»„ï¼‰-&gt;<code>serialize()</code> * 2-&gt;å†™å…¥Redis</p></blockquote><p><img src="https://i.imgflip.com/1issnv.jpg" alt="å›¾ç‰‡"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// PHP SESSION åºåˆ—åŒ–å™¨</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SessionSerializer</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">encode</span><span class="params">($array, $safe = true, $method = <span class="string">''</span>)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $method = <span class="keyword">empty</span>($method) ? ini_get(<span class="string">"session.serialize_handler"</span>) : $method;</span><br><span class="line">        <span class="keyword">switch</span> ($method) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"php"</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">self</span>::serializePhp($array, $safe);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"php_binary"</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">self</span>::serializePhpbinary($array, $safe);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="keyword">Exception</span>(<span class="string">"Unsupported session.serialize_handler: "</span> . $method . <span class="string">". Supported: php, php_binary"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">serializePhp</span><span class="params">($array, $safe = true)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> ($safe) &#123;</span><br><span class="line">            $array = unserialize(serialize($array));</span><br><span class="line">        &#125;</span><br><span class="line">        $raw  = <span class="string">''</span>;</span><br><span class="line">        $line = <span class="number">0</span>;</span><br><span class="line">        $keys = array_keys($array);</span><br><span class="line">        <span class="keyword">foreach</span> ($keys <span class="keyword">as</span> $key) &#123;</span><br><span class="line">            $value = $array[$key];</span><br><span class="line">            $line++;</span><br><span class="line">            $raw .= $key . <span class="string">'|'</span>;</span><br><span class="line">            <span class="keyword">if</span> (is_array($value) &amp;&amp; <span class="keyword">isset</span>($value[<span class="string">'huge_recursion_blocker_we_hope'</span>])) &#123;</span><br><span class="line">                $raw .= <span class="string">'R:'</span> . $value[<span class="string">'huge_recursion_blocker_we_hope'</span>] . <span class="string">';'</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                $raw .= serialize($value);</span><br><span class="line">            &#125;</span><br><span class="line">            $array[$key] = [<span class="string">'huge_recursion_blocker_we_hope'</span> =&gt; $line];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> $raw;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">serializePhpbinary</span><span class="params">($array, $safe = true)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">''</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">decode</span><span class="params">($session_data, $method = <span class="string">''</span>)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $method = <span class="keyword">empty</span>($method) ? ini_get(<span class="string">"session.serialize_handler"</span>) : $method;</span><br><span class="line">        <span class="keyword">switch</span> ($method) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"php"</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">self</span>::unserializePhp($session_data);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"php_binary"</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">self</span>::unserializePhpbinary($session_data);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="keyword">Exception</span>(<span class="string">"Unsupported session.serialize_handler: "</span> . $method . <span class="string">". Supported: php, php_binary"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">unserializePhp</span><span class="params">($session_data)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $return_data = [];</span><br><span class="line">        $offset      = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> ($offset &lt; strlen($session_data)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!strstr(substr($session_data, $offset), <span class="string">"|"</span>)) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="keyword">Exception</span>(<span class="string">"Invalid data, remaining: "</span> . substr($session_data, $offset));</span><br><span class="line">            &#125;</span><br><span class="line">            $pos     = strpos($session_data, <span class="string">"|"</span>, $offset);</span><br><span class="line">            $num     = $pos - $offset;</span><br><span class="line">            $varname = substr($session_data, $offset, $num);</span><br><span class="line">            $offset += $num + <span class="number">1</span>;</span><br><span class="line">            $data                  = unserialize(substr($session_data, $offset));</span><br><span class="line">            $return_data[$varname] = $data;</span><br><span class="line">            $offset += strlen(serialize($data));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> $return_data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">unserializePhpbinary</span><span class="params">($session_data)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $return_data = [];</span><br><span class="line">        $offset      = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> ($offset &lt; strlen($session_data)) &#123;</span><br><span class="line">            $num = ord($session_data[$offset]);</span><br><span class="line">            $offset += <span class="number">1</span>;</span><br><span class="line">            $varname = substr($session_data, $offset, $num);</span><br><span class="line">            $offset += $num;</span><br><span class="line">            $data   = unserialize(substr($session_data, $offset));</span><br><span class="line">            $return_data[$varname] = $data;</span><br><span class="line">            $offset += strlen(serialize($data));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> $return_data;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Redis Session é©±åŠ¨</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SessionRedis</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $lifeTime     = <span class="number">900</span>;</span><br><span class="line">    <span class="comment">// Laravelé¡¹ç›®ä¸­Sessionå­˜å‚¨è¦æ±‚</span></span><br><span class="line">    <span class="keyword">protected</span> $sessionName  = <span class="string">'your_laravel_app_name:'</span>;</span><br><span class="line">    <span class="comment">// å…±äº«cookieéœ€è¦</span></span><br><span class="line">    <span class="keyword">protected</span> $cookieDomain = <span class="string">'yourdomain.com'</span>;</span><br><span class="line">    <span class="keyword">protected</span> $handle       = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">open</span><span class="params">($savePath, $sessName)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;handle = <span class="keyword">new</span> Redis;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;handle-&gt;connect(<span class="string">'127.0.0.1'</span>, <span class="number">6379</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">close</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;gc(ini_get(<span class="string">'session.gc_maxlifetime'</span>));</span><br><span class="line">        <span class="keyword">$this</span>-&gt;handle-&gt;close();</span><br><span class="line">        <span class="keyword">$this</span>-&gt;handle = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">read</span><span class="params">($sessID)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">empty</span>($sessID)) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ä»Redisè¯»å–</span></span><br><span class="line">        $sessData = <span class="keyword">$this</span>-&gt;handle-&gt;get(<span class="keyword">$this</span>-&gt;sessionName . $sessID);</span><br><span class="line">        <span class="comment">// æŒ‰Laravelæ ¼å¼ååºåˆ—åŒ–</span></span><br><span class="line">        $sessData = unserialize(unserialize($sessData));</span><br><span class="line">        <span class="comment">// å¤„ç†éæ³•æ ¼å¼</span></span><br><span class="line">        $sessData = is_array($sessData) ? $sessData : [];</span><br><span class="line">        <span class="comment">// æŒ‰PHPå†…æ ¸éœ€è¦æ ¼å¼åºåˆ—åŒ–</span></span><br><span class="line">        $sessData = SessionSerializer::encode($sessData);</span><br><span class="line">        <span class="comment">// æ³¨æ„è¿™é‡Œéœ€è¦è¿”å›çš„æ˜¯åºåˆ—åŒ–åçš„å­—ç¬¦ä¸²</span></span><br><span class="line">        <span class="keyword">return</span> $sessData;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">write</span><span class="params">($sessID, $sessData)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">empty</span>($sessID)) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ååºåˆ—åŒ–ä¸ºæ•°ç»„</span></span><br><span class="line">        $sessData = SessionSerializer::decode($sessData);</span><br><span class="line">        <span class="comment">// æŒ‰Laraveléœ€è¦çš„æ ¼å¼åºåˆ—åŒ–</span></span><br><span class="line">        $sessData = serialize(serialize($sessData));</span><br><span class="line">        <span class="comment">// å­˜å…¥Redis</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;handle-&gt;setex(<span class="keyword">$this</span>-&gt;sessionName . $sessID, <span class="keyword">$this</span>-&gt;lifeTime, $sessData);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">destroy</span><span class="params">($sessID)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">empty</span>($sessID)) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;handle-&gt;delete(<span class="keyword">$this</span>-&gt;sessionName . $sessID);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">gc</span><span class="params">($sessMaxLifeTime)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">start</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        ini_set(<span class="string">'session.cookie_domain'</span>, <span class="keyword">isset</span>($m[<span class="number">0</span>]) ? $m[<span class="number">0</span>] : <span class="keyword">$this</span>-&gt;cookieDomain);</span><br><span class="line">        ini_set(<span class="string">'session.auto_start'</span>, <span class="number">0</span>);</span><br><span class="line">        ini_set(<span class="string">'session.use_trans_sid'</span>, <span class="number">0</span>);</span><br><span class="line">        ini_set(<span class="string">'session.gc_probability'</span>, <span class="number">1</span>);</span><br><span class="line">        ini_set(<span class="string">'session.gc_divisor'</span>, <span class="number">1000</span>);</span><br><span class="line">        ini_set(<span class="string">'session.gc_maxlifetime'</span>, <span class="keyword">$this</span>-&gt;lifeTime);</span><br><span class="line">        ini_set(<span class="string">'session.use_cookies'</span>, <span class="number">1</span>);</span><br><span class="line">        ini_set(<span class="string">'session.cookie_path'</span>, <span class="string">'/'</span>);</span><br><span class="line">        session_module_name(<span class="string">'user'</span>);</span><br><span class="line">        session_set_save_handler(</span><br><span class="line">            <span class="keyword">array</span>(&amp;<span class="keyword">$this</span>, <span class="string">'open'</span>),</span><br><span class="line">            <span class="keyword">array</span>(&amp;<span class="keyword">$this</span>, <span class="string">'close'</span>),</span><br><span class="line">            <span class="keyword">array</span>(&amp;<span class="keyword">$this</span>, <span class="string">'read'</span>),</span><br><span class="line">            <span class="keyword">array</span>(&amp;<span class="keyword">$this</span>, <span class="string">'write'</span>),</span><br><span class="line">            <span class="keyword">array</span>(&amp;<span class="keyword">$this</span>, <span class="string">'destroy'</span>),</span><br><span class="line">            <span class="keyword">array</span>(&amp;<span class="keyword">$this</span>, <span class="string">'gc'</span>)</span><br><span class="line">        );</span><br><span class="line">        session_start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">(<span class="keyword">new</span> SessionRedis())-&gt;start();</span><br></pre></td></tr></table></figure><h2 id="Laravel-å…¼å®¹ç¬¬ä¸‰æ–¹åº”ç”¨"><a href="#Laravel-å…¼å®¹ç¬¬ä¸‰æ–¹åº”ç”¨" class="headerlink" title="Laravel å…¼å®¹ç¬¬ä¸‰æ–¹åº”ç”¨"></a>Laravel å…¼å®¹ç¬¬ä¸‰æ–¹åº”ç”¨</h2><p>ä»¥ <code>Memcache</code> ä¸ºä¾‹</p><blockquote><p>æœåŠ¡å™¨è®°å¾—ç¼–è¯‘ <code>memcache</code> æ‰©å±•</p></blockquote><h3 id="å¢åŠ -session-é©±åŠ¨"><a href="#å¢åŠ -session-é©±åŠ¨" class="headerlink" title="å¢åŠ  session é©±åŠ¨"></a>å¢åŠ  session é©±åŠ¨</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Extensions</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Exception</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Memcache</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MemcacheSessionHandler</span> <span class="keyword">implements</span> \<span class="title">SessionHandlerInterface</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $handle      = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">protected</span> $sessionName = <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">protected</span> $lifeTime;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;sessionName = <span class="string">''</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;lifeTime    = config(<span class="string">'session.lifetime'</span>);</span><br><span class="line">        <span class="keyword">$this</span>-&gt;handle      = <span class="keyword">new</span> Memcache;</span><br><span class="line"></span><br><span class="line">        collect(config(<span class="string">'cache.stores.memcached.servers'</span>))-&gt;each(<span class="function"><span class="keyword">function</span> <span class="params">($server)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;handle-&gt;addServer($server[<span class="string">'host'</span>], $server[<span class="string">'port'</span>], <span class="keyword">true</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">open</span><span class="params">($savePath, $sessionName)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">close</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;handle-&gt;close();</span><br><span class="line">        <span class="keyword">$this</span>-&gt;handle = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">read</span><span class="params">($sessionId)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">empty</span>($sessionId)) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $data = <span class="keyword">$this</span>-&gt;handle-&gt;get(<span class="keyword">$this</span>-&gt;sessionName . $sessionId);</span><br><span class="line">        <span class="comment">// info($data, ['format' =&gt; 'php']);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// php -&gt; laravel</span></span><br><span class="line">        $data = <span class="keyword">self</span>::decode($data);</span><br><span class="line">        $data = serialize($data);</span><br><span class="line">        <span class="comment">// info($data, ['format' =&gt; 'laravel']);</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> $data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">write</span><span class="params">($sessionId, $data)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">empty</span>($sessionId)) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// info($data, ['format' =&gt; 'laravel']);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// laravel-&gt;php</span></span><br><span class="line">        $data = unserialize($data);</span><br><span class="line">        $data = <span class="keyword">self</span>::encode($data);</span><br><span class="line">        <span class="comment">// info($data, ['format' =&gt; 'php']);</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;handle-&gt;set(<span class="keyword">$this</span>-&gt;sessionName . $sessionId, $data, <span class="number">0</span>, <span class="keyword">$this</span>-&gt;lifeTime);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">destroy</span><span class="params">($sessionId)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">empty</span>($sessionId)) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;handle-&gt;delete(<span class="keyword">$this</span>-&gt;sessionName . $sessionId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">gc</span><span class="params">($lifetime)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">encode</span><span class="params">($array, $safe = true, $method = <span class="string">''</span>)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $method = <span class="keyword">empty</span>($method) ? ini_get(<span class="string">"session.serialize_handler"</span>) : $method;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">switch</span> ($method) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"php"</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">self</span>::serializePhp($array, $safe);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"php_binary"</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">self</span>::serializePhpbinary($array, $safe);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="keyword">Exception</span>(<span class="string">"Unsupported session.serialize_handler: "</span> . $method . <span class="string">". Supported: php, php_binary"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">serializePhp</span><span class="params">($array, $safe = true)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> ($safe) &#123;</span><br><span class="line">            $array = unserialize(serialize($array));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $raw  = <span class="string">''</span>;</span><br><span class="line">        $line = <span class="number">0</span>;</span><br><span class="line">        $keys = array_keys($array);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">foreach</span> ($keys <span class="keyword">as</span> $key) &#123;</span><br><span class="line">            $value = $array[$key];</span><br><span class="line">            $line++;</span><br><span class="line">            $raw .= $key . <span class="string">'|'</span>;</span><br><span class="line">            <span class="keyword">if</span> (is_array($value) &amp;&amp; <span class="keyword">isset</span>($value[<span class="string">'huge_recursion_blocker_we_hope'</span>])) &#123;</span><br><span class="line">                $raw .= <span class="string">'R:'</span> . $value[<span class="string">'huge_recursion_blocker_we_hope'</span>] . <span class="string">';'</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                $raw .= serialize($value);</span><br><span class="line">            &#125;</span><br><span class="line">            $array[$key] = [<span class="string">'huge_recursion_blocker_we_hope'</span> =&gt; $line];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> $raw;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">serializePhpbinary</span><span class="params">($array, $safe = true)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">''</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">decode</span><span class="params">($session_data, $method = <span class="string">''</span>)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $method = <span class="keyword">empty</span>($method) ? ini_get(<span class="string">"session.serialize_handler"</span>) : $method;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">switch</span> ($method) &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"php"</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">self</span>::unserializePhp($session_data);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">"php_binary"</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">self</span>::unserializePhpbinary($session_data);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="keyword">Exception</span>(<span class="string">"Unsupported session.serialize_handler: "</span> . $method . <span class="string">". Supported: php, php_binary"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">unserializePhp</span><span class="params">($session_data)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $return_data = [];</span><br><span class="line">        $offset      = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> ($offset &lt; strlen($session_data)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!strstr(substr($session_data, $offset), <span class="string">"|"</span>)) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="keyword">Exception</span>(<span class="string">"Invalid data, remaining: "</span> . substr($session_data, $offset));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            $pos     = strpos($session_data, <span class="string">"|"</span>, $offset);</span><br><span class="line">            $num     = $pos - $offset;</span><br><span class="line">            $varname = substr($session_data, $offset, $num);</span><br><span class="line">            $offset += $num + <span class="number">1</span>;</span><br><span class="line">            $data                  = unserialize(substr($session_data, $offset));</span><br><span class="line">            $return_data[$varname] = $data;</span><br><span class="line">            $offset += strlen(serialize($data));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> $return_data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">unserializePhpbinary</span><span class="params">($session_data)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $return_data = [];</span><br><span class="line">        $offset      = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> ($offset &lt; strlen($session_data)) &#123;</span><br><span class="line">            $num = ord($session_data[$offset]);</span><br><span class="line">            $offset += <span class="number">1</span>;</span><br><span class="line">            $varname = substr($session_data, $offset, $num);</span><br><span class="line">            $offset += $num;</span><br><span class="line">            $data                  = unserialize(substr($session_data, $offset));</span><br><span class="line">            $return_data[$varname] = $data;</span><br><span class="line">            $offset += strlen(serialize($data));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> $return_data;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ‰©å±•é©±åŠ¨"><a href="#æ‰©å±•é©±åŠ¨" class="headerlink" title="æ‰©å±•é©±åŠ¨"></a>æ‰©å±•é©±åŠ¨</h3><p>ç¼–è¾‘ app\AppServiceProvider.phpï¼Œåœ¨ <code>boot()</code> æ–¹æ³•å¢åŠ ä»¥ä¸‹ä»£ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">boot</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Session::extend(<span class="string">'memcache'</span>, <span class="function"><span class="keyword">function</span> <span class="params">($app)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> \App\Extensions\MemcacheSessionHandler;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹é©±åŠ¨"><a href="#ä¿®æ”¹é©±åŠ¨" class="headerlink" title="ä¿®æ”¹é©±åŠ¨"></a>ä¿®æ”¹é©±åŠ¨</h3><p>ç¼–è¾‘æˆ–å¢åŠ  <code>.env</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SESSION_DRIVER=memcache</span><br><span class="line">SESSION_LIFETIME=120</span><br><span class="line">SESSION_DOMAIN=.a.com</span><br></pre></td></tr></table></figure><h2 id="ç‰¹åˆ«æ³¨æ„"><a href="#ç‰¹åˆ«æ³¨æ„" class="headerlink" title="ç‰¹åˆ«æ³¨æ„ !!!!"></a>ç‰¹åˆ«æ³¨æ„ <code>!!!!</code></h2><p>å¦‚æœç¬¬ä¸‰æ–¹åº”ç”¨ PHP ç‰ˆæœ¬ä½äº <code>7.0</code>ï¼Œéœ€è¦è®¾ç½® session_id é•¿åº¦ä¸ Laravel é¡¹ç›®ï¼ˆsession_id é•¿åº¦ä¸º 40ï¼‰çš„ä¸€è‡´</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// PHP_VERSION &lt; 7.0</span></span><br><span class="line">ini_set(<span class="string">'session.hash_function'</span>, <span class="number">1</span>);</span><br><span class="line">ini_set(<span class="string">'session.hash_bits_per_character'</span>, <span class="number">4</span>);</span><br></pre></td></tr></table></figure><p>Laravel è®¾ç½®è®¤è¯ä¿¡æ¯ä¹Ÿéœ€æ³¨æ„ï¼Œ<code>auth()-&gt;login($user)</code> ä¼šæ›´æ–° session_idï¼Œå¯ä»¥æ”¹ç”¨ <code>auth()-&gt;setUser($user)</code></p><p>æœ€åï¼Œå¦‚æœä½ æœ‰æ›´å¥½çš„æ–¹æ¡ˆï¼Œè¯·ç•™è¨€ç»™æˆ‘ï¼Œä¸€èµ·äº¤æµå…±åŒè¿›æ­¥ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> laravel </tag>
            
            <tag> session </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¿®å¤MacOS Mojave dev beta1æ— æ³•æ­£å¸¸æ˜¾ç¤ºcheckboxé—®é¢˜</title>
      <link href="/mojave-checkbox-fix/"/>
      <url>/mojave-checkbox-fix/</url>
      
        <content type="html"><![CDATA[<p><a href="https://chrome.google.com/webstore/detail/mojave-checkbox-fix/ihlgehdlkphgngjfagonbeoepadbdaae/reviews" target="_blank" rel="noopener">mojave-checkbox-fix</a></p><blockquote><p>just installed this, easy fix. Just need to remember to uninstall it once itâ€™s working correctly.</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> å…¶ä»– </category>
          
      </categories>
      
      
        <tags>
            
            <tag> chrome </tag>
            
            <tag> mojave </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ESæŠ¥é”™Result window is too largeé—®é¢˜å¤„ç†</title>
      <link href="/elasticsearch-result-window-is-too-large/"/>
      <url>/elasticsearch-result-window-is-too-large/</url>
      
        <content type="html"><![CDATA[<p>æˆ‘åœ¨ä½¿ç”¨Elasticsearchè¿›è¡ŒsearchæŸ¥è¯¢çš„è¿‡ç¨‹ä¸­ï¼Œå‡ºç°äº†Result window is too largeé—®é¢˜ã€‚</p><blockquote><p>Result window is too large, from + size must be less than or equal to: [10000] but was [43155]. See the scroll api for a more efficient way to request large data sets. This limit can be set by changing the [index.max_result_window] index level setting.</p></blockquote><a id="more"></a><p>ä»ä¸Šé¢çš„æŠ¥é”™ä¿¡æ¯ï¼Œå¯ä»¥çœ‹åˆ°ESæç¤ºæˆ‘ç»“æœçª—å£å¤ªå¤§äº†ï¼Œç›®å‰æœ€å¤§å€¼ä¸º<code>10000</code>ï¼Œè€Œæˆ‘å´è¦æ±‚ç»™æˆ‘<code>43155</code>ã€‚å¹¶ä¸”åœ¨åé¢ä¹Ÿæåˆ°äº†è¦æ±‚æˆ‘ä¿®æ”¹<code>index.max_result_window</code>å‚æ•°æ¥å¢å¤§ç»“æœçª—å£å¤§å°ã€‚</p><p>ä¿®æ”¹æ–¹æ³•ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -XPUT -H <span class="string">"Content-Type: application/json"</span> http://192.168.8.82:9200/indexName/_settings -d <span class="string">'&#123;"index" : &#123;"max_result_window" : 100000000&#125;&#125;'</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> es </tag>
            
            <tag> elasticsearch </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®©Lumenæ”¯æŒè¯·æ±‚æ§åˆ¶</title>
      <link href="/lumen-support-throttle-requests/"/>
      <url>/lumen-support-throttle-requests/</url>
      
        <content type="html"><![CDATA[<blockquote><p>Lumen æ˜¯ä½ æ„å»ºå¾®æœåŠ¡æ¶æ„å’Œ <code>API</code> åº”ç”¨çš„å®Œç¾è§£å†³æ–¹æ¡ˆï¼Œäº‹å®ä¸Šï¼Œå¥¹æ˜¯å…¨å®‡å®™æœ€å¿«çš„æ¡†æ¶ä¹‹ä¸€ï¼Œç”šè‡³è¦å¿«è¿‡ä»¥é€Ÿåº¦è‘—ç§°çš„ <code>Silex</code> å’Œ <code>Slim</code>ï¼Œç°åœ¨ï¼Œä¸ºä½ çš„ <code>Laravel</code> åº”ç”¨ç¨‹åºç¼–å†™å¾®æœåŠ¡æ¶æ„å˜å¾—å†ç®€å•ä¸è¿‡äº†ã€‚</p></blockquote><p>ä½†æ˜¯ä½ åœ¨ä½¿ç”¨çš„è¿‡ç¨‹ä¸­ï¼Œä½ ä¼šå‘ç°å¾ˆå¤š <code>Laravel</code> ä¸­å¥½ç”¨çš„åŠŸèƒ½éƒ½è¢«ç²¾ç®€äº†ï¼Œæ¯”å¦‚è¯´è¯·æ±‚æ§åˆ¶ä¸­é—´ä»¶ <code>Throttle</code>ã€‚è¿™ä¸ªä¸­é—´ä»¶èƒ½ç®€å•çš„å®ç°è¯·æ±‚æ§åˆ¶ã€‚é‚£ä¹ˆæ¥ä¸‹æ¥è·Ÿæˆ‘ä¸€èµ·ä¸º <code>Lumen</code> é‡æ–°æ·»åŠ è¿™ä¹ˆå¥½ç”¨çš„åŠŸèƒ½å§ã€‚</p><a id="more"></a><h2 id="ä»-Laravel-ç§»æ¤"><a href="#ä»-Laravel-ç§»æ¤" class="headerlink" title="ä» Laravel ç§»æ¤"></a>ä» Laravel ç§»æ¤</h2><p><a href="https://github.com/laravel/framework/blob/5.2/src/Illuminate/Routing/Middleware/ThrottleRequests.php" target="_blank" rel="noopener">GitHubåœ°å€</a></p><p>ä¿å­˜ä¸º <code>app/Http/Middleware/ThrottleRequests.php</code>ï¼Œåˆ«å¿˜äº†ä¿®æ”¹ <code>namespace</code> ä¸º <code>App\Http\Middleware</code>ï¼Œå®Œæ•´ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Middleware</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">Closure</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Cache</span>\<span class="title">RateLimiter</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">HttpFoundation</span>\<span class="title">Response</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ThrottleRequests</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * The rate limiter instance.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> \Illuminate\Cache\RateLimiter</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> $limiter;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Create a new request throttler.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  \Illuminate\Cache\RateLimiter  $limiter</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> void</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(RateLimiter $limiter)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;limiter = $limiter;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Handle an incoming request.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  \Illuminate\Http\Request  $request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  \Closure  $next</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  int  $maxAttempts</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  int  $decayMinutes</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> mixed</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">handle</span><span class="params">($request, Closure $next, $maxAttempts = <span class="number">60</span>, $decayMinutes = <span class="number">1</span>)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $key = <span class="keyword">$this</span>-&gt;resolveRequestSignature($request);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;limiter-&gt;tooManyAttempts($key, $maxAttempts, $decayMinutes)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;buildResponse($key, $maxAttempts);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">$this</span>-&gt;limiter-&gt;hit($key, $decayMinutes);</span><br><span class="line"></span><br><span class="line">        $response = $next($request);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;addHeaders(</span><br><span class="line">            $response, $maxAttempts,</span><br><span class="line">            <span class="keyword">$this</span>-&gt;calculateRemainingAttempts($key, $maxAttempts)</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Resolve request signature.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  \Illuminate\Http\Request  $request</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> string</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">resolveRequestSignature</span><span class="params">($request)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// return $request-&gt;fingerprint();</span></span><br><span class="line">        <span class="comment">// Lumen ç‰ˆæœ¬ç¼ºå°‘ Request::fingerprint æ–¹æ³•</span></span><br><span class="line">        <span class="keyword">return</span> sha1(</span><br><span class="line">            $request-&gt;method() .</span><br><span class="line">            <span class="string">'|'</span> . $request-&gt;server(<span class="string">'SERVER_NAME'</span>) .</span><br><span class="line">            <span class="string">'|'</span> . $request-&gt;path() .</span><br><span class="line">            <span class="string">'|'</span> . $request-&gt;ip()</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Create a 'too many attempts' response.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  string  $key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  int  $maxAttempts</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> \Illuminate\Http\Response</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">buildResponse</span><span class="params">($key, $maxAttempts)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $response = <span class="keyword">new</span> Response(<span class="string">'Too Many Attempts.'</span>, <span class="number">429</span>);</span><br><span class="line"></span><br><span class="line">        $retryAfter = <span class="keyword">$this</span>-&gt;limiter-&gt;availableIn($key);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;addHeaders(</span><br><span class="line">            $response, $maxAttempts,</span><br><span class="line">            <span class="keyword">$this</span>-&gt;calculateRemainingAttempts($key, $maxAttempts, $retryAfter),</span><br><span class="line">            $retryAfter</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Add the limit header information to the given response.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  \Symfony\Component\HttpFoundation\Response  $response</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  int  $maxAttempts</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  int  $remainingAttempts</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  int|null  $retryAfter</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> \Illuminate\Http\Response</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">addHeaders</span><span class="params">(Response $response, $maxAttempts, $remainingAttempts, $retryAfter = null)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $headers = [</span><br><span class="line">            <span class="string">'X-RateLimit-Limit'</span>     =&gt; $maxAttempts,</span><br><span class="line">            <span class="string">'X-RateLimit-Remaining'</span> =&gt; $remainingAttempts,</span><br><span class="line">        ];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!is_null($retryAfter)) &#123;</span><br><span class="line">            $headers[<span class="string">'Retry-After'</span>] = $retryAfter;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        $response-&gt;headers-&gt;add($headers);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> $response;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Calculate the number of remaining attempts.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  string  $key</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  int  $maxAttempts</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span>  int|null  $retryAfter</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> int</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">calculateRemainingAttempts</span><span class="params">($key, $maxAttempts, $retryAfter = null)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!is_null($retryAfter)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;limiter-&gt;retriesLeft($key, $maxAttempts);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ³¨å†Œä¸­é—´ä»¶"><a href="#æ³¨å†Œä¸­é—´ä»¶" class="headerlink" title="æ³¨å†Œä¸­é—´ä»¶"></a>æ³¨å†Œä¸­é—´ä»¶</h2><p>æ‰¾åˆ° <code>bootstrap/app.php</code> æ–‡ä»¶ï¼Œæ·»åŠ ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$app-&gt;routeMiddleware([</span><br><span class="line">    <span class="string">'throttle'</span> =&gt; App\Http\Middleware\ThrottleRequests::class,</span><br><span class="line">]);</span><br></pre></td></tr></table></figure><h2 id="æ›´æ–°-composer"><a href="#æ›´æ–°-composer" class="headerlink" title="æ›´æ–° composer"></a>æ›´æ–° composer</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer dump-autoload</span><br></pre></td></tr></table></figure><h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><p>æ‰¾åˆ° <code>routes/web.php</code>ï¼Œä¿®æ”¹ or æ·»åŠ </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é»˜è®¤é€Ÿç‡æ˜¯60è¯·æ±‚/åˆ†é’Ÿ</span></span><br><span class="line">$router-&gt;group([<span class="string">'prefix'</span> =&gt; <span class="string">'api'</span>, <span class="string">'middleware'</span>=&gt;<span class="string">'throttle'</span>], <span class="function"><span class="keyword">function</span> <span class="params">()</span> <span class="title">use</span> <span class="params">($router)</span> </span>&#123;</span><br><span class="line">    $router-&gt;get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> $router-&gt;app-&gt;version();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// è‡ªå®šä¹‰é€Ÿç‡æ˜¯2è¯·æ±‚/åˆ†é’Ÿ</span></span><br><span class="line">$router-&gt;group([<span class="string">'prefix'</span> =&gt; <span class="string">'home'</span>, <span class="string">'middleware'</span>=&gt;<span class="string">'throttle:2,1'</span>], <span class="function"><span class="keyword">function</span> <span class="params">()</span> <span class="title">use</span> <span class="params">($router)</span> </span>&#123;</span><br><span class="line">    $router-&gt;get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> $router-&gt;app-&gt;version();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> php </tag>
            
            <tag> lumen </tag>
            
            <tag> throttle </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®©Lumenæ”¯æŒSession</title>
      <link href="/lumen-support-session/"/>
      <url>/lumen-support-session/</url>
      
        <content type="html"><![CDATA[<p><a href="https://lumen.laravel-china.org/docs/5.3/authentication" target="_blank" rel="noopener">å®˜æ–¹ä»‹ç»</a></p><blockquote><p>Lumen è™½ç„¶ä¸ Laravel ä½¿ç”¨äº†ç›¸åŒçš„åº•å±‚ç±»åº“å®ç°ï¼Œä½†æ˜¯å›  Lumen é¢å‘çš„æ˜¯æ— çŠ¶æ€ API çš„å¼€å‘ï¼Œä¸æ”¯æŒ sessionï¼Œæ‰€ä»¥é»˜è®¤çš„é…ç½®ä¸åŒã€‚Lumen å¿…é¡»ä½¿ç”¨æ— çŠ¶æ€çš„æœºåˆ¶æ¥å®ç°ï¼Œå¦‚ API ä»¤ç‰Œï¼ˆTokenï¼‰ã€‚</p></blockquote><p>ä¹Ÿå°±æ˜¯è¯´Lumenå†…æ ¸å·²ç»å‰¥ç¦»äº†Cookieã€Sessionï¼Œå¦‚æœéœ€è¦ä½¿ç”¨åˆ°ï¼Œéœ€è¦å¢åŠ å®‰è£…ï¼Œç»è¿‡ä¸€é˜µæŠ˜è…¾ï¼Œç»ˆäºæ•´å¥½äº†ï¼Œé¡ºä¾¿è®°å½•ä¸‹æ¥ã€‚</p><a id="more"></a><h2 id="å¢åŠ sessioné…ç½®"><a href="#å¢åŠ sessioné…ç½®" class="headerlink" title="å¢åŠ sessioné…ç½®"></a>å¢åŠ sessioné…ç½®</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> [</span><br><span class="line">    <span class="string">'driver'</span>          =&gt; <span class="string">'file'</span>,</span><br><span class="line">    <span class="string">'lifetime'</span>        =&gt; <span class="number">120</span>,</span><br><span class="line">    <span class="string">'expire_on_close'</span> =&gt; <span class="keyword">false</span>,</span><br><span class="line">    <span class="string">'encrypt'</span>         =&gt; <span class="keyword">false</span>,</span><br><span class="line">    <span class="string">'files'</span>           =&gt; storage_path(<span class="string">'framework/sessions'</span>),</span><br><span class="line">    <span class="string">'connection'</span>      =&gt; <span class="string">'session'</span>,</span><br><span class="line">    <span class="string">'table'</span>           =&gt; <span class="string">'sessions_laravel'</span>,</span><br><span class="line">    <span class="string">'store'</span>           =&gt; <span class="keyword">null</span>,</span><br><span class="line">    <span class="string">'lottery'</span>         =&gt; [<span class="number">2</span>, <span class="number">100</span>],</span><br><span class="line">    <span class="string">'cookie'</span>          =&gt; <span class="string">'PHPSESSID'</span>,</span><br><span class="line">    <span class="string">'path'</span>            =&gt; <span class="string">'/'</span>,</span><br><span class="line">    <span class="string">'domain'</span>          =&gt; env(<span class="string">'SESSION_DOMAIN'</span>, <span class="keyword">null</span>),</span><br><span class="line">    <span class="string">'secure'</span>          =&gt; <span class="keyword">false</span>,</span><br><span class="line">    <span class="string">'http_only'</span>       =&gt; <span class="keyword">true</span>,</span><br><span class="line">];</span><br></pre></td></tr></table></figure><h2 id="æ³¨å†ŒSessionä¸­é—´ä»¶åŠæœåŠ¡æä¾›è€…"><a href="#æ³¨å†ŒSessionä¸­é—´ä»¶åŠæœåŠ¡æä¾›è€…" class="headerlink" title="æ³¨å†ŒSessionä¸­é—´ä»¶åŠæœåŠ¡æä¾›è€…"></a>æ³¨å†ŒSessionä¸­é—´ä»¶åŠæœåŠ¡æä¾›è€…</h2><blockquote><p>ä¿®æ”¹bootstrap/app.phpï¼Œå¢åŠ ä»¥ä¸‹å†…å®¹</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ³¨å†ŒSessionä¸­é—´ä»¶</span></span><br><span class="line">$app-&gt;middleware([</span><br><span class="line">    \Illuminate\Session\Middleware\StartSession::class,</span><br><span class="line">]);</span><br><span class="line"><span class="comment">// æ³¨å†ŒSessionæœåŠ¡æä¾›è€…</span></span><br><span class="line">$app-&gt;register(Illuminate\Session\SessionServiceProvider::class);</span><br><span class="line"><span class="comment">// åŠ è½½Sessioné…ç½®</span></span><br><span class="line">$app-&gt;configure(<span class="string">'session'</span>);</span><br><span class="line"><span class="comment">// æ³¨å†Œå®¹å™¨ï¼ˆLumenå–æ¶ˆé»˜è®¤æ”¯æŒï¼‰</span></span><br><span class="line">$app-&gt;bind(<span class="string">'Illuminate\Session\SessionManager'</span>, <span class="string">'session'</span>);</span><br></pre></td></tr></table></figure><h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><p>ç¼–è¾‘routes/web.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$router-&gt;get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    $key = <span class="string">'key'</span>;</span><br><span class="line">    <span class="keyword">if</span> (app(<span class="string">'session'</span>)-&gt;has($key)) &#123;</span><br><span class="line">        <span class="keyword">return</span> app(<span class="string">'session'</span>)-&gt;get($key);</span><br><span class="line">    &#125;</span><br><span class="line">    app(<span class="string">'session'</span>)-&gt;put($key, <span class="string">'value'</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'set session success'</span>;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><blockquote><p>ç”Ÿå‘½çš„æ„ä¹‰åœ¨äºæŠ˜è…¾ï¼</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> php </tag>
            
            <tag> lumen </tag>
            
            <tag> session </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®©Lumenæ”¯æŒCookie</title>
      <link href="/lumen-support-cookie/"/>
      <url>/lumen-support-cookie/</url>
      
        <content type="html"><![CDATA[<p><a href="https://lumen.laravel-china.org/docs/5.3/authentication" target="_blank" rel="noopener">å®˜æ–¹ä»‹ç»</a></p><blockquote><p>Lumen è™½ç„¶ä¸ Laravel ä½¿ç”¨äº†ç›¸åŒçš„åº•å±‚ç±»åº“å®ç°ï¼Œä½†æ˜¯å›  Lumen é¢å‘çš„æ˜¯æ— çŠ¶æ€ API çš„å¼€å‘ï¼Œä¸æ”¯æŒ sessionï¼Œæ‰€ä»¥é»˜è®¤çš„é…ç½®ä¸åŒã€‚Lumen å¿…é¡»ä½¿ç”¨æ— çŠ¶æ€çš„æœºåˆ¶æ¥å®ç°ï¼Œå¦‚ API ä»¤ç‰Œï¼ˆTokenï¼‰ã€‚</p></blockquote><p>ä¹Ÿå°±æ˜¯è¯´Lumenå†…æ ¸å·²ç»å‰¥ç¦»äº†Cookieã€Sessionï¼Œå¦‚æœéœ€è¦ä½¿ç”¨åˆ°ï¼Œéœ€è¦å¢åŠ å®‰è£…ï¼Œç»è¿‡ä¸€é˜µæŠ˜è…¾ï¼Œç»ˆäºæ•´å¥½äº†ï¼Œé¡ºä¾¿è®°å½•ä¸‹æ¥ã€‚</p><a id="more"></a><h2 id="å®‰è£…CookieæœåŠ¡æä¾›è€…"><a href="#å®‰è£…CookieæœåŠ¡æä¾›è€…" class="headerlink" title="å®‰è£…CookieæœåŠ¡æä¾›è€…"></a>å®‰è£…CookieæœåŠ¡æä¾›è€…</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer require illuminate/cookie</span><br></pre></td></tr></table></figure><h2 id="å¢åŠ sessioné…ç½®"><a href="#å¢åŠ sessioné…ç½®" class="headerlink" title="å¢åŠ sessioné…ç½®"></a>å¢åŠ sessioné…ç½®</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> [</span><br><span class="line">    <span class="string">'driver'</span>          =&gt; <span class="string">'file'</span>,</span><br><span class="line">    <span class="string">'lifetime'</span>        =&gt; <span class="number">120</span>,</span><br><span class="line">    <span class="string">'expire_on_close'</span> =&gt; <span class="keyword">false</span>,</span><br><span class="line">    <span class="string">'encrypt'</span>         =&gt; <span class="keyword">false</span>,</span><br><span class="line">    <span class="string">'files'</span>           =&gt; storage_path(<span class="string">'framework/sessions'</span>),</span><br><span class="line">    <span class="string">'connection'</span>      =&gt; <span class="string">'session'</span>,</span><br><span class="line">    <span class="string">'table'</span>           =&gt; <span class="string">'sessions_laravel'</span>,</span><br><span class="line">    <span class="string">'store'</span>           =&gt; <span class="keyword">null</span>,</span><br><span class="line">    <span class="string">'lottery'</span>         =&gt; [<span class="number">2</span>, <span class="number">100</span>],</span><br><span class="line">    <span class="string">'cookie'</span>          =&gt; <span class="string">'PHPSESSID'</span>,</span><br><span class="line">    <span class="string">'path'</span>            =&gt; <span class="string">'/'</span>,</span><br><span class="line">    <span class="string">'domain'</span>          =&gt; env(<span class="string">'SESSION_DOMAIN'</span>, <span class="keyword">null</span>),</span><br><span class="line">    <span class="string">'secure'</span>          =&gt; <span class="keyword">false</span>,</span><br><span class="line">    <span class="string">'http_only'</span>       =&gt; <span class="keyword">true</span>,</span><br><span class="line">];</span><br></pre></td></tr></table></figure><h2 id="æ³¨å†ŒCookieæœåŠ¡æä¾›è€…"><a href="#æ³¨å†ŒCookieæœåŠ¡æä¾›è€…" class="headerlink" title="æ³¨å†ŒCookieæœåŠ¡æä¾›è€…"></a>æ³¨å†ŒCookieæœåŠ¡æä¾›è€…</h2><blockquote><p>ä¿®æ”¹bootstrap/app.phpï¼Œå¢åŠ ä»¥ä¸‹å†…å®¹</p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ³¨å†ŒCookieæœåŠ¡æä¾›è€…</span></span><br><span class="line">$app-&gt;register(Illuminate\Cookie\CookieServiceProvider::class);</span><br><span class="line"><span class="comment">// åŠ è½½sessioné…ç½®</span></span><br><span class="line">$app-&gt;configure(<span class="string">'session'</span>);</span><br></pre></td></tr></table></figure><h2 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h2><p>ç¼–è¾‘routes/web.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> <span class="title">Illuminate</span>\<span class="title">Support</span>\<span class="title">Facades</span>\<span class="title">Cookie</span>;</span><br><span class="line"></span><br><span class="line">$router-&gt;get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> <span class="title">use</span> <span class="params">($router)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> response($router-&gt;app-&gt;version())</span><br><span class="line">        -&gt;withCookie(Cookie::make(<span class="string">'cookie_key'</span>, <span class="string">'cookie_value'</span>));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><blockquote><p>ç”Ÿå‘½çš„æ„ä¹‰åœ¨äºæŠ˜è…¾ï¼</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> php </tag>
            
            <tag> lumen </tag>
            
            <tag> cookie </tag>
            
            <tag> composer </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Sphinx Ranking Mode(æ’åºæ¨¡å¼)</title>
      <link href="/sphinx-ranking-mode/"/>
      <url>/sphinx-ranking-mode/</url>
      
        <content type="html"><![CDATA[<h1 id="Ranking-overview-æ¦‚è§ˆ"><a href="#Ranking-overview-æ¦‚è§ˆ" class="headerlink" title="Ranking overview(æ¦‚è§ˆ)"></a>Ranking overview(æ¦‚è§ˆ)</h1><blockquote><p>Ranking (aka weighting) of the search results can be defined as a process of computing a so-called relevance (aka weight) for every given matched document with regards to a given query that matched it. So relevance is in the end just a number attached to every document that estimates how relevant the document is to the query. Search results can then be sorted based on this number and/or some additional parameters, so that the most sought after results would come up higher on the results page.</p></blockquote><p>æ’åº(åˆååŠ æƒ)ï¼Œæ˜¯åŸºäºè¯·æ±‚åŒ¹é…åˆ°çš„ç»“æœï¼Œè®¡ç®—æ‰€è°“çš„ç›¸å…³æ€§(åˆåæƒé‡)çš„ä¸€ä¸ªç¨‹åºã€‚ ç›¸å…³æ€§æ˜¯è¯·æ±‚ç»“æŸåè¢«é™„åŠ åœ¨æ–‡æ¡£ç»“æœä¸­çš„ä¸€ä¸ªä¼°ç®—å‡ºæ¥çš„æ•°å€¼,è¡¨ç¤ºåŒ¹é…çš„æ–‡æ¡£äºè¯·æ±‚çš„å…³é”®è¯ç›¸å…³çš„ç¨‹åº¦ï¼Œç„¶åæœç´¢çš„ç»“æœå°±èƒ½åŸºäºè¿™ä¸ªæ•°å€¼å’Œå…¶ä»–çš„ä¸€äº›é™„åŠ çš„å‚æ•°è¿›è¡Œæ’åºï¼Œè¿™æ ·å¤§å¤šæ•°ç›¸å…³çš„ç»“æœå°±èƒ½æ’åœ¨å‰é¢ã€‚</p><a id="more"></a><blockquote><p>There is no single standard one-size-fits-all way to rank any document in any scenario. Moreover, there can not ever be such a way, because relevance is subjective. As in, what seems relevant to you might not seem relevant to me. Hence, in general case itâ€™s not just hard to compute, itâ€™s theoretically impossible.</p></blockquote><p>å¯¹æ’åºæ¥è¯´ï¼Œåœ¨ä»»ä½•åœºæ™¯ä¸­éƒ½æ²¡æœ‰é€‚åº”æ‰€æœ‰çš„æƒ…å†µçš„æ ‡å‡†ï¼Œç”šè‡³å¯ä»¥è¯´ä¸å¯èƒ½æœ‰è¿™ç§æ ‡å‡†ï¼Œå› ä¸ºç›¸å…³æ€§æ˜¯ä¸€ç§å¾ˆä¸»è§‚çš„ä¸œè¥¿ï¼Œæ¯”å¦‚ï¼Œå¯¹ä½ æ¥è¯´ç›¸å…³æ€§å¾ˆå¼ºï¼Œå¯¹æˆ‘æ¥è¯´å´æ²¡æœ‰ã€‚å› è€Œä¸€èˆ¬å¾ˆéš¾å»è®¡ç®—ï¼Œç†è®ºä¸Šæ˜¯ä¸å¯èƒ½çš„ã€‚</p><blockquote><p>So ranking in Sphinx is configurable. It has a of a so-called . A ranker can formally be defined as a function that takes document and query as its input and produces a relevance value as output. In laymanâ€™s terms, a ranker controls exactly how (using which specific algorithm) will Sphinx assign weights to the document.</p></blockquote><p>åœ¨sphinxä¸­ï¼Œ æ’åºå…¶å®æ˜¯å¯é…ç½®çš„ï¼Œ ä»–æœ‰ä¸€ä¸ªå«ranker(è¿™é‡Œæˆ‘ç¿»è¯‘æˆæ’åºå™¨)çš„æ¦‚å¿µï¼Œ æ ¹æ®å®šä¹‰çš„æ–¹æ³•ï¼Œ æŠŠåŒ¹é…çš„æ–‡æ¡£å’Œè¯·æ±‚ä½œä¸ºè¾“å…¥ï¼Œè¾“å‡ºæ¥ä¸€ä¸ªç›¸å…³æ€§çš„å€¼ã€‚ ç®€è€Œè¨€ä¹‹ï¼Œ ä¸€ä¸ªrankerå¯ä»¥ç²¾ç¡®çš„ç»™æ¯ä¸ªæ–‡æ¡£è®¡ç®—å‡ºç›¸å…³æ€§çš„å€¼ã€‚</p><blockquote><p>Previously, this ranking function was rigidly bound to the matching</p><ol><li>So in the legacy matching modes (that is, SPH_MATCH_ALL, SPH_MATCH_ANY, SPH_MATCH_PHRASE, and SPH_MATCH_BOOLEAN) you can not</li></ol><p>choose the ranker. You can only do that in the SPH_MATCH_EXTENDED</p><ol><li>(Which is the only mode in SphinxQL and the suggested mode in SphinxAPI anyway.) To choose a non-default ranker you can either use</li></ol><p>SetRankingMode() with SphinxAPI, or OPTION ranker clause in SELECT<br>statement when using SphinxQL.</p></blockquote><p>ä»¥å‰ï¼Œç›¸æ’åºæ–¹æ³•è¢«ç¡¬æ€§çš„äºåŒ¹é…æ¨¡å¼ç»‘å®šåœ¨ä¸€èµ·ï¼Œ æ‰€ä»¥åœ¨ä¸€äº›è€çš„åŒ¹é…æ¨¡å¼ä¸­(æ¯”å¦‚ SPH_MATCH_ALL, SPH_MATCH_ANY, SPH_MATCH_PHRASE, and SPH_MATCH_BOOLEAN)ï¼Œ ä½ ä¸èƒ½é€‰æ‹©ranker(æ’åºå™¨)ã€‚ä½ åªèƒ½åœ¨SPH_MATCH_EXTENDED(è¿™ä¹Ÿæ˜¯åœ¨sphinxsqlå’ŒsphinxApiä¸­è¢«å»ºè®®ä½¿ç”¨çš„å”¯ä¸€çš„ä¸€ç§æ¨¡å¼)æ¨¡å¼ä¸‹é€‰æ‹©ã€‚ å¦‚ä½•é€‰æ‹©ä¸€ä¸ªéé»˜è®¤çš„ranker(æ’åºå™¨)ï¼Œåœ¨SphinxApiä¸­ä½¿ç”¨SetRankingMode()æ–¹æ³•ï¼Œåœ¨SphinxQLä¸­è®¾ç½®rankeré€‰é¡¹</p><blockquote><p>As a sidenote, legacy matching modes are internally implemented via the unified syntax anyway. When you use one of those modes, Sphinx just internally adjusts the query and sets the associated ranker, then executes the query using the very same unified code path.</p></blockquote><p>æ³¨æ„ï¼Œè€çš„åŒ¹é…æ¨¡å¼è¢«å†…ç½®äº†ç»Ÿä¸€çš„è¯­æ³•ï¼Œå½“ä½ ä½¿ç”¨è¿™äº›æ¨¡å¼çš„æ—¶å€™ï¼Œsphinxä»…ä»…å†…éƒ¨åˆ¤æ–­è¯·æ±‚å’Œè®¾ç½®ç›¸åº”çš„ranker,ç„¶åä½¿ç”¨ç›¸åŒçš„ä»£ç è·¯å¾„å»æ‰§è¡Œè¿™äº›è¯·æ±‚ã€‚</p><h1 id="Available-built-in-rankers-å†…ç½®çš„ranker"><a href="#Available-built-in-rankers-å†…ç½®çš„ranker" class="headerlink" title="Available built-in rankers(å†…ç½®çš„ranker)"></a>Available built-in rankers(å†…ç½®çš„ranker)</h1><blockquote><p>Sphinx ships with a number of built-in rankers suited for different</p><ol><li>A number of them uses two factors, phrase proximity (aka LCS) and BM25. Phrase proximity works on the keyword positions, while</li></ol><p>BM25 works on the keyword frequencies. Basically, the better the degree of the phrase match between the document body and the query, the higher is the phrase proximity (it maxes out when the document contains the entire query as a verbatim quote). And BM25 is higher when the document contains more rare words. Weâ€™ll save the detailed discussion for later.</p></blockquote><p>Sphinx å†…ç½®äº†ä¸€ç³»åˆ—çš„rankerï¼Œ ç”¨äºä¸åŒçš„ç›®çš„ã€‚ä»–ä»¬ä¸­éƒ½æ˜¯åŸºäºä¸¤ä¸ªå› ç´ ï¼Œ phrase proximity(åˆåLCS)å’ŒBM25ï¼Œ Phrase proximityç”¨äºè¡¨ç¤ºå…³é”®å­—ä¸å…³é”®å­—çš„ä½ç½®æœ‰å…³ï¼Œ BM25äºå…³é”®è¯çš„å‡ºç°çš„é¢‘ç‡æœ‰å…³ã€‚åŸºæœ¬ä¸Šï¼Œ è¯·æ±‚ä¸åŒ¹é…çš„æ–‡æ¡£è¶Šæ¥è¿‘ï¼Œ phrase proximityå°±è¶Šé«˜(å½“æ–‡æ¡£å®Œæ•´çš„åŒ…å«æ•´ä¸ªè¯·æ±‚çš„å…³é”®å­—æ—¶æœ€é«˜)ã€‚å½“æ–‡æ¡£ä¸­åŒ…å«çš„å…³é”®è¯è¶Šå¤šï¼ŒBM25å°±è¶Šé«˜ã€‚æˆ‘ä»¬ç¨å€™è®¨è®ºè¿™äº›ç»†èŠ‚</p><blockquote><p>Currently implemented rankers are:</p></blockquote><p>å½“å‰å†…ç½®çš„rankeræœ‰ï¼š</p><blockquote><ol><li>SPH_RANK_PROXIMITY_BM25, the default ranking mode that uses and combines both phrase proximity and BM25 ranking.</li></ol></blockquote><ol><li>SPH_RANK_PROXIMITY_BM25, é»˜è®¤çš„ranker,åŸºäºhrase proximity and BM25 rankingä¸¤ä¸ªå› ç´ </li></ol><blockquote><ol start="2"><li>SPH_RANK_BM25, statistical ranking mode which uses BM25 ranking only (similar to most other full-text engines). This mode is faster but may result in worse quality on queries which contain more than 1 keyword.</li></ol></blockquote><ol start="2"><li>SPH_RANK_BM25ï¼Œ å½“ä»…ä»…ä½¿ç”¨BM25è¿™ç§æ’åºå› ç´ çš„æ—¶å€™çš„æ¨¡å¼(äºå¤§å¤šæ•°å…¶ä»–çš„å…¨æ–‡å¼•æ“ç›¸ä¼¼)ï¼Œè¿™ç§æ¨¡å¼è™½ç„¶å¿«ï¼Œä½†ç»“æœçš„è´¨é‡ä¸é«˜ï¼Œå¾ˆå¤šç»“æœåŒ…å«çš„å…³é”®è¯ä¸æ­¢ä¸€ä¸ª(å³å…³é”®å­—è¶Šå¤šï¼Œåˆ†å€¼è¶Šé«˜ï¼Œä½†å¾ˆå¤šæ—¶å€™æˆ‘ä»¬æœ€æƒ³è¦çš„ä»…ä»…æ˜¯ä¸€ä¸ªå®Œå…¨å‘½ä¸­çš„ç»“æœ)</li></ol><blockquote><ol start="3"><li>SPH_RANK_NONE, no ranking mode. This mode is obviously the fastest. A weight of 1 is assigned to all matches. This is sometimes called boolean searching that just matches the documents but does not rank them.</li></ol></blockquote><ol start="3"><li>SPH_RANK_NONE æ²¡æœ‰ä»»ä½•æ’åºæ¨¡å¼çš„æ¨¡å¼ï¼Œè¿™ç§æ¨¡å¼å¾ˆæ˜æ˜¾æœ€å¿«ï¼Œ æ‰€æœ‰åŒ¹é…çš„æ–‡æ¡£çš„æƒé‡éƒ½æ˜¯1ï¼Œ æœ‰æ—¶å€™è¢«æˆä¸ºå¸ƒå°”æœç´¢ï¼Œè¿™ç§æœç´¢ä»…ä»…æœç´¢æ–‡æ¡£ï¼Œä½†ä¸ä¼šæ’åº</li></ol><blockquote><ol start="4"><li>SPH_RANK_WORDCOUNT, ranking by the keyword occurrences count. This computes the per-field keyword occurrence counts, then multiplies them by field weights, and sums the resulting values.</li></ol></blockquote><ol start="4"><li>SPH_RANK_WORDCOUNT æ ¹æ®å…³é”®å­—å‡ºç°çš„æ¬¡æ•°æ’åºï¼Œè¿™ç§æ’åºæ–¹å¼çš„è®¡ç®—æ˜¯åŸºäºæ¯ä¸ªå­—æ®µçš„å…³é”®å­—å‡ºç°çš„æ¬¡æ•°ï¼Œç„¶åæ•´åˆè¿™äº›å­—æ®µçš„æƒé‡å¾—å‡ºçš„ç»“æœã€‚</li></ol><blockquote><ol start="5"><li>SPH_RANK_PROXIMITY, added in version 0.9.9-rc1, returns raw phrase proximity value as a result. This mode is internally used to emulate SPH_MATCH_ALL queries.</li></ol></blockquote><blockquote><ol start="5"><li>SPH_RANK_PROXIMITYï¼Œ è¿™ç§æ’åºè¿”å›çš„æ˜¯æ¯ä¸ªæ–‡æ¡£äºè¯·æ±‚çš„ç›¸ä¼¼ç¨‹åº¦ï¼Œè¿™ç§æ¨¡å¼è¢«å†…ç½®ç”¨æ¥åœ¨SPH_MATCH_ALLåŒ¹é…æ¨¡å¼çš„æ—¶å€™æ’åº</li></ol></blockquote><blockquote><ol start="6"><li>SPH_RANK_MATCHANY, added in version 0.9.9-rc1, returns rank as it was computed in SPH_MATCH_ANY mode earlier, and is internally used to emulate SPH_MATCH_ANY queries.</li></ol></blockquote><ol start="6"><li>SPH_RANK_MATCHANYï¼Œ æ—©æœŸçš„æ—¶å€™åœ¨SPH_MATCH_ANYåŒ¹é…æ¨¡å¼ä¸­ä½¿ç”¨ï¼Œ è¿”å›ç›¸å…³å€¼ï¼Œåœ¨SPH_MATCH_ANYæ¨¡å¼ä¸­å†…ç½®çš„å°±æ˜¯è¿™ç§æ’åºæ¨¡å¼</li></ol><blockquote><ol start="7"><li>SPH_RANK_FIELDMASK, added in version 0.9.9-rc2, returns a 32-bit mask with N-th bit corresponding to N-th fulltext field, numbering from 0. The bit will only be set when the respective field has any keyword occurrences satisfying the query.</li></ol></blockquote><ol start="7"><li>SPH_RANK_FIELDMASK è¿”å›ä¸€ä¸ª32ä½çš„æ©ç ï¼Œ æ¯ä¸ªä½éƒ½å¯¹åº”ä¸€ä¸ªç›¸åº”çš„å…¨æ–‡å­—æ®µ(ä¸èƒ½åº”è¯¥è¦è¡¥é›¶)ï¼Œ ä»0å¼€å§‹ï¼Œ åªæœ‰å½“ç›¸åº”çš„å­—æ®µæœ‰å…³é”®å­—å‡ºç°çš„æ—¶å€™æ‰ä¼šè¢«ç½®1</li></ol><blockquote><ol start="8"><li>SPH_RANK_SPH04, added in version 1.10-beta, is generally based on the default SPH_RANK_PROXIMITY_BM25 ranker, but additionally boosts the matches when they occur in the very beginning or the very end of a text field. Thus, if a field equals the exact query, SPH04 should rank it higher than a field that contains the exact query but is not equal to it. (For instance, when the query is â€œHyde Parkâ€, a document entitled â€œHyde Parkâ€ should be ranked higher than a one entitled â€œHyde Park, Londonâ€ or â€œThe Hyde Park Cafeâ€.)</li></ol></blockquote><ol start="8"><li>SPH_RANK_SPH04ï¼Œ åŸºäºé»˜è®¤çš„SPH_RANK_PROXIMITY_BM25æ¨¡å¼ï¼Œ ä½†å‡å¦‚åŒ¹é…çš„æ–‡æ¡£çš„å¼€å¤´æˆ–è€…ç»“å°¾å‡ºç°äº†ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–‡æ¡£çš„ç›¸å…³å€¼å°±ä¼šæå‡ï¼Œæ‰€ä»¥ï¼Œå¦‚æœæŸä¸ªæ–‡æ¡£çš„ä¸€ä¸ªå­—æ®µå®Œå…¨äºè¯·æ±‚çš„å…³é”®å­—ä¸€è‡´ï¼Œ é‚£ä¹ˆè¿™ç§æ¨¡å¼ä¸‹çš„æ’åºçš„ä½ç½®å°±åº”è¯¥æ¯”æ–‡æ¡£ä¸­åŒ…å«è¯·æ±‚å…³é”®å­—çš„æ–‡æ¡£é«˜ã€‚(æ¯”å¦‚ï¼Œå¦‚æœè¯·æ±‚çš„å…³é”®å­—æ˜¯â€Hyde Parkâ€, â€œHyde Parkâ€çš„æ–‡æ¡£å°±ä¼šæ¯”â€Hyde Park, Londonâ€æˆ–è€…â€The Hyde Park Cafeâ€çš„æ’åºé«˜)</li></ol><blockquote><ol start="9"><li>SPH_RANK_EXPR, added in version 2.0.2-beta, lets you specify the ranking formula in run time. It exposes a number of internal text factors and lets you define how the final weight should be computed from those factors.</li></ol></blockquote><ol start="9"><li>SPH_RANK_EXPR è¿™ç§æ¨¡å¼è®©ä½ èƒ½åœ¨è¿è¡Œçš„æ—¶å€™æŒ‡å®šæ’åºè§„åˆ™ï¼Œ ä»–æš´éœ²äº†ä¸€ç³»åˆ—çš„å†…ç½®çš„æ–‡æœ¬çš„å› ç´ ï¼Œ è®©ä½ èƒ½åŸºäºè¿™äº›å› ç´ è®¡ç®—å‡ºæœ€ç»ˆçš„æƒé‡</li></ol><blockquote><p>You should specify the SPH_RANK_ prefix and use capital letters only when using the SetRankingMode() call from the SphinxAPI. The API ports expose these as global constants. Using SphinxQL syntax, the prefix should be omitted and the ranker name is case insensitive.</p></blockquote><p>ä½ å¯ä»¥æŒ‡å®šä¸€ä¸ªSPH_RANK_ä¸ºå‰ç¼€çš„æ’åºæ¨¡å¼ï¼Œè¦å…¨éƒ¨å¤§å†™ã€‚åœ¨SphinxAPIä¸­ä½¿ç”¨SetRankingMode()æ–¹æ³•ï¼Œè¿™ä¸ªAPIä¸­å®šä¹‰äº†è¿™äº›æ¨¡å¼çš„å…¨å±€å¸¸é‡ã€‚ åœ¨SphinxQLä¸­ï¼Œ è¿™ä¸ªå‰ç¼€è¦è¢«æ˜ å°„ï¼Œä¸”rankerçš„åç§°æ˜¯å¤§å°å†™æ•æ„Ÿçš„(å°±æ˜¯è¦æŒ‡å®šrankeræ¨¡å¼çš„å‚æ•°é€‰é¡¹)</p><h1 id="Example-ï¼ˆä¾‹å­ï¼‰"><a href="#Example-ï¼ˆä¾‹å­ï¼‰" class="headerlink" title="Example ï¼ˆä¾‹å­ï¼‰"></a>Example ï¼ˆä¾‹å­ï¼‰</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SphinxAPI</span></span><br><span class="line">$client-&gt;SetRankingMode ( SPH_RANK_SPH04 );</span><br><span class="line"></span><br><span class="line"><span class="comment">// SphinxQL</span></span><br><span class="line">mysql_query ( <span class="string">"SELECT ... OPTION ranker=sph04"</span> );</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> sphinx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQL Connection using old authentication protocol refused</title>
      <link href="/mysql-connect-connection-using-old-authentication-protocol-refused/"/>
      <url>/mysql-connect-connection-using-old-authentication-protocol-refused/</url>
      
        <content type="html"><![CDATA[<p>æœ‰ä¸€å°mysqlå‡çº§åˆ°5.6ç‰ˆæœ¬ï¼Œç»“æœè¿æ¥ä¸€äº›ä½ç‰ˆæœ¬çš„mysqlæœåŠ¡å™¨æŠ¥å‡ºå¦‚ä¸‹å¼‚å¸¸ï¼š</p><blockquote><p>Warning: mysql_connect(): Connection using old (pre-4.1.1) authentication protocol refused (client option â€˜secure_authâ€™ enabled)</p></blockquote><p>å¼‚å¸¸åŸå› åœ¨äºæœåŠ¡å™¨ç«¯çš„å¯†ç ç®¡ç†åè®®é™ˆæ—§ï¼Œä½¿ç”¨çš„æ˜¯æ—§æœ‰çš„ç”¨æˆ·å¯†ç æ ¼å¼å­˜å‚¨ï¼›ä½†æ˜¯å®¢æˆ·ç«¯å‡çº§ä¹‹åé‡‡ç”¨äº†æ–°çš„å¯†ç æ ¼å¼ã€‚mysql5.6ç‰ˆæœ¬é‡åˆ°è¿™ç§ä¸ä¸€è‡´çš„æƒ…å†µå°±ä¼šæ‹’ç»è¿æ¥ã€‚</p><a id="more"></a><p>è¯¦è§mysqlæ‰‹å†Œ <code>Server Command Options</code> ä¸€èŠ‚ä¸­ <code>--secure-auth</code> é€‰é¡¹çš„<a href="http://dev.mysql.com/doc/refman/5.6/en/server-options.html#option_mysqld_secure-auth" target="_blank" rel="noopener">è¯´æ˜</a></p><p>è§£å†³æ–¹æ³•æœ‰å¦‚ä¸‹ä¸¤ç§ï¼š</p><blockquote><p>1ã€æœåŠ¡å™¨ç«¯å‡çº§å¯ç”¨ <code>secure_auth</code> é€‰é¡¹ï¼›<br>2ã€å®¢æˆ·ç«¯è¿æ¥æ—¶offæ‰ <code>secure_auth</code> ï¼Œå³è¿æ¥æ—¶åŠ ä¸Š <code>--secure_auth=off</code>ï¼Œå¦‚ï¼š<code>mysql -p10.51.1.11 -P3308 -uroot --secure_auth=off</code><br>å¯¹äºæ–¹æ³•äºŒï¼Œä½¿ç”¨åœ¨ç¨‹åºåšç›¸åº” mysql é…ç½®å³å¯ï¼Œä»¥phpä¸ºä¾‹ï¼Œåœ¨ <code>php.ini</code> ä¸­è®¾ç½® <code>secure_auth=off</code></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
            <tag> authentication </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨ watch å¸®ä½ é‡å¤æ‰§è¡Œå‘½ä»¤</title>
      <link href="/repeat-the-command-using-watch/"/>
      <url>/repeat-the-command-using-watch/</url>
      
        <content type="html"><![CDATA[<p>æœ‰æ—¶å€™ä½ éœ€è¦ä¸æ–­çš„æ‰§è¡ŒæŸä¸ªå‘½ä»¤ï¼Œè¿½è¸ªå…¶è¾“å‡ºäº§ç”Ÿçš„å˜åŒ–æƒ…å†µã€‚ä½ å¯èƒ½ä¼šå†™ä¸€ä¸ªæ­»å¾ªç¯æ¥åšè¿™ä»¶äº‹æƒ…ï¼š</p><a id="more"></a><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> :</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">    clear</span><br><span class="line">    commands</span><br><span class="line">    sleep 1</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><p>ç„¶è€Œå®é™…ä¸Š<code>linuxä¸­</code>æœ‰ä¸€ä¸ª <code>watch</code> å‘½ä»¤èƒ½å¤Ÿå¸®ä½ åšè¿™ä»¶äº‹æƒ…ã€‚å®ƒä¼šå®šæœŸæ‰§è¡ŒæŒ‡å®šçš„ç¨‹åºå¹¶å°†ç»“æœå…¨å±è¾“å‡ºã€‚</p><p>watch çš„ä½¿ç”¨æ–¹æ³•å¾ˆç®€å•ï¼Œåªéœ€è¦</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">watch å‘½ä»¤</span><br></pre></td></tr></table></figure><p>å°±è¡Œäº†ï¼Œè¿™æ · <code>watch</code> å‘½ä»¤ä¼šæ¯éš”ä¸¤ç§’æ‰§è¡Œä¸€æ¬¡è¯¥è¯¥å‘½ä»¤ï¼Œå¹¶å…¨å±è¾“å‡ºæ‰§è¡Œç»“æœã€‚</p><p>ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼Œç¬¬ä¸€è¡Œä¸­çš„ <code>Every 2.0s</code>: è¡¨ç¤º <code>watch</code> æ¯éš”2ç§’æ‰§è¡Œä¸€æ¬¡å‘½ä»¤ã€‚åé¢çš„ <code>date</code> ä¸ºè¦æ‰§è¡Œçš„å‘½ä»¤ã€‚å†åé¢çš„ <code>T520: Thu May 10 16:55:23 2018</code> æ˜¯ä¸»æœºåä»¥åŠæ‰§è¡Œå‘½ä»¤çš„æ—¶é—´ã€‚</p><p>åœ¨ä¸‹é¢ï¼Œä»ç¬¬äºŒè¡Œå¼€å§‹å°±æ˜¯å‘½ä»¤æ‰§è¡Œçš„æ—¶é—´äº†ã€‚</p><p>é€šè¿‡ <code>-n INTERVAL</code> ä½ ä¹Ÿå¯ä»¥è®¾ç½®é‡å¤æ‰§è¡Œå‘½ä»¤çš„é—´éš”æ—¶é—´ï¼Œæ¯”å¦‚æˆ‘å¯ä»¥è°ƒæ•´ä¸ºæ¯5ç§’ä¸­æ‰§è¡Œä¸€æ¬¡ <code>date</code> å‘½ä»¤</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">watch -n 5 date</span><br></pre></td></tr></table></figure><p>ä¸ä»…å¦‚æ­¤,é€šè¿‡ <code>-d</code> é€‰é¡¹, <code>watch</code> è¿˜èƒ½é«˜äº®æ˜¾ç¤ºä¸¤æ¬¡è¾“å‡ºä¸­ä¸åŒçš„éƒ¨åˆ†ï¼Œè¿™ä¸ªåŠŸèƒ½ç›¸å½“å®ç”¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">watch -d -n 1 date</span><br></pre></td></tr></table></figure><p>é™¤äº†é«˜äº®æ˜¾ç¤ºè¾“å‡ºä¸­æ”¹å˜çš„éƒ¨åˆ†å¤–ï¼Œä½ ä¹Ÿå¯ä»¥è®¾ç½®è®© <code>watch</code> å‘ç°ç»“æœæœ‰æ”¹å˜æ—¶é€€å‡ºå¾ªç¯æ‰§è¡Œï¼Œæ–¹æ³•æ˜¯ä½¿ç”¨ <code>-g/--chgexit</code> é€‰é¡¹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">watch -g free</span><br></pre></td></tr></table></figure><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ <code>watch</code> å¹¶ä¸ä¼šå…³å¿ƒå‘½ä»¤çš„æ‰§è¡Œç»“æœæ˜¯å¦æˆåŠŸ</p><p>ä½†ä½ å¯ä»¥è®© watch æ£€æµ‹å‘½ä»¤çš„è¿”å›å€¼ï¼Œå½“å‘½ä»¤è¿è¡Œè¿”å›é0æ—¶å‘å‡ºèœ‚é¸£(<code>-b/â€“beep</code>)æˆ–è€…ç›´æ¥é€€å‡º(<code>-e/â€“errexit</code>)ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">watch -e wrong_commands</span><br></pre></td></tr></table></figure><p>æœ€åï¼Œè‹¥ä½ å¸Œæœ› <code>watch</code> åªæ˜¾ç¤ºå‡ºå‘½ä»¤çš„æ‰§è¡Œç»“æœï¼Œè€Œä¸è¦æ˜¾ç¤ºç¬¬ä¸€è¡Œçš„é‚£äº›ä¿¡æ¯ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ <code>-t</code> é€‰é¡¹å…³é—­<code>title</code>çš„æ˜¾ç¤º</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">watch -t date</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> watch </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PHPå›å­åŠ å¯†</title>
      <link href="/php-code-protector/"/>
      <url>/php-code-protector/</url>
      
        <content type="html"><![CDATA[<p>å› ä¸ºGithub Pageæ²¡åŠæ³•æ”¯æŒphpä»£ç è¿è¡Œï¼Œä¹‹å‰çš„<code>PHPå›å­åŠ å¯†</code>æ²¡åŠæ³•ç›´æ¥è¿è¡Œäº†ï¼ŒæŠŠæºç æ”¾å‡ºæ¥ï¼Œå¤§å®¶è‡ªå·±éƒ¨ç½²å§ã€‚</p><a id="more"></a><p>index.phpæºç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>($_SERVER[<span class="string">'REQUEST_METHOD'</span>]==<span class="string">'POST'</span>)&#123;</span><br><span class="line">    <span class="comment">// å¯¼å…¥ç±»</span></span><br><span class="line">    <span class="keyword">require</span> <span class="string">'PHPCodeProtector.class.php'</span>;</span><br><span class="line">    <span class="comment">// åˆ›å»ºç±»</span></span><br><span class="line">    $pcp = <span class="keyword">new</span> PHPCodeProtector;</span><br><span class="line">    <span class="comment">// åŠ è½½ä»£ç </span></span><br><span class="line">    $pcp-&gt;load($_POST[<span class="string">'code'</span>]);</span><br><span class="line">    <span class="comment">// è®¾ç½®ç‰ˆæœ¬ä¿¡æ¯</span></span><br><span class="line">    <span class="keyword">if</span>($_POST[<span class="string">'copyright_on'</span>])&#123;</span><br><span class="line">        $pcp-&gt;setCopyright($_POST[<span class="string">'copyright'</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è®¾ç½®è¿‡æœŸæ—¶é—´</span></span><br><span class="line">    <span class="keyword">if</span>($_POST[<span class="string">'expire_on'</span>])&#123;</span><br><span class="line">        $pcp-&gt;setExpire(strtotime($_POST[<span class="string">'expire'</span>]), $_POST[<span class="string">'expire_msg'</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è®¾ç½®å…è®¸IP</span></span><br><span class="line">    <span class="keyword">if</span>($_POST[<span class="string">'allow_ip_on'</span>])&#123;</span><br><span class="line">        $pcp-&gt;setAllowIp($_POST[<span class="string">'allow_ip'</span>], $_POST[<span class="string">'not_allow_ip_msg'</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è®¾ç½®å…è®¸åŸŸå</span></span><br><span class="line">    <span class="keyword">if</span>($_POST[<span class="string">'allow_domain_on'</span>])&#123;</span><br><span class="line">        $pcp-&gt;setAllowDomain($_POST[<span class="string">'allow_domain'</span>], $_POST[<span class="string">'not_allow_domain_msg'</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ä¿å­˜è‡³æœ¬åœ°</span></span><br><span class="line">    <span class="keyword">if</span>($_POST[<span class="string">'render_on'</span>])&#123;</span><br><span class="line">        $pcp-&gt;render($_POST[<span class="string">'render_name'</span>]);</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è¾“å‡ºåŠ å¯†åçš„ä»£ç </span></span><br><span class="line">    $code = $pcp-&gt;output();</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    $copyright            = <span class="string">'huangdijia@gmail.com'</span>;</span><br><span class="line">    $expire               = date(<span class="string">'Y-m-d'</span>, strtotime(<span class="string">'+1 day'</span>));</span><br><span class="line">    $expire_msg           = <span class="string">'PHPä»£ç å·²ç»è¿‡æœŸ'</span>;</span><br><span class="line">    $allow_ip             = <span class="string">'127.0.0.1,192.168.1.1'</span>;</span><br><span class="line">    $not_allow_ip_msg     = <span class="string">'PHPä»£ç ä¸å…è®¸åœ¨æ­¤IPæ‰§è¡Œ'</span>;</span><br><span class="line">    $allow_domain         = <span class="string">'localhost,www.hdj.me'</span>;</span><br><span class="line">    $not_allow_domain_msg = <span class="string">'PHPä»£ç ä¸å…è®¸åœ¨æ­¤åŸŸåæ‰§è¡Œ'</span>;</span><br><span class="line">    $render_name          = <span class="string">'pcp_'</span>.time().<span class="string">'.php'</span>;</span><br><span class="line">    $code                 = <span class="string">&lt;&lt;&lt;CODE</span></span><br><span class="line"><span class="string">&lt;?php</span></span><br><span class="line"><span class="string">/* Class   PHPCodeProtector */</span></span><br><span class="line"><span class="string">/* Version 1.0 */</span></span><br><span class="line"><span class="string">/* Author  Deeka */</span></span><br><span class="line"><span class="string">/* Email   huangdijia@gmail.com */</span></span><br><span class="line"><span class="string">echo phpinfo();</span></span><br><span class="line"><span class="string">?&gt;</span></span><br><span class="line"><span class="string">CODE;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;!DOCTYPE HTML&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">"utf-8"</span>&gt;</span><br><span class="line">&lt;title&gt;PHPCodeProtector&lt;/title&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">html,body, textarea&#123; font-size:<span class="number">13</span>px;&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;PHPä»£ç ä¿æŠ¤&lt;/h1&gt;</span><br><span class="line">&lt;p&gt;ç‰ˆæœ¬ï¼š<span class="number">1.0</span>&lt;/p&gt;</span><br><span class="line">&lt;div&gt;&lt;b&gt;å·²çŸ¥BUG&lt;/b&gt;&lt;/div&gt;</span><br><span class="line">&lt;ul&gt;</span><br><span class="line">    &lt;li&gt;å¸¸é‡ä¼šè¢«è½¬ä¸ºå­—ç¬¦ä¸²&lt;/li&gt;</span><br><span class="line">&lt;/ul&gt;</span><br><span class="line">&lt;form method=<span class="string">"post"</span> action=<span class="string">"?"</span>&gt;</span><br><span class="line">    &lt;p&gt;è¯·è¾“å…¥PHPä»£ç ï¼š&lt;/p&gt;</span><br><span class="line">    &lt;p&gt;&lt;textarea name=<span class="string">"code"</span> style=<span class="string">"width:590px;"</span> cols=<span class="string">"30"</span> rows=<span class="string">"20"</span>&gt;<span class="meta">&lt;?php</span> <span class="keyword">echo</span> $code; <span class="meta">?&gt;</span>&lt;/textarea&gt;&lt;/p&gt;</span><br><span class="line">    &lt;p&gt;</span><br><span class="line">        &lt;label&gt;&lt;input type=<span class="string">"checkbox"</span> name=<span class="string">"copyright_on"</span> <span class="meta">&lt;?php</span> <span class="keyword">echo</span> $_POST[<span class="string">'copyright_on'</span>]?<span class="string">'checked'</span>:<span class="string">''</span><span class="meta">?&gt;</span> /&gt; ç‰ˆæœ¬ä¿¡æ¯ï¼š&lt;/label&gt;</span><br><span class="line">        &lt;input type=<span class="string">"text"</span> name=<span class="string">"copyright"</span> value=<span class="string">"&lt;?php echo $_POST['copyright']?$_POST['copyright']:$copyright; ?&gt;"</span> /&gt;</span><br><span class="line">    &lt;/p&gt;</span><br><span class="line">    &lt;p&gt;</span><br><span class="line">        &lt;label&gt;&lt;input type=<span class="string">"checkbox"</span> name=<span class="string">"expire_on"</span> value=<span class="string">"1"</span> <span class="meta">&lt;?php</span> <span class="keyword">echo</span> $_POST[<span class="string">'expire_on'</span>]?<span class="string">'checked'</span>:<span class="string">''</span><span class="meta">?&gt;</span> /&gt; æœ‰ æ•ˆ æœŸï¼š&lt;/label&gt;</span><br><span class="line">        &lt;input type=<span class="string">"text"</span> name=<span class="string">"expire"</span> value=<span class="string">"&lt;?php echo $_POST['expire']?$_POST['expire']:$expire;?&gt;"</span> /&gt;</span><br><span class="line">        æç¤ºï¼š&lt;input type=<span class="string">"text"</span> name=<span class="string">"expire_msg"</span> size=<span class="string">"40"</span> value=<span class="string">"&lt;?php echo $_POST['expire_msg']?$_POST['expire_msg']:$expire_msg; ?&gt;"</span> /&gt;</span><br><span class="line">    &lt;/p&gt;</span><br><span class="line">    &lt;p&gt;</span><br><span class="line">        &lt;label&gt;&lt;input type=<span class="string">"checkbox"</span> name=<span class="string">"allow_ip_on"</span> value=<span class="string">"1"</span> <span class="meta">&lt;?php</span> <span class="keyword">echo</span> $_POST[<span class="string">'allow_ip_on'</span>]?<span class="string">'checked'</span>:<span class="string">''</span><span class="meta">?&gt;</span> /&gt; å… è®¸ IPï¼š&lt;/label&gt;</span><br><span class="line">        &lt;input type=<span class="string">"text"</span> name=<span class="string">"allow_ip"</span> value=<span class="string">"&lt;?php echo $_POST['allow_ip']?$_POST['allow_ip']:$allow_ip;?&gt;"</span> /&gt;</span><br><span class="line">        æç¤ºï¼š&lt;input type=<span class="string">"text"</span> name=<span class="string">"not_allow_ip_msg"</span> size=<span class="string">"40"</span> value=<span class="string">"&lt;?php echo $_POST['not_allow_ip_msg']?$_POST['not_allow_ip_msg']:$not_allow_ip_msg;?&gt;"</span> /&gt;</span><br><span class="line">    &lt;/p&gt;</span><br><span class="line">    &lt;p&gt;</span><br><span class="line">        &lt;label&gt;&lt;input type=<span class="string">"checkbox"</span> name=<span class="string">"allow_domain_on"</span> value=<span class="string">"1"</span> <span class="meta">&lt;?php</span> <span class="keyword">echo</span> $_POST[<span class="string">'allow_domain_on'</span>]?<span class="string">'checked'</span>:<span class="string">''</span><span class="meta">?&gt;</span> /&gt; å…è®¸åŸŸåï¼š&lt;/label&gt;</span><br><span class="line">        &lt;input type=<span class="string">"text"</span> name=<span class="string">"allow_domain"</span> value=<span class="string">"&lt;?php echo $_POST['allow_domain']?$_POST['allow_domain']:$allow_domain;?&gt;"</span> /&gt;</span><br><span class="line">        æç¤ºï¼š&lt;input type=<span class="string">"text"</span> name=<span class="string">"not_allow_domain_msg"</span> size=<span class="string">"40"</span> value=<span class="string">"&lt;?php echo $_POST['not_allow_domain_msg']?$_POST['not_allow_domain_msg']:$not_allow_domain_msg;?&gt;"</span> /&gt;</span><br><span class="line">    &lt;/p&gt;</span><br><span class="line">    &lt;p&gt;</span><br><span class="line">        &lt;label&gt;&lt;input type=<span class="string">"checkbox"</span> name=<span class="string">"render_on"</span> value=<span class="string">"1"</span> /&gt; ä¿å­˜ä¸ºï¼š&lt;/label&gt;</span><br><span class="line">        &lt;input type=<span class="string">"text"</span> name=<span class="string">"render_name"</span> value=<span class="string">"&lt;?php echo $_POST['render_name']?$_POST['render_name']:$render_name;?&gt;"</span> /&gt;</span><br><span class="line">    &lt;/p&gt;</span><br><span class="line">    &lt;p&gt;</span><br><span class="line">        &lt;button type=<span class="string">"submit"</span>&gt;æäº¤&lt;/button&gt;</span><br><span class="line">    &lt;/p&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>PHPCodeProtector.class.phpæºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// PHPæºç åŠ å¯†ç±» v1.0</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PHPCodeProtector</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $expire               = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> $expire_msg           = <span class="string">'PHPCode Expired!'</span>;</span><br><span class="line">    <span class="keyword">private</span> $allow_ip;</span><br><span class="line">    <span class="keyword">private</span> $allow_domain;</span><br><span class="line">    <span class="keyword">private</span> $not_allow_ip_msg     = <span class="string">'PHPCode Not Allow Run On This Ip!'</span>;</span><br><span class="line">    <span class="keyword">private</span> $not_allow_domain_msg = <span class="string">'PHPCode Not Allow Run On This Domain!'</span>;</span><br><span class="line">    <span class="keyword">private</span> $separator            = <span class="string">','</span>;</span><br><span class="line">    <span class="keyword">private</span> $key                  = <span class="string">'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz'</span>;</span><br><span class="line">    <span class="keyword">private</span> $comment;</span><br><span class="line">    <span class="keyword">private</span> $code;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åŠ è½½æ–‡ä»¶</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">load</span><span class="params">($code=<span class="string">''</span>, $isfile=<span class="number">0</span>)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>($isfile &amp;&amp; file_exists($code))&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;code = file_get_contents($code);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;code = $code;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¾“å‡º</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">output</span><span class="params">($highlight=<span class="number">0</span>)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $content = <span class="keyword">$this</span>-&gt;_crypt(<span class="keyword">$this</span>-&gt;code);</span><br><span class="line">        <span class="keyword">return</span> $highlight ? highlight_string($content) : $content;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦å­˜ä¸º</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">render</span><span class="params">($filename=<span class="string">''</span>, $type=<span class="string">"text/plain"</span>, $expire=<span class="number">180</span>)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!$filename)&#123;</span><br><span class="line">            $filename = <span class="string">'pcp_'</span>.time().<span class="string">'php'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// åŠ å¯†åä»£ç </span></span><br><span class="line">        $content = <span class="keyword">$this</span>-&gt;output();</span><br><span class="line">        $length = strlen($content);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//å‘é€Http Headerä¿¡æ¯ å¼€å§‹ä¸‹è½½</span></span><br><span class="line">        header(<span class="string">"Pragma: public"</span>);</span><br><span class="line">        header(<span class="string">"Cache-control: max-age="</span>.$expire);</span><br><span class="line">        <span class="comment">//header('Cache-Control: no-store, no-cache, must-revalidate');</span></span><br><span class="line">        header(<span class="string">"Expires: "</span> . gmdate(<span class="string">"D, d M Y H:i:s"</span>,time()+$expire) . <span class="string">"GMT"</span>);</span><br><span class="line">        header(<span class="string">"Last-Modified: "</span> . gmdate(<span class="string">"D, d M Y H:i:s"</span>,time()) . <span class="string">"GMT"</span>);</span><br><span class="line">        header(<span class="string">"Content-Disposition: attachment; filename="</span>.$filename);</span><br><span class="line">        header(<span class="string">"Content-Length: "</span>.$length);</span><br><span class="line">        header(<span class="string">"Content-type: "</span>.$type);</span><br><span class="line">        header(<span class="string">'Content-Encoding: none'</span>);</span><br><span class="line">        header(<span class="string">"Content-Transfer-Encoding: binary"</span> );</span><br><span class="line">        <span class="keyword">echo</span> $content;</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¿å­˜</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">save</span><span class="params">($file=<span class="string">''</span>)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $content = <span class="keyword">$this</span>-&gt;output();</span><br><span class="line">        <span class="keyword">return</span> file_put_contents($file, $content);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç‰ˆæœ¬æ³¨é‡Š</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setCopyright</span><span class="params">($copyright=<span class="string">''</span>)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">empty</span>($copyright))&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;copyright = $copyright;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¾ç½®è¶…æ—¶</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setExpire</span><span class="params">($expire=null, $expire_msg=<span class="string">'PHPCode Expired!'</span>)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!is_null($expire))&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;expire = $expire;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">empty</span>($expire_msg))&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;expire_msg = $expire_msg;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¾ç½®å…è®¸IP</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setAllowIp</span><span class="params">($allow_ip=<span class="string">''</span>, $not_allow_ip_msg=<span class="string">'PHPCode Not Allow Run On This Ip!'</span>)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">empty</span>($allow_ip))&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;allow_ip = $allow_ip;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">empty</span>($not_allow_ip_msg))&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;not_allow_ip_msg = $not_allow_ip_msg;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¾ç½®å…è®¸åŸŸå</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setAllowDomain</span><span class="params">($allow_domain=<span class="string">''</span>, $not_allow_domain_msg=<span class="string">'PHPCode Not Allow Run On This Domain!'</span>)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">empty</span>($allow_domain))&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;allow_domain = $allow_domain;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">empty</span>($not_allow_domain_msg))&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;not_allow_domain_msg = $not_allow_domain_msg;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¾ç½®å¯†åŒ™</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setKey</span><span class="params">($key)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;key = $key;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å–éšæœºå¯†åŒ™</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">_getRandKey</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> str_shuffle(<span class="keyword">$this</span>-&gt;key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åŠ å¯†</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">_crypt</span><span class="params">($php_code=<span class="string">''</span>)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// éšæœºå¯†åŒ™1</span></span><br><span class="line">        $rand_key1 = <span class="keyword">$this</span>-&gt;_getRandKey();</span><br><span class="line">        <span class="comment">// éšæœºå¯†åŒ™2</span></span><br><span class="line">        $rand_key2 = <span class="keyword">$this</span>-&gt;_getRandKey();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åŠ å…¥æ—¶é—´é™åˆ¶</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;expire &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            $verify_code .= <span class="string">'if(time() &gt; '</span>.<span class="keyword">$this</span>-&gt;expire.<span class="string">') die(\''</span>.<span class="keyword">$this</span>-&gt;expire_msg.<span class="string">'\');'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// åŠ å…¥IPé™åˆ¶</span></span><br><span class="line">        $allow_ips = explode(<span class="keyword">$this</span>-&gt;separator, <span class="keyword">$this</span>-&gt;allow_ip);</span><br><span class="line">        $allow_ips = array_filter($allow_ips);</span><br><span class="line">        <span class="keyword">if</span>(is_array($allow_ips) &amp;&amp; !<span class="keyword">empty</span>($allow_ips))&#123;</span><br><span class="line">            $verify_code .= <span class="string">'if(!in_array($_SERVER["SERVER_ADDR"], '</span>.str_replace(<span class="string">"\n"</span>, <span class="string">''</span>, var_export($allow_ips, <span class="keyword">true</span>)).<span class="string">')) die(\''</span>.<span class="keyword">$this</span>-&gt;not_allow_ip_msg.<span class="string">'\');'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// åŠ å…¥åŸŸåé™åˆ¶</span></span><br><span class="line">        $allow_domains = explode(<span class="keyword">$this</span>-&gt;separator, <span class="keyword">$this</span>-&gt;allow_domain);</span><br><span class="line">        $allow_domains = array_filter($allow_domains);</span><br><span class="line">        <span class="keyword">if</span>(is_array($allow_domains) &amp;&amp; !<span class="keyword">empty</span>($allow_domains))&#123;</span><br><span class="line">            $verify_code .= <span class="string">'if(!in_array($_SERVER["HTTP_HOST"], '</span>.str_replace(<span class="string">"\n"</span>, <span class="string">''</span>, var_export($allow_domains, <span class="keyword">true</span>)).<span class="string">')) die(\''</span>.<span class="keyword">$this</span>-&gt;not_allow_domain_msg.<span class="string">'\');'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// éªŒè¯ä¿¡æ¯</span></span><br><span class="line">        $verify_code = $verify_code ? <span class="string">'&lt;?php '</span> . $verify_code . <span class="string">'?&gt;'</span> : <span class="string">''</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// PHPæºç </span></span><br><span class="line">        $php_code = $verify_code.$php_code;</span><br><span class="line">        <span class="comment">// ä»£ç å‹ç¼©</span></span><br><span class="line">        $php_code = <span class="keyword">$this</span>-&gt;_compressPhpSrc($php_code);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// base64åŠ å¯†</span></span><br><span class="line">        $base64_str = base64_encode($php_code);</span><br><span class="line">        <span class="comment">// æ ¹æ®å¯†åŒ™æ›¿æ¢å¯¹åº”å­—ç¬¦</span></span><br><span class="line">        $c = strtr($base64_str, $rand_key1, $rand_key2);</span><br><span class="line">        $c = $rand_key1.$rand_key2.$c;</span><br><span class="line">        $q1 = <span class="string">"O00O0O"</span>;</span><br><span class="line">        $q2 = <span class="string">"O0O000"</span>;</span><br><span class="line">        $q3 = <span class="string">"O0OO00"</span>;</span><br><span class="line">        $q4 = <span class="string">"OO0O00"</span>;</span><br><span class="line">        $q5 = <span class="string">"OO0000"</span>;</span><br><span class="line">        $q6 = <span class="string">"O00OO0"</span>;</span><br><span class="line">        $s = <span class="string">'$'</span>.$q6.<span class="string">'=urldecode("%6E1%7A%62%2F%6D%615%5C%76%740%6928%2D%70%78%75%71%79%2A6%6C%72%6B%64%679%5F%65%68%63%73%77%6F4%2B%6637%6A");$'</span></span><br><span class="line">            .$q1.<span class="string">'=$'</span>.$q6.<span class="string">'&#123;3&#125;.$'</span>.$q6.<span class="string">'&#123;6&#125;.$'</span>.$q6.<span class="string">'&#123;33&#125;.$'</span>.$q6.<span class="string">'&#123;30&#125;;$'</span></span><br><span class="line">            .$q3.<span class="string">'=$'</span>.$q6.<span class="string">'&#123;33&#125;.$'</span>.$q6.<span class="string">'&#123;10&#125;.$'</span>.$q6.<span class="string">'&#123;24&#125;.$'</span>.$q6.<span class="string">'&#123;10&#125;.$'</span>.$q6.<span class="string">'&#123;24&#125;;$'</span></span><br><span class="line">            .$q4.<span class="string">'=$'</span>.$q3.<span class="string">'&#123;0&#125;.$'</span>.$q6.<span class="string">'&#123;18&#125;.$'</span>.$q6.<span class="string">'&#123;3&#125;.$'</span>.$q3.<span class="string">'&#123;0&#125;.$'</span>.$q3.<span class="string">'&#123;1&#125;.$'</span>.$q6.<span class="string">'&#123;24&#125;;$'</span></span><br><span class="line">            .$q5.<span class="string">'=$'</span>.$q6.<span class="string">'&#123;7&#125;.$'</span>.$q6.<span class="string">'&#123;13&#125;;$'</span></span><br><span class="line">            .$q1.<span class="string">'.=$'</span>.$q6.<span class="string">'&#123;22&#125;.$'</span>.$q6.<span class="string">'&#123;36&#125;.$'</span>.$q6.<span class="string">'&#123;29&#125;.$'</span>.$q6.<span class="string">'&#123;26&#125;.$'</span>.$q6.<span class="string">'&#123;30&#125;.$'</span>.$q6.<span class="string">'&#123;32&#125;.$'</span>.$q6.<span class="string">'&#123;35&#125;.$'</span>.$q6.<span class="string">'&#123;26&#125;.$'</span>.$q6.<span class="string">'&#123;30&#125;;eval($'</span></span><br><span class="line">            .$q1.<span class="string">'("'</span>.base64_encode(<span class="string">'$'</span>.$q2.<span class="string">'="'</span>.$c.<span class="string">'";eval(\'?&gt;\'.$'</span>.$q1.<span class="string">'($'</span>.$q3.<span class="string">'($'</span>.$q4.<span class="string">'($'</span>.$q2.<span class="string">',$'</span>.$q5.<span class="string">'*2),$'</span>.$q4.<span class="string">'($'</span>.$q2.<span class="string">',$'</span>.$q5.<span class="string">',$'</span>.$q5.<span class="string">'),$'</span>.$q4.<span class="string">'($'</span>.$q2.<span class="string">',0,$'</span>.$q5.<span class="string">'))));'</span>).<span class="string">'"));'</span>;</span><br><span class="line">        $code = <span class="string">'&lt;?php '</span>;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="keyword">$this</span>-&gt;copyright))&#123;</span><br><span class="line">            $code .= <span class="string">'/* '</span>.<span class="keyword">$this</span>-&gt;copyright.<span class="string">' */ '</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        $code .= $s;</span><br><span class="line">        <span class="comment">// è¿”å›</span></span><br><span class="line">        <span class="keyword">return</span> $code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// PHPä»£ç å‹ç¼©</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">_compressPhpSrc</span><span class="params">($src)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// Whitespaces left and right from this signs can be ignored</span></span><br><span class="line">        <span class="keyword">static</span> $IW = <span class="keyword">array</span>(</span><br><span class="line">            T_CONCAT_EQUAL,             <span class="comment">// .=</span></span><br><span class="line">            T_DOUBLE_ARROW,             <span class="comment">// =&gt;</span></span><br><span class="line">            T_BOOLEAN_AND,              <span class="comment">// &amp;&amp;</span></span><br><span class="line">            T_BOOLEAN_OR,               <span class="comment">// ||</span></span><br><span class="line">            T_IS_EQUAL,                 <span class="comment">// ==</span></span><br><span class="line">            T_IS_NOT_EQUAL,             <span class="comment">// != or &lt;&gt;</span></span><br><span class="line">            T_IS_SMALLER_OR_EQUAL,      <span class="comment">// &lt;=</span></span><br><span class="line">            T_IS_GREATER_OR_EQUAL,      <span class="comment">// &gt;=</span></span><br><span class="line">            T_INC,                      <span class="comment">// ++</span></span><br><span class="line">            T_DEC,                      <span class="comment">// --</span></span><br><span class="line">            T_PLUS_EQUAL,               <span class="comment">// +=</span></span><br><span class="line">            T_MINUS_EQUAL,              <span class="comment">// -=</span></span><br><span class="line">            T_MUL_EQUAL,                <span class="comment">// *=</span></span><br><span class="line">            T_DIV_EQUAL,                <span class="comment">// /=</span></span><br><span class="line">            T_IS_IDENTICAL,             <span class="comment">// ===</span></span><br><span class="line">            T_IS_NOT_IDENTICAL,         <span class="comment">// !==</span></span><br><span class="line">            T_DOUBLE_COLON,             <span class="comment">// ::</span></span><br><span class="line">            T_PAAMAYIM_NEKUDOTAYIM,     <span class="comment">// ::</span></span><br><span class="line">            T_OBJECT_OPERATOR,          <span class="comment">// -&gt;</span></span><br><span class="line">            T_DOLLAR_OPEN_CURLY_BRACES, <span class="comment">// $&#123;</span></span><br><span class="line">            T_AND_EQUAL,                <span class="comment">// &amp;=</span></span><br><span class="line">                T_MOD_EQUAL,                <span class="comment">// %=</span></span><br><span class="line">                T_XOR_EQUAL,                <span class="comment">// ^=</span></span><br><span class="line">                T_OR_EQUAL,                 <span class="comment">// |=</span></span><br><span class="line">                T_SL,                       <span class="comment">// &lt;&lt;</span></span><br><span class="line">                T_SR,                       <span class="comment">// &gt;&gt;</span></span><br><span class="line">                T_SL_EQUAL,                 <span class="comment">// &lt;&lt;=</span></span><br><span class="line">                T_SR_EQUAL,                 <span class="comment">// &gt;&gt;=</span></span><br><span class="line">            );</span><br><span class="line">            $tokens = token_get_all($src);</span><br><span class="line"></span><br><span class="line">            $new = <span class="string">""</span>;</span><br><span class="line">            $c = sizeof($tokens);</span><br><span class="line">            $iw = <span class="keyword">false</span>; <span class="comment">// ignore whitespace</span></span><br><span class="line">            $ih = <span class="keyword">false</span>; <span class="comment">// in HEREDOC</span></span><br><span class="line">            $ls = <span class="string">""</span>;    <span class="comment">// last sign</span></span><br><span class="line">            $ot = <span class="keyword">null</span>;  <span class="comment">// open tag</span></span><br><span class="line">            <span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; $c; $i++) &#123;</span><br><span class="line">                $token = $tokens[$i];</span><br><span class="line">                <span class="keyword">if</span>(is_array($token)) &#123;</span><br><span class="line">                    <span class="keyword">list</span>($tn, $ts) = $token; <span class="comment">// tokens: number, string, line</span></span><br><span class="line">                    $tname = token_name($tn);</span><br><span class="line">                    <span class="keyword">if</span>($tn == T_INLINE_HTML) &#123;</span><br><span class="line">                        $new .= $ts;</span><br><span class="line">                        $iw = <span class="keyword">false</span>;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">if</span>($tn == T_OPEN_TAG) &#123;</span><br><span class="line">                            <span class="keyword">if</span>(strpos($ts, <span class="string">" "</span>) || strpos($ts, <span class="string">"\n"</span>) || strpos($ts, <span class="string">"\t"</span>) || strpos($ts, <span class="string">"\r"</span>)) &#123;</span><br><span class="line">                                $ts = rtrim($ts);</span><br><span class="line">                            &#125;</span><br><span class="line">                            $ts .= <span class="string">" "</span>;</span><br><span class="line">                            $new .= $ts;</span><br><span class="line">                            $ot = T_OPEN_TAG;</span><br><span class="line">                            $iw = <span class="keyword">true</span>;</span><br><span class="line">                        &#125; <span class="keyword">elseif</span>($tn == T_OPEN_TAG_WITH_ECHO) &#123;</span><br><span class="line">                            $new .= $ts;</span><br><span class="line">                            $ot = T_OPEN_TAG_WITH_ECHO;</span><br><span class="line">                            $iw = <span class="keyword">true</span>;</span><br><span class="line">                        &#125; <span class="keyword">elseif</span>($tn == T_CLOSE_TAG) &#123;</span><br><span class="line">                            <span class="keyword">if</span>($ot == T_OPEN_TAG_WITH_ECHO) &#123;</span><br><span class="line">                                $new = rtrim($new, <span class="string">"; "</span>);</span><br><span class="line">                            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                                $ts = <span class="string">" "</span>.$ts;</span><br><span class="line">                            &#125;</span><br><span class="line">                            $new .= $ts;</span><br><span class="line">                            $ot = <span class="keyword">null</span>;</span><br><span class="line">                            $iw = <span class="keyword">false</span>;</span><br><span class="line">                        &#125; <span class="keyword">elseif</span>(in_array($tn, $IW)) &#123;</span><br><span class="line">                            $new .= $ts;</span><br><span class="line">                            $iw = <span class="keyword">true</span>;</span><br><span class="line">                        &#125; <span class="keyword">elseif</span>($tn == T_CONSTANT_ENCAPSED_STRING</span><br><span class="line">                            || $tn == T_ENCAPSED_AND_WHITESPACE)</span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="keyword">if</span>($ts[<span class="number">0</span>] == <span class="string">'"'</span>) &#123;</span><br><span class="line">                                $ts = addcslashes($ts, <span class="string">"\n\t\r"</span>);</span><br><span class="line">                            &#125;</span><br><span class="line">                            $new .= $ts;</span><br><span class="line">                            $iw = <span class="keyword">true</span>;</span><br><span class="line">                        &#125; <span class="keyword">elseif</span>($tn == T_WHITESPACE) &#123;</span><br><span class="line">                            $nt = @$tokens[$i+<span class="number">1</span>];</span><br><span class="line">                            <span class="keyword">if</span>(!$iw &amp;&amp; (!is_string($nt) || $nt == <span class="string">'$'</span>) &amp;&amp; !in_array($nt[<span class="number">0</span>], $IW)) &#123;</span><br><span class="line">                                $new .= <span class="string">" "</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                            $iw = <span class="keyword">false</span>;</span><br><span class="line">                        &#125; <span class="keyword">elseif</span>($tn == T_START_HEREDOC) &#123;</span><br><span class="line">                            $new .= <span class="string">"&lt;&lt;&lt;S\n"</span>;</span><br><span class="line">                            $iw = <span class="keyword">false</span>;</span><br><span class="line">                            $ih = <span class="keyword">true</span>; <span class="comment">// in HEREDOC</span></span><br><span class="line">                        &#125; <span class="keyword">elseif</span>($tn == T_END_HEREDOC) &#123;</span><br><span class="line">                            $new .= <span class="string">"S;"</span>;</span><br><span class="line">                            $iw = <span class="keyword">true</span>;</span><br><span class="line">                            $ih = <span class="keyword">false</span>; <span class="comment">// in HEREDOC</span></span><br><span class="line">                            <span class="keyword">for</span>($j = $i+<span class="number">1</span>; $j &lt; $c; $j++) &#123;</span><br><span class="line">                                <span class="keyword">if</span>(is_string($tokens[$j]) &amp;&amp; $tokens[$j] == <span class="string">";"</span>) &#123;</span><br><span class="line">                                    $i = $j;</span><br><span class="line">                                    <span class="keyword">break</span>;</span><br><span class="line">                                &#125; <span class="keyword">else</span> <span class="keyword">if</span>($tokens[$j][<span class="number">0</span>] == T_CLOSE_TAG) &#123;</span><br><span class="line">                                    <span class="keyword">break</span>;</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125; <span class="keyword">elseif</span>($tn == T_COMMENT || $tn == T_DOC_COMMENT) &#123;</span><br><span class="line">                            $iw = <span class="keyword">true</span>;</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            <span class="keyword">if</span>(!$ih) &#123;</span><br><span class="line">                                $ts = strtolower($ts);</span><br><span class="line">                            &#125;</span><br><span class="line">                            $new .= $ts;</span><br><span class="line">                            $iw = <span class="keyword">false</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    $ls = <span class="string">""</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span>(($token != <span class="string">";"</span> &amp;&amp; $token != <span class="string">":"</span>) || $ls != $token) &#123;</span><br><span class="line">                        $new .= $token;</span><br><span class="line">                        $ls = $token;</span><br><span class="line">                    &#125;</span><br><span class="line">                    $iw = <span class="keyword">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> $new;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> php </tag>
            
            <tag> åŠ å¯† </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>èº«ä»½è¯å·ç éªŒè¯çš„å‡ ä¸ªå®ç”¨å‡½æ•°</title>
      <link href="/cn-idcard-validate-function-in-javascript/"/>
      <url>/cn-idcard-validate-function-in-javascript/</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘éœ€è¦å¯¹èº«ä»½è¯åˆæ³•æ€§è¿›è¡ŒéªŒè¯ï¼Œå®åéªŒè¯æ˜¯ä¸æŒ‡æœ›äº†ï¼Œä¸è¿‡åŸæ¥çš„éªŒè¯è§„åˆ™å¤ªè¿‡ç®€å•ï¼Œåªæ˜¯ç®€å•çš„éªŒè¯äº†èº«ä»½è¯é•¿åº¦ï¼Œç°åœ¨ä¸šåŠ¡éœ€è¦åŠ å¼ºä¸‹èº«ä»½è¯éªŒè¯è§„åˆ™ï¼Œç½‘ä¸Šæ‰¾åˆ°äº†ä¸å°‘èµ„æ–™ï¼Œä¸è¿‡éƒ½ä¸åˆå¶çš„å¿ƒæ„ï¼Œæ— å¥ˆåªå¥½ç›´æ¥å†™ä¸€ä¸ªï¼Œä»£ç è¿˜æ˜¯ç”¨è‡ªå·±çš„èˆ’æœå“ˆã€‚</p><a id="more"></a><h2 id="èº«ä»½è¯å·ç æœ‰æ•ˆæ€§éªŒè¯"><a href="#èº«ä»½è¯å·ç æœ‰æ•ˆæ€§éªŒè¯" class="headerlink" title="èº«ä»½è¯å·ç æœ‰æ•ˆæ€§éªŒè¯"></a>èº«ä»½è¯å·ç æœ‰æ•ˆæ€§éªŒè¯</h2><p>JavaScript ä»£ç :</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isIDCard</span>(<span class="params">idcard</span>) </span>&#123;</span><br><span class="line">    idcard = idcard.toUpperCase(); <span class="comment">// å¯¹èº«ä»½è¯å·ç åšå¤„ç†</span></span><br><span class="line">    <span class="keyword">var</span> ereg;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> Y, JYM;</span><br><span class="line">    <span class="keyword">var</span> S, M;</span><br><span class="line">    <span class="comment">/*åŸºæœ¬æ ¡éªŒ*/</span></span><br><span class="line">    <span class="comment">//if (String.isNullOrEmpty(idcard)) return false;</span></span><br><span class="line">    <span class="keyword">var</span> idcard_array = <span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line">    idcard_array = idcard.split(<span class="string">""</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*èº«ä»½å·ç ä½æ•°åŠæ ¼å¼æ£€éªŒ*/</span></span><br><span class="line">    <span class="keyword">switch</span> (idcard.length) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">15</span>:</span><br><span class="line">            <span class="keyword">if</span> ((<span class="built_in">parseInt</span>(idcard.substr(<span class="number">6</span>, <span class="number">2</span>)) + <span class="number">1900</span>) % <span class="number">4</span> == <span class="number">0</span> || ((<span class="built_in">parseInt</span>(idcard.substr(<span class="number">6</span>, <span class="number">2</span>)) + <span class="number">1900</span>) % <span class="number">100</span> == <span class="number">0</span> &amp;&amp; (<span class="built_in">parseInt</span>(idcard.substr(<span class="number">6</span>, <span class="number">2</span>)) + <span class="number">1900</span>) % <span class="number">4</span> == <span class="number">0</span>)) &#123;</span><br><span class="line">                ereg = <span class="regexp">/^[1-9][0-9]&#123;5&#125;[0-9]&#123;2&#125;((01|03|05|07|08|10|12)(0[1-9]|[1-2][0-9]|3[0-1])|(04|06|09|11)(0[1-9]|[1-2][0-9]|30)|02(0[1-9]|[1-2][0-9]))[0-9]&#123;3&#125;$/</span>; <span class="comment">//æµ‹è¯•å‡ºç”Ÿæ—¥æœŸçš„åˆæ³•æ€§</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                ereg = <span class="regexp">/^[1-9][0-9]&#123;5&#125;[0-9]&#123;2&#125;((01|03|05|07|08|10|12)(0[1-9]|[1-2][0-9]|3[0-1])|(04|06|09|11)(0[1-9]|[1-2][0-9]|30)|02(0[1-9]|1[0-9]|2[0-8]))[0-9]&#123;3&#125;$/</span>; <span class="comment">//æµ‹è¯•å‡ºç”Ÿæ—¥æœŸçš„åˆæ³•æ€§</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (ereg.test(idcard)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">18</span>:</span><br><span class="line">            <span class="comment">//18ä½èº«ä»½å·ç æ£€æµ‹</span></span><br><span class="line">            <span class="comment">//å‡ºç”Ÿæ—¥æœŸçš„åˆæ³•æ€§æ£€æŸ¥</span></span><br><span class="line">            <span class="comment">//é—°å¹´æœˆæ—¥:((01|03|05|07|08|10|12)(0[1-9]|[1-2][0-9]|3[0-1])|(04|06|09|11)(0[1-9]|[1-2][0-9]|30)|02(0[1-9]|[1-2][0-9]))</span></span><br><span class="line">            <span class="comment">//å¹³å¹´æœˆæ—¥:((01|03|05|07|08|10|12)(0[1-9]|[1-2][0-9]|3[0-1])|(04|06|09|11)(0[1-9]|[1-2][0-9]|30)|02(0[1-9]|1[0-9]|2[0-8]))</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">parseInt</span>(idcard.substr(<span class="number">6</span>, <span class="number">4</span>)) % <span class="number">4</span> == <span class="number">0</span> || (<span class="built_in">parseInt</span>(idcard.substr(<span class="number">6</span>, <span class="number">4</span>)) % <span class="number">100</span> == <span class="number">0</span> &amp;&amp; <span class="built_in">parseInt</span>(idcard.substr(<span class="number">6</span>, <span class="number">4</span>)) % <span class="number">4</span> == <span class="number">0</span>)) &#123;</span><br><span class="line">                ereg = <span class="regexp">/^[1-9][0-9]&#123;5&#125;19[0-9]&#123;2&#125;((01|03|05|07|08|10|12)(0[1-9]|[1-2][0-9]|3[0-1])|(04|06|09|11)(0[1-9]|[1-2][0-9]|30)|02(0[1-9]|[1-2][0-9]))[0-9]&#123;3&#125;[0-9XxAa]$/</span>; <span class="comment">//é—°å¹´å‡ºç”Ÿæ—¥æœŸçš„åˆæ³•æ€§æ­£åˆ™è¡¨è¾¾å¼</span></span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                ereg = <span class="regexp">/^[1-9][0-9]&#123;5&#125;19[0-9]&#123;2&#125;((01|03|05|07|08|10|12)(0[1-9]|[1-2][0-9]|3[0-1])|(04|06|09|11)(0[1-9]|[1-2][0-9]|30)|02(0[1-9]|1[0-9]|2[0-8]))[0-9]&#123;3&#125;[0-9XxAa]$/</span>; <span class="comment">//å¹³å¹´å‡ºç”Ÿæ—¥æœŸçš„åˆæ³•æ€§æ­£åˆ™è¡¨è¾¾å¼</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (ereg.test(idcard)) &#123;<span class="comment">//æµ‹è¯•å‡ºç”Ÿæ—¥æœŸçš„åˆæ³•æ€§</span></span><br><span class="line">                <span class="comment">//è®¡ç®—æ ¡éªŒä½</span></span><br><span class="line">                S = (<span class="built_in">parseInt</span>(idcard_array[<span class="number">0</span>]) + <span class="built_in">parseInt</span>(idcard_array[<span class="number">10</span>])) * <span class="number">7</span></span><br><span class="line">                    + (<span class="built_in">parseInt</span>(idcard_array[<span class="number">1</span>]) + <span class="built_in">parseInt</span>(idcard_array[<span class="number">11</span>])) * <span class="number">9</span></span><br><span class="line">                    + (<span class="built_in">parseInt</span>(idcard_array[<span class="number">2</span>]) + <span class="built_in">parseInt</span>(idcard_array[<span class="number">12</span>])) * <span class="number">10</span></span><br><span class="line">                    + (<span class="built_in">parseInt</span>(idcard_array[<span class="number">3</span>]) + <span class="built_in">parseInt</span>(idcard_array[<span class="number">13</span>])) * <span class="number">5</span></span><br><span class="line">                    + (<span class="built_in">parseInt</span>(idcard_array[<span class="number">4</span>]) + <span class="built_in">parseInt</span>(idcard_array[<span class="number">14</span>])) * <span class="number">8</span></span><br><span class="line">                    + (<span class="built_in">parseInt</span>(idcard_array[<span class="number">5</span>]) + <span class="built_in">parseInt</span>(idcard_array[<span class="number">15</span>])) * <span class="number">4</span></span><br><span class="line">                    + (<span class="built_in">parseInt</span>(idcard_array[<span class="number">6</span>]) + <span class="built_in">parseInt</span>(idcard_array[<span class="number">16</span>])) * <span class="number">2</span></span><br><span class="line">                    + <span class="built_in">parseInt</span>(idcard_array[<span class="number">7</span>]) * <span class="number">1</span></span><br><span class="line">                    + <span class="built_in">parseInt</span>(idcard_array[<span class="number">8</span>]) * <span class="number">6</span></span><br><span class="line">                    + <span class="built_in">parseInt</span>(idcard_array[<span class="number">9</span>]) * <span class="number">3</span>;</span><br><span class="line">                Y = S % <span class="number">11</span>;</span><br><span class="line">                M = <span class="string">"F"</span>;</span><br><span class="line">                JYM = <span class="string">"10X98765432"</span>;</span><br><span class="line">                M = JYM.substr(Y, <span class="number">1</span>);</span><br><span class="line">                <span class="comment">/*åˆ¤æ–­æ ¡éªŒä½*/</span></span><br><span class="line">                <span class="keyword">if</span> (M == idcard_array[<span class="number">17</span>]) &#123;  <span class="comment">/*æ£€æµ‹IDçš„æ ¡éªŒä½false;*/</span></span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (idcard_array[<span class="number">17</span>] == <span class="string">'A'</span>) &#123;<span class="comment">//Aç»“å°¾ä¸æ ¡éªŒè§„åˆ™</span></span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                    <span class="comment">/*æ£€æµ‹IDçš„æ ¡éªŒä½false;*/</span></span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä»èº«ä»½è¯å·ç ä¸­è·å–ç›¸å…³ä¿¡æ¯ï¼Œæ¯”å¦‚ç”Ÿæ—¥ã€çœ"><a href="#ä»èº«ä»½è¯å·ç ä¸­è·å–ç›¸å…³ä¿¡æ¯ï¼Œæ¯”å¦‚ç”Ÿæ—¥ã€çœ" class="headerlink" title="ä»èº«ä»½è¯å·ç ä¸­è·å–ç›¸å…³ä¿¡æ¯ï¼Œæ¯”å¦‚ç”Ÿæ—¥ã€çœ"></a>ä»èº«ä»½è¯å·ç ä¸­è·å–ç›¸å…³ä¿¡æ¯ï¼Œæ¯”å¦‚ç”Ÿæ—¥ã€çœ</h2><p>JavaScript ä»£ç :</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkID</span>(<span class="params">ID</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">typeof</span> ID !== <span class="string">'string'</span>) <span class="keyword">return</span> <span class="string">'éæ³•å­—ç¬¦ä¸²'</span>;</span><br><span class="line">    <span class="keyword">var</span> city = &#123;<span class="number">11</span>:<span class="string">"åŒ—äº¬"</span>,<span class="number">12</span>:<span class="string">"å¤©æ´¥"</span>,<span class="number">13</span>:<span class="string">"æ²³åŒ—"</span>,<span class="number">14</span>:<span class="string">"å±±è¥¿"</span>,<span class="number">15</span>:<span class="string">"å†…è’™å¤"</span>,<span class="number">21</span>:<span class="string">"è¾½å®"</span>,<span class="number">22</span>:<span class="string">"å‰æ—"</span>,<span class="number">23</span>:<span class="string">"é»‘é¾™æ±Ÿ "</span>,<span class="number">31</span>:<span class="string">"ä¸Šæµ·"</span>,<span class="number">32</span>:<span class="string">"æ±Ÿè‹"</span>,<span class="number">33</span>:<span class="string">"æµ™æ±Ÿ"</span>,<span class="number">34</span>:<span class="string">"å®‰å¾½"</span>,<span class="number">35</span>:<span class="string">"ç¦å»º"</span>,<span class="number">36</span>:<span class="string">"æ±Ÿè¥¿"</span>,<span class="number">37</span>:<span class="string">"å±±ä¸œ"</span>,<span class="number">41</span>:<span class="string">"æ²³å—"</span>,<span class="number">42</span>:<span class="string">"æ¹–åŒ— "</span>,<span class="number">43</span>:<span class="string">"æ¹–å—"</span>,<span class="number">44</span>:<span class="string">"å¹¿ä¸œ"</span>,<span class="number">45</span>:<span class="string">"å¹¿è¥¿"</span>,<span class="number">46</span>:<span class="string">"æµ·å—"</span>,<span class="number">50</span>:<span class="string">"é‡åº†"</span>,<span class="number">51</span>:<span class="string">"å››å·"</span>,<span class="number">52</span>:<span class="string">"è´µå·"</span>,<span class="number">53</span>:<span class="string">"äº‘å—"</span>,<span class="number">54</span>:<span class="string">"è¥¿è— "</span>,<span class="number">61</span>:<span class="string">"é™•è¥¿"</span>,<span class="number">62</span>:<span class="string">"ç”˜è‚ƒ"</span>,<span class="number">63</span>:<span class="string">"é’æµ·"</span>,<span class="number">64</span>:<span class="string">"å®å¤"</span>,<span class="number">65</span>:<span class="string">"æ–°ç–†"</span>,<span class="number">71</span>:<span class="string">"å°æ¹¾"</span>,<span class="number">81</span>:<span class="string">"é¦™æ¸¯"</span>,<span class="number">82</span>:<span class="string">"æ¾³é—¨"</span>,<span class="number">91</span>:<span class="string">"å›½å¤–"</span>&#125;;</span><br><span class="line">    <span class="keyword">var</span> birthday = ID.substr(<span class="number">6</span>, <span class="number">4</span>) + <span class="string">'/'</span> + <span class="built_in">Number</span>(ID.substr(<span class="number">10</span>, <span class="number">2</span>)) + <span class="string">'/'</span> + <span class="built_in">Number</span>(ID.substr(<span class="number">12</span>, <span class="number">2</span>));</span><br><span class="line">    <span class="keyword">var</span> d = <span class="keyword">new</span> <span class="built_in">Date</span>(birthday);</span><br><span class="line">    <span class="keyword">var</span> newBirthday = d.getFullYear() + <span class="string">'/'</span> + <span class="built_in">Number</span>(d.getMonth() + <span class="number">1</span>) + <span class="string">'/'</span> + <span class="built_in">Number</span>(d.getDate());</span><br><span class="line">    <span class="keyword">var</span> currentTime = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime();</span><br><span class="line">    <span class="keyword">var</span> time = d.getTime();</span><br><span class="line">    <span class="keyword">var</span> arrInt = [<span class="number">7</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">4</span>, <span class="number">2</span>];</span><br><span class="line">    <span class="keyword">var</span> arrCh = [<span class="string">'1'</span>, <span class="string">'0'</span>, <span class="string">'X'</span>, <span class="string">'9'</span>, <span class="string">'8'</span>, <span class="string">'7'</span>, <span class="string">'6'</span>, <span class="string">'5'</span>, <span class="string">'4'</span>, <span class="string">'3'</span>, <span class="string">'2'</span>];</span><br><span class="line">    <span class="keyword">var</span> sum = <span class="number">0</span>, i, residue;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!<span class="regexp">/^\d&#123;17&#125;(\d|x)$/i</span>.test(ID)) <span class="keyword">return</span> <span class="string">'éæ³•èº«ä»½è¯'</span>;</span><br><span class="line">    <span class="keyword">if</span>(city[ID.substr(<span class="number">0</span>,<span class="number">2</span>)] === <span class="literal">undefined</span>) <span class="keyword">return</span> <span class="string">"éæ³•åœ°åŒº"</span>;</span><br><span class="line">    <span class="keyword">if</span>(time &gt;= currentTime || birthday !== newBirthday) <span class="keyword">return</span> <span class="string">'éæ³•ç”Ÿæ—¥'</span>;</span><br><span class="line">    <span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;<span class="number">17</span>; i++) &#123;</span><br><span class="line">      sum += ID.substr(i, <span class="number">1</span>) * arrInt[i];</span><br><span class="line">    &#125;</span><br><span class="line">    residue = arrCh[sum % <span class="number">11</span>];</span><br><span class="line">    <span class="keyword">if</span> (residue !== ID.substr(<span class="number">17</span>, <span class="number">1</span>)) <span class="keyword">return</span> <span class="string">'éæ³•èº«ä»½è¯å“¦'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> city[ID.substr(<span class="number">0</span>,<span class="number">2</span>)]+<span class="string">","</span>+birthday+<span class="string">","</span>+(ID.substr(<span class="number">16</span>,<span class="number">1</span>)%<span class="number">2</span>?<span class="string">" ç”·"</span>:<span class="string">"å¥³"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="éªŒè¯é¦™æ¸¯èº«ä»½è¯çš„æ ¼å¼æˆ–çœŸå®æ€§"><a href="#éªŒè¯é¦™æ¸¯èº«ä»½è¯çš„æ ¼å¼æˆ–çœŸå®æ€§" class="headerlink" title="éªŒè¯é¦™æ¸¯èº«ä»½è¯çš„æ ¼å¼æˆ–çœŸå®æ€§"></a>éªŒè¯é¦™æ¸¯èº«ä»½è¯çš„æ ¼å¼æˆ–çœŸå®æ€§</h2><p>JavaScript ä»£ç :</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">IsHKID</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> strValidChars = <span class="string">"ABCDEFGHIJKLMNOPQRSTUVWXYZ"</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// basic check length</span></span><br><span class="line">    <span class="keyword">if</span> (str.length &lt; <span class="number">8</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// handling bracket</span></span><br><span class="line">    <span class="keyword">if</span> (str.charAt(str.length<span class="number">-3</span>) == <span class="string">'('</span> &amp;&amp; str.charAt(str.length<span class="number">-1</span>) == <span class="string">')'</span>)</span><br><span class="line">        str = str.substring(<span class="number">0</span>, str.length - <span class="number">3</span>) + str.charAt(str.length <span class="number">-2</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// convert to upper case</span></span><br><span class="line">    str = str.toUpperCase();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// regular expression to check pattern and split</span></span><br><span class="line">    <span class="keyword">var</span> hkidPat = <span class="regexp">/^([A-Z]&#123;1,2&#125;)([0-9]&#123;6&#125;)([A0-9])$/</span>;</span><br><span class="line">    <span class="keyword">var</span> matchArray = str.match(hkidPat);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// not match, return false</span></span><br><span class="line">    <span class="keyword">if</span> (matchArray == <span class="literal">null</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// the character part, numeric part and check digit part</span></span><br><span class="line">    <span class="keyword">var</span> charPart = matchArray[<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">var</span> numPart = matchArray[<span class="number">2</span>];</span><br><span class="line">    <span class="keyword">var</span> checkDigit = matchArray[<span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// calculate the checksum for character part</span></span><br><span class="line">    <span class="keyword">var</span> checkSum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (charPart.length == <span class="number">2</span>) &#123;</span><br><span class="line">        checkSum += <span class="number">9</span> * (<span class="number">10</span> + strValidChars.indexOf(charPart.charAt(<span class="number">0</span>)));</span><br><span class="line">        checkSum += <span class="number">8</span> * (<span class="number">10</span> + strValidChars.indexOf(charPart.charAt(<span class="number">1</span>)));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        checkSum += <span class="number">9</span> * <span class="number">36</span>;</span><br><span class="line">        checkSum += <span class="number">8</span> * (<span class="number">10</span> + strValidChars.indexOf(charPart));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// calculate the checksum for numeric part</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, j = <span class="number">7</span>; i &lt; numPart.length; i++, j--)</span><br><span class="line">        checkSum += j * numPart.charAt(i);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// verify the check digit</span></span><br><span class="line">    <span class="keyword">var</span> remaining = checkSum % <span class="number">11</span>;</span><br><span class="line">    <span class="keyword">var</span> verify = remaining == <span class="number">0</span> ? <span class="number">0</span> : <span class="number">11</span> - remaining;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> verify == checkDigit || (verify == <span class="number">10</span> &amp;&amp; checkDigit == <span class="string">'A'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ç½‘ä¸Šæ‰¾äº†å¾ˆä¹…éƒ½æ²¡åˆæ„çš„éªŒè¯æ–¹å¼ï¼Œæœ€åé€šè¿‡Googleæ‰¾åˆ°ä¸€ä¸ªå›½å¤–å†™çš„jséªŒè¯ï¼Œå‘ç°å¯ä»¥ä½¿ç”¨ã€‚</p><p>ä¸Šé¢é‚£æ®µéªŒè¯çš„å¾ˆç²¾å¯†ï¼ŒåŒ…å«èº«ä»½è¯çœŸå®æ€§çš„æ ¡éªŒï¼Œå¦‚æœåªæ˜¯æƒ³éªŒè¯è¾“å…¥çš„é¦™æ¸¯èº«ä»½è¯æ ¼å¼ï¼Œè¯·ä½¿ç”¨ä¸‹é¢çš„è¿™æ®µjsã€‚</p><p>JavaScript ä»£ç :</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">IsHKID</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> strValidChars = <span class="string">"ABCDEFGHIJKLMNOPQRSTUVWXYZ"</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// basic check length</span></span><br><span class="line">    <span class="keyword">if</span> (str.length &lt; <span class="number">8</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// handling bracket</span></span><br><span class="line">    <span class="keyword">if</span> (str.charAt(str.length<span class="number">-3</span>) == <span class="string">'('</span> &amp;&amp; str.charAt(str.length<span class="number">-1</span>) == <span class="string">')'</span>)</span><br><span class="line">        str = str.substring(<span class="number">0</span>, str.length - <span class="number">3</span>) + str.charAt(str.length <span class="number">-2</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// convert to upper case</span></span><br><span class="line">    str = str.toUpperCase();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// regular expression to check pattern and split</span></span><br><span class="line">    <span class="keyword">var</span> hkidPat = <span class="regexp">/^([A-Z]&#123;1,2&#125;)([0-9]&#123;6&#125;)([A0-9])$/</span>;</span><br><span class="line">    <span class="keyword">var</span> matchArray = str.match(hkidPat);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// not match, return false</span></span><br><span class="line">    <span class="keyword">if</span> (matchArray == <span class="literal">null</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>æ¸¯æ¾³å±…æ°‘æ¥å¾€å†…åœ°é€šè¡Œè¯å·ç ç›®å‰å¥½åƒæ²¡æœ‰å¥½çš„åŠæ³•éªŒè¯ï¼Œè¿™é‡Œæä¾›ä¸€ä¸ªç®€å•çš„æ­£åˆ™ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/^([A-Z]\d&#123;<span class="number">6</span>,<span class="number">10</span>&#125;(\(\w&#123;<span class="number">1</span>&#125;\))?)$/</span><br></pre></td></tr></table></figure><p>æœ€åè¿™é‡Œæä¾›ä¸€ä¸ªéªŒè¯ä¸­å›½ï¼Œé¦™æ¸¯ï¼Œå°æ¹¾å’ŒéŸ©å›½èº«ä»½è¯çš„ JavaScript åº“ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Edditoria / validid</span><br><span class="line">A Javascript library to validate ID card numbers <span class="keyword">of</span> China, Taiwan, Hong Kong and South Korea</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> å‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> javascript </tag>
            
            <tag> idcard </tag>
            
            <tag> èº«ä»½è¯ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è§£å†³PHPè¾“å‡ºUTF-8ç¼–ç çš„csvä¹±ç é—®é¢˜</title>
      <link href="/fix-utf8-in-csv/"/>
      <url>/fix-utf8-in-csv/</url>
      
        <content type="html"><![CDATA[<p>ä¼—æ‰€å‘¨çŸ¥ï¼ŒUTF-8å·²ç»ä¸€ç»Ÿå¤©ä¸‹äº†ï¼Œä½†æ˜¯å¾®è½¯officeé»˜è®¤ä½¿ç”¨çš„è¿˜ä¸æ˜¯å®ƒï¼Œç»å¸¸åœ¨ä½¿ç”¨ç¨‹åºç”ŸæˆCSVçš„æ—¶å€™æ€»æ˜¯çœ‹åˆ°çš„æ˜¯ä¹±ç ï¼Œå…¶å®officeå¹¶éé¡½å›ºåˆ†å­ï¼Œåœ¨æ—©æœŸç‰ˆæœ¬å·²ç»å¢åŠ äº†å¯¹UTF-8çš„æ”¯æŒï¼Œä½†æ˜¯ä½ è¦å‘Šè¯‰ä»–ï¼Œä½ çš„æ•°æ®æ˜¯UTF-8ã€‚</p><p>æ€ä¹ˆåšå‘¢ï¼Ÿ</p><a id="more"></a><h2 id="PHPå¤„ç†æ–¹å¼"><a href="#PHPå¤„ç†æ–¹å¼" class="headerlink" title="PHPå¤„ç†æ–¹å¼"></a>PHPå¤„ç†æ–¹å¼</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// utf8</span></span><br><span class="line">$fp = fopen(<span class="string">'./test_csv.csv'</span>, <span class="string">'a'</span>);</span><br><span class="line">fwrite($fp,chr(<span class="number">0xEF</span>).chr(<span class="number">0xBB</span>).chr(<span class="number">0xBF</span>));<span class="comment">//è¾“å‡ºBOMå¤´</span></span><br><span class="line">fputcsv($fp, [<span class="string">'æ ‡é¢˜'</span>]);</span><br><span class="line">fputcsv($fp, [<span class="string">'è§£å†³ä¹±ç '</span>]);</span><br><span class="line">fclose($fp);</span><br></pre></td></tr></table></figure><h2 id="å‘½ä»¤è¡Œå¤„ç†æ–¹å¼"><a href="#å‘½ä»¤è¡Œå¤„ç†æ–¹å¼" class="headerlink" title="å‘½ä»¤è¡Œå¤„ç†æ–¹å¼"></a>å‘½ä»¤è¡Œå¤„ç†æ–¹å¼</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">printf</span> <span class="string">'\xEF\xBB\xBFâ€™ &gt; tmp.csv</span></span><br><span class="line"><span class="string">cat your.csv &gt;&gt; tmp.csv</span></span><br><span class="line"><span class="string">mv tmp.csv your.csv</span></span><br></pre></td></tr></table></figure><p>ä½  <code>getâˆš</code> åˆ°äº†å—ï¼Ÿ</p>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> php </tag>
            
            <tag> utf-8 </tag>
            
            <tag> csv </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å®ç°è‡ªå®šä¹‰apkå®‰è£…åŒ…</title>
      <link href="/custom-apk-by-php-ziparchive/"/>
      <url>/custom-apk-by-php-ziparchive/</url>
      
        <content type="html"><![CDATA[<p>éœ€æ±‚ï¼š</p><blockquote><p>çªç„¶æ”¶åˆ°è€å¤§çš„éœ€æ±‚ï¼Œè¦å¯¹äº§å“è¿›è¡Œä¸€æ¬¡æ¨èå¥½å‹å®‰è£…çš„æ´»åŠ¨ï¼Œæ¯ä¸ªä¼šå‘˜ä¸‹è½½è‡ªå·±çš„ä¸“å±å®‰è£…åŒ…ï¼ˆé‡Œé¢è®°å½•ä¼šå‘˜çš„ç›¸å…³ä¿¡æ¯ï¼‰ã€‚</p></blockquote><p>æ€è·¯ï¼š</p><blockquote><p>ç»è¿‡äº†è§£ï¼Œå‘ç°apkå®‰è£…åŒ…åŸæ¥åªæ˜¯zipçš„ä¸€ä¸ªé©¬ç”²ï¼Œä½¿ç”¨phpçš„ZipArchiveç±»å¯ä»¥å¯¹æ–‡ä»¶è¿›è¡Œæ“ä½œã€‚</p></blockquote><a id="more"></a><p>å®ç°ä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æºæ–‡ä»¶</span></span><br><span class="line">$apk    = <span class="string">"gb.apk"</span>;</span><br><span class="line"><span class="comment">// ç”Ÿæˆä¸´æ—¶æ–‡ä»¶</span></span><br><span class="line">$file   = tempnam(<span class="string">"tmp"</span>, <span class="string">"zip"</span>);</span><br><span class="line"><span class="comment">// å¤åˆ¶æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">false</span>===file_put_contents($file, file_get_contents($apk)))&#123;</span><br><span class="line">    <span class="keyword">exit</span>(<span class="string">'copy faild!'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ‰“å¼€ä¸´æ—¶æ–‡ä»¶</span></span><br><span class="line">$zip    = <span class="keyword">new</span> ZipArchive();</span><br><span class="line">$zip-&gt;open($file);</span><br><span class="line"><span class="comment">// æ·»åŠ æ–‡ä»¶</span></span><br><span class="line"><span class="comment">// ç”±äºapké™å®šåªèƒ½ä¿®æ”¹æ­¤ç›®å½•å†…çš„æ–‡ä»¶ï¼Œå¦åˆ™ä¼šæŠ¥æ— æ•ˆapkåŒ…</span></span><br><span class="line">$zip-&gt;addFromString(<span class="string">'META-INF/extends.json'</span>, json_encode(<span class="keyword">array</span>(<span class="string">'author'</span>=&gt;<span class="string">'deeka'</span>)));</span><br><span class="line"><span class="comment">// å…³é—­zip</span></span><br><span class="line">$zip-&gt;close();</span><br><span class="line"><span class="comment">// ä¸‹è½½æ–‡ä»¶</span></span><br><span class="line">header(<span class="string">"Content-Type: application/zip"</span>);</span><br><span class="line">header(<span class="string">"Content-Length: "</span> . filesize($file));</span><br><span class="line">header(<span class="string">"Content-Disposition: attachment; filename=\"&#123;$apk&#125;\""</span>);</span><br><span class="line"><span class="comment">// è¾“å‡ºäºŒè¿›åˆ¶æµ</span></span><br><span class="line">readfile($file);</span><br><span class="line"><span class="comment">// åˆ é™¤ä¸´æ—¶æ–‡ä»¶</span></span><br><span class="line">unlink($file);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> php </tag>
            
            <tag> zip </tag>
            
            <tag> ziparchive </tag>
            
            <tag> apk </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é˜²å¾¡æ€§ç¼–ç¨‹</title>
      <link href="/defensive-programming/"/>
      <url>/defensive-programming/</url>
      
        <content type="html"><![CDATA[<p>åœ¨å…¬å¸ï¼Œæˆ‘ä»¬ç¢°åˆ°çš„å¾ˆå¤§ä¸€éƒ¨åˆ†é—®é¢˜éƒ½æ˜¯NullPointerExceptionã€‚æˆ‘å¸¸å¸¸å°±æƒ³ï¼šè¿™æ®µç¨‹åºæ˜æ˜åœ¨æˆ‘ç”µè„‘è¿è¡Œå¥½å¥½çš„ï¼Œä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ç§æƒ…å†µå‘¢ï¼Ÿ<br>å› ä¸ºï¼Œæˆ‘ä»¬æ°¸è¿œéƒ½æ— æ³•é¢„æµ‹ç”¨æˆ·ä½¿ç”¨æ—¶ä¼šå‘ç”Ÿçš„å„ç§æƒ…å†µã€‚æ‰€ä»¥é˜²å¾¡æ€§ç¼–ç¨‹å¯ä»¥è®©æˆ‘ä»¬å‡å°‘å¾ˆå¤§ä¸€éƒ¨åˆ†é”™è¯¯ã€‚</p><a id="more"></a><h2 id="å¼€å§‹ä¹‹å‰å…ˆçœ‹è¿™æ®µä»£ç "><a href="#å¼€å§‹ä¹‹å‰å…ˆçœ‹è¿™æ®µä»£ç " class="headerlink" title="å¼€å§‹ä¹‹å‰å…ˆçœ‹è¿™æ®µä»£ç "></a>å¼€å§‹ä¹‹å‰å…ˆçœ‹è¿™æ®µä»£ç </h2><p>éœ€æ±‚ï¼š å°†å­—ç¬¦ä¸²è½¬æ¢æˆä¸€ä¸ªæ•°å­—ï¼Œå¦‚â€12345â€(string)è½¬ä¸º12345(int)ã€‚<br>ä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">atoi</span><span class="params">($a)</span></span>&#123;</span><br><span class="line">    $len    = strlen($a);</span><br><span class="line">    $num    = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>($i=$len<span class="number">-1</span>; $i&gt;=<span class="number">0</span>; $i--)&#123;</span><br><span class="line">        $num    += ($a&#123;$i&#125;<span class="number">-0</span>) * pow(<span class="number">10</span>, $len-$i<span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $num;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é—®é¢˜ï¼š</p><ul><li>å¦‚æœä¼ è¿›æ¥ä¸€ä¸ªè´Ÿæ•°ç»“æœæ˜¯ä»€ä¹ˆï¼Ÿæ¯”å¦‚ï¼šâ€-123456â€ã€‚</li><li>å¦‚æœä¼ è¿›æ¥ä¸€ä¸ªnullæˆ–falseä¼šæ€ä¹ˆæ ·ï¼Ÿï¼ˆphpè¿”å›çš„ç»“æœéƒ½æ˜¯0ï¼Œè²Œä¼¼æ²¡é”™ï¼‰</li></ul><p>æç„¶å¤§æ‚Ÿï¼ï¼ï¼å¤ªå¤šä¸œè¥¿æ²¡è€ƒè™‘ï¼ï¼ï¼</p><h2 id="ä»€ä¹ˆæ˜¯é˜²å¾¡æ€§ç¼–ç¨‹"><a href="#ä»€ä¹ˆæ˜¯é˜²å¾¡æ€§ç¼–ç¨‹" class="headerlink" title="ä»€ä¹ˆæ˜¯é˜²å¾¡æ€§ç¼–ç¨‹"></a>ä»€ä¹ˆæ˜¯é˜²å¾¡æ€§ç¼–ç¨‹</h2><blockquote><p>é¡¾åæ€ä¹‰ï¼Œé˜²å¾¡æ€§ç¼–ç¨‹ï¼ˆDefensive programmingï¼‰æ˜¯ä¸€ç§ç»†è‡´ã€è°¨æ…çš„ç¼–ç¨‹æ–¹æ³•ã€‚<br>é˜²å¾¡å¼ç¼–ç¨‹ä¸»è¦ç”¨äºå¯èƒ½è¢«æ»¥ç”¨ï¼Œæ¶ä½œå‰§æˆ–æ— æ„åœ°é€ æˆç¾éš¾æ€§å½±å“çš„ç¨‹åºä¸Šã€‚<br>é˜²å¾¡æ€§ç¼–ç¨‹æ˜¯ä¸€ç§é˜²å«æ–¹å¼ï¼Œè€Œä¸æ˜¯ä¸€ç§è¡¥æ•‘å½¢å¼ã€‚</p></blockquote><h2 id="å¦‚ä½•å†™é˜²å¾¡æ€§ä»£ç å‘¢"><a href="#å¦‚ä½•å†™é˜²å¾¡æ€§ä»£ç å‘¢" class="headerlink" title="å¦‚ä½•å†™é˜²å¾¡æ€§ä»£ç å‘¢"></a>å¦‚ä½•å†™é˜²å¾¡æ€§ä»£ç å‘¢</h2><p>çœ‹çœ‹è¿™æ ·ä¼šä¸ä¼šå¥½ä¸€äº›ï¼Ÿ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">atoi</span><span class="params">($a)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(is_null($a)) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="keyword">Exception</span>(<span class="string">'$a is null'</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">false</span>===$a) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="keyword">Exception</span>(<span class="string">'$a is false'</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="number">0</span>==strlen($a)) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="keyword">Exception</span>(<span class="string">'$a is empty string'</span>);</span><br><span class="line">    $len    = strlen($a);</span><br><span class="line">    $num    = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>($i=$len<span class="number">-1</span>; $i&gt;=<span class="number">0</span>; $i--)&#123;</span><br><span class="line">        $num    += ($a&#123;$i&#125;<span class="number">-0</span>) * pow(<span class="number">10</span>, $len-$i<span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $num;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡è¦çš„ç»éªŒå°±æ˜¯ï¼š<br>å½“ä½ å†™ä¸€ä¸ªæ–¹æ³•éœ€è¦å¯¹ä¼ å…¥çš„å‚æ•°è¿›è¡Œå¤„ç†æˆ–è€…è®¡ç®—çš„æ—¶å€™ï¼Œä½ å¿…é¡»è¦ä¸¥æ ¼éªŒè¯ä¼ å…¥å‚æ•°çš„æ­£ç¡®æ€§ï¼Œå¦‚æœä¸ç¬¦åˆï¼Œå°±åº”å½“ç»™å‡ºæç¤ºï¼<br>é˜²å¾¡æ€§ç¼–ç¨‹çš„æœ€åŸºæœ¬è§„åˆ™ï¼š<br>ä¿æŠ¤ç¨‹åºå…é­éæ³•è¾“å…¥æ•°æ®çš„ç ´åã€‚</p><h2 id="ä¸ºä»€ä¹ˆè¦é˜²å¾¡æ€§ç¼–ç¨‹"><a href="#ä¸ºä»€ä¹ˆè¦é˜²å¾¡æ€§ç¼–ç¨‹" class="headerlink" title="ä¸ºä»€ä¹ˆè¦é˜²å¾¡æ€§ç¼–ç¨‹"></a>ä¸ºä»€ä¹ˆè¦é˜²å¾¡æ€§ç¼–ç¨‹</h2><ul><li>ä¸ºäº†è®©ä½ å†™çš„ä»£ç æ­£ç¡®è¿è¡Œ</li><li>æä¾›å‚æ•°é”™è¯¯çš„åŸå› </li><li>å¯ä»¥å¿«é€Ÿæ‰¾åˆ° bug</li></ul>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> php </tag>
            
            <tag> ç¼–ç¨‹ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>nginxå®‰å…¨é…ç½®ä¹‹ç™½åå•è®¾ç½®</title>
      <link href="/nginx-config-white-list/"/>
      <url>/nginx-config-white-list/</url>
      
        <content type="html"><![CDATA[<blockquote><p>ç½‘ç«™å®‰å…¨ï¼Œé˜²ä¸èƒœé˜²</p></blockquote><p>ä½ æ°¸è¿œä¸çŸ¥é“é»‘å®¢åˆ©ç”¨ä»€ä¹ˆæ¼æ´å¯¹ä½ çš„ç½‘ç«™è¿›è¡Œæ”»å‡»ï¼Œæœ€å¸¸è§çš„æ‰‹æ®µæ˜¯åˆ©ç”¨æ¼æ´åœ¨ä½ çš„ç½‘ç«™ç•™ä¸ªåé—¨ï¼Œå–œæ¬¢çš„æ—¶å€™æ¥é€›é€›ï¼Œæ¯”å¦‚ç©ä½ çš„æœåŠ¡å™¨ä¸Šä¼ ä¸€ä¸ªx.phpï¼Œç›´æ¥è®¿é—®ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://www.example.com/a/b/c/d/a.php</span><br></pre></td></tr></table></figure><p>ç„¶åå°±å¯ä»¥ä¸ºæ‰€æ¬²ä¸ºäº†ï¼Œé‚£ä¹ˆæœ‰æ²¡æœ‰åŠæ³•è®©é»‘å®¢å³ä½¿åˆ©ç”¨æ¼æ´ä¸Šä¼ äº†phpä»£ç è€Œæ²¡åŠæ³•è¿è¡Œå‘¢ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ã€‚</p><p>æ€è·¯æ˜¯ä»è¿è¡Œphpçš„php-fpmç€æ‰‹ï¼Œåœ¨nginxä¸Šåšé…ç½®ï¼Œå®¢å®˜è¯·çœ‹é…ç½®ã€‚</p><a id="more"></a><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen       80;</span><br><span class="line">    server_name  www.example.com;</span><br><span class="line">    root         /home/htdocs/app/;</span><br><span class="line">    index        index.php;</span><br><span class="line">    location / &#123;</span><br><span class="line">        try_files <span class="variable">$uri</span> <span class="variable">$uri</span>/ /index.php?s=<span class="variable">$uri</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    location ~ .*\.php$ &#123;</span><br><span class="line">        <span class="comment"># ç™½åå•é…ç½®ï¼Œåªå…è®¸/index.phpã€/api.phpè®¿é—®</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$fastcgi_script_name</span> !~* <span class="string">"^/(index|api)\.php$"</span>) &#123;</span><br><span class="line">            <span class="built_in">return</span> 403;</span><br><span class="line">        &#125;</span><br><span class="line">        fastcgi_pass   127.0.0.1:9000;</span><br><span class="line">        fastcgi_index  index.php;</span><br><span class="line">        include        fcgi.conf;</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> php </tag>
            
            <tag> nginx </tag>
            
            <tag> webserver </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¿®æ”¹é…ç½®nginxé™åˆ¶æ¶æ„çˆ¬è™«é¢‘ç‡</title>
      <link href="/nginx-limit-req-to-limit-spider/"/>
      <url>/nginx-limit-req-to-limit-spider/</url>
      
        <content type="html"><![CDATA[<p>è¶…è¿‡è®¾ç½®çš„é™å®šé¢‘ç‡ï¼Œå°±ä¼šç»™<code>spider</code>ä¸€ä¸ª<code>503</code>ã€‚<br>ä¸Šè¿°é…ç½®è¯¦ç»†è§£é‡Šè¯·è‡ªè¡Œ<code>google</code>ä¸‹ï¼Œå…·ä½“çš„<code>spider/bot</code>åç§°è¯·è‡ªå®šä¹‰ã€‚</p><a id="more"></a><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å…¨å±€é…ç½®</span></span><br><span class="line">limit_req_zone <span class="variable">$anti_spider</span> zone=anti_spider:10m rate=15r/m;</span><br><span class="line"><span class="comment">#æŸä¸ªserverä¸­</span></span><br><span class="line">limit_req zone=anti_spider burst=30 nodelay;</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$http_user_agent</span> ~* <span class="string">"xxspider|xxbot"</span>) &#123;</span><br><span class="line">  <span class="built_in">set</span> <span class="variable">$anti_spider</span> <span class="variable">$http_user_agent</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nginx </tag>
            
            <tag> çˆ¬è™« </tag>
            
            <tag> robots </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ©ç”¨åå‘ä»£ç†æ‰¹é‡å®ç°httpsåè®®è®¿é—®</title>
      <link href="/use-nginx-proxy-for-muilt-https-setting/"/>
      <url>/use-nginx-proxy-for-muilt-https-setting/</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘æœ‰ä¸€ä¸ªé¡¹ç›®éœ€æ±‚ï¼Œéœ€è¦ä¸ºç«™ç‚¹å¢åŠ httpsè®¿é—®ã€‚</p><p>å¼€å§‹åªé…ç½®äº†wwwåŸŸåä¸‹çš„httpsï¼Œå‘ç°csså’Œjséƒ½æ— æ³•æ­£å¸¸åŠ è½½ï¼ŒåŸå› æ˜¯httpsé¡µé¢ï¼Œå¦‚æœåŠ è½½httpåè®®çš„å†…å®¹ï¼Œä¼šè¢«è®¤ä¸ºé¡µé¢ä¸å®‰å…¨ï¼Œå°¤å…¶æ˜¯IEï¼Œåˆ·æ–°ä¸€ä¸‹é¡µé¢å°±è¦å¼¹å‡ºä¸€æ¬¡ç¡®è®¤ï¼Œç›¸å½“çƒ¦äººã€‚</p><p>åæ¥è‹¦é€¼çš„æŠŠå„ä¸ªå­åŸŸåéƒ½åŠ å…¥äº†httpsé…ç½®ï¼Œnginx.confé‡Œå†™å„ä¸ªå­åŸŸåéƒ½å†™äº†ä¸€ä¸ª443çš„serveré…ç½®ï¼Œæ¯æ–°å¢ä¸€ä¸ªåŸŸåï¼Œè¿˜å¾—copyä¸€ä»½ï¼Œå¦‚æœæ˜¯ä¿®æ”¹ä¸€ä¸‹ç«™ç‚¹çš„é…ç½®ï¼Œè¿˜å¾—æ”¹ä¸¤æ¬¡ä»¥ä¸Šã€‚</p><a id="more"></a><p>åæ¥è·ŸåŒäº‹è®¨è®ºï¼Œå‘ç°ä½¿ç”¨åå‘ä»£ç†ï¼Œå¯ä»¥å¿«æ·ç°å®ï¼Œé…ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">sever&#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    sever_name www.hdj.me;</span><br><span class="line">    root /home/webroot/www/;</span><br><span class="line">    index index.php index.html;</span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line">&#125;</span><br><span class="line">sever&#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    sever_name img.hdj.me;</span><br><span class="line">    root /home/webroot/img/;</span><br><span class="line">    index index.php index.html;</span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line">&#125;</span><br><span class="line">sever&#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    sever_name static.hdj.me;</span><br><span class="line">    root /home/webroot/static/;</span><br><span class="line">    index index.php index.html;</span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line">&#125;</span><br><span class="line">sever&#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    sever_name upload.hdj.me;</span><br><span class="line">    root /home/webroot/upload/;</span><br><span class="line">    index index.php index.html;</span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line">&#125;</span><br><span class="line">server &#123;</span><br><span class="line">    listen 443;</span><br><span class="line">    server_name www.hdj.me img.hdj.me static.hdj.me upload.hdj.me;</span><br><span class="line">    ssl on;</span><br><span class="line">    ssl_certificate /usr/<span class="built_in">local</span>/nginx/conf/hdj.me.crt;</span><br><span class="line">    ssl_certificate_key /usr/<span class="built_in">local</span>/nginx/conf/hdj.me.key;</span><br><span class="line"> </span><br><span class="line">    location /&#123;</span><br><span class="line">        proxy_pass http://127.0.0.1:80;</span><br><span class="line">        proxy_redirect off;</span><br><span class="line">        proxy_set_header X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        proxy_set_header X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">        proxy_set_header Host <span class="variable">$host</span>;</span><br><span class="line">        proxy_set_header SSL <span class="string">'1'</span>;</span><br><span class="line">        proxy_redirect http:// https://;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·é…ç½®å¥½ï¼Œè®¿é—®ï¼š</p><ul><li><a href="https://www.hdj.me/" target="_blank" rel="noopener">https://www.hdj.me/</a></li><li><a href="https://img.hdj.me/" target="_blank" rel="noopener">https://img.hdj.me/</a></li><li><a href="https://static.hdj.me/" target="_blank" rel="noopener">https://static.hdj.me/</a></li><li><a href="https://upload.hdj.me/" target="_blank" rel="noopener">https://upload.hdj.me/</a></li></ul><p>ä¼šè¢«åå‘ä»£ç†è‡³ï¼š</p><ul><li><a href="http://www.hdj.me/" target="_blank" rel="noopener">http://www.hdj.me/</a></li><li><a href="http://img.hdj.me/" target="_blank" rel="noopener">http://img.hdj.me/</a></li><li><a href="http://static.hdj.me/" target="_blank" rel="noopener">http://static.hdj.me/</a></li><li><a href="http://upload.hdj.me/" target="_blank" rel="noopener">http://upload.hdj.me/</a></li></ul><p>è€Œä¸éœ€è¦å¯¹å„ä¸ªåŸŸåéƒ½é…ç½®ä¸€ä¸ª443çš„ç«™ç‚¹ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nginx </tag>
            
            <tag> https </tag>
            
            <tag> proxy </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>nginxæœåŠ¡å™¨é˜²sqlæ³¨å…¥/æº¢å‡ºæ”»å‡»/spamåŠç¦User-agents</title>
      <link href="/nginx-block-sqlinjections-and-deny-user-agents/"/>
      <url>/nginx-block-sqlinjections-and-deny-user-agents/</url>
      
        <content type="html"><![CDATA[<p>åºŸè¯ä¸è¯´ï¼Œç›´æ¥ä¸Šé…ç½®ï¼Œå®¢å®˜è¯·çœ‹</p><a id="more"></a><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    <span class="comment">## ç¦SQLæ³¨å…¥ Block SQL injections</span></span><br><span class="line">    <span class="built_in">set</span> <span class="variable">$block_sql_injections</span> 0;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$query_string</span> ~ <span class="string">"union.*select.*\("</span>) &#123;</span><br><span class="line">        <span class="built_in">set</span> <span class="variable">$block_sql_injections</span> 1;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$query_string</span> ~ <span class="string">"union.*all.*select.*"</span>) &#123;</span><br><span class="line">        <span class="built_in">set</span> <span class="variable">$block_sql_injections</span> 1;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$query_string</span> ~ <span class="string">"concat.*\("</span>) &#123;</span><br><span class="line">        <span class="built_in">set</span> <span class="variable">$block_sql_injections</span> 1;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$block_sql_injections</span> = 1) &#123;</span><br><span class="line">        <span class="built_in">return</span> 444;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">## ç¦æ‰æ–‡ä»¶æ³¨å…¥</span></span><br><span class="line">    <span class="built_in">set</span> <span class="variable">$block_file_injections</span> 0;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$query_string</span> ~ <span class="string">"[a-zA-Z0-9_]=http://"</span>) &#123;</span><br><span class="line">        <span class="built_in">set</span> <span class="variable">$block_file_injections</span> 1;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$query_string</span> ~ <span class="string">"[a-zA-Z0-9_]=(\.\.//?)+"</span>) &#123;</span><br><span class="line">        <span class="built_in">set</span> <span class="variable">$block_file_injections</span> 1;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$query_string</span> ~ <span class="string">"[a-zA-Z0-9_]=/([a-z0-9_.]//?)+"</span>) &#123;</span><br><span class="line">        <span class="built_in">set</span> <span class="variable">$block_file_injections</span> 1;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$block_file_injections</span> = 1) &#123;</span><br><span class="line">        <span class="built_in">return</span> 444;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">## ç¦æ‰æº¢å‡ºæ”»å‡»</span></span><br><span class="line">    <span class="built_in">set</span> <span class="variable">$block_common_exploits</span> 0;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$query_string</span> ~ <span class="string">"(&lt;|%3C).*script.*(&gt;|%3E)"</span>) &#123;</span><br><span class="line">        <span class="built_in">set</span> <span class="variable">$block_common_exploits</span> 1;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$query_string</span> ~ <span class="string">"GLOBALS(=|\[|\%[0-9A-Z]&#123;0,2&#125;)"</span>) &#123;</span><br><span class="line">        <span class="built_in">set</span> <span class="variable">$block_common_exploits</span> 1;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$query_string</span> ~ <span class="string">"_REQUEST(=|\[|\%[0-9A-Z]&#123;0,2&#125;)"</span>) &#123;</span><br><span class="line">        <span class="built_in">set</span> <span class="variable">$block_common_exploits</span> 1;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$query_string</span> ~ <span class="string">"proc/self/environ"</span>) &#123;</span><br><span class="line">        <span class="built_in">set</span> <span class="variable">$block_common_exploits</span> 1;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$query_string</span> ~ <span class="string">"mosConfig_[a-zA-Z_]&#123;1,21&#125;(=|\%3D)"</span>) &#123;</span><br><span class="line">        <span class="built_in">set</span> <span class="variable">$block_common_exploits</span> 1;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$query_string</span> ~ <span class="string">"base64_(en|de)code\(.*\)"</span>) &#123;</span><br><span class="line">        <span class="built_in">set</span> <span class="variable">$block_common_exploits</span> 1;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$block_common_exploits</span> = 1) &#123;</span><br><span class="line">        <span class="built_in">return</span> 444;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">## ç¦spamå­—æ®µ</span></span><br><span class="line">    <span class="built_in">set</span> <span class="variable">$block_spam</span> 0;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$query_string</span> ~ <span class="string">"\b(ultram|unicauca|valium|viagra|vicodin|xanax|ypxaieo)\b"</span>) &#123;</span><br><span class="line">        <span class="built_in">set</span> <span class="variable">$block_spam</span> 1;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$query_string</span> ~ <span class="string">"\b(erections|hoodia|huronriveracres|impotence|levitra|libido)\b"</span>) &#123;</span><br><span class="line">        <span class="built_in">set</span> <span class="variable">$block_spam</span> 1;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$query_string</span> ~ <span class="string">"\b(ambien|blue\spill|cialis|cocaine|ejaculation|erectile)\b"</span>) &#123;</span><br><span class="line">        <span class="built_in">set</span> <span class="variable">$block_spam</span> 1;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$query_string</span> ~ <span class="string">"\b(lipitor|phentermin|pro[sz]ac|sandyauer|tramadol|troyhamby)\b"</span>) &#123;</span><br><span class="line">        <span class="built_in">set</span> <span class="variable">$block_spam</span> 1;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$block_spam</span> = 1) &#123;</span><br><span class="line">        <span class="built_in">return</span> 444;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">## ç¦æ‰user-agents</span></span><br><span class="line">    <span class="built_in">set</span> <span class="variable">$block_user_agents</span> 0;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Donâ€™t disable wget if you need it to run cron jobs!</span></span><br><span class="line">    <span class="comment"># if ($http_user_agent ~ "Wget") &#123;</span></span><br><span class="line">    <span class="comment">#     set $block_user_agents 1;</span></span><br><span class="line">    <span class="comment"># &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Disable Akeeba Remote Control 2.5 and earlier</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$http_user_agent</span> ~ <span class="string">"Indy Library"</span>) &#123;</span><br><span class="line">        <span class="built_in">set</span> <span class="variable">$block_user_agents</span> 1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Common bandwidth hoggers and hacking tools.</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$http_user_agent</span> ~ <span class="string">"libwww-perl"</span>) &#123;</span><br><span class="line">        <span class="built_in">set</span> <span class="variable">$block_user_agents</span> 1;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$http_user_agent</span> ~ <span class="string">"GetRight"</span>) &#123;</span><br><span class="line">        <span class="built_in">set</span> <span class="variable">$block_user_agents</span> 1;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$http_user_agent</span> ~ <span class="string">"GetWeb!"</span>) &#123;</span><br><span class="line">        <span class="built_in">set</span> <span class="variable">$block_user_agents</span> 1;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$http_user_agent</span> ~ <span class="string">"Go!Zilla"</span>) &#123;</span><br><span class="line">        <span class="built_in">set</span> <span class="variable">$block_user_agents</span> 1;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$http_user_agent</span> ~ <span class="string">"Download Demon"</span>) &#123;</span><br><span class="line">        <span class="built_in">set</span> <span class="variable">$block_user_agents</span> 1;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$http_user_agent</span> ~ <span class="string">"Go-Ahead-Got-It"</span>) &#123;</span><br><span class="line">        <span class="built_in">set</span> <span class="variable">$block_user_agents</span> 1;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$http_user_agent</span> ~ <span class="string">"TurnitinBot"</span>) &#123;</span><br><span class="line">        <span class="built_in">set</span> <span class="variable">$block_user_agents</span> 1;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$http_user_agent</span> ~ <span class="string">"GrabNet"</span>) &#123;</span><br><span class="line">        <span class="built_in">set</span> <span class="variable">$block_user_agents</span> 1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$block_user_agents</span> = 1) &#123;</span><br><span class="line">        <span class="built_in">return</span> 444;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯´æ˜ï¼š</p><blockquote><p>é˜²sqlæ³¨å…¥/æº¢å‡ºæ”»å‡»/spamé‡‡ç”¨ç¦æ‰URLä¸­åŒ…å«çš„å­—æ®µå®ç°ï¼Œè¯·æ ¹æ®éœ€è¦åˆç†æ·»åŠ è¿”å›444,æ˜¯å®Œå…¨ä¸å›åº”å®¢æˆ·ç«¯ï¼Œæ¯”403æ›´åŠ éå¸¸èŠ‚çœç³»ç»Ÿèµ„æº</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nginx </tag>
            
            <tag> sql </tag>
            
            <tag> æ³¨å…¥ </tag>
            
            <tag> spam </tag>
            
            <tag> user-agent </tag>
            
            <tag> æº¢å‡ºæ”»å‡» </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æœªçŸ¥çš„ææƒ§â€”â€”NULL</title>
      <link href="/null-in-mysql/"/>
      <url>/null-in-mysql/</url>
      
        <content type="html"><![CDATA[<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    <span class="literal">NULL</span> = <span class="number">0</span>,</span><br><span class="line">    <span class="literal">NULL</span> = <span class="number">12345</span>,</span><br><span class="line">    <span class="literal">NULL</span> &lt;&gt; <span class="number">12345</span>,</span><br><span class="line">    <span class="literal">NULL</span> + <span class="number">12345</span>,</span><br><span class="line">    <span class="literal">NULL</span> || <span class="string">'abc'</span>,</span><br><span class="line">    <span class="literal">NULL</span> = <span class="literal">NULL</span> ,</span><br><span class="line">    <span class="literal">NULL</span> &lt;&gt; <span class="literal">NULL</span> ,</span><br><span class="line">    <span class="literal">NULL</span> <span class="keyword">AND</span> <span class="literal">TRUE</span> ,</span><br><span class="line">    <span class="literal">NULL</span> <span class="keyword">AND</span> <span class="literal">FALSE</span> ,</span><br><span class="line">    <span class="literal">NULL</span> <span class="keyword">OR</span> <span class="literal">FALSE</span> ,</span><br><span class="line">    <span class="literal">NULL</span> <span class="keyword">OR</span> <span class="literal">TRUE</span> ,</span><br><span class="line">    <span class="keyword">NOT</span> (<span class="literal">NULL</span>);</span><br></pre></td></tr></table></figure><p>å¦‚æœè¿™æ˜¯ä¸€é“é¢è¯•é¢˜ï¼Œä¼°è®¡ä¸çŸ¥é“æœ‰å¤šå°‘ç¨‹åºå‘˜ç”šè‡³æ˜¯DBAä¼šé˜µäº¡ã€‚</p><a id="more"></a><p>æ­£ç¡®çš„ç­”æ¡ˆæ˜¯ä»€ä¹ˆï¼Ÿï¼ˆä¸ºäº†åŠ æ·±å°è±¡ï¼Œå»ºè®®å¤åˆ¶SQLåˆ°mysqlé‡Œå»æ‰§è¡Œï¼Œçœ‹ä¸€ä¸‹ï¼‰</p><p>ä¸‹é¢è·Ÿå¤§å®¶åˆ†æä¸€ä¸‹åŸå› ï¼š</p><p><img src="/images/null-in-mysql.png" alt="å›¾ç‰‡"></p><p>é‚£ä¹ˆåœ¨åº”ç”¨ä¸­å¦‚ä½•é¿å…NULLå¸¦æ¥çš„ä¸€äº›å›°æ‰°å‘¢ï¼Ÿ</p><blockquote><ul><li>æŠŠNULLå½“æˆä¸€ä¸ªç‰¹æ®Šå€¼ï¼Œä¸ç­‰äºç©ºã€0ã€FALSEï¼Œä½¿ç”¨IS NULL/IS NOT NULLå»æ£€æµ‹</li><li>å£°æ˜NOT NULLåˆ—ï¼Œç»™äºé»˜è®¤å€¼</li></ul></blockquote>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®åº“ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> mysql </tag>
            
            <tag> null </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxä¸‹æŸ¥çœ‹nginxï¼Œapacheï¼Œmysqlï¼Œphpçš„ç¼–è¯‘å‚æ•°</title>
      <link href="/linux-check-nginx-apache-mysql-php-configure/"/>
      <url>/linux-check-nginx-apache-mysql-php-configure/</url>
      
        <content type="html"><![CDATA[<p>åœ¨å‡çº§è½¯ä»¶ç‰ˆæœ¬çš„æ—¶å€™ï¼Œå¦‚æœæ²¡æœ‰æ–‡æ¡£ï¼Œé‚£æ˜¯ç›¸å½“ç—›è‹¦çš„äº‹æƒ…ï¼Œç¼–è¯‘å‚æ•°æ˜¯ä»€ä¹ˆï¼Ÿ</p><a id="more"></a><p>1ã€nginxç¼–è¯‘å‚æ•°ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/<span class="built_in">local</span>/nginx/sbin/nginx -V</span><br></pre></td></tr></table></figure><p>2ã€apacheç¼–è¯‘å‚æ•°ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /usr/<span class="built_in">local</span>/apache/build/config.nice</span><br></pre></td></tr></table></figure><p>3ã€phpç¼–è¯‘å‚æ•°ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/<span class="built_in">local</span>/php/bin/php -i |grep configure</span><br></pre></td></tr></table></figure><p>4ã€mysqlç¼–è¯‘å‚æ•°ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /usr/<span class="built_in">local</span>/mysql/bin/mysqlbug|grep configure</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> php </tag>
            
            <tag> nginx </tag>
            
            <tag> mysql </tag>
            
            <tag> apache </tag>
            
            <tag> configure </tag>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å†…ç½‘æœºå™¨çš„è·å–å…¬ç½‘IPçš„æ–¹æ³•</title>
      <link href="/intranet-computer-get-internet-ip-by-php/"/>
      <url>/intranet-computer-get-internet-ip-by-php/</url>
      
        <content type="html"><![CDATA[<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getClientIp</span><span class="params">()</span></span>&#123;  </span><br><span class="line">    $socket = socket_create(AF_INET, SOCK_STREAM, <span class="number">6</span>);  </span><br><span class="line">    $ret = socket_connect($socket,<span class="string">'ns1.dnspod.net'</span>,<span class="number">6666</span>);  </span><br><span class="line">    $buf = socket_read($socket, <span class="number">16</span>);  </span><br><span class="line">    socket_close($socket);  </span><br><span class="line">    <span class="keyword">return</span> $buf;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¼ºç‚¹ï¼šä¾èµ–ç¬¬ä¸‰æ–¹ï¼Œæ•ˆç‡ä¸ç½‘ç»œçŠ¶å†µæœ‰å…³ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> php </tag>
            
            <tag> getclientip </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Nginx upstreamçš„5ç§æƒé‡åˆ†é…æ–¹å¼</title>
      <link href="/five-ways-of-nginx-upstream/"/>
      <url>/five-ways-of-nginx-upstream/</url>
      
        <content type="html"><![CDATA[<p>1ã€è½®è¯¢ï¼ˆé»˜è®¤ï¼‰</p><blockquote><p>æ¯ä¸ªè¯·æ±‚æŒ‰æ—¶é—´é¡ºåºé€ä¸€åˆ†é…åˆ°ä¸åŒçš„åç«¯æœåŠ¡å™¨ï¼Œå¦‚æœåç«¯æœåŠ¡å™¨downæ‰ï¼Œèƒ½è‡ªåŠ¨å‰”é™¤ã€‚</p></blockquote><p>2ã€weight<br>æŒ‡å®šè½®è¯¢å‡ ç‡ï¼Œweightå’Œè®¿é—®æ¯”ç‡æˆæ­£æ¯”ï¼Œç”¨äºåç«¯æœåŠ¡å™¨æ€§èƒ½ä¸å‡çš„æƒ…å†µã€‚</p><a id="more"></a><p>ä¾‹å¦‚ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">upstream backend &#123;</span><br><span class="line">    server 192.168.0.14 weight=10;</span><br><span class="line">    server 192.168.0.15 weight=10;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3ã€ip_hash<br>æ¯ä¸ªè¯·æ±‚æŒ‰è®¿é—®ipçš„hashç»“æœåˆ†é…ï¼Œè¿™æ ·æ¯ä¸ªè®¿å®¢å›ºå®šè®¿é—®ä¸€ä¸ªåç«¯æœåŠ¡å™¨ï¼Œå¯ä»¥è§£å†³sessionçš„é—®é¢˜ã€‚<br>ä¾‹å¦‚ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">upstream backend &#123;</span><br><span class="line">    ip_hash;</span><br><span class="line">    server 192.168.0.14:88;</span><br><span class="line">    server 192.168.0.15:80;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4ã€fairï¼ˆç¬¬ä¸‰æ–¹ï¼‰<br>æŒ‰åç«¯æœåŠ¡å™¨çš„å“åº”æ—¶é—´æ¥åˆ†é…è¯·æ±‚ï¼Œå“åº”æ—¶é—´çŸ­çš„ä¼˜å…ˆåˆ†é…ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">upstream backend &#123;</span><br><span class="line">    server server1.linuxany.com;</span><br><span class="line">    server server2.linuxany.com;</span><br><span class="line">    fair;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>5ã€url_hashï¼ˆç¬¬ä¸‰æ–¹ï¼‰</p><p>æŒ‰è®¿é—®urlçš„hashç»“æœæ¥åˆ†é…è¯·æ±‚ï¼Œä½¿æ¯ä¸ªurlå®šå‘åˆ°åŒä¸€ä¸ªåç«¯æœåŠ¡å™¨ï¼Œåç«¯æœåŠ¡å™¨ä¸ºç¼“å­˜æ—¶æ¯”è¾ƒæœ‰æ•ˆã€‚</p><p>ä¾‹ï¼šåœ¨upstreamä¸­åŠ å…¥hashè¯­å¥ï¼Œserverè¯­å¥ä¸­ä¸èƒ½å†™å…¥weightç­‰å…¶ä»–çš„å‚æ•°ï¼Œhash_methodæ˜¯ä½¿ç”¨çš„hashç®—æ³•</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">upstream backend &#123;</span><br><span class="line">    server squid1:3128;</span><br><span class="line">    server squid2:3128;</span><br><span class="line">    <span class="built_in">hash</span> <span class="variable">$request_uri</span>;</span><br><span class="line">    hash_method crc32;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å®šä¹‰è´Ÿè½½å‡è¡¡è®¾å¤‡çš„IpåŠè®¾å¤‡çŠ¶æ€</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">upstream backend&#123;</span><br><span class="line">    ip_hash;</span><br><span class="line">    server 127.0.0.1:9090 down;</span><br><span class="line">    server 127.0.0.1:8080 weight=2;</span><br><span class="line">    server 127.0.0.1:6060;</span><br><span class="line">    server 127.0.0.1:7070 backup;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨éœ€è¦ä½¿ç”¨è´Ÿè½½å‡è¡¡çš„serverä¸­å¢åŠ </p><blockquote><p>proxy_pass <code>http://bakend/</code>;</p></blockquote><p>æ¯ä¸ªè®¾å¤‡çš„çŠ¶æ€è®¾ç½®ä¸º:</p><ul><li>down è¡¨ç¤ºå•å‰çš„serveræš‚æ—¶ä¸å‚ä¸è´Ÿè½½</li><li>weight é»˜è®¤ä¸º1.weightè¶Šå¤§ï¼Œè´Ÿè½½çš„æƒé‡å°±è¶Šå¤§ã€‚</li><li>max_fails ï¼šå…è®¸è¯·æ±‚å¤±è´¥çš„æ¬¡æ•°é»˜è®¤ä¸º1.å½“è¶…è¿‡æœ€å¤§æ¬¡æ•°æ—¶ï¼Œè¿”å›proxy_next_upstream æ¨¡å—å®šä¹‰çš„é”™è¯¯</li><li>fail_timeout:max_failsæ¬¡å¤±è´¥åï¼Œæš‚åœçš„æ—¶é—´ã€‚</li><li>backupï¼š å…¶å®ƒæ‰€æœ‰çš„ébackupæœºå™¨downæˆ–è€…å¿™çš„æ—¶å€™ï¼Œè¯·æ±‚backupæœºå™¨ã€‚æ‰€ä»¥è¿™å°æœºå™¨å‹åŠ›ä¼šæœ€è½»ã€‚</li></ul><p>nginxæ”¯æŒåŒæ—¶è®¾ç½®å¤šç»„çš„è´Ÿè½½å‡è¡¡ï¼Œç”¨æ¥ç»™ä¸ç”¨çš„serveræ¥ä½¿ç”¨ã€‚</p><blockquote><p><code>client_body_in_file_only</code> è®¾ç½®ä¸º<code>On</code> å¯ä»¥è®²client postè¿‡æ¥çš„æ•°æ®è®°å½•åˆ°æ–‡ä»¶ä¸­ç”¨æ¥åšdebug<br><code>client_body_temp_path</code> è®¾ç½®è®°å½•æ–‡ä»¶çš„ç›®å½• å¯ä»¥è®¾ç½®æœ€å¤š3å±‚ç›®å½•</p></blockquote><p><code>location</code> å¯¹URLè¿›è¡ŒåŒ¹é….å¯ä»¥è¿›è¡Œé‡å®šå‘æˆ–è€…è¿›è¡Œæ–°çš„ä»£ç†<code>è´Ÿè½½å‡è¡¡</code></p>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nginx </tag>
            
            <tag> upstream </tag>
            
            <tag> weight </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>preg_matchæ­£åˆ™åŒ¹é…çš„å­—ç¬¦ä¸²é•¿åº¦é—®é¢˜</title>
      <link href="/strlen-of-preg-match/"/>
      <url>/strlen-of-preg-match/</url>
      
        <content type="html"><![CDATA[<p>é¡¹ç›®ä¸­ï¼Œç”¨<code>preg_match</code>æ­£åˆ™æå–ç›®æ ‡å†…å®¹ï¼Œæ­»æ´»æœ‰é—®é¢˜ï¼Œä»£ç æµ‹å¾—æ­»å»æ´»æ¥ã€‚<br>åæ¥å‘ç°<code>pcre.backtrack_limit</code>çš„å€¼é»˜è®¤åªè®¾äº†<code>100000</code>ã€‚</p><a id="more"></a><p>è§£å†³åŠæ³•ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ini_set(â€˜pcre.backtrack_limitâ€™, <span class="number">999999999</span>);</span><br></pre></td></tr></table></figure><p>æ³¨ï¼šè¿™ä¸ªå‚æ•°åœ¨php 5.2.0ç‰ˆæœ¬ä¹‹åå¯ç”¨ã€‚<br>å¦å¤–è¯´è¯´å…³äºï¼š<code>pcre.recursion_limit</code><br><code>pcre.recursion_limit</code>æ˜¯<code>PCRE</code>çš„é€’å½’é™åˆ¶ï¼Œè¿™ä¸ªé¡¹å¦‚æœè®¾å¾ˆå¤§çš„å€¼ï¼Œä¼šæ¶ˆè€—æ‰€æœ‰è¿›ç¨‹çš„å¯ç”¨å †æ ˆï¼Œæœ€åå¯¼è‡´PHPå´©æºƒã€‚<br>ä¹Ÿå¯ä»¥é€šè¿‡ä¿®æ”¹é…ç½®æ¥é™åˆ¶ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ini_set(â€˜pcre.recursion_limitâ€™, <span class="number">99999</span>);</span><br></pre></td></tr></table></figure><p>å®é™…é¡¹ç›®åº”ç”¨ä¸­ï¼Œæœ€å¥½ä¹Ÿå¯¹å†…å­˜è¿›è¡Œé™å®šè®¾ç½®ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ini_set(â€˜memory_limitâ€™, â€™<span class="number">64</span>Mâ€™);</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±æ¯”è¾ƒç¨³å¦¥å¦¥å˜ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> php </tag>
            
            <tag> æ­£åˆ™ </tag>
            
            <tag> regex </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxä¸‹æµ‹è¯•ç¡¬ç›˜è¯»å†™é€Ÿåº¦</title>
      <link href="/test-for-disk-rw-in-linux/"/>
      <url>/test-for-disk-rw-in-linux/</url>
      
        <content type="html"><![CDATA[<p>timeæœ‰è®¡æ—¶ä½œç”¨<br>ddç”¨äºå¤åˆ¶ï¼Œä»ifè¯»å‡ºï¼Œå†™åˆ°of<br><code>if=/dev/zero</code>ä¸äº§ç”ŸIOï¼Œå› æ­¤å¯ä»¥ç”¨æ¥æµ‹è¯•çº¯å†™é€Ÿåº¦ã€‚<br>åŒç†<code>of=/dev/null</code>ä¸äº§ç”ŸIOï¼Œå¯ä»¥ç”¨æ¥æµ‹è¯•çº¯è¯»é€Ÿåº¦ã€‚<br>bsæ˜¯æ¯æ¬¡è¯»æˆ–å†™çš„å¤§å°ï¼Œå³ä¸€ä¸ªå—çš„å¤§å°ï¼Œcountæ˜¯è¯»å†™å—çš„æ•°é‡ã€‚</p><a id="more"></a><h3 id="1-æµ‹-ç›®å½•æ‰€åœ¨ç£ç›˜çš„çº¯å†™é€Ÿåº¦ï¼š"><a href="#1-æµ‹-ç›®å½•æ‰€åœ¨ç£ç›˜çš„çº¯å†™é€Ÿåº¦ï¼š" class="headerlink" title="1.æµ‹/ç›®å½•æ‰€åœ¨ç£ç›˜çš„çº¯å†™é€Ÿåº¦ï¼š"></a>1.æµ‹/ç›®å½•æ‰€åœ¨ç£ç›˜çš„çº¯å†™é€Ÿåº¦ï¼š</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">time dd <span class="keyword">if</span>=/dev/zero bs=1024 count=1000000 of=/1Gb.file</span><br></pre></td></tr></table></figure><h3 id="2-æµ‹-ç›®å½•æ‰€åœ¨ç£ç›˜çš„çº¯è¯»é€Ÿåº¦ï¼š"><a href="#2-æµ‹-ç›®å½•æ‰€åœ¨ç£ç›˜çš„çº¯è¯»é€Ÿåº¦ï¼š" class="headerlink" title="2.æµ‹/ç›®å½•æ‰€åœ¨ç£ç›˜çš„çº¯è¯»é€Ÿåº¦ï¼š"></a>2.æµ‹/ç›®å½•æ‰€åœ¨ç£ç›˜çš„çº¯è¯»é€Ÿåº¦ï¼š</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dd <span class="keyword">if</span>=/kvm/ftp/other/1Gb.file bs=64k |dd of=/dev/null</span><br></pre></td></tr></table></figure><h3 id="3-æµ‹è¯»å†™é€Ÿåº¦-è¿™æ˜¯ä»€ä¹ˆ-ï¼š"><a href="#3-æµ‹è¯»å†™é€Ÿåº¦-è¿™æ˜¯ä»€ä¹ˆ-ï¼š" class="headerlink" title="3.æµ‹è¯»å†™é€Ÿåº¦(è¿™æ˜¯ä»€ä¹ˆ)ï¼š"></a>3.æµ‹è¯»å†™é€Ÿåº¦(è¿™æ˜¯ä»€ä¹ˆ)ï¼š</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dd <span class="keyword">if</span>=/vat/<span class="built_in">test</span> of=/oradata/test1 bs=64k</span><br></pre></td></tr></table></figure><blockquote><p>ç†è®ºä¸Šå¤åˆ¶é‡è¶Šå¤§æµ‹è¯•è¶Šå‡†ç¡®ã€‚</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> dd </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½œå“</title>
      <link href="/cases/"/>
      <url>/cases/</url>
      
        <content type="html"><![CDATA[<blockquote><p>ä»äº‹IT10ä½™å¹´ï¼Œåšè¿‡å¤§å¤§å°å°çš„é¡¹ç›®æŒºå¤šçš„ï¼Œæœ‰äº›å·²ç»ä¸‹çº¿äº†ï¼Œæ•´ç†ä¸ºäº†æœ‰ä¸€å¤©èƒ½å›é¡¾ä¸€ä¸‹ã€‚</p></blockquote><a id="more"></a><h2 id="ç½‘ç«™"><a href="#ç½‘ç«™" class="headerlink" title="ç½‘ç«™"></a>ç½‘ç«™</h2><ul><li><a href="http://www.sucop.com" target="_blank" rel="noopener">è¶…çº§å·¡è­¦</a></li><li><a href="http://www.qianyun.cn" target="_blank" rel="noopener">åƒäº‘ç§‘æŠ€</a></li><li><a href="http://webscan.sucop.com" target="_blank" rel="noopener">è¶…çº§å·¡è­¦ç½‘é¡µç‰ˆ</a></li><li><a href="http://jmx.unnoo.com" target="_blank" rel="noopener">é¸¡æ¯›ä¿¡</a></li><li><a href="http://www.unnoo.com" target="_blank" rel="noopener">å¤§æˆå¤©ä¸‹</a></li><li><a href="http://www.xiaobai.com" target="_blank" rel="noopener">å°ç™½è½¯ä»¶</a></li><li><a href="http://baoku.xiaobai.com" target="_blank" rel="noopener">å°ç™½è½¯ä»¶å®åº“</a></li><li><a href="http://www.mmgsw.com" target="_blank" rel="noopener">èŒ‚åå¹¿è§†ç½‘</a></li><li><a href="http://www.8591.com.tw" target="_blank" rel="noopener">å®ç‰©äº¤æ˜“ç½‘TW</a></li><li><a href="http://www.8591.com.hk" target="_blank" rel="noopener">å®ç‰©äº¤æ˜“ç½‘HK</a></li><li><a href="http://www.100.com.tw" target="_blank" rel="noopener">100å®¤å†…è®¾è®¡</a></li></ul><h2 id="é¡¹ç›®"><a href="#é¡¹ç›®" class="headerlink" title="é¡¹ç›®"></a>é¡¹ç›®</h2><ul><li>è¶…çº§å·¡è­¦ä¼ä¸šç‰ˆ</li><li>å›½å®¶ä¿¡æ¯å®‰å…¨å·¥ç¨‹</li><li>ä¸Šæµ·è®¡ç®—æœºå®‰å…¨é¡¹ç›®</li><li>è¶…çº§å·¡è­¦äº‘æŸ¥æ€æœåŠ¡</li><li>å°ç™½è½¯ä»¶ç®¡å®¶</li><li>æ•°ç¿å³æ—¶é€šè®¯ä¸­å°</li></ul><h2 id="å‚ä¸å¼€æºé¡¹ç›®"><a href="#å‚ä¸å¼€æºé¡¹ç›®" class="headerlink" title="å‚ä¸å¼€æºé¡¹ç›®"></a>å‚ä¸å¼€æºé¡¹ç›®</h2><ul><li><a href="https://github.com/top-think/think" target="_blank" rel="noopener">ThinkPHP</a></li></ul><h2 id="Larave-æ‰©å±•åŒ…"><a href="#Larave-æ‰©å±•åŒ…" class="headerlink" title="Larave æ‰©å±•åŒ…"></a>Larave æ‰©å±•åŒ…</h2><ul><li><a href="https://github.com/huangdijia/laravel-trigger" target="_blank" rel="noopener">Laravel Trigger</a></li><li><a href="https://github.com/huangdijia/laravel-youdu" target="_blank" rel="noopener">Laravel Youdu</a></li><li><a href="https://github.com/huangdijia/laravel-ipip" target="_blank" rel="noopener">Laravel Ipip</a></li><li><a href="https://github.com/huangdijia/laravel-ssdb" target="_blank" rel="noopener">Laravel Ssdb</a></li><li><a href="https://github.com/huangdijia/laravel-accessyou" target="_blank" rel="noopener">Laravel Accessyou</a></li><li><a href="https://github.com/huangdijia/laravel-mxtong" target="_blank" rel="noopener">Laravel Mxtong</a></li><li><a href="https://github.com/huangdijia/laravel-mitake" target="_blank" rel="noopener">Laravel Mitake</a></li><li><a href="https://github.com/huangdijia/laravel-smspro" target="_blank" rel="noopener">Laravel Smspro</a></li><li><a href="https://github.com/huangdijia/laravel-twsms" target="_blank" rel="noopener">Laravel Twsms</a></li><li><a href="https://github.com/huangdijia/laravel-icomet" target="_blank" rel="noopener">Laravel Icomet</a></li><li><a href="https://github.com/huangdijia/laravel-gateway-worker" target="_blank" rel="noopener">Laravel Gateway Worker</a></li></ul><h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><ul><li><del>wnmpé›†æˆç¯å¢ƒ</del></li><li><a href="/php-code-protector/">PHPå›å­åŠ å¯†</a></li><li><del>PHPæŠ“å–è§†é¢‘ç¼©ç•¥å›¾ç±»VedioUrlParser(æ”¯æŒä¼˜é…·ã€åœŸè±†ã€é…·å…­ã€56ã€ä¹è§†ã€æœç‹)</del></li><li><a href="https://gitee.com/deeka/jsComfirm" target="_blank" rel="noopener">jQueryæ’ä»¶jsConfirm-1.0</a></li><li><a href="https://gitee.com/deeka/inputDefault" target="_blank" rel="noopener">åŸºäºjQueryçš„inputæç¤ºä¿¡æ¯æ’ä»¶inputDefault</a></li><li><a href="https://gitee.com/deeka/iframeupload" target="_blank" rel="noopener">åŸºäºjQueryçš„æ— åˆ·æ–°ä¸Šä¼ æ’ä»¶iframeupload</a></li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>ç¥å¥‡çš„fastcgi_finish_request</title>
      <link href="/fastcgi-finish-request/"/>
      <url>/fastcgi-finish-request/</url>
      
        <content type="html"><![CDATA[<p>å½“PHPè¿è¡Œåœ¨<code>FastCGI</code>æ¨¡å¼æ—¶ï¼Œ<code>PHP FPM</code>æä¾›äº†ä¸€ä¸ªåä¸º<code>fastcgi_finish_request</code>çš„æ–¹æ³•ã€‚æŒ‰ç…§æ–‡æ¡£ä¸Šçš„è¯´æ³•ï¼Œæ­¤æ–¹æ³•å¯ä»¥æé«˜è¯·æ±‚çš„å¤„ç†é€Ÿåº¦ï¼Œå¦‚æœæœ‰äº›å¤„ç†å¯ä»¥åœ¨é¡µé¢ç”Ÿæˆå®Œåå†è¿›è¡Œï¼Œå°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ã€‚</p><a id="more"></a><p>å¬èµ·æ¥å¯èƒ½æœ‰äº›èŒ«ç„¶ï¼Œæˆ‘ä»¬é€šè¿‡å‡ ä¸ªä¾‹å­æ¥è¯´æ˜ä¸€ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="string">'ä¾‹å­ï¼š'</span>;</span><br><span class="line"></span><br><span class="line">fastcgi_finish_request();</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">'To be, or not to be, that is the question.'</span>;</span><br><span class="line"></span><br><span class="line">file_put_contents(<span class="string">'log.txt'</span>, <span class="string">'ç”Ÿå­˜è¿˜æ˜¯æ¯ç­ï¼Œè¿™æ˜¯ä¸ªé—®é¢˜ã€‚'</span>);</span><br></pre></td></tr></table></figure><p>é€šè¿‡æµè§ˆå™¨ï¼ˆä¸æ˜¯å‘½ä»¤è¡Œï¼ï¼‰è¿è¡Œæ­¤è„šæœ¬ï¼Œç»“æœå‘ç°å¹¶æ²¡æœ‰è¾“å‡ºç›¸åº”çš„å­—ç¬¦ä¸²ï¼Œä½†å´ç”Ÿæˆäº†ç›¸åº”çš„æ–‡ä»¶ã€‚ç”±æ­¤è¯´æ˜åœ¨è°ƒç”¨<code>fastcgi_finish_request</code>åï¼Œå®¢æˆ·ç«¯å“åº”å°±å·²ç»ç»“æŸï¼Œä½†ä¸æ­¤åŒæ—¶æœåŠ¡ç«¯è„šæœ¬å´ç»§ç»­è¿è¡Œï¼</p><p>åˆç†åˆ©ç”¨è¿™ä¸ªç‰¹æ€§å¯ä»¥å¤§å¤§æå‡ç”¨æˆ·ä½“éªŒï¼Œè¶çƒ­æ‰“é“å†æ¥ä¸€ä¸ªä¾‹å­ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="string">'ä¾‹å­ï¼š'</span>;</span><br><span class="line"></span><br><span class="line">file_put_contents(<span class="string">'log.txt'</span>, date(<span class="string">'Y-m-d H:i:s'</span>) . <span class="string">" ä¸Šä¼ è§†é¢‘\n"</span>, FILE_APPEND);</span><br><span class="line"></span><br><span class="line">fastcgi_finish_request();</span><br><span class="line"></span><br><span class="line">sleep(<span class="number">1</span>);</span><br><span class="line">file_put_contents(<span class="string">'log.txt'</span>, date(<span class="string">'Y-m-d H:i:s'</span>) . <span class="string">" è½¬æ¢æ ¼å¼\n"</span>, FILE_APPEND);</span><br><span class="line"></span><br><span class="line">sleep(<span class="number">1</span>);</span><br><span class="line">file_put_contents(<span class="string">'log.txt'</span>, date(<span class="string">'Y-m-d H:i:s'</span>) . <span class="string">" æå–å›¾ç‰‡\n"</span>, FILE_APPEND);</span><br></pre></td></tr></table></figure><p>ä»£ç é‡Œç”¨<code>sleep</code>æ¨¡æ‹Ÿä¸€äº›è€—æ—¶çš„æ“ä½œï¼Œæµè§ˆæ—¶æ²¡æœ‰è¢«å µå¡ï¼Œç¨‹åºå´éƒ½æ‰§è¡Œäº†ï¼Œå…·ä½“çœ‹æ—¥å¿—ã€‚</p><p>æœ«äº†ç»™æ‚¨æä¸ªé†’ï¼Œ<code>Yahoo</code> åœ¨ <code>Best Practices for Speeding Up Your Web Site</code> ä¸­æåˆ°äº† <code>Flush the Buffer Early</code>ï¼Œä¹Ÿå°±æ˜¯åˆ©ç”¨PHPä¸­çš„flushæ–¹æ³•æŠŠå†…å®¹å°½å¿«å‘åˆ°å®¢æˆ·ç«¯å»ï¼Œè™½ç„¶è¡¨é¢ä¸Šå®ƒå’Œæœ¬æ–‡ä»‹ç»çš„fastcgi_finish_requestæœ‰äº›è®¸çš„ç±»ä¼¼ï¼Œä½†æœ¬è´¨ä¸Šå®Œå…¨ä¸åŒï¼Œåˆ«æ··æ·†äº†ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> php </tag>
            
            <tag> nginx </tag>
            
            <tag> fastcgi </tag>
            
            <tag> request </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æœåŠ¡å™¨è¿”å›çŠ¶æ€ç è¯¦è§£</title>
      <link href="/http-status-codes-images-desc/"/>
      <url>/http-status-codes-images-desc/</url>
      
        <content type="html"><![CDATA[<p>ä»¥å‰åªæ˜¯çœ‹çš„æ¯ç‡¥çš„æ–‡å­—ç‰ˆçš„æœåŠ¡å™¨è¿”å›çŠ¶æ€ç .<br>ç°åœ¨ï¼Œçœ‹ä¸€å¼ æ¯”è¾ƒå½¢è±¡çš„å›¾è§£,å¸Œæœ›èƒ½å¢å¼ºè®°å¿†.ç‚¹å‡»å›¾ç‰‡çœ‹å¤§å›¾.</p><a id="more"></a><table><thead><tr><th align="left">çŠ¶æ€ç </th><th align="left">è¯´æ˜</th></tr></thead><tbody><tr><td align="left">400</td><td align="left">è¯·æ±‚æ— æ•ˆ</td></tr><tr><td align="left">401.1</td><td align="left">æœªæˆæƒï¼šç™»å½•å¤±è´¥</td></tr><tr><td align="left">401.2</td><td align="left">æœªæˆæƒï¼šæœåŠ¡å™¨é…ç½®é—®é¢˜å¯¼è‡´ç™»å½•å¤±è´¥</td></tr><tr><td align="left">401.3</td><td align="left">ACL ç¦æ­¢è®¿é—®èµ„æº</td></tr><tr><td align="left">401.4</td><td align="left">æœªæˆæƒï¼šæˆæƒè¢«ç­›é€‰å™¨æ‹’ç»</td></tr><tr><td align="left">401.5</td><td align="left">æœªæˆæƒï¼šISAPI æˆ– CGI æˆæƒå¤±è´¥</td></tr><tr><td align="left">403</td><td align="left">ç¦æ­¢è®¿é—®</td></tr><tr><td align="left">403</td><td align="left">å¯¹ Internet æœåŠ¡ç®¡ç†å™¨ (HTML) çš„è®¿é—®ä»…é™äº Localhost</td></tr><tr><td align="left">403.1</td><td align="left">ç¦æ­¢è®¿é—®ï¼šç¦æ­¢å¯æ‰§è¡Œè®¿é—®</td></tr><tr><td align="left">403.2</td><td align="left">ç¦æ­¢è®¿é—®ï¼šç¦æ­¢è¯»è®¿é—®</td></tr><tr><td align="left">403.3</td><td align="left">ç¦æ­¢è®¿é—®ï¼šç¦æ­¢å†™è®¿é—®</td></tr><tr><td align="left">403.4</td><td align="left">ç¦æ­¢è®¿é—®ï¼šè¦æ±‚ SSL</td></tr><tr><td align="left">403.5</td><td align="left">ç¦æ­¢è®¿é—®ï¼šè¦æ±‚ SSL 128</td></tr><tr><td align="left">403.6</td><td align="left">ç¦æ­¢è®¿é—®ï¼šIP åœ°å€è¢«æ‹’ç»</td></tr><tr><td align="left">403.7</td><td align="left">ç¦æ­¢è®¿é—®ï¼šè¦æ±‚å®¢æˆ·è¯ä¹¦</td></tr><tr><td align="left">403.8</td><td align="left">ç¦æ­¢è®¿é—®ï¼šç¦æ­¢ç«™ç‚¹è®¿é—®</td></tr><tr><td align="left">403.9</td><td align="left">ç¦æ­¢è®¿é—®ï¼šè¿æ¥çš„ç”¨æˆ·è¿‡å¤š</td></tr><tr><td align="left">403.10</td><td align="left">ç¦æ­¢è®¿é—®ï¼šé…ç½®æ— æ•ˆ</td></tr><tr><td align="left">403.11</td><td align="left">ç¦æ­¢è®¿é—®ï¼šå¯†ç æ›´æ”¹</td></tr><tr><td align="left">403.12</td><td align="left">ç¦æ­¢è®¿é—®ï¼šæ˜ å°„å™¨æ‹’ç»è®¿é—®</td></tr><tr><td align="left">403.13</td><td align="left">ç¦æ­¢è®¿é—®ï¼šå®¢æˆ·è¯ä¹¦å·²è¢«åŠé”€</td></tr><tr><td align="left">403.15</td><td align="left">ç¦æ­¢è®¿é—®ï¼šå®¢æˆ·è®¿é—®è®¸å¯è¿‡å¤š</td></tr><tr><td align="left">403.16</td><td align="left">ç¦æ­¢è®¿é—®ï¼šå®¢æˆ·è¯ä¹¦ä¸å¯ä¿¡æˆ–è€…æ— æ•ˆ</td></tr><tr><td align="left">403.17</td><td align="left">ç¦æ­¢è®¿é—®ï¼šå®¢æˆ·è¯ä¹¦å·²ç»åˆ°æœŸæˆ–è€…å°šæœªç”Ÿæ•ˆ</td></tr><tr><td align="left">404.1</td><td align="left">æ— æ³•æ‰¾åˆ° Web ç«™ç‚¹</td></tr><tr><td align="left">404</td><td align="left">æ— æ³•æ‰¾åˆ°æ–‡ä»¶</td></tr><tr><td align="left">405</td><td align="left">èµ„æºè¢«ç¦æ­¢</td></tr><tr><td align="left">406</td><td align="left">æ— æ³•æ¥å—</td></tr><tr><td align="left">407</td><td align="left">è¦æ±‚ä»£ç†èº«ä»½éªŒè¯</td></tr><tr><td align="left">410</td><td align="left">æ°¸è¿œä¸å¯ç”¨</td></tr><tr><td align="left">412</td><td align="left">å…ˆå†³æ¡ä»¶å¤±è´¥</td></tr><tr><td align="left">414</td><td align="left">è¯·æ±‚-URI å¤ªé•¿</td></tr><tr><td align="left">500</td><td align="left">å†…éƒ¨æœåŠ¡å™¨é”™è¯¯</td></tr><tr><td align="left">500.100</td><td align="left">å†…éƒ¨æœåŠ¡å™¨é”™è¯¯-ASP é”™è¯¯</td></tr><tr><td align="left">500-11</td><td align="left">æœåŠ¡å™¨å…³é—­</td></tr><tr><td align="left">500-12</td><td align="left">åº”ç”¨ç¨‹åºé‡æ–°å¯åŠ¨</td></tr><tr><td align="left">500-13</td><td align="left">æœåŠ¡å™¨å¤ªå¿™</td></tr><tr><td align="left">500-14</td><td align="left">åº”ç”¨ç¨‹åºæ— æ•ˆ</td></tr><tr><td align="left">500-15</td><td align="left">ä¸å…è®¸è¯·æ±‚ global.asa</td></tr><tr><td align="left">501</td><td align="left">æœªå®ç°</td></tr><tr><td align="left">502</td><td align="left">ç½‘å…³é”™è¯¯</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> å‰ç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> http </tag>
            
            <tag> status_code </tag>
            
            <tag> çŠ¶æ€ç  </tag>
            
            <tag> æœåŠ¡å™¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®¾ç½®vimä½œä¸ºcrontab -eçš„é»˜è®¤ç¼–è¾‘å™¨</title>
      <link href="/set-vim-for-crontab-default-edito/"/>
      <url>/set-vim-for-crontab-default-edito/</url>
      
        <content type="html"><![CDATA[<p>ä¹ æƒ¯äº†ç”¨vimä¿®æ”¹crontabå†…å®¹ï¼Œå¯æœ‰äº›ç³»ç»Ÿé»˜è®¤çš„æ˜¯nanoï¼Œç”¨èµ·æ¥ç”šæ˜¯ç—›è‹¦ï¼ŒGoogleæœç´¢äº†ä¸€ä¸‹ï¼Œæ‰¾åˆ°ä¸‹é¢æ–¹æ³•ï¼š</p><a id="more"></a><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"export EDITOR=/usr/bin/vim"</span> &gt;&gt; .bashrc</span><br></pre></td></tr></table></figure><p>ç„¶åé‡æ–°æ‰“å¼€ç»ˆç«¯ï¼Œè¾“å…¥ <code>crontab -e</code>ï¼Œå‘ç°å·²ç»é»˜è®¤ä½¿ç”¨ <code>vim</code> äº†ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> åç«¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> vim </tag>
            
            <tag> crontab </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å…³äº</title>
      <link href="/about/"/>
      <url>/about/</url>
      
        <content type="html"><![CDATA[<h2 id="ç½‘ç»œID"><a href="#ç½‘ç»œID" class="headerlink" title="ç½‘ç»œID"></a>ç½‘ç»œID</h2><ul><li>å–µäº†ä¸ªå’ª</li><li>æ¸¸ç¦»ä¸2</li><li>Deeka<a id="more"></a></li></ul><h2 id="æ¯•ä¸šé™¢æ ¡"><a href="#æ¯•ä¸šé™¢æ ¡" class="headerlink" title="æ¯•ä¸šé™¢æ ¡"></a>æ¯•ä¸šé™¢æ ¡</h2><ul><li><a href="http://www.gdpa.edu.cn/" target="_blank" rel="noopener">èŒ‚åå­¦é™¢ï¼ˆå¹¿ä¸œçŸ³æ²¹åŒ–å·¥å­¦é™¢ï¼‰</a></li></ul><h2 id="ä¸“ä¸š"><a href="#ä¸“ä¸š" class="headerlink" title="ä¸“ä¸š"></a>ä¸“ä¸š</h2><ul><li>è®¡ç®—æœºç½‘ç»œæŠ€æœ¯</li></ul><h2 id="æŠ€èƒ½"><a href="#æŠ€èƒ½" class="headerlink" title="æŠ€èƒ½"></a>æŠ€èƒ½</h2><h3 id="è¯­è¨€"><a href="#è¯­è¨€" class="headerlink" title="è¯­è¨€"></a>è¯­è¨€</h3><ul><li>PHP</li><li>Golang</li><li>NodeJS</li><li>Lua</li></ul><h3 id="æ•°æ®åº“"><a href="#æ•°æ®åº“" class="headerlink" title="æ•°æ®åº“"></a>æ•°æ®åº“</h3><ul><li>MySQL</li><li>NoSQL/MongoDB</li></ul><h3 id="ç¼“å­˜"><a href="#ç¼“å­˜" class="headerlink" title="ç¼“å­˜"></a>ç¼“å­˜</h3><ul><li>Redis</li><li>Memcached</li><li>Ssdb</li></ul><h3 id="æ¡†æ¶"><a href="#æ¡†æ¶" class="headerlink" title="æ¡†æ¶"></a>æ¡†æ¶</h3><ul><li>Laravel/Lumen</li><li>ThinkPHP</li><li>JQuery/Vue</li></ul><h2 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h2><ul><li>æœåŠ¡å™¨è¿ç»´</li><li>K8S</li></ul><h2 id="å…³æ³¨æˆ‘"><a href="#å…³æ³¨æˆ‘" class="headerlink" title="å…³æ³¨æˆ‘"></a>å…³æ³¨æˆ‘</h2><ul><li><a href="https://github.com/huangdijia" target="_blank" rel="noopener">GitHub</a></li><li><a href="https://packagist.org/packages/huangdijia/" target="_blank" rel="noopener">Packages</a></li><li><a href="http://twitter.com/huangdijia" target="_blank" rel="noopener">Twitter</a></li></ul><h2 id="è”ç³»æˆ‘"><a href="#è”ç³»æˆ‘" class="headerlink" title="è”ç³»æˆ‘"></a>è”ç³»æˆ‘</h2><ul><li>Emailï¼š<a href="mailto:huangdijia@gmail.com" target="_blank" rel="noopener">huangdijia@gmail.com</a></li></ul>]]></content>
      
      
      
    </entry>
    
    
  
  
    
    
    <entry>
      <title>å…¨éƒ¨åˆ†ç±»</title>
      <link href="/categories/index.html"/>
      <url>/categories/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>å…¨éƒ¨æ ‡ç­¾</title>
      <link href="/tags/index.html"/>
      <url>/tags/index.html</url>
      
        <content type="html"><![CDATA[]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/lib/pjax/package.json"/>
      <url>/lib/pjax/package.json</url>
      
        <content type="html"><![CDATA[{"name":"pjax","version":"0.2.8","description":"Easily enable fast AJAX navigation on any website (using pushState + XHR)","keywords":["pjax","pushstate","ajax","navigation","transition","animation"],"repository":"https://github.com/MoOx/pjax.git","author":"Maxime Thirouin","contributors":["BehindTheMath","Robin North (http://robinnorth.co.uk)"],"license":"MIT","main":"index.js","files":["index.js","lib","pjax.js","pjax.min.js","index.d.ts"],"types":"index.d.ts","devDependencies":{"browserify":"^15.0.0","eslint":"^5.7.0","eslint-config-i-am-meticulous":"^11.0.0","husky":"^1.2.0","jsdom":"^11.5.1","jsdom-global":"^3.0.2","lint-staged":"^8.1.0","npmpub":"^3.1.0","nyc":"^11.4.1","opn-cli":"^3.1.0","prettier":"^1.14.3","serve":"^11.3.2","tap-nyc":"^1.0.3","tap-spec":"^4.1.1","tape":"^4.8.0","uglify-js":"^3.3.8"},"scripts":{"lint":"eslint .","standalone":"browserify index.js --standalone Pjax > pjax.js","build":"npm run standalone && uglifyjs pjax.js -o pjax.min.js","build-debug":"browserify index.js --debug --standalone Pjax > pjax.js","tests":"tape -r ./tests/setup.js \"./tests/**/*.js\"","test":"npm run lint && npm run tests | tap-spec","coverage-tests":"npm run tests | tap-nyc","coverage":"nyc -x \"tests/**\" npm run coverage-tests","example":"opn http://localhost:3000/example/ && serve -p 3000 .","prepublish":"npm run build","release":"npmpub"},"husky":{"hooks":{"pre-commit":"npm test && lint-staged"}},"lint-staged":{"*.js":["eslint --fix","prettier --write","git add"]}}]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/lib/pjax/index.js"/>
      <url>/lib/pjax/index.js</url>
      
        <content type="html"><![CDATA[// var executeScripts = require("./lib/execute-scripts");  // unused-varvar forEachEls = require("./lib/foreach-els");var parseOptions = require("./lib/parse-options");var switches = require("./lib/switches");var newUid = require("./lib/uniqueid");var on = require("./lib/events/on");var trigger = require("./lib/events/trigger");var clone = require("./lib/util/clone");var contains = require("./lib/util/contains");var extend = require("./lib/util/extend");var noop = require("./lib/util/noop");var Pjax = function(options) {  this.state = {    numPendingSwitches: 0,    href: null,    options: null  };  this.options = parseOptions(options);  this.log("Pjax options", this.options);  if (this.options.scrollRestoration && "scrollRestoration" in history) {    history.scrollRestoration = "manual";  }  this.maxUid = this.lastUid = newUid();  this.parseDOM(document);  on(    window,    "popstate",    function(st) {      if (st.state) {        var opt = clone(this.options);        opt.url = st.state.url;        opt.title = st.state.title;        // Since state already exists, prevent it from being pushed again        opt.history = false;        opt.scrollPos = st.state.scrollPos;        if (st.state.uid < this.lastUid) {          opt.backward = true;        } else {          opt.forward = true;        }        this.lastUid = st.state.uid;        // @todo implement history cache here, based on uid        this.loadUrl(st.state.url, opt);      }    }.bind(this)  );};Pjax.switches = switches;Pjax.prototype = {  log: require("./lib/proto/log"),  getElements: function(el) {    return el.querySelectorAll(this.options.elements);  },  parseDOM: function(el) {    var parseElement = require("./lib/proto/parse-element");    forEachEls(this.getElements(el), parseElement, this);  },  refresh: function(el) {    this.parseDOM(el || document);  },  reload: function() {    window.location.reload();  },  attachLink: require("./lib/proto/attach-link"),  attachForm: require("./lib/proto/attach-form"),  forEachSelectors: function(cb, context, DOMcontext) {    return require("./lib/foreach-selectors").bind(this)(      this.options.selectors,      cb,      context,      DOMcontext    );  },  switchSelectors: function(selectors, fromEl, toEl, options) {    return require("./lib/switches-selectors").bind(this)(      this.options.switches,      this.options.switchesOptions,      selectors,      fromEl,      toEl,      options    );  },  latestChance: function(href) {    window.location = href;  },  onSwitch: function() {    trigger(window, "resize scroll");    this.state.numPendingSwitches--;    // debounce calls, so we only run this once after all switches are finished.    if (this.state.numPendingSwitches === 0) {      this.afterAllSwitches();    }  },  loadContent: function(html, options) {    if (typeof html !== "string") {      trigger(document, "pjax:complete pjax:error", options);      return;    }    var tmpEl = document.implementation.createHTMLDocument("pjax");    // parse HTML attributes to copy them    // since we are forced to use documentElement.innerHTML (outerHTML can't be used for <html>)    var htmlRegex = /<html[^>]+>/gi;    var htmlAttribsRegex = /\s?[a-z:]+(?:=['"][^'">]+['"])*/gi;    var matches = html.match(htmlRegex);    if (matches && matches.length) {      matches = matches[0].match(htmlAttribsRegex);      if (matches.length) {        matches.shift();        matches.forEach(function(htmlAttrib) {          var attr = htmlAttrib.trim().split("=");          if (attr.length === 1) {            tmpEl.documentElement.setAttribute(attr[0], true);          } else {            tmpEl.documentElement.setAttribute(attr[0], attr[1].slice(1, -1));          }        });      }    }    tmpEl.documentElement.innerHTML = html;    this.log(      "load content",      tmpEl.documentElement.attributes,      tmpEl.documentElement.innerHTML.length    );    // Clear out any focused controls before inserting new page contents.    if (      document.activeElement &&      contains(document, this.options.selectors, document.activeElement)    ) {      try {        document.activeElement.blur();      } catch (e) {} // eslint-disable-line no-empty    }    this.switchSelectors(this.options.selectors, tmpEl, document, options);  },  abortRequest: require("./lib/abort-request"),  doRequest: require("./lib/send-request"),  handleResponse: require("./lib/proto/handle-response"),  loadUrl: function(href, options) {    options =      typeof options === "object"        ? extend({}, this.options, options)        : clone(this.options);    this.log("load href", href, options);    // Abort any previous request    this.abortRequest(this.request);    trigger(document, "pjax:send", options);    // Do the request    this.request = this.doRequest(      href,      options,      this.handleResponse.bind(this)    );  },  afterAllSwitches: function() {    // FF bug: Wonâ€™t autofocus fields that are inserted via JS.    // This behavior is incorrect. So if theres no current focus, autofocus    // the last field.    //    // http://www.w3.org/html/wg/drafts/html/master/forms.html    var autofocusEl = Array.prototype.slice      .call(document.querySelectorAll("[autofocus]"))      .pop();    if (autofocusEl && document.activeElement !== autofocusEl) {      autofocusEl.focus();    }    // execute scripts when DOM have been completely updated    this.options.selectors.forEach(function(selector) {      forEachEls(document.querySelectorAll(selector), function(el) {        // executeScripts(el);        if (el === 0) ;  // intentially left blank!      });    });    var state = this.state;    if (state.options.history) {      if (!window.history.state) {        this.lastUid = this.maxUid = newUid();        window.history.replaceState(          {            url: window.location.href,            title: document.title,            uid: this.maxUid,            scrollPos: [0, 0]          },          document.title        );      }      // Update browser history      this.lastUid = this.maxUid = newUid();      window.history.pushState(        {          url: state.href,          title: state.options.title,          uid: this.maxUid,          scrollPos: [0, 0]        },        state.options.title,        state.href      );    }    this.forEachSelectors(function(el) {      this.parseDOM(el);    }, this);    // Fire Events    trigger(document, "pjax:complete pjax:success", state.options);    if (typeof state.options.analytics === "function") {      state.options.analytics();    }    if (state.options.history) {      // First parse url and check for hash to override scroll      var a = document.createElement("a");      a.href = this.state.href;      if (a.hash) {        var name = a.hash.slice(1);        name = decodeURIComponent(name);        var curtop = 0;        var target =          document.getElementById(name) || document.getElementsByName(name)[0];        if (target) {          // http://stackoverflow.com/questions/8111094/cross-browser-javascript-function-to-find-actual-position-of-an-element-in-page          if (target.offsetParent) {            do {              curtop += target.offsetTop;              target = target.offsetParent;            } while (target);          }        }        window.scrollTo(0, curtop);      } else if (state.options.scrollTo !== false) {        // Scroll page to top on new page load        if (state.options.scrollTo.length > 1) {          window.scrollTo(state.options.scrollTo[0], state.options.scrollTo[1]);        } else {          window.scrollTo(0, state.options.scrollTo);        }      }    } else if (state.options.scrollRestoration && state.options.scrollPos) {      window.scrollTo(state.options.scrollPos[0], state.options.scrollPos[1]);    }    this.state = {      numPendingSwitches: 0,      href: null,      options: null    };  }};Pjax.isSupported = require("./lib/is-supported");// arguably could do `if( require("./lib/is-supported")()) {` but that might be a little to simpleif (Pjax.isSupported()) {  module.exports = Pjax;}// if there isnâ€™t required browser functions, returning stupid apielse {  var stupidPjax = noop;  for (var key in Pjax.prototype) {    if (      Pjax.prototype.hasOwnProperty(key) &&      typeof Pjax.prototype[key] === "function"    ) {      stupidPjax[key] = noop;    }  }  module.exports = stupidPjax;}</html[^></html>]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/lib/pjax/CHANGELOG.html"/>
      <url>/lib/pjax/CHANGELOG.html</url>
      
        <content type="html"><![CDATA[<h1 id="0-2-8-2019-03-09"><a href="#0-2-8-2019-03-09" class="headerlink" title="0.2.8 - 2019-03-09"></a>0.2.8 - 2019-03-09</h1><ul><li>Fixed: Edge form support.<br>(<a href="https://github.com/MoOx/pjax/pull/178" target="_blank" rel="noopener">#178</a> - @robinnorth)</li><li>Fixed: Removed keyup event listener for forms.<br>(<a href="https://github.com/MoOx/pjax/pull/184" target="_blank" rel="noopener">#184</a> - @BehindTheMath)</li><li>Fixed: Bugs in evalScripts().<br>(<a href="https://github.com/MoOx/pjax/pull/186" target="_blank" rel="noopener">#186</a> - @BehindTheMath)</li><li>Fixed: Handle non-string HTML passed to loadContent().<br>(<a href="https://github.com/MoOx/pjax/pull/200" target="_blank" rel="noopener">#200</a> - @BehindTheMath)</li><li>Tooling: Switch linting to ESLint and Prettier.<br>(<a href="https://github.com/MoOx/pjax/pull/191" target="_blank" rel="noopener">#191</a> - @BehindTheMath)</li></ul><h1 id="0-2-7-2018-08-15"><a href="#0-2-7-2018-08-15" class="headerlink" title="0.2.7 - 2018-08-15"></a>0.2.7 - 2018-08-15</h1><ul><li>Fixed: Parsing values of option elements in forms.<br>(<a href="https://github.com/MoOx/pjax/pull/162" target="_blank" rel="noopener">#162</a> - @BehindTheMath)</li><li>Fixed: Added index.d.ts to package.json so it will be installed by npm.<br>(<a href="https://github.com/MoOx/pjax/commit/c589ab9c25bee6161bf3e557eaca44e51c14fb89" target="_blank" rel="noopener">c589ab9</a> - @BehindTheMath)</li><li>Fixed: <code>options.history</code> to correctly parse being set to false.<br>(<a href="https://github.com/MoOx/pjax/pull/165" target="_blank" rel="noopener">#165</a> - @BehindTheMath).</li><li>Fixed: Pass the current <code>options</code> object to <code>loadContent()</code>.<br>(<a href="https://github.com/MoOx/pjax/pull/171" target="_blank" rel="noopener">#171</a> - @BehindTheMath)</li><li>Fixed: Ensure correct XHR encoding for multipart/form-data forms<br>(<a href="https://github.com/MoOx/pjax/pull/174" target="_blank" rel="noopener">#174</a> - @BehindTheMath)</li><li>Added: More documentation.<br>(<a href="https://github.com/MoOx/pjax/pull/160" target="_blank" rel="noopener">#160</a>, <a href="https://github.com/MoOx/pjax/pull/171" target="_blank" rel="noopener">#171</a> - @robinnorth, @BehindTheMath)</li></ul><h1 id="0-2-6-2018-04-30"><a href="#0-2-6-2018-04-30" class="headerlink" title="0.2.6 - 2018-04-30"></a>0.2.6 - 2018-04-30</h1><ul><li>Fixed: Form submission for GET requests.<br>(<a href="https://github.com/MoOx/pjax/pull/129" target="_blank" rel="noopener">#129</a> - @robinnorth)</li><li>Fixed: Refactor <code>loadUrl()</code> to make manually calling simpler.<br>(<a href="https://github.com/MoOx/pjax/pull/134" target="_blank" rel="noopener">#134</a> - @robinnorth)</li><li>Fixed: Support multiple select fields in form submissions.<br>(<a href="https://github.com/MoOx/pjax/pull/147" target="_blank" rel="noopener">#147</a> - @robinnorth)</li><li>Fixed: Use the same options object in <code>handle-response</code> as in <code>send-request</code>. This way, <code>pjax.state.options</code> will also have the request options.<br>(<a href="https://github.com/MoOx/pjax/pull/148" target="_blank" rel="noopener">#148</a> - @BehindTheMath)</li><li>Added: Move the XHR callback to a separate method, and trigger an error event if the response cannot be parsed.<br>(<a href="https://github.com/MoOx/pjax/pull/137" target="_blank" rel="noopener">#137</a> - @BehindTheMath)</li><li>Added: TypeScript definitions.<br>(<a href="https://github.com/MoOx/pjax/pull/138" target="_blank" rel="noopener">#138</a> - @BehindTheMath)</li><li>Added: <code>replaceNode</code> switch, as an alternative to the <code>outerHTML</code> switch.<br>(<a href="https://github.com/MoOx/pjax/pull/141" target="_blank" rel="noopener">#141</a> - @BehindTheMath)</li><li>Added: <code>X-PJAX-Selectors</code> HTTP header. This is a serialized JSON array of selectors, taken from <code>options.selectors</code>. You can use this to send back only the elements that Pjax will use to switch, instead of sending the whole page.<br>(<a href="https://github.com/MoOx/pjax/pull/144" target="_blank" rel="noopener">#144</a> - @BehindTheMath)</li><li>Added: An option to use <code>FormData</code> to submit forms.<br>(<a href="https://github.com/MoOx/pjax/pull/153" target="_blank" rel="noopener">#153</a> - @BehindTheMath)</li><li>Added: Tests.<br>(<a href="https://github.com/MoOx/pjax/commit/f98f2dd63b48113ff91b6bd8808257bfc723ef6b" target="_blank" rel="noopener">f98f2dd</a>, <a href="https://github.com/MoOx/pjax/pull/145" target="_blank" rel="noopener">#145</a> - @robinnorth, @BehindTheMath)</li></ul><h1 id="0-2-5-2018-02-02"><a href="#0-2-5-2018-02-02" class="headerlink" title="0.2.5 - 2018-02-02"></a>0.2.5 - 2018-02-02</h1><ul><li>Fixed: Async switch functions now work correctly, because the DOM is now parsed after all the switches finish.<br>(<a href="https://github.com/MoOx/pjax/pull/79" target="_blank" rel="noopener">#79</a>, <a href="https://github.com/MoOx/pjax/pull/110" target="_blank" rel="noopener">#110</a> - @oskarrough, @BehindTheMath, @robinnorth)</li><li>Fixed: Bug on IE11 preventing AJAX page refresh.<br>(<a href="https://github.com/MoOx/pjax/pull/81" target="_blank" rel="noopener">#81</a> - @CPTechnikVX)</li><li>Fixed: Default switches are now available as <code>Pjax.switches</code>.<br>(<a href="https://github.com/MoOx/pjax/pull/92" target="_blank" rel="noopener">#92</a> - @BehindTheMath)</li><li>Fixed: An error that was caused by a missing <code>switchElementsAlt</code>.<br>(<a href="https://github.com/MoOx/pjax/pull/93" target="_blank" rel="noopener">#93</a>, <a href="https://github.com/MoOx/pjax/pull/104" target="_blank" rel="noopener">#104</a> - @BehindTheMath, @robinnorth)</li><li>Fixed: Incorrect <code>main</code> field in npm package<br>(<a href="https://github.com/MoOx/pjax/pull/105" target="_blank" rel="noopener">#105</a> - @robinnorth)</li><li>Fixed: A pending XHR is now aborted if the user navigates somewhere else before the request is finished.<br>(<a href="https://github.com/MoOx/pjax/pull/114" target="_blank" rel="noopener">#114</a> - @robinnorth)</li><li>Fixed: When rendering new content, focus will now be removed only from elements within one of the containers manipulated by Pjax.<br>(<a href="https://github.com/MoOx/pjax/pull/116" target="_blank" rel="noopener">#116</a> - @BehindTheMath)</li><li>Fixed: Stop dispatching extraneous <code>pjax:complete</code> events when external scripts load<br>(<a href="https://github.com/MoOx/pjax/pull/118" target="_blank" rel="noopener">#118</a> - @robinnorth)</li><li>Added: Send the <code>X-PJAX</code> header with XHR requests.<br>(<a href="https://github.com/MoOx/pjax/pull/80" target="_blank" rel="noopener">#80</a> - @bram1028)</li><li>Added: Direct download link for script tags. (@MoOx)</li><li>Added: Pass the element that triggered Pjax to the <code>pjax:send</code> event.<br>(<a href="https://github.com/MoOx/pjax/pull/94" target="_blank" rel="noopener">#94</a> - @BehindTheMath)</li><li>Added: An option to set a timeout for XHR requests.<br>(<a href="https://github.com/MoOx/pjax/pull/95" target="_blank" rel="noopener">#95</a> - @BehindTheMath)</li><li>Added: Checks for XHR redirects<br>(<a href="https://github.com/MoOx/pjax/pull/101" target="_blank" rel="noopener">#101</a> - @BehindTheMath)</li><li>Added: Save scroll position with history, and restore when navigating backwards or forwards.<br>(<a href="https://github.com/MoOx/pjax/pull/110" target="_blank" rel="noopener">#110</a>, <a href="https://github.com/MoOx/pjax/pull/119" target="_blank" rel="noopener">#119</a> - @BehindTheMath, @robinnorth)</li><li>Added: Scroll to element position when URL contains a hash<br>(<a href="https://github.com/MoOx/pjax/pull/110" target="_blank" rel="noopener">#110</a> - @BehindTheMath)</li><li>Added: Minified version of the Pjax bundle.<br>(<a href="https://github.com/MoOx/pjax/pull/115" target="_blank" rel="noopener">#115</a> - @BehindTheMath)</li><li>Changed: Miscellaneous code and tests cleanup.<br>(<a href="https://github.com/MoOx/pjax/pull/96" target="_blank" rel="noopener">#96</a>, <a href="https://github.com/MoOx/pjax/pull/98" target="_blank" rel="noopener">#98</a>, <a href="https://github.com/MoOx/pjax/pull/99" target="_blank" rel="noopener">#99</a>, <a href="https://github.com/MoOx/pjax/pull/1070" target="_blank" rel="noopener">#100</a>, <a href="https://github.com/MoOx/pjax/pull/107" target="_blank" rel="noopener">#107</a>, <a href="https://github.com/MoOx/pjax/pull/113" target="_blank" rel="noopener">#113</a>, <a href="https://github.com/MoOx/pjax/pull/120" target="_blank" rel="noopener">#120</a> - @BehindTheMath, @MoOx, @robinnorth)</li></ul><h1 id="0-2-4-2016-06-28"><a href="#0-2-4-2016-06-28" class="headerlink" title="0.2.4 - 2016-06-28"></a>0.2.4 - 2016-06-28</h1><ul><li>Fixed: <code>refresh</code> should now work (use <code>this.parseDOM</code> for refresh)<br>(<a href="https://github.com/MoOx/pjax/pull/67" target="_blank" rel="noopener">#67</a> - @compressed)</li><li>Fixed: Some attributes, such as <code>itemscope</code> have no corresponding value.<br>This change allows them to still be set.<br>(<a href="https://github.com/MoOx/pjax/pull/67" target="_blank" rel="noopener">#67</a> - @compressed)</li><li>Added: <code>cacheBust</code> option<br>(<a href="https://github.com/MoOx/pjax/pull/71" target="_blank" rel="noopener">#71</a> - @tremby)</li></ul><h1 id="0-2-3-2016-03-24"><a href="#0-2-3-2016-03-24" class="headerlink" title="0.2.3 - 2016-03-24"></a>0.2.3 - 2016-03-24</h1><ul><li>Fixed: <code>currentUrlFullReload</code> option now works</li><li>Fixed: <code>this.reload</code> is now a Function<br>(<a href="https://github.com/MoOx/pjax/issues/65" target="_blank" rel="noopener">#65</a>)</li></ul><h1 id="0-2-2-2016-03-12"><a href="#0-2-2-2016-03-12" class="headerlink" title="0.2.2 - 2016-03-12"></a>0.2.2 - 2016-03-12</h1><ul><li>Fixed: added back standalone version in <code>./pjax.js</code><br>(<a href="https://github.com/MoOx/pjax/issues/57" target="_blank" rel="noopener">#57</a></li><li>Fixed: error when using pjax with google analytics (<code>options</code> was undefined)<br>(<a href="https://github.com/MoOx/pjax/pull/59" target="_blank" rel="noopener">#59</a>)</li><li>Fixed: HierarchyRequestError error<br>(<a href="https://github.com/MoOx/pjax/pull/49" target="_blank" rel="noopener">#49</a>)</li><li>Fixed: <code>TypeError: Pjax.forEachEls is not a function</code><br>(<a href="https://github.com/MoOx/pjax/pull/52" target="_blank" rel="noopener">#52</a>)</li><li>Fixed: <code>TypeError: Pjax.executeScripts is not a function</code><br>(<a href="https://github.com/MoOx/pjax/pull/52" target="_blank" rel="noopener">#52</a>)</li><li>Fixed: <code>TypeError: Pjax.clone is not a function</code><br>(<a href="https://github.com/MoOx/pjax/pull/52" target="_blank" rel="noopener">#52</a>)</li><li>Added: Ignore events with prevented defaults<br>(<a href="https://github.com/MoOx/pjax/pull/50" target="_blank" rel="noopener">#50</a>)</li></ul><h1 id="0-2-1-2015-02-04"><a href="#0-2-1-2015-02-04" class="headerlink" title="0.2.1 - 2015-02-04"></a>0.2.1 - 2015-02-04</h1><ul><li>Fixed: itâ€™s better when a release have actual files.</li></ul><h1 id="0-2-0-2015-02-04"><a href="#0-2-0-2015-02-04" class="headerlink" title="0.2.0 - 2015-02-04"></a>0.2.0 - 2015-02-04</h1><ul><li>Fixed: prevent scrollTo from being converted from false to 0 (<a href="https://github.com/MoOx/pjax/pull/33" target="_blank" rel="noopener">#33</a>)</li><li>Changed: code exploded in commonjs style</li><li>Added: lots of tests</li><li>Added: <code>refresh</code> method to force update a DOM element (<a href="https://github.com/MoOx/pjax/pull/36" target="_blank" rel="noopener">#36</a>)</li></ul><h1 id="0-1-4-2014-10-14"><a href="#0-1-4-2014-10-14" class="headerlink" title="0.1.4 - 2014-10-14"></a>0.1.4 - 2014-10-14</h1><ul><li>Fixed: allow to load pages without any attributes on <code>&lt;html&gt;</code> element (fix <a href="https://github.com/MoOx/pjax/issues/6" target="_blank" rel="noopener">#6</a>)</li><li>Fixed: make <code>Pjax.switches.sideBySide</code> method usable (fix <a href="https://github.com/MoOx/pjax/issues/13" target="_blank" rel="noopener">#13</a>)</li></ul><h1 id="0-1-3-2014-09-16"><a href="#0-1-3-2014-09-16" class="headerlink" title="0.1.3 - 2014-09-16"></a>0.1.3 - 2014-09-16</h1><ul><li>Fixed: clicking on the current url somewhere does not produce a full reload by default (see option <code>currentUrlFullReload</code>)</li><li>Fixed: <code>document.implementation.createHTMLDocument</code> error (in IE10, ref <a href="https://github.com/MoOx/pjax/pull/16" target="_blank" rel="noopener">#16</a>)</li></ul><h1 id="0-1-2-2014-04-03"><a href="#0-1-2-2014-04-03" class="headerlink" title="0.1.2 - 2014-04-03"></a>0.1.2 - 2014-04-03</h1><ul><li>Changed: <code>pjax.js</code> relocated in <code>src/</code></li><li>Fixed: <code>&lt;html&gt;</code> attributes of pjaxified document are now available</li></ul><h1 id="0-1-1-2014-04-02"><a href="#0-1-1-2014-04-02" class="headerlink" title="0.1.1 - 2014-04-02"></a>0.1.1 - 2014-04-02</h1><ul><li>Fixed: safer UMD wrapper (fix concat issue)</li></ul><h1 id="0-1-0-2014-03-24"><a href="#0-1-0-2014-03-24" class="headerlink" title="0.1.0 - 2014-03-24"></a>0.1.0 - 2014-03-24</h1><p>âœ¨ Initial release</p>]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/lib/pjax/pjax.min.js"/>
      <url>/lib/pjax/pjax.min.js</url>
      
        <content type="html"><![CDATA[(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.Pjax=f()}})(function(){var define,module,exports;return function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r}()({1:[function(require,module,exports){var executescripts="require("./lib/execute-scripts");var" foreachels="require("./lib/foreach-els");var" parseoptions="require("./lib/parse-options");var" switches="require("./lib/switches");var" newuid="require("./lib/uniqueid");var" on="require("./lib/events/on");var" trigger="require("./lib/events/trigger");var" clone="require("./lib/util/clone");var" contains="require("./lib/util/contains");var" extend="require("./lib/util/extend");var" noop="require("./lib/util/noop");var" pjax="function(options){this.state={numPendingSwitches:0,href:null,options:null};this.options=parseOptions(options);this.log("Pjax" options",this.options);if(this.options.scrollrestoration&&"scrollrestoration"in history){history.scrollrestoration="manual" }this.maxuid="this.lastUid=newUid();this.parseDOM(document);on(window,"popstate",function(st){if(st.state){var" opt="clone(this.options);opt.url=st.state.url;opt.title=st.state.title;opt.history=false;opt.scrollPos=st.state.scrollPos;if(st.state.uid<this.lastUid){opt.backward=true}else{opt.forward=true}this.lastUid=st.state.uid;this.loadUrl(st.state.url,opt)}}.bind(this))};Pjax.switches=switches;Pjax.prototype={log:require("./lib/proto/log"),getElements:function(el){return" el.queryselectorall(this.options.elements)},parsedom:function(el){var parseelement="require("./lib/proto/parse-element");forEachEls(this.getElements(el),parseElement,this)},refresh:function(el){this.parseDOM(el||document)},reload:function(){window.location.reload()},attachLink:require("./lib/proto/attach-link"),attachForm:require("./lib/proto/attach-form"),forEachSelectors:function(cb,context,DOMcontext){return" require(". lib foreach-selectors").bind(this)(this.options.selectors,cb,context,domcontext)},switchselectors:function(selectors,fromel,toel,options){return switches-selectors").bind(this)(this.options.switches,this.options.switchesoptions,selectors,fromel,toel,options)},latestchance:function(href){window.location="href},onSwitch:function(){trigger(window,"resize" scroll");this.state.numpendingswitches--;if(this.state.numpendingswitches="==0){this.afterAllSwitches()}},loadContent:function(html,options){if(typeof" html!="="string"){trigger(document,"pjax:complete" pjax:error",options);return}var tmpel="document.implementation.createHTMLDocument("pjax");var" htmlregex="/<html[^">]+>/gi;var htmlAttribsRegex=/\s?[a-z:]+(?:=['"][^'">]+['"])*/gi;var matches=html.match(htmlRegex);if(matches&&matches.length){matches=matches[0].match(htmlAttribsRegex);if(matches.length){matches.shift();matches.forEach(function(htmlAttrib){var attr=htmlAttrib.trim().split("=");if(attr.length===1){tmpEl.documentElement.setAttribute(attr[0],true)}else{tmpEl.documentElement.setAttribute(attr[0],attr[1].slice(1,-1))}})}}tmpEl.documentElement.innerHTML=html;this.log("load content",tmpEl.documentElement.attributes,tmpEl.documentElement.innerHTML.length);if(document.activeElement&&contains(document,this.options.selectors,document.activeElement)){try{document.activeElement.blur()}catch(e){}}this.switchSelectors(this.options.selectors,tmpEl,document,options)},abortRequest:require("./lib/abort-request"),doRequest:require("./lib/send-request"),handleResponse:require("./lib/proto/handle-response"),loadUrl:function(href,options){options=typeof options==="object"?extend({},this.options,options):clone(this.options);this.log("load href",href,options);this.abortRequest(this.request);trigger(document,"pjax:send",options);this.request=this.doRequest(href,options,this.handleResponse.bind(this))},afterAllSwitches:function(){var autofocusEl=Array.prototype.slice.call(document.querySelectorAll("[autofocus]")).pop();if(autofocusEl&&document.activeElement!==autofocusEl){autofocusEl.focus()}this.options.selectors.forEach(function(selector){forEachEls(document.querySelectorAll(selector),function(el){})});var state=this.state;if(state.options.history){if(!window.history.state){this.lastUid=this.maxUid=newUid();window.history.replaceState({url:window.location.href,title:document.title,uid:this.maxUid,scrollPos:[0,0]},document.title)}this.lastUid=this.maxUid=newUid();window.history.pushState({url:state.href,title:state.options.title,uid:this.maxUid,scrollPos:[0,0]},state.options.title,state.href)}this.forEachSelectors(function(el){this.parseDOM(el)},this);trigger(document,"pjax:complete pjax:success",state.options);if(typeof state.options.analytics==="function"){state.options.analytics()}if(state.options.history){var a=document.createElement("a");a.href=this.state.href;if(a.hash){var name=a.hash.slice(1);name=decodeURIComponent(name);var curtop=0;var target=document.getElementById(name)||document.getElementsByName(name)[0];if(target){if(target.offsetParent){do{curtop+=target.offsetTop;target=target.offsetParent}while(target)}}window.scrollTo(0,curtop)}else if(state.options.scrollTo!==false){if(state.options.scrollTo.length>1){window.scrollTo(state.options.scrollTo[0],state.options.scrollTo[1])}else{window.scrollTo(0,state.options.scrollTo)}}}else if(state.options.scrollRestoration&&state.options.scrollPos){window.scrollTo(state.options.scrollPos[0],state.options.scrollPos[1])}this.state={numPendingSwitches:0,href:null,options:null}}};Pjax.isSupported=require("./lib/is-supported");if(Pjax.isSupported()){module.exports=Pjax}else{var stupidPjax=noop;for(var key in Pjax.prototype){if(Pjax.prototype.hasOwnProperty(key)&&typeof Pjax.prototype[key]==="function"){stupidPjax[key]=noop}}module.exports=stupidPjax}},{"./lib/abort-request":2,"./lib/events/on":4,"./lib/events/trigger":5,"./lib/execute-scripts":6,"./lib/foreach-els":7,"./lib/foreach-selectors":8,"./lib/is-supported":9,"./lib/parse-options":10,"./lib/proto/attach-form":11,"./lib/proto/attach-link":12,"./lib/proto/handle-response":13,"./lib/proto/log":14,"./lib/proto/parse-element":15,"./lib/send-request":16,"./lib/switches":18,"./lib/switches-selectors":17,"./lib/uniqueid":19,"./lib/util/clone":20,"./lib/util/contains":21,"./lib/util/extend":22,"./lib/util/noop":23}],2:[function(require,module,exports){var noop=require("./util/noop");module.exports=function(request){if(request&&request.readyState<4){request.onreadystatechange=noop;request.abort()}}},{". util noop":23}],3:[function(require,module,exports){module.exports="function(el){var" code="el.text||el.textContent||el.innerHTML||"";var" src="el.src||"";var" parent="el.parentNode||document.querySelector("head")||document.documentElement;var" script="document.createElement("script");if(code.match("document.write")){if(console&&console.log){console.log("Script" contains document.write. canâ€™t be executed correctly. skipped ",el)}return false}script.type="text/javascript" ;script.id="el.id;if(src!==""){script.src=src;script.async=false}if(code!==""){try{script.appendChild(document.createTextNode(code))}catch(e){script.text=code}}parent.appendChild(script);if((parent" instanceof htmlheadelement||parent htmlbodyelement)&&parent.contains(script)){parent.removechild(script)}return true}},{}],4:[function(require,module,exports){var foreachels="require("../foreach-els");module.exports=function(els,events,listener,useCapture){events=typeof" events="=="string"?events.split("" "):events;events.foreach(function(e){foreachels(els,function(el){el.addeventlistener(e,listener,usecapture)})})}},{".. foreach-els":7}],5:[function(require,module,exports){var "):events;events.foreach(function(e){var event;event="document.createEvent("HTMLEvents");event.initEvent(e,true,true);event.eventName=e;if(opts){Object.keys(opts).forEach(function(key){event[key]=opts[key]})}forEachEls(els,function(el){var" domfix="false;if(!el.parentNode&&el!==document&&el!==window){domFix=true;document.body.appendChild(el)}el.dispatchEvent(event);if(domFix){el.parentNode.removeChild(el)}})})}},{"../foreach-els":7}],6:[function(require,module,exports){var" evalscript="require("./eval-script");module.exports=function(el){if(el.tagName.toLowerCase()==="script"){evalScript(el)}forEachEls(el.querySelectorAll("script"),function(script){if(!script.type||script.type.toLowerCase()==="text/javascript"){if(script.parentNode){script.parentNode.removeChild(script)}evalScript(script)}})}},{"./eval-script":3,"./foreach-els":7}],7:[function(require,module,exports){module.exports=function(els,fn,context){if(els" htmlcollection||els nodelist||els array){return array.prototype.foreach.call(els,fn,context)}return fn.call(context,els)}},{}],8:[function(require,module,exports){var window.history&&window.history.pushstate&&window.history.replacestate&&!navigator.useragent.match( ((ipod|iphone|ipad).+\bos\s+[1-4]\d|webapps\ .+cfnetwork) )}},{}],10:[function(require,module,exports){var defaultswitches="require("./switches");module.exports=function(options){options=options||{};options.elements=options.elements||"a[href]," form[action]";options.selectors="options.selectors||["title",".js-Pjax"];options.switches=options.switches||{};options.switchesOptions=options.switchesOptions||{};options.history=typeof" options.history="=="undefined"?true:options.history;options.analytics=typeof" options.analytics="=="function"||options.analytics===false?options.analytics:defaultAnalytics;options.scrollTo=typeof" options.scrollto="=="undefined"?0:options.scrollTo;options.scrollRestoration=typeof" options.scrollrestoration!="="undefined"?options.scrollRestoration:true;options.cacheBust=typeof" options.cachebust="=="undefined"?true:options.cacheBust;options.debug=options.debug||false;options.timeout=options.timeout||0;options.currentUrlFullReload=typeof" options.currenturlfullreload="=="undefined"?false:options.currentUrlFullReload;if(!options.switches.head){options.switches.head=defaultSwitches.switchElementsAlt}if(!options.switches.body){options.switches.body=defaultSwitches.switchElementsAlt}return" options};function defaultanalytics(){if(window._gaq){_gaq.push(["_trackpageview"])}if(window.ga){ga("send","pageview",{page:location.pathname,title:document.title})}}},{". switches":18}],11:[function(require,module,exports){var on="require("../events/on");var" clone="require("../util/clone");var" attrstate="data-pjax-state" ;var formaction="function(el,event){if(isDefaultPrevented(event)){return}var" options="clone(this.options);options.requestOptions={requestUrl:el.getAttribute("action")||window.location.href,requestMethod:el.getAttribute("method")||"GET"};var" virtlinkelement="document.createElement("a");virtLinkElement.setAttribute("href",options.requestOptions.requestUrl);var" attrvalue="checkIfShouldAbort(virtLinkElement,options);if(attrValue){el.setAttribute(attrState,attrValue);return}event.preventDefault();if(el.enctype==="multipart/form-data"){options.requestOptions.formData=new" formdata(el)}else{options.requestoptions.requestparams="parseFormElements(el)}el.setAttribute(attrState,"submit");options.triggerElement=el;this.loadUrl(virtLinkElement.href,options)};function" parseformelements(el){var requestparams="[];var" formelements="el.elements;for(var" i="0;i<formElements.length;i++){var" element="formElements[i];var" tagname="element.tagName.toLowerCase();if(!!element.name&&element.attributes!==undefined&&tagName!=="button"){var" type="element.attributes.type;if(!type||type.value!=="checkbox"&&type.value!=="radio"||element.checked){var" values="[];if(tagName==="select"){var" opt;for(var j="0;j<element.options.length;j++){opt=element.options[j];if(opt.selected&&!opt.disabled){values.push(opt.hasAttribute("value")?opt.value:opt.text)}}}else{values.push(element.value)}for(var" k="0;k<values.length;k++){requestParams.push({name:encodeURIComponent(element.name),value:encodeURIComponent(values[k])})}}}}return" requestparams}function checkifshouldabort(virtlinkelement,options){if(virtlinkelement.protocol!="=window.location.protocol||virtLinkElement.host!==window.location.host){return"external"}if(virtLinkElement.hash&&virtLinkElement.href.replace(virtLinkElement.hash,"")===window.location.href.replace(location.hash,"")){return"anchor"}if(virtLinkElement.href===window.location.href.split("#")[0]+"#"){return"anchor-empty"}if(options.currentUrlFullReload&&virtLinkElement.href===window.location.href.split("#")[0]){return"reload"}}var" isdefaultprevented="function(event){return" event.defaultprevented||event.returnvalue="==false};module.exports=function(el){var" that="this;el.setAttribute(attrState,"");on(el,"submit",function(event){formAction.call(that,el,event)})}},{"../events/on":4,"../util/clone":20}],12:[function(require,module,exports){var" linkaction="function(el,event){if(isDefaultPrevented(event)){return}var" checkifshouldabort(el,event){if(event.which>1||event.metaKey||event.ctrlKey||event.shiftKey||event.altKey){return"modifier"}if(el.protocol!==window.location.protocol||el.host!==window.location.host){return"external"}if(el.hash&&el.href.replace(el.hash,"")===window.location.href.replace(location.hash,"")){return"anchor"}if(el.href===window.location.href.split("#")[0]+"#"){return"anchor-empty"}}var isDefaultPrevented=function(event){return event.defaultPrevented||event.returnValue===false};module.exports=function(el){var that=this;el.setAttribute(attrState,"");on(el,"click",function(event){linkAction.call(that,el,event)});on(el,"keyup",function(event){if(event.keyCode===13){linkAction.call(that,el,event)}}.bind(this))}},{"../events/on":4,"../util/clone":20}],13:[function(require,module,exports){var clone=require("../util/clone");var newUid=require("../uniqueid");var trigger=require("../events/trigger");module.exports=function(responseText,request,href,options){options=clone(options||this.options);options.request=request;if(responseText===false){trigger(document,"pjax:complete pjax:error",options);return}var currentState=window.history.state||{};window.history.replaceState({url:currentState.url||window.location.href,title:currentState.title||document.title,uid:currentState.uid||newUid(),scrollPos:[document.documentElement.scrollLeft||document.body.scrollLeft,document.documentElement.scrollTop||document.body.scrollTop]},document.title,window.location.href);var oldHref=href;if(request.responseURL){if(href!==request.responseURL){href=request.responseURL}}else if(request.getResponseHeader("X-PJAX-URL")){href=request.getResponseHeader("X-PJAX-URL")}else if(request.getResponseHeader("X-XHR-Redirected-To")){href=request.getResponseHeader("X-XHR-Redirected-To")}var a=document.createElement("a");a.href=oldHref;var oldHash=a.hash;a.href=href;if(oldHash&&!a.hash){a.hash=oldHash;href=a.href}this.state.href=href;this.state.options=options;try{this.loadContent(responseText,options)}catch(e){trigger(document,"pjax:error",options);if(!this.options.debug){if(console&&console.error){console.error("Pjax switch fail: ",e)}return this.latestChance(href)}else{throw e}}}},{"../events/trigger":5,"../uniqueid":19,"../util/clone":20}],14:[function(require,module,exports){module.exports=function(){if(this.options.debug&&console){if(typeof console.log==="function"){console.log.apply(console,arguments)}else if(console.log){console.log(arguments)}}}},{}],15:[function(require,module,exports){var attrState="data-pjax-state";module.exports=function(el){switch(el.tagName.toLowerCase()){case"a":if(!el.hasAttribute(attrState)){this.attachLink(el)}break;case"form":if(!el.hasAttribute(attrState)){this.attachForm(el)}break;default:throw"Pjax can only be applied on <a> or <form> submit"}}},{}],16:[function(require,module,exports){var updateQueryString=require("./util/update-query-string");module.exports=function(location,options,callback){options=options||{};var queryString;var requestOptions=options.requestOptions||{};var requestMethod=(requestOptions.requestMethod||"GET").toUpperCase();var requestParams=requestOptions.requestParams||null;var formData=requestOptions.formData||null;var requestPayload=null;var request=new XMLHttpRequest;var timeout=options.timeout||0;request.onreadystatechange=function(){if(request.readyState===4){if(request.status===200){callback(request.responseText,request,location,options)}else if(request.status!==0){callback(null,request,location,options)}}};request.onerror=function(e){console.log(e);callback(null,request,location,options)};request.ontimeout=function(){callback(null,request,location,options)};if(requestParams&&requestParams.length){queryString=requestParams.map(function(param){return param.name+"="+param.value}).join("&");switch(requestMethod){case"GET":location=location.split("?")[0];location+="?"+queryString;break;case"POST":requestPayload=queryString;break}}else if(formData){requestPayload=formData}if(options.cacheBust){location=updateQueryString(location,"t",Date.now())}request.open(requestMethod,location,true);request.timeout=timeout;request.setRequestHeader("X-Requested-With","XMLHttpRequest");request.setRequestHeader("X-PJAX","true");request.setRequestHeader("X-PJAX-Selectors",JSON.stringify(options.selectors));if(requestPayload&&requestMethod==="POST"&&!formData){request.setRequestHeader("Content-Type","application/x-www-form-urlencoded")}request.send(requestPayload);return request}},{"./util/update-query-string":24}],17:[function(require,module,exports){var forEachEls=require("./foreach-els");var defaultSwitches=require("./switches");module.exports=function(switches,switchesOptions,selectors,fromEl,toEl,options){var switchesQueue=[];selectors.forEach(function(selector){var newEls=fromEl.querySelectorAll(selector);var oldEls=toEl.querySelectorAll(selector);if(this.log){this.log("Pjax switch",selector,newEls,oldEls)}if(newEls.length!==oldEls.length){throw"DOM doesnâ€™t look the same on new loaded page: â€™"+selector+"â€™ - new "+newEls.length+", old "+oldEls.length}forEachEls(newEls,function(newEl,i){var oldEl=oldEls[i];if(this.log){this.log("newEl",newEl,"oldEl",oldEl)}var callback=switches[selector]?switches[selector].bind(this,oldEl,newEl,options,switchesOptions[selector]):defaultSwitches.outerHTML.bind(this,oldEl,newEl,options);switchesQueue.push(callback)},this)},this);this.state.numPendingSwitches=switchesQueue.length;switchesQueue.forEach(function(queuedSwitch){queuedSwitch()})}},{"./foreach-els":7,"./switches":18}],18:[function(require,module,exports){var on=require("./events/on");module.exports={outerHTML:function(oldEl,newEl){oldEl.outerHTML=newEl.outerHTML;this.onSwitch()},innerHTML:function(oldEl,newEl){oldEl.innerHTML=newEl.innerHTML;if(newEl.className===""){oldEl.removeAttribute("class")}else{}this.onSwitch()},switchElementsAlt:function(oldEl,newEl){oldEl.innerHTML=newEl.innerHTML;if(newEl.hasAttributes()){var attrs=newEl.attributes;for(var i=0;i</form></a></4){request.onreadystatechange=noop;request.abort()}}},{".></t.length;i++)o(t[i]);return>]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/lib/pjax/example/index.html"/>
      <url>/lib/pjax/example/index.html</url>
      
        <content type="html"><![CDATA[<!doctype html><html>  <head><meta name="generator" content="Hexo 3.9.0">    <meta charset="utf-8">    <title>Hello</title>    <script src="../pjax.js"></script>    <script src="example.js"></script>  </head>  <body>    <div class="body">      <h1>Index</h1>      Hello.      Go to <a href="page2.html" class="js-Pjax">Page 2</a> or <a href="page3.html" class="js-Pjax">Page 3</a> and view your console to see Pjax events.      Clicking on <a href="index.html">this page</a> will do nothing.      <h2>Manual URL loading</h2>      You can use Pjax's <i>loadUrl</i> method to manually load a URL. Click the buttons below to try it out!<br><br>      <button data-manual-trigger>loadUrl with current options</button><br><br>      <button data-manual-trigger data-manual-trigger-override="true">loadUrl with overridden options (no cache busting)</button>      <h2>Forms</h2>      You can submit GET or POST forms with Pjax! Go to the <a href="forms.html">form examples</a> to try it out.    </div>  </body></html>]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/lib/pjax/example/page2.html"/>
      <url>/lib/pjax/example/page2.html</url>
      
        <content type="html"><![CDATA[<!doctype html><html>  <head><meta name="generator" content="Hexo 3.9.0">    <meta charset="utf-8">    <title>Page 2</title>    <script src="../pjax.js"></script>    <script src="example.js"></script>  </head>  <body>    <div class="body">      <h1>Page 2</h1>      Hello. Go to <a href="index.html" class="js-Pjax">Index</a>.    </div>  </body></html>]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/lib/pjax/example/example.js"/>
      <url>/lib/pjax/example/example.js</url>
      
        <content type="html"><![CDATA[/* global Pjax */var pjax;var initButtons = function() {  var buttons = document.querySelectorAll("button[data-manual-trigger]");  if (!buttons) {    return;  }  // jshint -W083  for (var i = 0; i < buttons.length; i++) {    buttons[i].addEventListener("click", function(e) {      var el = e.currentTarget;      if (el.getAttribute("data-manual-trigger-override") === "true") {        // Manually load URL with overridden Pjax instance options        pjax.loadUrl("/example/page2.html", { cacheBust: false });      } else {        // Manually load URL with current Pjax instance options        pjax.loadUrl("/example/page2.html");      }    });  }  // jshint +W083};console.log("Document initialized:", window.location.href);document.addEventListener("pjax:send", function() {  console.log("Event: pjax:send", arguments);});document.addEventListener("pjax:complete", function() {  console.log("Event: pjax:complete", arguments);});document.addEventListener("pjax:error", function() {  console.log("Event: pjax:error", arguments);});document.addEventListener("pjax:success", function() {  console.log("Event: pjax:success", arguments);  // Init page content  initButtons();});document.addEventListener("DOMContentLoaded", function() {  // Init Pjax instance  pjax = new Pjax({    elements: [".js-Pjax"],    selectors: [".body", "title"],    cacheBust: true  });  console.log("Pjax initialized.", pjax);  // Init page content  initButtons();});]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/lib/pjax/example/page3.html"/>
      <url>/lib/pjax/example/page3.html</url>
      
        <content type="html"><![CDATA[<!doctype html><html>  <head><meta name="generator" content="Hexo 3.9.0">    <meta charset="utf-8">    <title>Page 3</title>    <script src="../pjax.js"></script>    <script src="example.js"></script>  </head>  <body>    <div class="body">      <h1>Page 3</h1>      Hello. Go to <a href="index.html" class="js-Pjax">Index</a>.    </div>  </body></html>]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/lib/pjax/example/forms.html"/>
      <url>/lib/pjax/example/forms.html</url>
      
        <content type="html"><![CDATA[<!doctype html><html>  <head><meta name="generator" content="Hexo 3.9.0">    <meta charset="utf-8">    <title>Forms</title>    <script src="../pjax.js"></script>    <script src="example.js"></script>  </head>  <body>    <div class="body">      <h1>Forms</h1>      Hello. Try out the examples below and inspect the results in your browser's developer tools, or go to the <a href="index.html" class="js-Pjax">Index</a>.      <h3>GET form</h3>      <form action method="get" class="js-Pjax" id="get-form">        <label for="get-form-text">Text input:</label>        <input type="text" name="textInput" id="get-form-text" value="Foobar">        <br>        <br>        <label for="get-form-number">Number input:</label>        <input type="number" name="numberInput" id="get-form-number" value="1">        <br>        <br>        <label for="get-form-email">Email input:</label>        <input type="email" name="emailInput" id="get-form-email" value="example@example.com">        <br>        <br>        <label for="get-form-textarea">Textarea:</label>        <textarea name="textarea" id="get-form-textarea">This is some text</textarea>        <br>        <br>        <fieldset>          <label for="get-form-radio-1">Radio input:</label>          <input type="radio" name="radioInput" value="radio-1" checked id="get-form-radio-1">          <label for="get-form-radio-2">Radio input alt:</label>          <input type="radio" name="radioInput" value="radio-2" id="get-form-radio-2">        </fieldset>        <br>        <br>        <label for="get-form-checkbox">Checkbox input:</label>        <input type="checkbox" name="checkboxInput" checked id="get-form-checkbox">        <br>        <br>        <label for="get-form-select">Select list:</label>        <select multiple name="select" id="get-form-select">          <option>            Option 1          </option>          <option>            Option 2          </option>        </select>        <br>        <br>        <input type="submit" value="Submit">      </form>      <br>      <br>      <h3>POST form</h3>      <form action method="post" class="js-Pjax" id="post-form">        <label for="post-form-text">Text input:</label>        <input type="text" name="textInput" id="post-form-text" value="Foobar">        <br>        <br>        <label for="post-form-number">Number input:</label>        <input type="number" name="numberInput" id="post-form-number" value="1">        <br>        <br>        <label for="post-form-email">Email input:</label>        <input type="email" name="emailInput" id="post-form-email" value="example@example.com">        <br>        <br>        <label for="post-form-textarea">Textarea:</label>        <textarea name="textarea" id="post-form-textarea">This is some text</textarea>        <br>        <br>        <fieldset>          <label for="post-form-radio-1">Radio input:</label>          <input type="radio" name="radioInput" value="radio-1" checked id="post-form-radio-1">          <label for="post-form-radio-2">Radio input alt:</label>          <input type="radio" name="radioInput" value="radio-2" id="post-form-radio-2">        </fieldset>        <br>        <br>        <label for="post-form-checkbox">Checkbox input:</label>        <input type="checkbox" name="checkboxInput" checked id="post-form-checkbox">        <br>        <br>        <label for="post-form-select">Select list:</label>        <select multiple name="select" id="post-form-select">          <option>            Option 1          </option>          <option>            Option 2          </option>        </select>        <br>        <br>        <input type="submit" value="Submit">      </form>    </div>  </body></html>]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/lib/pjax/lib/abort-request.js"/>
      <url>/lib/pjax/lib/abort-request.js</url>
      
        <content type="html"><![CDATA[var noop = require("./util/noop");module.exports = function(request) {  if (request && request.readyState < 4) {    request.onreadystatechange = noop;    request.abort();  }};]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/lib/pjax/lib/eval-script.js"/>
      <url>/lib/pjax/lib/eval-script.js</url>
      
        <content type="html"><![CDATA[module.exports = function(el) {  var code = el.text || el.textContent || el.innerHTML || "";  var src = el.src || "";  var parent =    el.parentNode || document.querySelector("head") || document.documentElement;  var script = document.createElement("script");  if (code.match("document.write")) {    if (console && console.log) {      console.log(        "Script contains document.write. Canâ€™t be executed correctly. Code skipped ",        el      );    }    return false;  }  script.type = "text/javascript";  script.id = el.id;  /* istanbul ignore if */  if (src !== "") {    script.src = src;    script.async = false; // force synchronous loading of peripheral JS  }  if (code !== "") {    try {      script.appendChild(document.createTextNode(code));    } catch (e) {      /* istanbul ignore next */      // old IEs have funky script nodes      script.text = code;    }  }  // execute  parent.appendChild(script);  // avoid pollution only in head or body tags  if (    (parent instanceof HTMLHeadElement || parent instanceof HTMLBodyElement) &&    parent.contains(script)  ) {    parent.removeChild(script);  }  return true;};]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/lib/pjax/lib/execute-scripts.js"/>
      <url>/lib/pjax/lib/execute-scripts.js</url>
      
        <content type="html"><![CDATA[var forEachEls = require("./foreach-els");var evalScript = require("./eval-script");// Finds and executes scripts (used for newly added elements)// Needed since innerHTML does not run scriptsmodule.exports = function(el) {  if (el.tagName.toLowerCase() === "script") {    evalScript(el);  }  forEachEls(el.querySelectorAll("script"), function(script) {    if (!script.type || script.type.toLowerCase() === "text/javascript") {      if (script.parentNode) {        script.parentNode.removeChild(script);      }      evalScript(script);    }  });};]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/lib/pjax/lib/foreach-selectors.js"/>
      <url>/lib/pjax/lib/foreach-selectors.js</url>
      
        <content type="html"><![CDATA[var forEachEls = require("./foreach-els");module.exports = function(selectors, cb, context, DOMcontext) {  DOMcontext = DOMcontext || document;  selectors.forEach(function(selector) {    forEachEls(DOMcontext.querySelectorAll(selector), cb, context);  });};]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/lib/pjax/lib/foreach-els.js"/>
      <url>/lib/pjax/lib/foreach-els.js</url>
      
        <content type="html"><![CDATA[/* global HTMLCollection: true */module.exports = function(els, fn, context) {  if (    els instanceof HTMLCollection ||    els instanceof NodeList ||    els instanceof Array  ) {    return Array.prototype.forEach.call(els, fn, context);  }  // assume simple DOM element  return fn.call(context, els);};]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/lib/pjax/lib/is-supported.js"/>
      <url>/lib/pjax/lib/is-supported.js</url>
      
        <content type="html"><![CDATA[module.exports = function() {  // Borrowed wholesale from https://github.com/defunkt/jquery-pjax  return (    window.history &&    window.history.pushState &&    window.history.replaceState &&    // pushState isnâ€™t reliable on iOS until 5.    !navigator.userAgent.match(      /((iPod|iPhone|iPad).+\bOS\s+[1-4]\D|WebApps\/.+CFNetwork)/    )  );};]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/lib/pjax/lib/parse-options.js"/>
      <url>/lib/pjax/lib/parse-options.js</url>
      
        <content type="html"><![CDATA[/* global _gaq: true, ga: true */var defaultSwitches = require("./switches");module.exports = function(options) {  options = options || {};  options.elements = options.elements || "a[href], form[action]";  options.selectors = options.selectors || ["title", ".js-Pjax"];  options.switches = options.switches || {};  options.switchesOptions = options.switchesOptions || {};  options.history =    typeof options.history === "undefined" ? true : options.history;  options.analytics =    typeof options.analytics === "function" || options.analytics === false      ? options.analytics      : defaultAnalytics;  options.scrollTo =    typeof options.scrollTo === "undefined" ? 0 : options.scrollTo;  options.scrollRestoration =    typeof options.scrollRestoration !== "undefined"      ? options.scrollRestoration      : true;  options.cacheBust =    typeof options.cacheBust === "undefined" ? true : options.cacheBust;  options.debug = options.debug || false;  options.timeout = options.timeout || 0;  options.currentUrlFullReload =    typeof options.currentUrlFullReload === "undefined"      ? false      : options.currentUrlFullReload;  // We canâ€™t replace body.outerHTML or head.outerHTML.  // It creates a bug where a new body or head are created in the DOM.  // If you set head.outerHTML, a new body tag is appended, so the DOM has 2 body nodes, and vice versa  if (!options.switches.head) {    options.switches.head = defaultSwitches.switchElementsAlt;  }  if (!options.switches.body) {    options.switches.body = defaultSwitches.switchElementsAlt;  }  return options;};/* istanbul ignore next */function defaultAnalytics() {  if (window._gaq) {    _gaq.push(["_trackPageview"]);  }  if (window.ga) {    ga("send", "pageview", { page: location.pathname, title: document.title });  }}]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/lib/pjax/lib/send-request.js"/>
      <url>/lib/pjax/lib/send-request.js</url>
      
        <content type="html"><![CDATA[var updateQueryString = require("./util/update-query-string");module.exports = function(location, options, callback) {  options = options || {};  var queryString;  var requestOptions = options.requestOptions || {};  var requestMethod = (requestOptions.requestMethod || "GET").toUpperCase();  var requestParams = requestOptions.requestParams || null;  var formData = requestOptions.formData || null;  var requestPayload = null;  var request = new XMLHttpRequest();  var timeout = options.timeout || 0;  request.onreadystatechange = function() {    if (request.readyState === 4) {      if (request.status === 200) {        callback(request.responseText, request, location, options);      } else if (request.status !== 0) {        callback(null, request, location, options);      }    }  };  request.onerror = function(e) {    console.log(e);    callback(null, request, location, options);  };  request.ontimeout = function() {    callback(null, request, location, options);  };  // Prepare the request payload for forms, if available  if (requestParams && requestParams.length) {    // Build query string    queryString = requestParams      .map(function(param) {        return param.name + "=" + param.value;      })      .join("&");    switch (requestMethod) {      case "GET":        // Reset query string to avoid an issue with repeat submissions where checkboxes that were        // previously checked are incorrectly preserved        location = location.split("?")[0];        // Append new query string        location += "?" + queryString;        break;      case "POST":        // Send query string as request payload        requestPayload = queryString;        break;    }  } else if (formData) {    requestPayload = formData;  }  // Add a timestamp as part of the query string if cache busting is enabled  if (options.cacheBust) {    location = updateQueryString(location, "t", Date.now());  }  request.open(requestMethod, location, true);  request.timeout = timeout;  request.setRequestHeader("X-Requested-With", "XMLHttpRequest");  request.setRequestHeader("X-PJAX", "true");  request.setRequestHeader(    "X-PJAX-Selectors",    JSON.stringify(options.selectors)  );  // Send the proper header information for POST forms  if (requestPayload && requestMethod === "POST" && !formData) {    request.setRequestHeader(      "Content-Type",      "application/x-www-form-urlencoded"    );  }  request.send(requestPayload);  return request;};]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/lib/pjax/lib/switches-selectors.js"/>
      <url>/lib/pjax/lib/switches-selectors.js</url>
      
        <content type="html"><![CDATA[var forEachEls = require("./foreach-els");var defaultSwitches = require("./switches");module.exports = function(  switches,  switchesOptions,  selectors,  fromEl,  toEl,  options) {  var switchesQueue = [];  selectors.forEach(function(selector) {    var newEls = fromEl.querySelectorAll(selector);    var oldEls = toEl.querySelectorAll(selector);    if (this.log) {      this.log("Pjax switch", selector, newEls, oldEls);    }    if (newEls.length !== oldEls.length) {      throw "DOM doesnâ€™t look the same on new loaded page: â€™" +        selector +        "â€™ - new " +        newEls.length +        ", old " +        oldEls.length;    }    forEachEls(      newEls,      function(newEl, i) {        var oldEl = oldEls[i];        if (this.log) {          this.log("newEl", newEl, "oldEl", oldEl);        }        var callback = switches[selector]          ? switches[selector].bind(              this,              oldEl,              newEl,              options,              switchesOptions[selector]            )          : defaultSwitches.outerHTML.bind(this, oldEl, newEl, options);        switchesQueue.push(callback);      },      this    );  }, this);  this.state.numPendingSwitches = switchesQueue.length;  switchesQueue.forEach(function(queuedSwitch) {    queuedSwitch();  });};]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/lib/pjax/lib/uniqueid.js"/>
      <url>/lib/pjax/lib/uniqueid.js</url>
      
        <content type="html"><![CDATA[module.exports = (function() {  var counter = 0;  return function() {    var id = "pjax" + new Date().getTime() + "_" + counter;    counter++;    return id;  };})();]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/lib/pjax/lib/switches.js"/>
      <url>/lib/pjax/lib/switches.js</url>
      
        <content type="html"><![CDATA[var on = require("./events/on");module.exports = {  outerHTML: function(oldEl, newEl) {    oldEl.outerHTML = newEl.outerHTML;    this.onSwitch();  },  innerHTML: function(oldEl, newEl) {    oldEl.innerHTML = newEl.innerHTML;    if (newEl.className === "") {      oldEl.removeAttribute("class");    } else {      //oldEl.className = newEl.className;    }    this.onSwitch();  },  switchElementsAlt: function(oldEl, newEl) {    oldEl.innerHTML = newEl.innerHTML;    // Copy attributes from the new element to the old one    if (newEl.hasAttributes()) {      var attrs = newEl.attributes;      for (var i = 0; i < attrs.length; i++) {        oldEl.attributes.setNamedItem(attrs[i].cloneNode());      }    }    this.onSwitch();  },  // Equivalent to outerHTML(), but doesn't require switchElementsAlt() for <head> and </head><body>  replaceNode: function(oldEl, newEl) {    oldEl.parentNode.replaceChild(newEl, oldEl);    this.onSwitch();  },  sideBySide: function(oldEl, newEl, options, switchOptions) {    var forEach = Array.prototype.forEach;    var elsToRemove = [];    var elsToAdd = [];    var fragToAppend = document.createDocumentFragment();    var animationEventNames =      "animationend webkitAnimationEnd MSAnimationEnd oanimationend";    var animatedElsNumber = 0;    var sexyAnimationEnd = function(e) {      if (e.target !== e.currentTarget) {        // end triggered by an animation on a child        return;      }      animatedElsNumber--;      if (animatedElsNumber </body>]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/lib/pjax/tests/setup.js"/>
      <url>/lib/pjax/tests/setup.js</url>
      
        <content type="html"><![CDATA[var jsdomOptions = {  url: "https://example.org/",  runScripts: "dangerously"};require("jsdom-global")("", jsdomOptions);]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/lib/pjax/pjax.js"/>
      <url>/lib/pjax/pjax.js</url>
      
        <content type="html"><![CDATA[(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.Pjax = f()}})(function(){var define,module,exports;return (function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){ var executescripts="require("./lib/execute-scripts");" foreachels="require("./lib/foreach-els");" parseoptions="require("./lib/parse-options");" switches="require("./lib/switches");" newuid="require("./lib/uniqueid");" on="require("./lib/events/on");" trigger="require("./lib/events/trigger");" clone="require("./lib/util/clone");" contains="require("./lib/util/contains");" extend="require("./lib/util/extend");" noop="require("./lib/util/noop");" pjax="function(options)" { this.state="{" numpendingswitches: 0, href: null, options: null }; this.options="parseOptions(options);" this.log("pjax options", this.options); if (this.options.scrollrestoration && "scrollrestoration" in history) history.scrollrestoration="manual" ; } this.maxuid="this.lastUid" = newuid(); this.parsedom(document); on( window, "popstate", function(st) (st.state) opt="clone(this.options);" opt.url="st.state.url;" opt.title="st.state.title;" since state already exists, prevent it from being pushed again opt.history="false;" opt.scrollpos="st.state.scrollPos;" (st.state.uid < this.lastuid) opt.backward="true;" else opt.forward="true;" this.lastuid="st.state.uid;" @todo implement history cache here, based uid this.loadurl(st.state.url, opt); }.bind(this) ); pjax.switches="switches;" pjax.prototype="{" log: require(". lib proto log"), getelements: function(el) return el.queryselectorall(this.options.elements); }, parsedom: parseelement="require("./lib/proto/parse-element");" foreachels(this.getelements(el), parseelement, this); refresh: this.parsedom(el || document); reload: function() window.location.reload(); attachlink: attach-link"), attachform: attach-form"), foreachselectors: function(cb, context, domcontext) foreach-selectors").bind(this)( this.options.selectors, cb, domcontext switchselectors: function(selectors, fromel, toel, options) switches-selectors").bind(this)( this.options.switches, this.options.switchesoptions, selectors, options latestchance: function(href) window.location="href;" onswitch: trigger(window, "resize scroll"); this.state.numpendingswitches--; debounce calls, so we only run this once after all are finished. (this.state.numpendingswitches="==" 0) this.afterallswitches(); loadcontent: function(html, (typeof html !="=" "string") trigger(document, "pjax:complete pjax:error", options); return; tmpel="document.implementation.createHTMLDocument("pjax");" parse attributes to copy them forced use documentelement.innerhtml (outerhtml can't be used for <html>)    var htmlRegex = /<html[^>]+>/gi;    var htmlAttribsRegex = /\s?[a-z:]+(?:=['"][^'">]+['"])*/gi;    var matches = html.match(htmlRegex);    if (matches && matches.length) {      matches = matches[0].match(htmlAttribsRegex);      if (matches.length) {        matches.shift();        matches.forEach(function(htmlAttrib) {          var attr = htmlAttrib.trim().split("=");          if (attr.length === 1) {            tmpEl.documentElement.setAttribute(attr[0], true);          } else {            tmpEl.documentElement.setAttribute(attr[0], attr[1].slice(1, -1));          }        });      }    }    tmpEl.documentElement.innerHTML = html;    this.log(      "load content",      tmpEl.documentElement.attributes,      tmpEl.documentElement.innerHTML.length    );    // Clear out any focused controls before inserting new page contents.    if (      document.activeElement &&      contains(document, this.options.selectors, document.activeElement)    ) {      try {        document.activeElement.blur();      } catch (e) {} // eslint-disable-line no-empty    }    this.switchSelectors(this.options.selectors, tmpEl, document, options);  },  abortRequest: require("./lib/abort-request"),  doRequest: require("./lib/send-request"),  handleResponse: require("./lib/proto/handle-response"),  loadUrl: function(href, options) {    options =      typeof options === "object"        ? extend({}, this.options, options)        : clone(this.options);    this.log("load href", href, options);    // Abort any previous request    this.abortRequest(this.request);    trigger(document, "pjax:send", options);    // Do the request    this.request = this.doRequest(      href,      options,      this.handleResponse.bind(this)    );  },  afterAllSwitches: function() {    // FF bug: Wonâ€™t autofocus fields that are inserted via JS.    // This behavior is incorrect. So if theres no current focus, autofocus    // the last field.    //    // http://www.w3.org/html/wg/drafts/html/master/forms.html    var autofocusEl = Array.prototype.slice      .call(document.querySelectorAll("[autofocus]"))      .pop();    if (autofocusEl && document.activeElement !== autofocusEl) {      autofocusEl.focus();    }    // execute scripts when DOM have been completely updated    this.options.selectors.forEach(function(selector) {      forEachEls(document.querySelectorAll(selector), function(el) {        //executeScripts(el);      });    });    var state = this.state;    if (state.options.history) {      if (!window.history.state) {        this.lastUid = this.maxUid = newUid();        window.history.replaceState(          {            url: window.location.href,            title: document.title,            uid: this.maxUid,            scrollPos: [0, 0]          },          document.title        );      }      // Update browser history      this.lastUid = this.maxUid = newUid();      window.history.pushState(        {          url: state.href,          title: state.options.title,          uid: this.maxUid,          scrollPos: [0, 0]        },        state.options.title,        state.href      );    }    this.forEachSelectors(function(el) {      this.parseDOM(el);    }, this);    // Fire Events    trigger(document, "pjax:complete pjax:success", state.options);    if (typeof state.options.analytics === "function") {      state.options.analytics();    }    if (state.options.history) {      // First parse url and check for hash to override scroll      var a = document.createElement("a");      a.href = this.state.href;      if (a.hash) {        var name = a.hash.slice(1);        name = decodeURIComponent(name);        var curtop = 0;        var target =          document.getElementById(name) || document.getElementsByName(name)[0];        if (target) {          // http://stackoverflow.com/questions/8111094/cross-browser-javascript-function-to-find-actual-position-of-an-element-in-page          if (target.offsetParent) {            do {              curtop += target.offsetTop;              target = target.offsetParent;            } while (target);          }        }        window.scrollTo(0, curtop);      } else if (state.options.scrollTo !== false) {        // Scroll page to top on new page load        if (state.options.scrollTo.length > 1) {          window.scrollTo(state.options.scrollTo[0], state.options.scrollTo[1]);        } else {          window.scrollTo(0, state.options.scrollTo);        }      }    } else if (state.options.scrollRestoration && state.options.scrollPos) {      window.scrollTo(state.options.scrollPos[0], state.options.scrollPos[1]);    }    this.state = {      numPendingSwitches: 0,      href: null,      options: null    };  }};Pjax.isSupported = require("./lib/is-supported");// arguably could do `if( require("./lib/is-supported")()) {` but that might be a little to simpleif (Pjax.isSupported()) {  module.exports = Pjax;}// if there isnâ€™t required browser functions, returning stupid apielse {  var stupidPjax = noop;  for (var key in Pjax.prototype) {    if (      Pjax.prototype.hasOwnProperty(key) &&      typeof Pjax.prototype[key] === "function"    ) {      stupidPjax[key] = noop;    }  }  module.exports = stupidPjax;}},{"./lib/abort-request":2,"./lib/events/on":4,"./lib/events/trigger":5,"./lib/execute-scripts":6,"./lib/foreach-els":7,"./lib/foreach-selectors":8,"./lib/is-supported":9,"./lib/parse-options":10,"./lib/proto/attach-form":11,"./lib/proto/attach-link":12,"./lib/proto/handle-response":13,"./lib/proto/log":14,"./lib/proto/parse-element":15,"./lib/send-request":16,"./lib/switches":18,"./lib/switches-selectors":17,"./lib/uniqueid":19,"./lib/util/clone":20,"./lib/util/contains":21,"./lib/util/extend":22,"./lib/util/noop":23}],2:[function(require,module,exports){var noop = require("./util/noop");module.exports = function(request) {  if (request && request.readyState < 4) {    request.onreadystatechange = noop;    request.abort();  }};},{"./util/noop":23}],3:[function(require,module,exports){module.exports = function(el) {  var code = el.text || el.textContent || el.innerHTML || "";  var src = el.src || "";  var parent =    el.parentNode || document.querySelector("head") || document.documentElement;  var script = document.createElement("script");  if (code.match("document.write")) {    if (console && console.log) {      console.log(        "Script contains document.write. Canâ€™t be executed correctly. Code skipped ",        el      );    }    return false;  }  script.type = "text/javascript";  script.id = el.id;  /* istanbul ignore if */  if (src !== "") {    script.src = src;    script.async = false; // force synchronous loading of peripheral JS  }  if (code !== "") {    try {      script.appendChild(document.createTextNode(code));    } catch (e) {      /* istanbul ignore next */      // old IEs have funky script nodes      script.text = code;    }  }  // execute  parent.appendChild(script);  // avoid pollution only in head or body tags  if (    (parent instanceof HTMLHeadElement || parent instanceof HTMLBodyElement) &&    parent.contains(script)  ) {    parent.removeChild(script);  }  return true;};},{}],4:[function(require,module,exports){var forEachEls = require("../foreach-els");module.exports = function(els, events, listener, useCapture) {  events = typeof events === "string" ? events.split(" ") : events;  events.forEach(function(e) {    forEachEls(els, function(el) {      el.addEventListener(e, listener, useCapture);    });  });};},{"../foreach-els":7}],5:[function(require,module,exports){var forEachEls = require("../foreach-els");module.exports = function(els, events, opts) {  events = typeof events === "string" ? events.split(" ") : events;  events.forEach(function(e) {    var event;    event = document.createEvent("HTMLEvents");    event.initEvent(e, true, true);    event.eventName = e;    if (opts) {      Object.keys(opts).forEach(function(key) {        event[key] = opts[key];      });    }    forEachEls(els, function(el) {      var domFix = false;      if (!el.parentNode && el !== document && el !== window) {        // THANK YOU IE (9/10/11)        // dispatchEvent doesn't work if the element is not in the DOM        domFix = true;        document.body.appendChild(el);      }      el.dispatchEvent(event);      if (domFix) {        el.parentNode.removeChild(el);      }    });  });};},{"../foreach-els":7}],6:[function(require,module,exports){var forEachEls = require("./foreach-els");var evalScript = require("./eval-script");// Finds and executes scripts (used for newly added elements)// Needed since innerHTML does not run scriptsmodule.exports = function(el) {  if (el.tagName.toLowerCase() === "script") {    evalScript(el);  }  forEachEls(el.querySelectorAll("script"), function(script) {    if (!script.type || script.type.toLowerCase() === "text/javascript") {      if (script.parentNode) {        script.parentNode.removeChild(script);      }      evalScript(script);    }  });};},{"./eval-script":3,"./foreach-els":7}],7:[function(require,module,exports){/* global HTMLCollection: true */module.exports = function(els, fn, context) {  if (    els instanceof HTMLCollection ||    els instanceof NodeList ||    els instanceof Array  ) {    return Array.prototype.forEach.call(els, fn, context);  }  // assume simple DOM element  return fn.call(context, els);};},{}],8:[function(require,module,exports){var forEachEls = require("./foreach-els");module.exports = function(selectors, cb, context, DOMcontext) {  DOMcontext = DOMcontext || document;  selectors.forEach(function(selector) {    forEachEls(DOMcontext.querySelectorAll(selector), cb, context);  });};},{"./foreach-els":7}],9:[function(require,module,exports){module.exports = function() {  // Borrowed wholesale from https://github.com/defunkt/jquery-pjax  return (    window.history &&    window.history.pushState &&    window.history.replaceState &&    // pushState isnâ€™t reliable on iOS until 5.    !navigator.userAgent.match(      /((iPod|iPhone|iPad).+\bOS\s+[1-4]\D|WebApps\/.+CFNetwork)/    )  );};},{}],10:[function(require,module,exports){/* global _gaq: true, ga: true */var defaultSwitches = require("./switches");module.exports = function(options) {  options = options || {};  options.elements = options.elements || "a[href], form[action]";  options.selectors = options.selectors || ["title", ".js-Pjax"];  options.switches = options.switches || {};  options.switchesOptions = options.switchesOptions || {};  options.history =    typeof options.history === "undefined" ? true : options.history;  options.analytics =    typeof options.analytics === "function" || options.analytics === false      ? options.analytics      : defaultAnalytics;  options.scrollTo =    typeof options.scrollTo === "undefined" ? 0 : options.scrollTo;  options.scrollRestoration =    typeof options.scrollRestoration !== "undefined"      ? options.scrollRestoration      : true;  options.cacheBust =    typeof options.cacheBust === "undefined" ? true : options.cacheBust;  options.debug = options.debug || false;  options.timeout = options.timeout || 0;  options.currentUrlFullReload =    typeof options.currentUrlFullReload === "undefined"      ? false      : options.currentUrlFullReload;  // We canâ€™t replace body.outerHTML or head.outerHTML.  // It creates a bug where a new body or head are created in the DOM.  // If you set head.outerHTML, a new body tag is appended, so the DOM has 2 body nodes, and vice versa  if (!options.switches.head) {    options.switches.head = defaultSwitches.switchElementsAlt;  }  if (!options.switches.body) {    options.switches.body = defaultSwitches.switchElementsAlt;  }  return options;};/* istanbul ignore next */function defaultAnalytics() {  if (window._gaq) {    _gaq.push(["_trackPageview"]);  }  if (window.ga) {    ga("send", "pageview", { page: location.pathname, title: document.title });  }}},{"./switches":18}],11:[function(require,module,exports){var on = require("../events/on");var clone = require("../util/clone");var attrState = "data-pjax-state";var formAction = function(el, event) {  if (isDefaultPrevented(event)) {    return;  }  // Since loadUrl modifies options and we may add our own modifications below,  // clone it so the changes don't persist  var options = clone(this.options);  // Initialize requestOptions  options.requestOptions = {    requestUrl: el.getAttribute("action") || window.location.href,    requestMethod: el.getAttribute("method") || "GET"  };  // create a testable virtual link of the form action  var virtLinkElement = document.createElement("a");  virtLinkElement.setAttribute("href", options.requestOptions.requestUrl);  var attrValue = checkIfShouldAbort(virtLinkElement, options);  if (attrValue) {    el.setAttribute(attrState, attrValue);    return;  }  event.preventDefault();  if (el.enctype === "multipart/form-data") {    options.requestOptions.formData = new FormData(el);  } else {    options.requestOptions.requestParams = parseFormElements(el);  }  el.setAttribute(attrState, "submit");  options.triggerElement = el;  this.loadUrl(virtLinkElement.href, options);};function parseFormElements(el) {  var requestParams = [];  var formElements = el.elements;  for (var i = 0; i < formElements.length; i++) {    var element = formElements[i];    var tagName = element.tagName.toLowerCase();    // jscs:disable disallowImplicitTypeConversion    if (      !!element.name &&      element.attributes !== undefined &&      tagName !== "button"    ) {      // jscs:enable disallowImplicitTypeConversion      var type = element.attributes.type;      if (        !type ||        (type.value !== "checkbox" && type.value !== "radio") ||        element.checked      ) {        // Build array of values to submit        var values = [];        if (tagName === "select") {          var opt;          for (var j = 0; j < element.options.length; j++) {            opt = element.options[j];            if (opt.selected && !opt.disabled) {              values.push(opt.hasAttribute("value") ? opt.value : opt.text);            }          }        } else {          values.push(element.value);        }        for (var k = 0; k < values.length; k++) {          requestParams.push({            name: encodeURIComponent(element.name),            value: encodeURIComponent(values[k])          });        }      }    }  }  return requestParams;}function checkIfShouldAbort(virtLinkElement, options) {  // Ignore external links.  if (    virtLinkElement.protocol !== window.location.protocol ||    virtLinkElement.host !== window.location.host  ) {    return "external";  }  // Ignore click if we are on an anchor on the same page  if (    virtLinkElement.hash &&    virtLinkElement.href.replace(virtLinkElement.hash, "") ===      window.location.href.replace(location.hash, "")  ) {    return "anchor";  }  // Ignore empty anchor "foo.html#"  if (virtLinkElement.href === window.location.href.split("#")[0] + "#") {    return "anchor-empty";  }  // if declared as a full reload, just normally submit the form  if (    options.currentUrlFullReload &&    virtLinkElement.href === window.location.href.split("#")[0]  ) {    return "reload";  }}var isDefaultPrevented = function(event) {  return event.defaultPrevented || event.returnValue === false;};module.exports = function(el) {  var that = this;  el.setAttribute(attrState, "");  on(el, "submit", function(event) {    formAction.call(that, el, event);  });};},{"../events/on":4,"../util/clone":20}],12:[function(require,module,exports){var on = require("../events/on");var clone = require("../util/clone");var attrState = "data-pjax-state";var linkAction = function(el, event) {  if (isDefaultPrevented(event)) {    return;  }  // Since loadUrl modifies options and we may add our own modifications below,  // clone it so the changes don't persist  var options = clone(this.options);  var attrValue = checkIfShouldAbort(el, event);  if (attrValue) {    el.setAttribute(attrState, attrValue);    return;  }  event.preventDefault();  // donâ€™t do "nothing" if user try to reload the page by clicking the same link twice  if (    this.options.currentUrlFullReload &&    el.href === window.location.href.split("#")[0]  ) {    el.setAttribute(attrState, "reload");    this.reload();    return;  }  el.setAttribute(attrState, "load");  options.triggerElement = el;  this.loadUrl(el.href, options);};function checkIfShouldAbort(el, event) {  // Donâ€™t break browser special behavior on links (like page in new window)  if (    event.which > 1 ||    event.metaKey ||    event.ctrlKey ||    event.shiftKey ||    event.altKey  ) {    return "modifier";  }  // we do test on href now to prevent unexpected behavior if for some reason  // user have href that can be dynamically updated  // Ignore external links.  if (    el.protocol !== window.location.protocol ||    el.host !== window.location.host  ) {    return "external";  }  // Ignore anchors on the same page (keep native behavior)  if (    el.hash &&    el.href.replace(el.hash, "") ===      window.location.href.replace(location.hash, "")  ) {    return "anchor";  }  // Ignore empty anchor "foo.html#"  if (el.href === window.location.href.split("#")[0] + "#") {    return "anchor-empty";  }}var isDefaultPrevented = function(event) {  return event.defaultPrevented || event.returnValue === false;};module.exports = function(el) {  var that = this;  el.setAttribute(attrState, "");  on(el, "click", function(event) {    linkAction.call(that, el, event);  });  on(    el,    "keyup",    function(event) {      if (event.keyCode === 13) {        linkAction.call(that, el, event);      }    }.bind(this)  );};},{"../events/on":4,"../util/clone":20}],13:[function(require,module,exports){var clone = require("../util/clone");var newUid = require("../uniqueid");var trigger = require("../events/trigger");module.exports = function(responseText, request, href, options) {  options = clone(options || this.options);  options.request = request;  // Fail if unable to load HTML via AJAX  if (responseText === false) {    trigger(document, "pjax:complete pjax:error", options);    return;  }  // push scroll position to history  var currentState = window.history.state || {};  window.history.replaceState(    {      url: currentState.url || window.location.href,      title: currentState.title || document.title,      uid: currentState.uid || newUid(),      scrollPos: [        document.documentElement.scrollLeft || document.body.scrollLeft,        document.documentElement.scrollTop || document.body.scrollTop      ]    },    document.title,    window.location.href  );  // Check for redirects  var oldHref = href;  if (request.responseURL) {    if (href !== request.responseURL) {      href = request.responseURL;    }  } else if (request.getResponseHeader("X-PJAX-URL")) {    href = request.getResponseHeader("X-PJAX-URL");  } else if (request.getResponseHeader("X-XHR-Redirected-To")) {    href = request.getResponseHeader("X-XHR-Redirected-To");  }  // Add back the hash if it was removed  var a = document.createElement("a");  a.href = oldHref;  var oldHash = a.hash;  a.href = href;  if (oldHash && !a.hash) {    a.hash = oldHash;    href = a.href;  }  this.state.href = href;  this.state.options = options;  try {    this.loadContent(responseText, options);  } catch (e) {    trigger(document, "pjax:error", options);    if (!this.options.debug) {      if (console && console.error) {        console.error("Pjax switch fail: ", e);      }      return this.latestChance(href);    } else {      throw e;    }  }};},{"../events/trigger":5,"../uniqueid":19,"../util/clone":20}],14:[function(require,module,exports){module.exports = function() {  if (this.options.debug && console) {    if (typeof console.log === "function") {      console.log.apply(console, arguments);    }    // IE is weird    else if (console.log) {      console.log(arguments);    }  }};},{}],15:[function(require,module,exports){var attrState = "data-pjax-state";module.exports = function(el) {  switch (el.tagName.toLowerCase()) {    case "a":      // only attach link if el does not already have link attached      if (!el.hasAttribute(attrState)) {        this.attachLink(el);      }      break;    case "form":      // only attach link if el does not already have link attached      if (!el.hasAttribute(attrState)) {        this.attachForm(el);      }      break;    default:      throw "Pjax can only be applied on <a> or <form> submit";  }};},{}],16:[function(require,module,exports){var updateQueryString = require("./util/update-query-string");module.exports = function(location, options, callback) {  options = options || {};  var queryString;  var requestOptions = options.requestOptions || {};  var requestMethod = (requestOptions.requestMethod || "GET").toUpperCase();  var requestParams = requestOptions.requestParams || null;  var formData = requestOptions.formData || null;  var requestPayload = null;  var request = new XMLHttpRequest();  var timeout = options.timeout || 0;  request.onreadystatechange = function() {    if (request.readyState === 4) {      if (request.status === 200) {        callback(request.responseText, request, location, options);      } else if (request.status !== 0) {        callback(null, request, location, options);      }    }  };  request.onerror = function(e) {    console.log(e);    callback(null, request, location, options);  };  request.ontimeout = function() {    callback(null, request, location, options);  };  // Prepare the request payload for forms, if available  if (requestParams && requestParams.length) {    // Build query string    queryString = requestParams      .map(function(param) {        return param.name + "=" + param.value;      })      .join("&");    switch (requestMethod) {      case "GET":        // Reset query string to avoid an issue with repeat submissions where checkboxes that were        // previously checked are incorrectly preserved        location = location.split("?")[0];        // Append new query string        location += "?" + queryString;        break;      case "POST":        // Send query string as request payload        requestPayload = queryString;        break;    }  } else if (formData) {    requestPayload = formData;  }  // Add a timestamp as part of the query string if cache busting is enabled  if (options.cacheBust) {    location = updateQueryString(location, "t", Date.now());  }  request.open(requestMethod, location, true);  request.timeout = timeout;  request.setRequestHeader("X-Requested-With", "XMLHttpRequest");  request.setRequestHeader("X-PJAX", "true");  request.setRequestHeader(    "X-PJAX-Selectors",    JSON.stringify(options.selectors)  );  // Send the proper header information for POST forms  if (requestPayload && requestMethod === "POST" && !formData) {    request.setRequestHeader(      "Content-Type",      "application/x-www-form-urlencoded"    );  }  request.send(requestPayload);  return request;};},{"./util/update-query-string":24}],17:[function(require,module,exports){var forEachEls = require("./foreach-els");var defaultSwitches = require("./switches");module.exports = function(  switches,  switchesOptions,  selectors,  fromEl,  toEl,  options) {  var switchesQueue = [];  selectors.forEach(function(selector) {    var newEls = fromEl.querySelectorAll(selector);    var oldEls = toEl.querySelectorAll(selector);    if (this.log) {      this.log("Pjax switch", selector, newEls, oldEls);    }    if (newEls.length !== oldEls.length) {      throw "DOM doesnâ€™t look the same on new loaded page: â€™" +        selector +        "â€™ - new " +        newEls.length +        ", old " +        oldEls.length;    }    forEachEls(      newEls,      function(newEl, i) {        var oldEl = oldEls[i];        if (this.log) {          this.log("newEl", newEl, "oldEl", oldEl);        }        var callback = switches[selector]          ? switches[selector].bind(              this,              oldEl,              newEl,              options,              switchesOptions[selector]            )          : defaultSwitches.outerHTML.bind(this, oldEl, newEl, options);        switchesQueue.push(callback);      },      this    );  }, this);  this.state.numPendingSwitches = switchesQueue.length;  switchesQueue.forEach(function(queuedSwitch) {    queuedSwitch();  });};},{"./foreach-els":7,"./switches":18}],18:[function(require,module,exports){var on = require("./events/on");module.exports = {  outerHTML: function(oldEl, newEl) {    oldEl.outerHTML = newEl.outerHTML;    this.onSwitch();  },  innerHTML: function(oldEl, newEl) {    oldEl.innerHTML = newEl.innerHTML;    if (newEl.className === "") {      oldEl.removeAttribute("class");    } else {      //oldEl.className = newEl.className;    }    this.onSwitch();  },  switchElementsAlt: function(oldEl, newEl) {    oldEl.innerHTML = newEl.innerHTML;    // Copy attributes from the new element to the old one    if (newEl.hasAttributes()) {      var attrs = newEl.attributes;      for (var i = 0; i < attrs.length; i++) {        oldEl.attributes.setNamedItem(attrs[i].cloneNode());      }    }    this.onSwitch();  },  // Equivalent to outerHTML(), but doesn't require switchElementsAlt() for <head> and </head><body>  replaceNode: function(oldEl, newEl) {    oldEl.parentNode.replaceChild(newEl, oldEl);    this.onSwitch();  },  sideBySide: function(oldEl, newEl, options, switchOptions) {    var forEach = Array.prototype.forEach;    var elsToRemove = [];    var elsToAdd = [];    var fragToAppend = document.createDocumentFragment();    var animationEventNames =      "animationend webkitAnimationEnd MSAnimationEnd oanimationend";    var animatedElsNumber = 0;    var sexyAnimationEnd = function(e) {      if (e.target !== e.currentTarget) {        // end triggered by an animation on a child        return;      }      animatedElsNumber--;      if (animatedElsNumber </body></form></a></html[^></t.length;i++)o(t[i]);return>]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/lib/pjax/lib/events/on.js"/>
      <url>/lib/pjax/lib/events/on.js</url>
      
        <content type="html"><![CDATA[var forEachEls = require("../foreach-els");module.exports = function(els, events, listener, useCapture) {  events = typeof events === "string" ? events.split(" ") : events;  events.forEach(function(e) {    forEachEls(els, function(el) {      el.addEventListener(e, listener, useCapture);    });  });};]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/lib/pjax/lib/events/off.js"/>
      <url>/lib/pjax/lib/events/off.js</url>
      
        <content type="html"><![CDATA[var forEachEls = require("../foreach-els");module.exports = function(els, events, listener, useCapture) {  events = typeof events === "string" ? events.split(" ") : events;  events.forEach(function(e) {    forEachEls(els, function(el) {      el.removeEventListener(e, listener, useCapture);    });  });};]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/lib/pjax/lib/events/trigger.js"/>
      <url>/lib/pjax/lib/events/trigger.js</url>
      
        <content type="html"><![CDATA[var forEachEls = require("../foreach-els");module.exports = function(els, events, opts) {  events = typeof events === "string" ? events.split(" ") : events;  events.forEach(function(e) {    var event;    event = document.createEvent("HTMLEvents");    event.initEvent(e, true, true);    event.eventName = e;    if (opts) {      Object.keys(opts).forEach(function(key) {        event[key] = opts[key];      });    }    forEachEls(els, function(el) {      var domFix = false;      if (!el.parentNode && el !== document && el !== window) {        // THANK YOU IE (9/10/11)        // dispatchEvent doesn't work if the element is not in the DOM        domFix = true;        document.body.appendChild(el);      }      el.dispatchEvent(event);      if (domFix) {        el.parentNode.removeChild(el);      }    });  });};]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/lib/pjax/lib/proto/attach-form.js"/>
      <url>/lib/pjax/lib/proto/attach-form.js</url>
      
        <content type="html"><![CDATA[var on = require("../events/on");var clone = require("../util/clone");var attrState = "data-pjax-state";var formAction = function(el, event) {  if (isDefaultPrevented(event)) {    return;  }  // Since loadUrl modifies options and we may add our own modifications below,  // clone it so the changes don't persist  var options = clone(this.options);  // Initialize requestOptions  options.requestOptions = {    requestUrl: el.getAttribute("action") || window.location.href,    requestMethod: el.getAttribute("method") || "GET"  };  // create a testable virtual link of the form action  var virtLinkElement = document.createElement("a");  virtLinkElement.setAttribute("href", options.requestOptions.requestUrl);  var attrValue = checkIfShouldAbort(virtLinkElement, options);  if (attrValue) {    el.setAttribute(attrState, attrValue);    return;  }  event.preventDefault();  if (el.enctype === "multipart/form-data") {    options.requestOptions.formData = new FormData(el);  } else {    options.requestOptions.requestParams = parseFormElements(el);  }  el.setAttribute(attrState, "submit");  options.triggerElement = el;  this.loadUrl(virtLinkElement.href, options);};function parseFormElements(el) {  var requestParams = [];  var formElements = el.elements;  for (var i = 0; i < formElements.length; i++) {    var element = formElements[i];    var tagName = element.tagName.toLowerCase();    // jscs:disable disallowImplicitTypeConversion    if (      !!element.name &&      element.attributes !== undefined &&      tagName !== "button"    ) {      // jscs:enable disallowImplicitTypeConversion      var type = element.attributes.type;      if (        !type ||        (type.value !== "checkbox" && type.value !== "radio") ||        element.checked      ) {        // Build array of values to submit        var values = [];        if (tagName === "select") {          var opt;          for (var j = 0; j < element.options.length; j++) {            opt = element.options[j];            if (opt.selected && !opt.disabled) {              values.push(opt.hasAttribute("value") ? opt.value : opt.text);            }          }        } else {          values.push(element.value);        }        for (var k = 0; k < values.length; k++) {          requestParams.push({            name: encodeURIComponent(element.name),            value: encodeURIComponent(values[k])          });        }      }    }  }  return requestParams;}function checkIfShouldAbort(virtLinkElement, options) {  // Ignore external links.  if (    virtLinkElement.protocol !== window.location.protocol ||    virtLinkElement.host !== window.location.host  ) {    return "external";  }  // Ignore click if we are on an anchor on the same page  if (    virtLinkElement.hash &&    virtLinkElement.href.replace(virtLinkElement.hash, "") ===      window.location.href.replace(location.hash, "")  ) {    return "anchor";  }  // Ignore empty anchor "foo.html#"  if (virtLinkElement.href === window.location.href.split("#")[0] + "#") {    return "anchor-empty";  }  // if declared as a full reload, just normally submit the form  if (    options.currentUrlFullReload &&    virtLinkElement.href === window.location.href.split("#")[0]  ) {    return "reload";  }}var isDefaultPrevented = function(event) {  return event.defaultPrevented || event.returnValue === false;};module.exports = function(el) {  var that = this;  el.setAttribute(attrState, "");  on(el, "submit", function(event) {    formAction.call(that, el, event);  });};]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/lib/pjax/lib/proto/handle-response.js"/>
      <url>/lib/pjax/lib/proto/handle-response.js</url>
      
        <content type="html"><![CDATA[var clone = require("../util/clone");var newUid = require("../uniqueid");var trigger = require("../events/trigger");module.exports = function(responseText, request, href, options) {  options = clone(options || this.options);  options.request = request;  // Fail if unable to load HTML via AJAX  if (responseText === false) {    trigger(document, "pjax:complete pjax:error", options);    return;  }  // push scroll position to history  var currentState = window.history.state || {};  window.history.replaceState(    {      url: currentState.url || window.location.href,      title: currentState.title || document.title,      uid: currentState.uid || newUid(),      scrollPos: [        document.documentElement.scrollLeft || document.body.scrollLeft,        document.documentElement.scrollTop || document.body.scrollTop      ]    },    document.title,    window.location.href  );  // Check for redirects  var oldHref = href;  if (request.responseURL) {    if (href !== request.responseURL) {      href = request.responseURL;    }  } else if (request.getResponseHeader("X-PJAX-URL")) {    href = request.getResponseHeader("X-PJAX-URL");  } else if (request.getResponseHeader("X-XHR-Redirected-To")) {    href = request.getResponseHeader("X-XHR-Redirected-To");  }  // Add back the hash if it was removed  var a = document.createElement("a");  a.href = oldHref;  var oldHash = a.hash;  a.href = href;  if (oldHash && !a.hash) {    a.hash = oldHash;    href = a.href;  }  this.state.href = href;  this.state.options = options;  try {    this.loadContent(responseText, options);  } catch (e) {    trigger(document, "pjax:error", options);    if (!this.options.debug) {      if (console && console.error) {        console.error("Pjax switch fail: ", e);      }      return this.latestChance(href);    } else {      throw e;    }  }};]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/lib/pjax/lib/proto/log.js"/>
      <url>/lib/pjax/lib/proto/log.js</url>
      
        <content type="html"><![CDATA[module.exports = function() {  if (this.options.debug && console) {    if (typeof console.log === "function") {      console.log.apply(console, arguments);    }    // IE is weird    else if (console.log) {      console.log(arguments);    }  }};]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/lib/pjax/lib/proto/attach-link.js"/>
      <url>/lib/pjax/lib/proto/attach-link.js</url>
      
        <content type="html"><![CDATA[var on = require("../events/on");var clone = require("../util/clone");var attrState = "data-pjax-state";var linkAction = function(el, event) {  if (isDefaultPrevented(event)) {    return;  }  // Since loadUrl modifies options and we may add our own modifications below,  // clone it so the changes don't persist  var options = clone(this.options);  var attrValue = checkIfShouldAbort(el, event);  if (attrValue) {    el.setAttribute(attrState, attrValue);    return;  }  event.preventDefault();  // donâ€™t do "nothing" if user try to reload the page by clicking the same link twice  if (    this.options.currentUrlFullReload &&    el.href === window.location.href.split("#")[0]  ) {    el.setAttribute(attrState, "reload");    this.reload();    return;  }  el.setAttribute(attrState, "load");  options.triggerElement = el;  this.loadUrl(el.href, options);};function checkIfShouldAbort(el, event) {  // Donâ€™t break browser special behavior on links (like page in new window)  if (    event.which > 1 ||    event.metaKey ||    event.ctrlKey ||    event.shiftKey ||    event.altKey  ) {    return "modifier";  }  // we do test on href now to prevent unexpected behavior if for some reason  // user have href that can be dynamically updated  // Ignore external links.  if (    el.protocol !== window.location.protocol ||    el.host !== window.location.host  ) {    return "external";  }  // Ignore anchors on the same page (keep native behavior)  if (    el.hash &&    el.href.replace(el.hash, "") ===      window.location.href.replace(location.hash, "")  ) {    return "anchor";  }  // Ignore empty anchor "foo.html#"  if (el.href === window.location.href.split("#")[0] + "#") {    return "anchor-empty";  }}var isDefaultPrevented = function(event) {  return event.defaultPrevented || event.returnValue === false;};module.exports = function(el) {  var that = this;  el.setAttribute(attrState, "");  on(el, "click", function(event) {    linkAction.call(that, el, event);  });  on(    el,    "keyup",    function(event) {      if (event.keyCode === 13) {        linkAction.call(that, el, event);      }    }.bind(this)  );};]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/lib/pjax/lib/util/clone.js"/>
      <url>/lib/pjax/lib/util/clone.js</url>
      
        <content type="html"><![CDATA[module.exports = function(obj) {  /* istanbul ignore if */  if (null === obj || "object" !== typeof obj) {    return obj;  }  var copy = obj.constructor();  for (var attr in obj) {    if (obj.hasOwnProperty(attr)) {      copy[attr] = obj[attr];    }  }  return copy;};]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/lib/pjax/lib/proto/parse-element.js"/>
      <url>/lib/pjax/lib/proto/parse-element.js</url>
      
        <content type="html"><![CDATA[var attrState = "data-pjax-state";module.exports = function(el) {  switch (el.tagName.toLowerCase()) {    case "a":      // only attach link if el does not already have link attached      if (!el.hasAttribute(attrState)) {        this.attachLink(el);      }      break;    case "form":      // only attach link if el does not already have link attached      if (!el.hasAttribute(attrState)) {        this.attachForm(el);      }      break;    default:      throw "Pjax can only be applied on <a> or <form> submit";  }};</form></a>]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/lib/pjax/lib/util/extend.js"/>
      <url>/lib/pjax/lib/util/extend.js</url>
      
        <content type="html"><![CDATA[module.exports = function(target) {  if (target == null) {    return null;  }  var to = Object(target);  for (var i = 1; i < arguments.length; i++) {    var source = arguments[i];    if (source != null) {      for (var key in source) {        // Avoid bugs when hasOwnProperty is shadowed        if (Object.prototype.hasOwnProperty.call(source, key)) {          to[key] = source[key];        }      }    }  }  return to;};]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/lib/pjax/lib/util/contains.js"/>
      <url>/lib/pjax/lib/util/contains.js</url>
      
        <content type="html"><![CDATA[module.exports = function contains(doc, selectors, el) {  for (var i = 0; i < selectors.length; i++) {    var selectedEls = doc.querySelectorAll(selectors[i]);    for (var j = 0; j < selectedEls.length; j++) {      if (selectedEls[j].contains(el)) {        return true;      }    }  }  return false;};]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/lib/pjax/lib/util/noop.js"/>
      <url>/lib/pjax/lib/util/noop.js</url>
      
        <content type="html"><![CDATA[module.exports = function() {};]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/lib/pjax/lib/util/update-query-string.js"/>
      <url>/lib/pjax/lib/util/update-query-string.js</url>
      
        <content type="html"><![CDATA[module.exports = function(uri, key, value) {  var re = new RegExp("([?&])" + key + "=.*?(&|$)", "i");  var separator = uri.indexOf("?") !== -1 ? "&" : "?";  if (uri.match(re)) {    return uri.replace(re, "$1" + key + "=" + value + "$2");  } else {    return uri + separator + key + "=" + value;  }};]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/lib/pjax/tests/lib/eval-scripts.js"/>
      <url>/lib/pjax/tests/lib/eval-scripts.js</url>
      
        <content type="html"><![CDATA[var tape = require("tape");var evalScript = require("../../lib/eval-script");tape("test evalScript method", function(t) {  document.body.className = "";  var script = document.createElement("script");  script.innerHTML = "document.body.className = 'executed'";  t.equal(document.body.className, "", "script hasn't been executed yet");  evalScript(script);  t.equal(    document.body.className,    "executed",    "script has been properly executed"  );  script.innerHTML = "document.write('failure')";  var bodyText = "document.write hasn't been executed";  document.body.text = bodyText;  evalScript(script);  t.equal(document.body.text, bodyText, "document.write hasn't been executed");  t.end();});tape(  "evalScript should not throw an error if the script removed itself",  function(t) {    var script = document.createElement("script");    script.id = "myScript";    script.innerHTML =      "const script = document.querySelector('#myScript');" +      "script.parentNode.removeChild(script);";    try {      evalScript(script);      t.pass("Missing script tested successfully");    } catch (e) {      console.error(e);      t.fail("Attempted to remove missing script");    }    t.end();  });]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/lib/pjax/tests/lib/abort-request.js"/>
      <url>/lib/pjax/tests/lib/abort-request.js</url>
      
        <content type="html"><![CDATA[var tape = require("tape");var abortRequest = require("../../lib/abort-request.js");var sendRequest = require("../../lib/send-request.js");// Polyfill responseURL property into XMLHttpRequest if it doesn't exist,// just for the purposes of this test// This polyfill is not complete; it won't show the updated location if a// redirection occurred, but it's fine for our purposes.if (!("responseURL" in XMLHttpRequest.prototype)) {  var nativeOpen = XMLHttpRequest.prototype.open;  XMLHttpRequest.prototype.open = function(method, url) {    this.responseURL = url;    return nativeOpen.apply(this, arguments);  };}tape("test aborting xhr request", function(t) {  var requestCacheBust = sendRequest.bind({    options: {      cacheBust: true    }  });  t.test("- pending request is aborted", function(t) {    var r = requestCacheBust("https://httpbin.org/delay/10", {}, function() {      t.fail("xhr was not aborted");    });    t.equal(r.readyState, 1, "xhr readyState is '1' (SENT)");    abortRequest(r);    t.equal(r.readyState, 0, "xhr readyState is '0' (ABORTED)");    t.equal(r.status, 0, "xhr HTTP status is '0' (ABORTED)");    t.equal(r.responseText, "", "xhr response is empty");    t.end();  });  t.test("- request is not aborted if it has already completed", function(t) {    var r = requestCacheBust("https://httpbin.org/get", {}, function() {      abortRequest(r);      t.equal(r.readyState, 4, "xhr readyState is '4' (DONE)");      t.equal(r.status, 200, "xhr HTTP status is '200' (OK)");      t.end();    });  });  t.test("- request is not aborted if it is undefined", function(t) {    var r;    try {      abortRequest(r);    } catch (e) {      t.fail("aborting an undefined request threw an error");    }    t.equal(typeof r, "undefined", "undefined xhr was ignored");    t.end();  });  t.end();});]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/lib/pjax/tests/lib/execute-scripts.js"/>
      <url>/lib/pjax/tests/lib/execute-scripts.js</url>
      
        <content type="html"><![CDATA[var tape = require("tape");var executeScripts = require("../../lib/execute-scripts");tape(  "test executeScripts method when the script tag is inside a container",  function(t) {    document.body.className = "";    var container = document.createElement("div");    container.innerHTML =      "<" + "script" ">document.body.className = 'executed';</"><" + "script" ">document.body.className += ' correctly';</">";    t.equal(document.body.className, "", "script hasn't been executed yet");    executeScripts(container);    t.equal(      document.body.className,      "executed correctly",      "script has been properly executed"    );    t.end();  });tape("test executeScripts method with just a script tag", function(t) {  document.body.className = "";  var script = document.createElement("script");  script.innerHTML = "document.body.className = 'executed correctly';";  t.equal(document.body.className, "", "script hasn't been executed yet");  executeScripts(script);  t.equal(    document.body.className,    "executed correctly",    "script has been properly executed"  );  t.end();});]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/lib/pjax/tests/lib/foreach-els.js"/>
      <url>/lib/pjax/tests/lib/foreach-els.js</url>
      
        <content type="html"><![CDATA[var tape = require("tape");var forEachEls = require("../../lib/foreach-els.js");var div = document.createElement("div");var span = document.createElement("span");var cb = function(el) {  el.innerHTML = "boom";};tape("test forEachEls on one element", function(t) {  div.innerHTML = "div tag";  forEachEls(div, cb);  t.equal(div.innerHTML, "boom", "works correctly on one element");  t.end();});tape("test forEachEls on an array", function(t) {  div.innerHTML = "div tag";  span.innerHTML = "span tag";  forEachEls([div, span], cb);  t.equal(    div.innerHTML,    "boom",    "works correctly on the first element of the array"  );  t.equal(    span.innerHTML,    "boom",    "works correctly on the last element of the array"  );  t.end();});tape("test forEachEls on a NodeList", function(t) {  div.innerHTML = "div tag";  span.innerHTML = "span tag";  var frag = document.createDocumentFragment();  frag.appendChild(div);  frag.appendChild(span);  forEachEls(frag.childNodes, cb);  t.equal(    div.innerHTML,    "boom",    "works correctly on the first element of the document fragment"  );  t.equal(    span.innerHTML,    "boom",    "works correctly on the last element of the document fragment"  );  t.end();});]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/lib/pjax/tests/lib/is-supported.js"/>
      <url>/lib/pjax/tests/lib/is-supported.js</url>
      
        <content type="html"><![CDATA[var tape = require("tape");var isSupported = require("../../lib/is-supported.js");tape("test isSupported method", function(t) {  t.true(    isSupported(),    "well, we run test on supported browser, so it should be ok here"  );  t.end();});]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/lib/pjax/tests/lib/events.js"/>
      <url>/lib/pjax/tests/lib/events.js</url>
      
        <content type="html"><![CDATA[var tape = require("tape");var on = require("../../lib/events/on");var off = require("../../lib/events/off");var trigger = require("../../lib/events/trigger");var el = document.createElement("div");var el2 = document.createElement("span");var els = [el, el2];var classCb = function() {  this.className += "on";};var attrCb = function() {  this.setAttribute("data-state", this.getAttribute("data-state") + "ON");};tape("test events on/off/trigger for one element, one event", function(t) {  el.className = "";  on(el, "click", classCb);  trigger(el, "click");  t.equal(el.className, "on", "attached callback has been fired properly");  el.className = "off";  off(el, "click", classCb);  trigger(el, "click");  t.equal(el.className, "off", "triggered event didn't fire detached callback");  t.end();});tape("test events on/off/trigger for multiple elements, one event", function(  t) {  el.className = "";  el2.className = "";  on(els, "click", classCb);  trigger(els, "click");  t.equal(    el.className,    "on",    "attached callback has been fired properly on the first element"  );  t.equal(    el2.className,    "on",    "attached callback has been fired properly on the second element"  );  el.className = "off";  el2.className = "off";  off(els, "click", classCb);  trigger(els, "click");  t.equal(    el.className,    "off",    "triggered event didn't fire detached callback on the first element"  );  t.equal(    el2.className,    "off",    "triggered event didn't fire detached callback on the second element"  );  t.end();});tape("test events on/off/trigger for one element, multiple events", function(  t) {  el.className = "";  on(el, "click mouseover", classCb);  trigger(el, "click mouseover");  t.equal(el.className, "onon", "attached callbacks have been fired properly");  el.className = "off";  off(el, "click mouseover", classCb);  trigger(el, "click mouseover");  t.equal(    el.className,    "off",    "triggered events didn't fire detached callback"  );  t.end();});tape(  "test events on/off/trigger for multiple elements, multiple events",  function(t) {    el.className = "";    el2.className = "";    el.setAttribute("data-state", "");    el2.setAttribute("data-state", "");    on(els, "click mouseover", classCb);    on(els, "resize scroll", attrCb);    trigger(els, "click mouseover resize scroll");    t.equal(      el.className,      "onon",      "attached callbacks has been fired properly on the first element"    );    t.equal(      el.getAttribute("data-state"),      "ONON",      "attached callbacks has been fired properly on the first element"    );    t.equal(      el2.className,      "onon",      "attached callbacks has been fired properly on the second element"    );    t.equal(      el2.getAttribute("data-state"),      "ONON",      "attached callbacks has been fired properly on the second element"    );    el.className = "off";    el2.className = "off";    el.setAttribute("data-state", "off");    el2.setAttribute("data-state", "off");    off(els, "click mouseover", classCb);    off(els, "resize scroll", attrCb);    trigger(els, "click mouseover resize scroll");    t.equal(      el.className,      "off",      "triggered events didn't fire detached callbacks on the first element"    );    t.equal(      el.getAttribute("data-state"),      "off",      "triggered events didn't fire detached callbacks on the first element"    );    t.equal(      el2.className,      "off",      "triggered events didn't fire detached callbacks on the first element"    );    t.equal(      el2.getAttribute("data-state"),      "off",      "triggered events didn't fire detached callbacks on the first element"    );    t.end();  });tape("test events on top level elements", function(t) {  var el = document;  el.className = "";  on(el, "click", classCb);  trigger(el, "click");  t.equal(    el.className,    "on",    "attached callback has been fired properly on document"  );  el = window;  el.className = "";  // With jsdom, the default this is global, not window, so we need to explicitly bind to window.  on(el, "click", classCb.bind(window));  trigger(el, "click");  t.equal(    el.className,    "on",    "attached callback has been fired properly on window"  );  t.end();});]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/lib/pjax/tests/lib/foreach-selectors.js"/>
      <url>/lib/pjax/tests/lib/foreach-selectors.js</url>
      
        <content type="html"><![CDATA[var tape = require("tape");var forEachEls = require("../../lib/foreach-selectors.js");var cb = function(el) {  el.className = "modified";};tape("test forEachSelector", function(t) {  forEachEls(["html", "body"], cb);  t.equal(    document.documentElement.className,    "modified",    "callback has been executed on first selector"  );  t.equal(    document.body.className,    "modified",    "callback has been executed on first selector"  );  document.documentElement.className = "";  document.body.className = "";  forEachEls(["html", "body"], cb, null, document.documentElement);  t.equal(    document.documentElement.className,    "",    "callback has not been executed on first selector when context is used"  );  t.equal(    document.body.className,    "modified",    "callback has been executed on first selector when context is used"  );  t.end();});]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/lib/pjax/tests/lib/send-request.js"/>
      <url>/lib/pjax/tests/lib/send-request.js</url>
      
        <content type="html"><![CDATA[var tape = require("tape");var sendRequest = require("../../lib/send-request.js");// Polyfill responseURL property into XMLHttpRequest if it doesn't exist,// just for the purposes of this test// This polyfill is not complete; it won't show the updated location if a// redirection occurred, but it's fine for our purposes.if (!("responseURL" in XMLHttpRequest.prototype)) {  var nativeOpen = XMLHttpRequest.prototype.open;  XMLHttpRequest.prototype.open = function(method, url) {    this.responseURL = url;    return nativeOpen.apply(this, arguments);  };}tape("test xhr request", function(t) {  var url = "https://httpbin.org/get";  t.test("- request is made, gets a result, and is cache-busted", function(t) {    var r = sendRequest(url, { cacheBust: true }, function(result) {      t.equal(        r.responseURL.indexOf("?"),        url.length,        "XHR URL is cache-busted when configured to be"      );      try {        result = JSON.parse(result);      } catch (e) {        t.fail("xhr doesn't get a JSON response");      }      t.same(typeof result, "object", "xhr request get a result");      t.end();    });  });  t.test("- request is not cache-busted when configured not to be", function(    t  ) {    var r = sendRequest(url, {}, function() {      t.equal(r.responseURL, url, "XHR URL is left untouched");      t.end();    });  });  t.end();});tape("request headers are sent properly", function(t) {  var url = "https://httpbin.org/headers";  var options = {    selectors: ["div.pjax", "div.container"]  };  sendRequest(url, options, function(responseText) {    var headers = JSON.parse(responseText).headers;    t.equals(      headers["X-Requested-With"],      "XMLHttpRequest",      "X-Requested-With header is set correctly"    );    // Httpbin.org changes the case to 'X-Pjax'    t.equals(headers["X-Pjax"], "true", "X-PJAX header is set correctly");    t.equals(      headers["X-Pjax-Selectors"],      '["div.pjax","div.container"]',      "X-PJAX-Selectors header is set correctly"    );    t.end();  });});tape("HTTP status codes other than 200 are handled properly", function(t) {  var url = "https://httpbin.org/status/400";  sendRequest(url, {}, function(responseText, request) {    t.equals(responseText, null, "responseText is null");    t.equals(request.status, 400, "HTTP status code is correct");    t.end();  });});tape.skip("XHR error is handled properly", function(t) {  var url = "https://encrypted.google.com/foobar";  sendRequest(url, {}, function(responseText) {    t.equals(responseText, null, "responseText is null");    t.end();  });});tape("POST body data is sent properly", function(t) {  var url = "https://httpbin.org/post";  var params = [    {      name: "test",      value: "1"    }  ];  var options = {    requestOptions: {      requestMethod: "POST",      requestParams: params    }  };  sendRequest(url, options, function(responseText) {    var response = JSON.parse(responseText);    t.same(      response.form[params[0].name],      params[0].value,      "requestParams were sent properly"    );    t.equals(      response.headers["Content-Type"],      "application/x-www-form-urlencoded",      "Content-Type header was set properly"    );    t.end();  });});tape("GET query data is sent properly", function(t) {  var url = "https://httpbin.org/get";  var params = [    {      name: "test",      value: "1"    }  ];  var options = {    requestOptions: {      requestParams: params    }  };  sendRequest(url, options, function(responseText) {    var response = JSON.parse(responseText);    t.same(      response.args[params[0].name],      params[0].value,      "requestParams were sent properly"    );    t.end();  });});tape("XHR timeout is handled properly", function(t) {  var url = "https://httpbin.org/delay/5";  var options = {    timeout: 1000  };  sendRequest(url, options, function(responseText) {    t.equals(responseText, null, "responseText is null");    t.end();  });});]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/lib/pjax/tests/lib/switches.js"/>
      <url>/lib/pjax/tests/lib/switches.js</url>
      
        <content type="html"><![CDATA[var tape = require("tape");var switches = require("../../lib/switches");var noop = require("../../lib/util/noop");tape("test outerHTML switch", function(t) {  var outerHTML = switches.outerHTML;  var doc = document.implementation.createHTMLDocument();  var container = doc.createElement("div");  container.innerHTML = "<p id="p">Original Text</p>";  doc.body.appendChild(container);  var p = doc.createElement("p");  p.innerHTML = "New Text";  outerHTML.bind({    onSwitch: noop  })(doc.querySelector("p"), p);  t.equals(    doc.querySelector("p").innerHTML,    "New Text",    "Elements correctly switched"  );  t.notEquals(    doc.querySelector("p").id,    "p",    "other attributes overwritten correctly"  );  t.end();});tape("test innerHTML switch", function(t) {  var innerHTML = switches.innerHTML;  var doc = document.implementation.createHTMLDocument();  var container = doc.createElement("div");  container.innerHTML = "<p id="p">Original Text</p>";  doc.body.appendChild(container);  var p = doc.createElement("p");  p.innerHTML = "New Text";  p.className = "p";  innerHTML.bind({    onSwitch: noop  })(doc.querySelector("p"), p);  t.equals(    doc.querySelector("p").innerHTML,    "New Text",    "Elements correctly switched"  );  t.equals(doc.querySelector("p").className, "p", "classname set correctly");  t.equals(doc.querySelector("p").id, "p", "other attributes set correctly");  p.removeAttribute("class");  innerHTML.bind({    onSwitch: noop  })(doc.querySelector("p"), p);  t.equals(doc.querySelector("p").className, "", "classname set correctly");  t.end();});tape("test replaceNode switch", function(t) {  var replaceNode = switches.replaceNode;  var doc = document.implementation.createHTMLDocument();  var container = doc.createElement("div");  container.innerHTML = "<p>Original Text</p>";  doc.body.appendChild(container);  var p = doc.createElement("p");  p.innerHTML = "New Text";  replaceNode.bind({    onSwitch: noop  })(doc.querySelector("p"), p);  t.equals(    doc.querySelector("div").innerHTML,    "<p>New Text</p>",    "Elements correctly switched"  );  t.end();});]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/lib/pjax/tests/lib/switch-selectors.js"/>
      <url>/lib/pjax/tests/lib/switch-selectors.js</url>
      
        <content type="html"><![CDATA[var tape = require("tape");var switchesSelectors = require("../../lib/switches-selectors.js");var noop = require("../../lib/util/noop");var pjax = {  onSwitch: function() {    console.log("Switched");  },  state: {},  log: noop};// @author darylteotape("test switchesSelectors", function(t) {  // switchesSelectors relies on a higher level function callback  // should really be passed in instead so I'll leave it here as a TODO:  var tmpEl = document.implementation.createHTMLDocument();  // a div container is used because swapping the containers  // will generate a new element, so things get weird  // using "body" generates a lot of testling cruft that I don't  // want so let's avoid that  var container = document.createElement("div");  container.innerHTML = "<p>Original Text</p><span>No Change</span>";  document.body.appendChild(container);  var container2 = tmpEl.createElement("div");  container2.innerHTML = "<p>New Text</p><span>New Span</span>";  tmpEl.body.appendChild(container2);  switchesSelectors.bind(pjax)(    {}, // switches    {}, // switchesOptions    ["p"], // selectors,    tmpEl, // fromEl    document, // toEl,    {} // options  );  t.equals(    container.innerHTML,    "<p>New Text</p><span>No Change</span>",    "Elements correctly switched"  );  t.end();});tape("test switchesSelectors when number of elements don't match", function(t) {  var newTempDoc = document.implementation.createHTMLDocument();  var originalTempDoc = document.implementation.createHTMLDocument();  // a div container is used because swapping the containers  // will generate a new element, so things get weird  // using "body" generates a lot of testling cruft that I don't  // want so let's avoid that  var container = originalTempDoc.createElement("div");  container.innerHTML = "<p>Original text</p><span>No change</span>";  originalTempDoc.body.appendChild(container);  var container2 = newTempDoc.createElement("div");  container2.innerHTML =    "<p>New text</p><p>More new text</p><span>New span</span>";  newTempDoc.body.appendChild(container2);  var switchSelectorsFn = switchesSelectors.bind(    pjax,    {}, // switches    {}, // switchesOptions    ["p"], // selectors,    newTempDoc, // fromEl    originalTempDoc, // toEl,    {} // options  );  t.throws(    switchSelectorsFn,    null,    "error was thrown properly since number of elements don't match"  );  t.end();});]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/lib/pjax/tests/lib/parse-options.js"/>
      <url>/lib/pjax/tests/lib/parse-options.js</url>
      
        <content type="html"><![CDATA[var tape = require("tape");var parseOptions = require("../../lib/parse-options.js");tape("test parse initalization options function", function(t) {  t.test("- default options", function(t) {    var pjax = {};    pjax.options = parseOptions({});    t.equal(pjax.options.elements, "a[href], form[action]");    t.equal(pjax.options.selectors.length, 2, "selectors length");    t.equal(pjax.options.selectors[0], "title");    t.equal(pjax.options.selectors[1], ".js-Pjax");    t.equal(typeof pjax.options.switches, "object");    t.equal(Object.keys(pjax.options.switches).length, 2); // head and body    t.equal(typeof pjax.options.switchesOptions, "object");    t.equal(Object.keys(pjax.options.switchesOptions).length, 0);    t.equal(pjax.options.history, true);    t.equal(typeof pjax.options.analytics, "function");    t.equal(pjax.options.scrollTo, 0);    t.equal(pjax.options.scrollRestoration, true);    t.equal(pjax.options.cacheBust, true);    t.equal(pjax.options.debug, false);    t.equal(pjax.options.currentUrlFullReload, false);    t.end();  });  // verify analytics always ends up as a function even when passed not a function  t.test("- analytics is a function", function(t) {    var pjax = {};    pjax.options = parseOptions({ analytics: "some string" });    t.deepEqual(typeof pjax.options.analytics, "function");    t.end();  });  // verify that the value false for scrollTo is not squashed  t.test("- scrollTo remains false", function(t) {    var pjax = {};    pjax.options = parseOptions({ scrollTo: false });    t.deepEqual(pjax.options.scrollTo, false);    t.end();  });  t.end();});]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/lib/pjax/tests/lib/uniqueid.js"/>
      <url>/lib/pjax/tests/lib/uniqueid.js</url>
      
        <content type="html"><![CDATA[var tape = require("tape");var uniqueid = require("../../lib/uniqueid.js");tape("test uniqueid", function(t) {  var a = uniqueid();  var b = uniqueid();  t.notEqual(a, b, "Two calls to uniqueid produce different values");  t.end();});]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/lib/pjax/tests/lib/proto/attach-form.js"/>
      <url>/lib/pjax/tests/lib/proto/attach-form.js</url>
      
        <content type="html"><![CDATA[var tape = require("tape");var on = require("../../../lib/events/on");var trigger = require("../../../lib/events/trigger");var attachForm = require("../../../lib/proto/attach-form");var attr = "data-pjax-state";tape("test attach form prototype method", function(t) {  var form = document.createElement("form");  var loadUrlCalled = false;  attachForm.call(    {      options: {        currentUrlFullReload: true      },      loadUrl: function() {        loadUrlCalled = true;      }    },    form  );  var internalUri =    window.location.protocol +    "//" +    window.location.host +    window.location.pathname +    window.location.search;  form.action = "http://external.com/";  trigger(form, "submit");  t.equal(form.getAttribute(attr), "external", "external url stop behavior");  form.action = internalUri + "#anchor";  trigger(form, "submit");  t.equal(form.getAttribute(attr), "anchor", "internal anchor stop behavior");  window.location.hash = "#anchor";  form.action = internalUri + "#another-anchor";  trigger(form, "submit");  t.equal(form.getAttribute(attr), "anchor", "different anchors stop behavior");  window.location.hash = "";  form.action = internalUri + "#";  trigger(form, "submit");  t.equal(    form.getAttribute(attr),    "anchor-empty",    "empty anchor stop behavior"  );  form.action = window.location.href;  trigger(form, "submit");  t.equal(    form.getAttribute(attr),    "reload",    "submitting when currentUrlFullReload is true will submit normally, without XHR"  );  t.equal(loadUrlCalled, false, "loadUrl() not called");  form.action =    window.location.protocol + "//" + window.location.host + "/internal";  form.method = "POST";  trigger(form, "submit");  t.equal(    form.getAttribute(attr),    "submit",    "triggering a POST request to the next page"  );  t.equal(loadUrlCalled, true, "loadUrl() called correctly");  loadUrlCalled = false;  form.setAttribute(attr, "");  form.action =    window.location.protocol + "//" + window.location.host + "/internal";  form.method = "GET";  trigger(form, "submit");  t.equal(    form.getAttribute(attr),    "submit",    "triggering a GET request to the next page"  );  t.equal(loadUrlCalled, true, "loadUrl() called correctly");  t.end();});tape("test attach form preventDefaulted events", function(t) {  var loadUrlCalled = false;  var form = document.createElement("form");  // This needs to be before the call to attachForm()  on(form, "submit", function(event) {    event.preventDefault();  });  attachForm.call(    {      options: {},      loadUrl: function() {        loadUrlCalled = true;      }    },    form  );  form.action = "#";  trigger(form, "submit");  t.equal(    loadUrlCalled,    false,    "events that are preventDefaulted should not fire callback"  );  t.end();});tape("test options are not modified by attachForm", function(t) {  var form = document.createElement("form");  var options = { foo: "bar" };  var loadUrl = function() {};  attachForm.call({ options: options, loadUrl: loadUrl }, form);  form.action =    window.location.protocol +    "//" +    window.location.host +    window.location.pathname +    window.location.search;  form.method = "GET";  trigger(form, "submit");  t.equal(    1,    Object.keys(options).length,    "options object that is passed in should not be modified"  );  t.equal(    "bar",    options.foo,    "options object that is passed in should not be modified"  );  t.end();});tape("test form elements parsed correctly", function(t) {  t.plan(1);  var form = document.createElement("form");  var input = document.createElement("input");  input.name = "input";  input.value = "value";  form.appendChild(input);  var params = [    {      name: "input",      value: "value"    }  ];  var pjax = {    options: {},    loadUrl: function(href, options) {      t.same(        options.requestOptions.requestParams,        params,        "form elements parsed correctly"      );    }  };  attachForm.call(pjax, form);  form.action =    window.location.protocol + "//" + window.location.host + "/internal";  trigger(form, "submit");  // see loadUrl defined above  t.end();});tape('test form.enctype="multipart/form-data"', function(t) {  t.plan(4);  var form = document.createElement("form");  form.enctype = "multipart/form-data";  var input = document.createElement("input");  input.name = "input";  input.value = "value";  form.appendChild(input);  var pjax = {    options: {},    loadUrl: function(href, options) {      t.equals(        options.requestOptions.requestParams,        undefined,        "form elements not parsed manually"      );      t.true(        options.requestOptions.formData instanceof FormData,        "requestOptions.formData is a FormData"      );      t.equals(        Array.from(options.requestOptions.formData.entries()).length,        1,        "correct number of FormData elements"      );      t.equals(        options.requestOptions.formData.get("input"),        "value",        "FormData element value set correctly"      );    }  };  attachForm.call(pjax, form);  form.action =    window.location.protocol + "//" + window.location.host + "/internal";  trigger(form, "submit");  // see loadUrl defined above  t.end();});]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/lib/pjax/tests/lib/proto/parse-element.js"/>
      <url>/lib/pjax/tests/lib/proto/parse-element.js</url>
      
        <content type="html"><![CDATA[var tape = require("tape");var parseElement = require("../../../lib/proto/parse-element");var pjax = {  attachLink: function() {    return true;  },  attachForm: function() {    return true;  }};tape("test parse element prototype method", function(t) {  t.doesNotThrow(function() {    var a = document.createElement("a");    parseElement.call(pjax, a);  }, "<a> element can be parsed");  t.doesNotThrow(function() {    var form = document.createElement("form");    parseElement.call(pjax, form);  }, "<form> element can be parsed");  t.throws(function() {    var el = document.createElement("div");    parseElement.call(pjax, el);  }, "<div> element cannot be parsed");  t.end();});</div></form></a>]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/lib/pjax/tests/lib/proto/attach-link.js"/>
      <url>/lib/pjax/tests/lib/proto/attach-link.js</url>
      
        <content type="html"><![CDATA[var tape = require("tape");var on = require("../../../lib/events/on");var trigger = require("../../../lib/events/trigger");var attachLink = require("../../../lib/proto/attach-link");var attr = "data-pjax-state";tape("test attach link prototype method", function(t) {  var a = document.createElement("a");  var loadUrlCalled = false;  attachLink.call(    {      options: {},      loadUrl: function() {        loadUrlCalled = true;      }    },    a  );  var internalUri =    window.location.protocol +    "//" +    window.location.host +    window.location.pathname +    window.location.search;  a.href = internalUri;  trigger(a, "click", { metaKey: true });  t.equal(a.getAttribute(attr), "modifier", "event key modifier stop behavior");  a.href = "http://external.com/";  trigger(a, "click");  t.equal(a.getAttribute(attr), "external", "external url stop behavior");  window.location.hash = "#anchor";  a.href = internalUri + "#anchor";  trigger(a, "click");  t.equal(a.getAttribute(attr), "anchor", "internal anchor stop behavior");  a.href = internalUri + "#another-anchor";  trigger(a, "click");  t.equal(a.getAttribute(attr), "anchor", "different anchors stop behavior");  window.location.hash = "";  a.href = internalUri + "#";  trigger(a, "click");  t.equal(a.getAttribute(attr), "anchor-empty", "empty anchor stop behavior");  a.href = window.location.protocol + "//" + window.location.host + "/internal";  trigger(a, "click");  t.equals(    a.getAttribute(attr),    "load",    "triggering an internal link sets the state attribute to 'load'"  );  t.equals(    loadUrlCalled,    true,    "triggering an internal link actually loads the page"  );  t.end();});tape("test attach link preventDefaulted events", function(t) {  var loadUrlCalled = false;  var a = document.createElement("a");  // This needs to be before the call to attachLink()  on(a, "click", function(event) {    event.preventDefault();  });  attachLink.call(    {      options: {},      loadUrl: function() {        loadUrlCalled = true;      }    },    a  );  a.href = "#";  trigger(a, "click");  t.equal(    loadUrlCalled,    false,    "events that are preventDefaulted should not fire callback"  );  t.end();});tape("test options are not modified by attachLink", function(t) {  var a = document.createElement("a");  var options = { foo: "bar" };  var loadUrl = function() {};  attachLink.call({ options: options, loadUrl: loadUrl }, a);  a.href =    window.location.protocol +    "//" +    window.location.host +    window.location.pathname +    window.location.search;  trigger(a, "click");  t.equal(    1,    Object.keys(options).length,    "options object that is passed in should not be modified"  );  t.equal(    "bar",    options.foo,    "options object that is passed in should not be modified"  );  t.end();});tape("test link triggered by keyboard", function(t) {  var a = document.createElement("a");  var pjax = {    options: {},    loadUrl: function() {      t.equal(        a.getAttribute(attr),        "load",        "triggering a internal link actually loads the page"      );    }  };  t.plan(3);  attachLink.call(pjax, a);  a.href = window.location.protocol + "//" + window.location.host + "/internal";  trigger(a, "keyup", { keyCode: 14 });  t.equal(    a.getAttribute(attr),    "",    "keycode other than 13 doesn't trigger anything"  );  trigger(a, "keyup", { keyCode: 13, metaKey: true });  t.equal(a.getAttribute(attr), "modifier", "event key modifier stop behavior");  trigger(a, "keyup", { keyCode: 13 });  // see loadUrl defined above  t.end();});tape(  "test link with the same URL as the current one, when currentUrlFullReload set to true",  function(t) {    var a = document.createElement("a");    var pjax = {      options: {        currentUrlFullReload: true      },      reload: function() {        t.pass("this.reload() was called correctly");      },      loadUrl: function() {        t.fail("loadUrl() was called wrongly");      }    };    t.plan(2);    attachLink.call(pjax, a);    a.href = window.location.href;    trigger(a, "click");    t.equal(a.getAttribute(attr), "reload", "reload stop behavior");    t.end();  });]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/lib/pjax/tests/lib/proto/handle-response.js"/>
      <url>/lib/pjax/tests/lib/proto/handle-response.js</url>
      
        <content type="html"><![CDATA[var tape = require("tape");var handleResponse = require("../../../lib/proto/handle-response");var noop = require("../../../lib/util/noop");var loadContent = require("../../../index").prototype.loadContent;var href = "https://example.org/";var storeEventHandler;var pjaxErrorEventTriggerTest;tape("test events triggered when handleResponse(false) is called", function(t) {  t.plan(3);  var pjax = {    options: {      test: 1    }  };  var events = [];  storeEventHandler = function(e) {    events.push(e.type);    t.equal(e.test, 1);  };  document.addEventListener("pjax:complete", storeEventHandler);  document.addEventListener("pjax:error", storeEventHandler);  handleResponse.bind(pjax)(false, null);  t.same(    events,    ["pjax:complete", "pjax:error"],    "calling handleResponse(false) triggers 'pjax:complete' and 'pjax:error'"  );  document.removeEventListener("pjax:complete", storeEventHandler);  document.removeEventListener("pjax:error", storeEventHandler);  t.end();});tape("test when handleResponse() is called normally", function(t) {  var pjax = {    options: {      test: 1    },    loadContent: noop,    state: {}  };  var request = {    getResponseHeader: noop  };  handleResponse.bind(pjax)("", request, "href");  delete window.history.state.uid;  t.same(    window.history.state,    {      url: href,      title: "",      scrollPos: [0, 0]    },    "window.history.state is set correctly"  );  t.equals(pjax.state.href, "href", "this.state.href is set correctly");  t.equals(    Object.keys(pjax.state.options).length,    2,    "this.state.options is set correctly"  );  t.same(    pjax.state.options.request,    request,    "this.state.options is set correctly"  );  t.equals(pjax.state.options.test, 1, "this.state.options is set correctly");  t.end();});tape(  "test when handleResponse() is called normally with request.responseURL",  function(t) {    var pjax = {      options: {},      loadContent: noop,      state: {}    };    var request = {      responseURL: href + "1",      getResponseHeader: noop    };    handleResponse.bind(pjax)("", request, "");    t.equals(      pjax.state.href,      request.responseURL,      "this.state.href is set correctly"    );    t.end();  });tape("test when handleResponse() is called normally with X-PJAX-URL", function(  t) {  var pjax = {    options: {},    loadContent: noop,    state: {}  };  var request = {    getResponseHeader: function(header) {      if (header === "X-PJAX-URL") {        return href + "2";      }    }  };  handleResponse.bind(pjax)("", request, "");  t.equals(pjax.state.href, href + "2", "this.state.href is set correctly");  t.end();});tape(  "test when handleResponse() is called normally with X-XHR-Redirected-To",  function(t) {    var pjax = {      options: {},      loadContent: noop,      state: {}    };    var request = {      getResponseHeader: function(header) {        if (header === "X-XHR-Redirected-To") {          return href + "3";        }      }    };    handleResponse.bind(pjax)("", request, "");    t.equals(pjax.state.href, href + "3", "this.state.href is set correctly");    t.end();  });tape("test when handleResponse() is called normally with a hash", function(t) {  var pjax = {    options: {},    loadContent: noop,    state: {}  };  var request = {    responseURL: href + "2",    getResponseHeader: noop  };  handleResponse.bind(pjax)("", request, href + "1#test");  t.equals(    pjax.state.href,    href + "2#test",    "this.state.href is set correctly"  );  t.end();});tape("test try...catch for loadContent() when options.debug is true", function(  t) {  t.plan(2);  var pjax = {    options: {},    loadContent: noop,    state: {}  };  var request = {    getResponseHeader: noop  };  pjax.loadContent = function() {    throw new Error();  };  pjax.options.debug = true;  document.removeEventListener("pjax:error", storeEventHandler);  pjaxErrorEventTriggerTest = function() {    t.pass("pjax:error event triggered");  };  document.addEventListener("pjax:error", pjaxErrorEventTriggerTest);  t.throws(    function() {      handleResponse.bind(pjax)("", request, "");    },    Error,    "error is rethrown"  );  t.end();});tape("test try...catch for loadContent()", function(t) {  t.plan(2);  var pjax = {    options: {},    loadContent: noop,    state: {}  };  var request = {    getResponseHeader: noop  };  pjax.loadContent = function() {    throw new Error();  };  pjax.latestChance = function() {    return true;  };  pjax.options.debug = false;  document.removeEventListener("pjax:error", pjaxErrorEventTriggerTest);  t.doesNotThrow(    function() {      t.equals(        handleResponse.bind(pjax)("", request, ""),        true,        "this.latestChance() is called"      );    },    Error,    "error is not thrown"  );  t.end();});tape(  "test events triggered when loadContent() is called with a non-string html argument",  function(t) {    t.plan(3);    var options = {      test: 1    };    var events = [];    storeEventHandler = function(e) {      events.push(e.type);      t.equal(e.test, 1);    };    document.addEventListener("pjax:complete", storeEventHandler);    document.addEventListener("pjax:error", storeEventHandler);    loadContent(null, options);    t.same(      events,      ["pjax:complete", "pjax:error"],      "calling loadContent() with a non-string html argument triggers 'pjax:complete' and 'pjax:error'"    );    document.removeEventListener("pjax:complete", storeEventHandler);    document.removeEventListener("pjax:error", storeEventHandler);    t.end();  });]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/lib/pjax/tests/lib/util/clone.js"/>
      <url>/lib/pjax/tests/lib/util/clone.js</url>
      
        <content type="html"><![CDATA[var tape = require("tape");var clone = require("../../../lib/util/clone");tape("test clone method", function(t) {  var obj = { one: 1, two: 2 };  var cloned = clone(obj);  t.notEqual(obj, cloned, "cloned object isn't the original object");  t.same(obj, cloned, "cloned object has the same values as original object");  cloned.three = 3;  t.notSame(    obj,    cloned,    "modified cloned object doesn't have the same values as original object"  );  t.end();});]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/lib/pjax/tests/lib/util/contains.js"/>
      <url>/lib/pjax/tests/lib/util/contains.js</url>
      
        <content type="html"><![CDATA[var tape = require("tape");var contains = require("../../../lib/util/contains.js");tape("test contains function", function(t) {  var tempDoc = document.implementation.createHTMLDocument();  tempDoc.body.innerHTML =    "<div><p id="el" class="js-Pjax"></p></div><span></span>";  var selectors = ["div"];  var el = tempDoc.body.querySelector("#el");  t.equal(    contains(tempDoc, selectors, el),    true,    "contains() returns true when a selector contains the element"  );  selectors = ["span"];  t.equal(    contains(tempDoc, selectors, el),    false,    "contains() returns false when the selectors do not contain the element"  );  t.end();});]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/lib/pjax/tests/lib/util/extend.js"/>
      <url>/lib/pjax/tests/lib/util/extend.js</url>
      
        <content type="html"><![CDATA[var tape = require("tape");var extend = require("../../../lib/util/extend");tape("test extend method", function(t) {  var obj = { one: 1, two: 2 };  var extended = extend({}, obj, { two: "two", three: 3 });  t.notEqual(obj, extended, "extended object isn't the original object");  t.notSame(    obj,    extended,    "extended object doesn't have the same values as original object"  );  t.notSame(    obj.two,    extended.two,    "extended object value overwrites value from original object"  );  extended = extend(null);  t.equals(extended, null, "passing null returns null");  t.end();});]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/lib/pjax/tests/lib/util/noop.js"/>
      <url>/lib/pjax/tests/lib/util/noop.js</url>
      
        <content type="html"><![CDATA[var tape = require("tape");var noop = require("../../../lib/util/noop");tape("test noop function", function(t) {  t.equal(typeof noop, "function", "noop is a function");  t.equal(noop(), undefined, "noop() returns nothing");  t.end();});]]></content>
      
    </entry>
    
    
    
    <entry>
      <title></title>
      <link href="/lib/pjax/tests/lib/util/update-query-string.js"/>
      <url>/lib/pjax/tests/lib/util/update-query-string.js</url>
      
        <content type="html"><![CDATA[var tape = require("tape");var updateQueryString = require("../../../lib/util/update-query-string");tape("test update query string method", function(t) {  var url = "http://example.com";  var updatedUrl = updateQueryString(url, "foo", "bar");  t.notEqual(url, updatedUrl, "update query string modifies URL");  t.equal(    updatedUrl,    url + "?foo=bar",    "update query string creates new query string when no query string params are set"  );  updatedUrl = updateQueryString(updatedUrl, "foo", "baz");  t.equal(    updatedUrl,    url + "?foo=baz",    "update query string updates existing query string param"  );  updatedUrl = updateQueryString(updatedUrl, "bar", "");  t.equal(    updatedUrl,    url + "?foo=baz&bar=",    "update query string appends to existing query string"  );  t.end();});]]></content>
      
    </entry>
    
    
  
</search>
